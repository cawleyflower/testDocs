<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting Date and Time | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/docs/Cumulus-Linux/">
    Cumulus Linux</a> 
  <ul>
    

    
    <li>
      <a href="/docs/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/docs/Cumulus-Linux/system-config/Setting_Date_and_Time/" class="active">Setting Date and Time</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/docs/NetQ/">
    Net Q</a> 
  <ul>
    
    <li><a href="/docs/NetQ/deployment_guide/">
    Deployment Guide</a> 
  <ul>
    

    
    <li>
      <a href="/docs/NetQ/deployment_guide/config_optional_netq/Configuring_Optional_NetQ_Capabilities/">Configuring Optional Net Q Capabilities</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/deployment_guide/deployment_preface/Deployment_Preface/">Deployment Preface</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/deployment_guide/install_netq/Install_NetQ/">Install Net Q</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/deployment_guide/maintain_netq/Maintain_NetQ/">Maintain Net Q</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/deployment_guide/netq_primer/Cumulus_NetQ_Primer/">Cumulus Net Q Primer</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/docs/NetQ/Cumulus_NetQ_CLI_User_Guide/">Cumulus Net Q C L I User Guide</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/Release_Notes/Cumulus_NetQ_2.0_Release_Notes/">Cumulus Net Q 2.0 Release Notes</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/Cumulus_NetQ_UI_User_Guide/">Cumulus Net Q U I User Guide</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_switches/Monitor_Switches/">Monitor Switches</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_the_network/Monitor_the_Network/">Monitor the Network</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_the_network/monitor_alarm_events/Monitor_Alarm_Events/">Monitor Alarm Events</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_the_network/monitor_informational_events/Monitor_Informational_Events/">Monitor Informational Events</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_the_network/monitor_network_health/Monitor_Network_Health/">Monitor Network Health</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_the_network/monitor_network_inventory/Monitor_Network_Inventory/">Monitor Network Inventory</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/monitor_the_network/monitor_network_protocols/Monitor_Network_Layer_Protocols/">Monitor Network Layer Protocols</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/netq_ui_overview/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/UI_User_Guide/ui_preface/UI_Preface/">U I Preface</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/CLI_Preface/CLI_Preface/">C L I Preface</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/automate_common_tasks/Automate_Common_and_Repetitive_Tasks/">Automate Common and Repetitive Tasks</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/command_line_overview/NetQ_Command_Line_Overview/">Net Q Command Line Overview</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_containter_environments/Monitor_Container_Environments/">Monitor Container Environments</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_data_link_layer/Monitor_Data_Link_Layer_Devices_and_Protocols/">Monitor Data Link Layer Devices and Protocols</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_linux_hosts/Monitor_Linux_Hosts/">Monitor Linux Hosts</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_network_health/Monitor_Overall_Network_Health/">Monitor Overall Network Health</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_network_layer/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_physical_layer/Monitor_Physical_Layer_Components/">Monitor Physical Layer Components</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_switch_hardware/Monitor_Switch_Hardware_and_Software/">Monitor Switch Hardware and Software</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/monitor_virtual_overlays/Monitor_Virtual_Network_Overlays/">Monitor Virtual Network Overlays</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/resolve_issues/Resolve_Issues/">Resolve Issues</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/resolve_issues/Resolve_MLAG_Issues/">Resolve M L a G Issues</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/resolve_issues/investiage_netq_issues/Investigate_NetQ_Issues/">Investigate Net Q Issues</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/cli_user_guide/resolve_issues/methods_for_diagnosing_issues/Methods_for_Diagnosing_Network_Issues/">Methods for Diagnosing Network Issues</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/getting_started/Getting_Started_with_the_Cumulus_NetQ_Appliance/">Getting Started With the Cumulus Net Q Appliance</a>
    </li>
    
    <li>
      <a href="/docs/NetQ/software_installation_guide/Cumulus_NetQ_Appliance_Software_Installation_Guide/">Cumulus Net Q Appliance Software Installation Guide</a>
    </li>
    
  </ul>

    </li>
    

    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Setting Date and Time</strong>
</header>

      
<article class="markdown">

<h1 id="setting-date-and-time">Setting Date and Time</h1>

<p>Setting the time zone, date and time requires root privileges;
use <code>sudo</code>.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#SettingDateandTime-SettheTimeZone">Set the Time Zone</a>

<ul>
<li><a href="#SettingDateandTime-Editthe/etc/timezoneFile">Edit
the /etc/timezone File</a></li>
<li><a href="#SettingDateandTime-UsetheGuidedWizard">Use the Guided Wizard</a></li>
</ul></li>
<li><a href="#SettingDateandTime-SettheDateandTime">Set the Date and Time</a></li>
<li><a href="#SettingDateandTime-SettheTimeUsingNTPandNCLU">Set the Time Using NTP and
NCLU</a></li>
<li><a href="#SettingDateandTime-SpecifytheNTPSourceInterface">Specify the NTP Source
Interface</a></li>
<li><a href="#SettingDateandTime-NTPDefaultConfiguration">NTP Default
Configuration</a></li>
<li><a href="#SettingDateandTime-PTPPrecisionTimeProtocol(PTP)BoundaryClock">Precision Time Protocol (PTP) Boundary
Clock</a>

<ul>
<li><a href="#SettingDateandTime-EnablethePTPBoundaryClockontheSwitch">Enable the PTP Boundary Clock on the
Switch</a></li>
<li><a href="#SettingDateandTime-ConfigurethePTPBoundaryClock">Configure the PTP Boundary
Clock</a></li>
<li><a href="#SettingDateandTime-ExampleConfiguration">Example
Configuration</a></li>
<li><a href="#SettingDateandTime-VerifyPTPBoundaryClockConfiguration">Verify PTP Boundary Clock
Configuration</a></li>
<li><a href="#SettingDateandTime-ViewPTPStatusInformation">View PTP Status
Information</a></li>
<li><a href="#SettingDateandTime-DeletePTPBoundaryClockConfiguration">Delete PTP Boundary Clock
Configuration</a></li>
</ul></li>
<li><a href="#SettingDateandTime-UseNTPinaDHCPEnvironment">Use NTP in a DHCP
Environment</a></li>
<li><a href="#SettingDateandTime-RelatedInformation">Related Information</a></li>
</ul>

<h2 id="set-the-time-zone">Set the Time Zone</h2>

<p>You can use one of two methods to set the time zone on the switch:</p>

<ul>
<li>Edit the <code>/etc/timezone</code> file.</li>
<li>Use the guided wizard.</li>
</ul>

<h3 id="edit-the-etc-timezone-file">Edit the <code>/etc/timezone</code> File</h3>

<p>To see the current time zone, list the contents of <code>/etc/timezone</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ cat /etc/timezone
US/Eastern</code></pre></div>
<p>Edit the file to add your desired time zone. A list of valid time zones
can be found at the
following <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">link</a>.</p>

<p>Use the following command to apply the new time zone immediately.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo dpkg-reconfigure --frontend noninteractive tzdata</code></pre></div>
<h3 id="use-the-guided-wizard">Use the Guided Wizard</h3>

<p>To set the time zone using the guided wizard,
run  <code>dpkg-reconfigure tzdata</code> as root:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo dpkg-reconfigure tzdata</code></pre></div>
<p>Then navigate the menus to enable the time zone you want. The following
example selects the US/Pacific time zone:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo dpkg-reconfigure tzdata

Configuring tzdata
------------------

Please select the geographic area in which you live. Subsequent configuration
questions will narrow this down by presenting a list of cities, representing
the time zones in which they are located.

  1. Africa      4. Australia  7. Atlantic  10. Pacific  13. Etc
  2. America     5. Arctic     8. Europe    11. SystemV
  3. Antarctica  6. Asia       9. Indian    12. US
Geographic area: 12

Please select the city or region corresponding to your time zone.

  1. Alaska    4. Central  7. Indiana-Starke  10. Pacific
  2. Aleutian  5. Eastern  8. Michigan        11. Pacific-New
  3. Arizona   6. Hawaii   9. Mountain        12. Samoa
Time zone: 10

Current default time zone: &#39;US/Pacific&#39;
Local time is now:      Mon Jun 17 09:27:45 PDT 2013.
Universal Time is now:  Mon Jun 17 16:27:45 UTC 2013.</code></pre></div>
<p>For more info see the Debian <a href="http://www.debian.org/doc/manuals/system-administrator/ch-sysadmin-time.html">System Administrator’s Manual –
Time</a>.</p>

<h2 id="set-the-date-and-time">Set the Date and Time</h2>

<p>The switch contains a battery backed hardware clock that maintains the
time while the switch is powered off and in between reboots. When the
switch is running, the Cumulus Linux operating system maintains its own
software clock.</p>

<p>During boot up, the time from the hardware clock is copied into the
operating system’s software clock. The software clock is then used for
all timekeeping responsibilities. During system shutdown, the software
clock is copied back to the battery backed hardware clock.</p>

<p>You can set the date and time on the software clock using
the <code>date</code> command. First, determine your current time zone:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch$ date +%Z</code></pre></div>
<p>If you need to reconfigure the current time zone, refer to the
instructions above.</p>

<p>Then, to set the system clock according to the time zone configured:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch$ sudo date -s &#34;Tue Jan 12 00:37:13 2016&#34;</code></pre></div>
<p>See <code>man date(1)</code> for more information.</p>

<p>You can write the current value of the system (software) clock to the
hardware clock using the  <code>hwclock</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch$ sudo hwclock -w</code></pre></div>
<p>See <code>man hwclock(8)</code> for more information.</p>

<p>You can find a good overview of the software and hardware clocks in the
Debian <a href="http://www.debian.org/doc/manuals/system-administrator/ch-sysadmin-time.html">System Administrator&rsquo;s Manual –
Time</a>,
specifically the section <a href="http://www.debian.org/doc/manuals/system-administrator/ch-sysadmin-time.html#s16.2">Setting and showing hardware
clock</a>.</p>

<h2 id="set-the-time-using-ntp-and-nclu">Set the Time Using NTP and NCLU</h2>

<p>The  <code>ntpd</code> daemon running on the switch implements the NTP protocol. It
synchronizes the system time with time servers listed
in <code>/etc/ntp.conf</code>. The <code>ntpd</code> daemon is started at boot by default.
See <code>man ntpd(8)</code> for <code>ntpd</code> details. You can check <a href="http://nlug.ml1.co.uk/2012/01/ntpq-p-output/831">this
site</a> for an
explanation of the output.</p>

<p>By default, <code>/etc/ntp.conf</code> contains some default time servers. You can
specify the NTP server or servers you want to use
with <a href="Network_Command_Line_Utility_-_NCLU">NCLU</a>; include
the <code>iburst</code> option to increase the sync speed.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add time ntp server 4.cumulusnetworks.pool.ntp.org iburst
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands add the NTP server to the list of servers
in <code>/etc/ntp.conf</code>: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"># pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will
# pick a different set every time it starts up.  Please consider joining the
# pool: &lt;http://www.pool.ntp.org/join.html&gt;
server 0.cumulusnetworks.pool.ntp.org iburst
server 1.cumulusnetworks.pool.ntp.org iburst
server 2.cumulusnetworks.pool.ntp.org iburst
server 3.cumulusnetworks.pool.ntp.org iburst
server 4.cumulusnetworks.pool.ntp.org iburst</code></pre></div>
<p>To set the initial date and time via NTP before starting
the <code>ntpd</code> daemon, use <code>ntpd -q</code>. This is the same as <code>ntpdate</code>, which
is to be retired and no longer available. See <code>man ntp.conf(5)</code> for
details on configuring <code>ntpd</code> using <code>ntp.conf</code>.</p>

<p><code>ntpd -q</code> can hang if the time servers are not reachable.</p>

<p>To verify that <code>ntpd</code> is running on the system:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ps -ef | grep ntp
ntp       4074     1  0 Jun20 ?        00:00:33 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 101:102</code></pre></div>
<p>To check the NTP peer status:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show time ntp servers 
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
+minime.fdf.net  58.180.158.150   3 u  140 1024  377   55.659    0.339   1.464
+69.195.159.158  128.138.140.44   2 u  259 1024  377   41.587    1.011   1.677
*chl.la          216.218.192.202  2 u  210 1024  377    4.008    1.277   1.628
+vps3.drown.org  17.253.2.125     2 u  743 1024  377   39.319   -0.316   1.384</code></pre></div>
<p>To remove one or more NTP servers:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net del time ntp server 0.cumulusnetworks.pool.ntp.org iburst
cumulus@switch:~$ net del time ntp server 1.cumulusnetworks.pool.ntp.org iburst
cumulus@switch:~$ net del time ntp server 2.cumulusnetworks.pool.ntp.org iburst
cumulus@switch:~$ net del time ntp server 3.cumulusnetworks.pool.ntp.org iburst
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h2 id="specify-the-ntp-source-interface">Specify the NTP Source Interface</h2>

<p>You can change the source interface that NTP uses if you want to use an
interface other than eth0, which is the default. </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add time ntp source swp10
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration snippet in
the <code>ntp.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">...
 
# Specify interfaces
interface listen swp10

...</code></pre></div>
<h2 id="ntp-default-configuration">NTP Default Configuration</h2>

<p>The default NTP configuration comprises the following servers, which are
listed in the <code>/etc/ntpd.conf</code> file:</p>

<ul>
<li>server
<a href="http://0.cumulusnetworks.pool.ntp.org">0.cumulusnetworks.pool.ntp.org</a>
iburst</li>
<li>server
<a href="http://1.cumulusnetworks.pool.ntp.org">1.cumulusnetworks.pool.ntp.org</a>
iburst</li>
<li>server
<a href="http://2.cumulusnetworks.pool.ntp.org">2.cumulusnetworks.pool.ntp.org</a>
iburst</li>
<li>server
<a href="http://3.cumulusnetworks.pool.ntp.org">3.cumulusnetworks.pool.ntp.org</a>
iburst</li>
</ul>

<p>The contents of the <code>/etc/ntpd.conf</code> file are listed below.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Default
ntpd.conf file &hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"># /etc/ntp.conf, configuration for ntpd; see ntp.conf(5) for help

driftfile /var/lib/ntp/ntp.drift


# Enable this if you want statistics to be logged.
#statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable


# You do need to talk to an NTP server or two (or three).
#server ntp.your-provider.example

# pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will
# pick a different set every time it starts up.  Please consider joining the
# pool: &lt;http://www.pool.ntp.org/join.html&gt;
server 0.cumulusnetworks.pool.ntp.org iburst
server 1.cumulusnetworks.pool.ntp.org iburst
server 2.cumulusnetworks.pool.ntp.org iburst
server 3.cumulusnetworks.pool.ntp.org iburst


# Access control configuration; see /usr/share/doc/ntp-doc/html/accopt.html for
# details.  The web page &lt;http://support.ntp.org/bin/view/Support/AccessRestrictions&gt;
# might also be helpful.
#
# Note that &#34;restrict&#34; applies to both servers and clients, so a configuration
# that might be intended to block requests from certain clients could also end
# up blocking replies from your own upstream servers.

# By default, exchange time with everybody, but don&#39;t allow configuration.
restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod notrap nomodify nopeer noquery

# Local users may interrogate the ntp server more closely.
restrict 127.0.0.1
restrict ::1

# Clients from this (example!) subnet have unlimited access, but only if
# cryptographically authenticated.
#restrict 192.168.123.0 mask 255.255.255.0 notrust


# If you want to provide time to your local subnet, change the next line.
# (Again, the address is an example only.)
#broadcast 192.168.123.255

# If you want to listen to time broadcasts on your local subnet, de-comment the
# next lines.  Please do this only if you trust everybody on the network!
#disable auth
#broadcastclient

# Specify interfaces, don&#39;t listen on switch ports
interface listen eth0</code></pre></div>
<h2 id="precision-time-protocol-ptp-boundary-clock">Precision Time Protocol (PTP) Boundary Clock</h2>

<p>With the growth of low latency and high performance applications,
precision timing has become increasingly important. Precision Time
Protocol (PTP) is used to synchronize clocks in a network and is capable
of sub-microsecond accuracy. The clocks are organized in a master-slave
hierarchy. The slaves are synchronized to their masters, which can be
slaves to their own masters. The hierarchy is created and updated
automatically by the best master clock (BMC) algorithm, which runs on
every clock. The grandmaster clock is the top-level master and is
typically synchronized by using a Global Positioning System (GPS) time
source to provide a high-degree of accuracy.</p>

<p>A boundary clock has multiple ports; one or more master ports and one or
more slave ports. The master ports provide time (the time can originate
from other masters further up the hierarchy) and the slave ports receive
time. The boundary clock absorbs sync messages in the slave port, uses
that port to set its clock, then generates new sync messages from this
clock out of all of its master ports.</p>

<p>Cumulus Linux includes the <code>ptp4l</code> package for PTP, which uses
the <code>phc2sys</code> daemon to synchronize the PTP clock with the system
clock. </p>

<ul>
<li>Cumulus Linux currently supports PTP on the Mellanox Spectrum ASIC
only.</li>
<li>If you do not perform a full disk image install of Cumulus Linux 3.6
or later, you need to install the <code>ptp4l</code> package with
the <code>apt-get install ptp4l</code> command.</li>
<li>PTP is supported in boundary clock mode only (the switch provides
timing to downstream servers; it is a slave to a higher-level clock
and a master to downstream clocks).</li>
<li>The switch uses hardware time stamping to capture timestamps from an
Ethernet frame at the physical layer. This allows PTP to account for
delays in message transfer and greatly improves the accuracy of time
synchronization.</li>
<li>Only IPv4/UDP PTP packets are supported.</li>
<li>Only a single PTP domain per network is supported. A PTP domain is a
network or a portion of a network within which all the clocks are
synchronized.</li>
</ul>

<p>In the following example, boundary clock 2 receives time from Master 1
(the grandmaster) on a PTP slave port, sets its clock and passes the
time down from the PTP master port to boundary clock 1. Boundary clock 1
receives the time on a PTP slave port, sets its clock and passes the
time down the hierarchy through the PTP master ports to the hosts that
receive the time.</p>

<h3 id="enable-the-ptp-boundary-clock-on-the-switch">Enable the PTP Boundary Clock on the Switch</h3>

<p>To enable the PTP boundary clock on the switch:</p>

<ol>
<li><p>Open the <code>/etc/cumulus/switchd.conf</code> file in a text editor and add
the following line:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">ptp.timestamping = TRUE</code></pre></div></li>

<li><p>Restart <code>switchd</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl restart switchd.service</code></pre></div></li>
</ol>

<h3 id="configure-the-ptp-boundary-clock">Configure the PTP Boundary Clock</h3>

<p>To configure a boundary clock:</p>

<ol>
<li><p>Configure the interfaces on the switch that you want to use for PTP.
Each interface must be configured as a layer 3 routed interface with
an IP address. </p>

<p>PTP *is* supported on BGP unnumbered interfaces.</p>

<p>PTP is <em>not</em> supported on switched virtual interfaces (SVIs).</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp13s0 ip address 10.0.0.9/32
cumulus@switch:~$ net add interface swp13s1 ip address 10.0.0.10/32</code></pre></div></li>

<li><p>Configure PTP options on the switch:</p>

<ul>
<li><p>Set the <code>gm-capable</code> option to <code>no</code> to configure the switch to
be a boundary clock.</p></li>

<li><p>Set the priority, which selects the best master clock. You can
set priority 1 or 2. For each priority, you can use a number
between 0 and 255. The default priority is 255. For the boundary
clock, use a number above 128. The lower priority is applied
first.</p></li>

<li><p>Add the <code>time-stamping</code> parameter. The switch automatically
enables hardware time-stamping to capture timestamps from an
Ethernet frame at the physical layer. If you are testing PTP in
a virtual environment, hardware time-stamping is not available;
however the <code>time-stamping</code> parameter is still required.</p></li>

<li><p>Add the PTP master and slave interfaces. You do not specify
which is a master interface and which is a slave interface; this
is determined by the PTP packet received.</p></li>
</ul>

<p>The following commands provide an example configuration:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add ptp global gm-capable no
cumulus@switch:~$ net add ptp global priority2 254
cumulus@switch:~$ net add ptp global priority1 254
cumulus@switch:~$ net add ptp global time-stamping
cumulus@switch:~$ net add ptp interface swp13s0
cumulus@switch:~$ net add ptp interface swp13s1
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>The <code>ptp4l</code> man page describes all the configuration parameters.</p></li>

<li><p>Restart the <code>ptp4l</code> and <code>phc2sys</code> daemons:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl restart ptp41.service phc2sys.service</code></pre></div>
<p>The configuration is saved in the <code>/etc/ptp4l.conf</code> file.</p></li>

<li><p>Enable the services to start at boot time:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl enable ptp41.service phc2sys.service</code></pre></div></li>
</ol>

<h3 id="example-configuration">Example Configuration</h3>

<p>In the following example, the boundary clock on the switch receives time
from Master 1 (the grandmaster) on PTP slave port swp3s0, sets its clock
and passes the time down through PTP master ports swp3s1, swp3s2, and
swp3s3 to the hosts that receive the time.</p>

<p><img src="attachments/8362545/8362544.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<p> </p>

<p>The configuration for the above example is shown below. The example
assumes that you have already configured the layer 3 routed interfaces
(<code>swp3s0</code>, <code>swp3s1</code>, <code>swp3s2</code>, and <code>swp3s3</code>) you want to use for PTP. </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add ptp global gm-capable no
cumulus@switch:~$ net add ptp global priority2 254
cumulus@switch:~$ net add ptp global priority1 254
cumulus@switch:~$ net add ptp global time-stamping
cumulus@switch:~$ net add ptp interface swp3s0
cumulus@switch:~$ net add ptp interface swp3s1
cumulus@switch:~$ net add ptp interface swp3s2
cumulus@switch:~$ net add ptp interface swp3s3
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h3 id="verify-ptp-boundary-clock-configuration">Verify PTP Boundary Clock Configuration</h3>

<p>To view a summary of the PTP configuration on the switch, run
the <code>net show configuration ptp</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show configuration ptp
  
ptp
  global
 
    slaveOnly
      0
    
    priority1
      255
    
    priority2
      255
    
    domainNumber
      0
    
    logging_level
      5
    
    path_trace_enabled
      0
    
    use_syslog
      1
    
    verbose
      0
    
    summary_interval
      0
    
    time_stamping
      hardware
    
    gmCapable
      0
  swp15s0
  swp15s1
...</code></pre></div>
<h3 id="view-ptp-status-information">View PTP Status Information</h3>

<p>To view PTP status information, run
the <code>net show ptp parent_data_set</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show ptp parent_data_set
parent_data_set
===============
parentPortIdentity                    000200.fffe.000001-1
parentStats                           0
observedParentOffsetScaledLogVariance 0xffff
observedParentClockPhaseChangeRate    0x7fffffff
grandmasterPriority1                  127
gm.ClockClass                         248
gm.ClockAccuracy                      0xfe
gm.OffsetScaledLogVariance            0xffff
grandmasterPriority2                  127
grandmasterIdentity                   000200.fffe.000001</code></pre></div>
<p>To view the additional PTP status information, including the delta in
nanoseconds from the master clock, run
the <code>sudo pmc -u -b 0 'GET TIME_STATUS_NP'</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo pmc -u -b 0 &#39;GET TIME_STATUS_NP&#39;
sending: GET TIME_STATUS_NP
    7cfe90.fffe.f56dfc-0 seq 0 RESPONSE MANAGEMENT TIME_STATUS_NP
        master_offset              12610
        ingress_time               1525717806521177336
        cumulativeScaledRateOffset +0.000000000
        scaledLastGmPhaseChange    0
        gmTimeBaseIndicator        0
        lastGmPhaseChange          0x0000&#39;0000000000000000.0000
        gmPresent                  true
        gmIdentity                 000200.fffe.000005
    000200.fffe.000005-1 seq 0 RESPONSE MANAGEMENT TIME_STATUS_NP
        master_offset              0
        ingress_time               0
        cumulativeScaledRateOffset +0.000000000
        scaledLastGmPhaseChange    0
        gmTimeBaseIndicator        0
        lastGmPhaseChange          0x0000&#39;0000000000000000.0000
        gmPresent                  false
        gmIdentity                 000200.fffe.000005
    000200.fffe.000006-1 seq 0 RESPONSE MANAGEMENT TIME_STATUS_NP
        master_offset              5544033534
        ingress_time               1525717812106811842
        cumulativeScaledRateOffset +0.000000000
        scaledLastGmPhaseChange    0
        gmTimeBaseIndicator        0
        lastGmPhaseChange          0x0000&#39;0000000000000000.0000
        gmPresent                  true
        gmIdentity                 000200.fffe.000005</code></pre></div>
<h3 id="delete-ptp-boundary-clock-configuration">Delete PTP Boundary Clock Configuration</h3>

<p>To delete PTP configuration, delete the PTP master and slave interfaces.
The following example commands delete the PTP
interfaces <code>swp3s0</code>, <code>swp3s1</code>, and <code>swp3s2</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net del ptp interface swp3s0
cumulus@switch:~$ net del ptp interface swp3s1
cumulus@switch:~$ net del ptp interface swp3s2
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h2 id="use-ntp-in-a-dhcp-environment">Use NTP in a DHCP Environment</h2>

<p>If you use DHCP and want to specify your NTP servers, you must specify
an alternate configuration file for NTP.</p>

<p>Before you create the file, ensure that the DHCP-generated configuration
file exists. In Cumulus Linux 3.6.1 and later (which uses NTP 1:4.2.8),
the DHCP-generated file is named <code>/run/ntp.conf.dhcp</code> while in Cumulus
Linux 3.6.0 and earlier (which uses NTP 1:4.2.6) the file is
named <code>/var/lib/ntp/ntp.conf.dhcp</code>. This file is generated by
the <code>/etc/dhcp/dhclient-exit-hooks.d/ntp</code> script and is a copy of the
default <code>/etc/ntp.conf</code> with a modified server list from the DHCP
server. If this file does not exist and you plan on using DHCP in the
future, you can copy your current <code>/etc/ntp.conf</code> file to the location
of the DHCP file.</p>

<p>To use an alternate configuration file that persists across upgrades of
Cumulus Linux, create a <code>systemd</code> unit override file
called <code>/etc/systemd/system/ntp.service.d/config.conf</code> and add the
following content:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo echo &#39;
[Service]
ExecStart=
ExecStart=/usr/sbin/ntpd -n -u ntp:ntp -g -c /run/ntp.conf.dhcp
&#39;  &gt; ~/over
sudo mkdir -p /etc/systemd/system/ntp.service.d
sudo mv ~/over /etc/systemd/system/ntp.service.d/dhcp.conf
sudo chown root:root /etc/systemd/system/ntp.service.d/dhcp.conf</code></pre></div>
<p>To validate that your configuration, run these commands:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl daemon-reload
cumulus@switch:~$ sudo systemctl restart ntp
cumulus@switch:~$ sudo systemctl status -n0 ntp.service</code></pre></div>
<p>If the state is not <em>Active</em>, or the alternate configuration file does
not appear in the <code>ntp</code> command line — for example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ /usr/sbin/ntpd -n -u ntp:ntp -g -c /run/ntp.conf.dhcp</code></pre></div>
<p>— then it is likely that a mistake was made. In this case, correct the
mistake and rerun the three commands above to verify.</p>

<p>With this unit file override present, changing NTP settings using NCLU
do not take effect until the DHCP script regenerates the alternate NTP
configuration file.</p>

<h2 id="related-information">Related Information</h2>

<ul>
<li>-   <a href="http://www.debian.org/doc/manuals/system-administrator/ch-sysadmin-time.html">Debian System Administrator’s Manual –
    Time</a>

<ul>
<li><a href="http://www.ntp.org">www.ntp.org</a></li>
<li><a href="http://en.wikipedia.org/wiki/Network_Time_Protocol">en.wikipedia.org/wiki/Network_Time_Protocol</a></li>
<li><a href="http://wiki.debian.org/NTP">wiki.debian.org/NTP</a></li>
</ul></li>
</ul>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362545/8362549.png">PBR_example2.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362545/8362548.png">PTP.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362545/8362547.png">ptpWithPorts.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362545/8362546.png">PTPExample.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362545/8362544.png">PTPConfiguration.png</a> (image/png)</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/6acd7c038710e07f4a059d10b137f7b93cf9f759" title='Last modified February 26, 2019 13:53 EST by Daniel Cawley' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Feb 26, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#setting-date-and-time">Setting Date and Time</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#set-the-time-zone">Set the Time Zone</a>
<ul>
<li><a href="#edit-the-etc-timezone-file">Edit the <code>/etc/timezone</code> File</a></li>
<li><a href="#use-the-guided-wizard">Use the Guided Wizard</a></li>
</ul></li>
<li><a href="#set-the-date-and-time">Set the Date and Time</a></li>
<li><a href="#set-the-time-using-ntp-and-nclu">Set the Time Using NTP and NCLU</a></li>
<li><a href="#specify-the-ntp-source-interface">Specify the NTP Source Interface</a></li>
<li><a href="#ntp-default-configuration">NTP Default Configuration</a></li>
<li><a href="#precision-time-protocol-ptp-boundary-clock">Precision Time Protocol (PTP) Boundary Clock</a>
<ul>
<li><a href="#enable-the-ptp-boundary-clock-on-the-switch">Enable the PTP Boundary Clock on the Switch</a></li>
<li><a href="#configure-the-ptp-boundary-clock">Configure the PTP Boundary Clock</a></li>
<li><a href="#example-configuration">Example Configuration</a></li>
<li><a href="#verify-ptp-boundary-clock-configuration">Verify PTP Boundary Clock Configuration</a></li>
<li><a href="#view-ptp-status-information">View PTP Status Information</a></li>
<li><a href="#delete-ptp-boundary-clock-configuration">Delete PTP Boundary Clock Configuration</a></li>
</ul></li>
<li><a href="#use-ntp-in-a-dhcp-environment">Use NTP in a DHCP Environment</a></li>
<li><a href="#related-information">Related Information</a></li>
<li><a href="#attachments">Attachments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
