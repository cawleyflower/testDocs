<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Troubleshooting | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/" class="active">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Network Troubleshooting</strong>
</header>

      
<article class="markdown">

<h1 id="network-troubleshooting">Network Troubleshooting</h1>

<p>Cumulus Linux contains a number of command line and analytical tools to
help you troubleshoot issues with your network.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#NetworkTroubleshooting-CheckReachabilityUsingping">Check Reachability Using
ping</a></li>
<li><a href="#NetworkTroubleshooting-PrintRouteTraceUsingtraceroute">Print Route Trace Using
traceroute</a></li>
<li><a href="#NetworkTroubleshooting-ManipulatetheSystemARPCache">Manipulate the System ARP
Cache</a></li>
<li><a href="#NetworkTroubleshooting-GenerateTrafficUsingmz">Generate Traffic Using
mz</a></li>
<li><a href="#NetworkTroubleshooting-counter_aclCreateCounterACLRules">Create Counter ACL
Rules</a></li>
<li><a href="#NetworkTroubleshooting-spanConfigureSPANandERSPAN">Configure SPAN and
ERSPAN</a>

<ul>
<li><a href="#NetworkTroubleshooting-span_limitsLimitationsforSPAN/ERSPAN">Limitations for
SPAN/ERSPAN</a></li>
<li><a href="#NetworkTroubleshooting-ConfigureSPANforSwitchPorts">Configure SPAN for Switch
Ports</a></li>
<li><a href="#NetworkTroubleshooting-ConfigureSPANforBonds">Configure SPAN for
Bonds</a></li>
<li><a href="#NetworkTroubleshooting-ConfigureERSPAN">Configure ERSPAN</a></li>
<li><a href="#NetworkTroubleshooting-selective_spanningSelectiveSpanning">Selective
Spanning</a></li>
<li><a href="#NetworkTroubleshooting-RemoveSPANRules">Remove SPAN Rules</a></li>
<li><a href="#NetworkTroubleshooting-MonitorControlPlaneTrafficwithtcpdump">Monitor Control Plane Traffic with
tcpdump</a></li>
</ul></li>
<li><a href="#NetworkTroubleshooting-RelatedInformation">Related Information</a></li>
</ul>

<h2 id="check-reachability-using-ping">Check Reachability Using ping</h2>

<p><code>ping</code> is used to check reachability of a host. <code>ping</code> also calculates
the time it takes for packets to travel the round trip. See <code>man ping</code>
for details.</p>

<p>To test the connection to an IPv4 host:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ping 192.0.2.45
PING 192.0.2.45 (192.0.2.45) 56(84) bytes of data.
64 bytes from 192.0.2.45: icmp_req=1 ttl=53 time=40.4 ms
64 bytes from 192.0.2.45: icmp_req=2 ttl=53 time=39.6 ms
...</code></pre></div>
<p>To test the connection to an IPv6 host:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ping6 -I swp1 2001::db8:ff:fe00:2
PING 2001::db8:ff:fe00:2(2001::db8:ff:fe00:2) from 2001::db8:ff:fe00:1 swp1: 56 data bytes
64 bytes from 2001::db8:ff:fe00:2: icmp_seq=1 ttl=64 time=1.43 ms
64 bytes from 2001::db8:ff:fe00:2: icmp_seq=2 ttl=64 time=0.927 ms</code></pre></div>
<p>When troubleshooting intermittent connectivity issues, it is helpful to
send continuous pings to a host.</p>

<p>To send continuous pings to an IPv4 host:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">ping -i 1 -W1 -D -O 192.0.2.45 | while read row ; do awk &#39;{ sub(/[0-9]{10}/, strftime(&#34;%Y-%m-%d %H:%M:%S&#34;,  substr($0,2,10))) }1&#39; &lt;&lt;&lt; &#34;$row&#34;; done</code></pre></div>
<p>To send continuous pings to an IPv6 host:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">ping6 -i 1 -W1 -D -O swp1 2001::db8:ff:fe00:2 | while read row ; do awk &#39;{ sub(/[0-9]{10}/, strftime(&#34;%Y-%m-%d %H:%M:%S&#34;,  substr($0,2,10))) }1&#39; &lt;&lt;&lt; &#34;$row&#34;; done</code></pre></div>
<p>where:</p>

<p><code>-i</code> specifies the wait interval between sending each packet, in
seconds.<br />
<code>-W</code> specifies the number of seconds that the <code>ping</code> command waits for a
response. The option affects only timeout in absence of any responses,
otherwise <code>ping</code> waits for two RTTs (round trip time in milliseconds).<br />
<code>-D</code> prints a timestamp (unix time) before each line.<br />
<code>-O</code> reports outstanding ICMP ECHO replies before sending the next
packet.</p>

<p><code>-awk</code> substitutes human readable time format for unix time.</p>

<h2 id="print-route-trace-using-traceroute">Print Route Trace Using traceroute</h2>

<p><code>traceroute</code> tracks the route that packets take from an IP network on
their way to a given host. See <code>man traceroute</code> for details.</p>

<p>To track the route to an IPv4 host:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ traceroute www.google.com
traceroute to www.google.com (74.125.239.49), 30 hops max, 60 byte packets
1  cumulusnetworks.com (192.168.1.1)  0.614 ms  0.863 ms  0.932 ms
...
5  core2-1-1-0.pao.net.google.com (198.32.176.31)  22.347 ms  22.584 ms  24.328 ms
6  216.239.49.250 (216.239.49.250)  24.371 ms  25.757 ms  25.987 ms
7  72.14.232.35 (72.14.232.35)  27.505 ms  22.925 ms  22.323 ms
8  nuq04s19-in-f17.1e100.net (74.125.239.49)  23.544 ms  21.851 ms  22.604 ms</code></pre></div>
<h2 id="manipulate-the-system-arp-cache">Manipulate the System ARP Cache</h2>

<p><code>arp</code> manipulates or displays the kernel’s IPv4 network neighbor cache.
See <code>man arp</code> for details.</p>

<p>To display the ARP cache:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ arp -a
? (11.0.2.2) at 00:02:00:00:00:10 [ether] on swp3
? (11.0.3.2) at 00:02:00:00:00:01 [ether] on swp4
? (11.0.0.2) at 44:38:39:00:01:c1 [ether] on swp1</code></pre></div>
<p>To delete an ARP cache entry:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ arp -d 11.0.2.2
cumulus@switch:~$ arp -a
? (11.0.2.2) at &lt;incomplete&gt; on swp3
? (11.0.3.2) at 00:02:00:00:00:01 [ether] on swp4
? (11.0.0.2) at 44:38:39:00:01:c1 [ether] on swp1</code></pre></div>
<p>To add a static ARP cache entry:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ arp -s 11.0.2.2 00:02:00:00:00:10
cumulus@switch:~$ arp -a
? (11.0.2.2) at 00:02:00:00:00:10 [ether] PERM on swp3
? (11.0.3.2) at 00:02:00:00:00:01 [ether] on swp4
? (11.0.0.2) at 44:38:39:00:01:c1 [ether] on swp1</code></pre></div>
<p>If you need to flush or remove and ARP entry for a specific interface,
you can disable dynamic ARP learning:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ip link set arp off dev INTERFACE</code></pre></div>
<h2 id="generate-traffic-using-mz">Generate Traffic Using mz</h2>

<p><code>mz</code> is a fast traffic generator. It can generate a large variety of
packet types at high speed. See <code>man mz</code> for details.</p>

<p>For example, to send two sets of packets to TCP port 23 and 24, with
source IP 11.0.0.1 and destination 11.0.0.2, do the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo mz swp1 -A 11.0.0.1 -B 11.0.0.2 -c 2 -v -t tcp &#34;dp=23-24&#34;

Mausezahn 0.40 - (C) 2007-2010 by Herbert Haas - http://www.perihel.at/sec/mz/
Use at your own risk and responsibility!
-- Verbose mode --

This system supports a high resolution clock.
 The clock resolution is 4000250 nanoseconds.
Mausezahn will send 4 frames...
 IP:  ver=4, len=40, tos=0, id=0, frag=0, ttl=255, proto=6, sum=0, SA=11.0.0.1, DA=11.0.0.2,
      payload=[see next layer]
 TCP: sp=0, dp=23, S=42, A=42, flags=0, win=10000, len=20, sum=0,
      payload=

 IP:  ver=4, len=40, tos=0, id=0, frag=0, ttl=255, proto=6, sum=0, SA=11.0.0.1, DA=11.0.0.2,
      payload=[see next layer]
 TCP: sp=0, dp=24, S=42, A=42, flags=0, win=10000, len=20, sum=0,
      payload=

 IP:  ver=4, len=40, tos=0, id=0, frag=0, ttl=255, proto=6, sum=0, SA=11.0.0.1, DA=11.0.0.2,
      payload=[see next layer]
 TCP: sp=0, dp=23, S=42, A=42, flags=0, win=10000, len=20, sum=0,
      payload=

 IP:  ver=4, len=40, tos=0, id=0, frag=0, ttl=255, proto=6, sum=0, SA=11.0.0.1, DA=11.0.0.2,
      payload=[see next layer]
 TCP: sp=0, dp=24, S=42, A=42, flags=0, win=10000, len=20, sum=0,
      payload=</code></pre></div>
<h2 id="create-counter-acl-rules">Create Counter ACL Rules</h2>

<p>In Linux, all ACL rules are always counted. To create an ACL rule for
counting purposes only, set the rule action to ACCEPT. See the
<a href="Netfilter_-_ACLs">Netfilter</a> chapter for details on how to use
<code>cl-acltool</code> to set up iptables-/ip6tables-/ebtables-based ACLs.</p>

<p>Always place your rules files under <code>/etc/cumulus/acl/policy.d/</code>.</p>

<p>To count all packets going to a Web server:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ cat sample_count.rules

[iptables]
-A FORWARD -p tcp --dport 80 -j ACCEPT

cumulus@switch:~$ sudo cl-acltool -i -p sample_count.rules
Using user provided rule file sample_count.rules
Reading rule file sample_count.rules ...
Processing rules in file sample_count.rules ...
Installing acl policy... done.

cumulus@switch:~$ sudo iptables -L -v
Chain INPUT (policy ACCEPT 16 packets, 2224 bytes)
pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
pkts bytes target     prot opt in     out     source               destination
   2   156 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:http

Chain OUTPUT (policy ACCEPT 44 packets, 8624 bytes)
pkts bytes target     prot opt in     out     source               destination</code></pre></div>
<p>The <code>-p</code> option clears out all other rules, and the <code>-i</code> option is used
to reinstall all the rules. </p>

<h2 id="configure-span-and-erspan">Configure SPAN and ERSPAN</h2>

<p>SPAN (Switched Port Analyzer) provides for the mirroring of all packets
coming in from or going out of an interface (the <em>SPAN source</em>), and
being copied and transmitted out of a local port (the <em>SPAN
destination</em>) for monitoring. The SPAN destination port is also referred
to as a mirror-to-port (MTP). The original packet is still switched,
while a mirrored copy of the packet is sent out of the MTP.</p>

<p>ERSPAN (Encapsulated Remote SPAN) enables the mirrored packets to be
sent to a monitoring node located anywhere across the routed network.
The switch finds the outgoing port of the mirrored packets by doing a
lookup of the destination IP address in its routing table. The original
L2 packet is encapsulated with GRE for IP delivery. The encapsulated
packets have the following format:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"> ----------------------------------------------------------
| MAC_HEADER | IP_HEADER | GRE_HEADER | L2_Mirrored_Packet |
 ----------------------------------------------------------</code></pre></div>
<p>Mirrored traffic is not guaranteed. If the MTP is congested, mirrored
packets may be discarded.</p>

<p>SPAN and ERSPAN are configured via <code>cl-acltool</code>, the <a href="Netfilter_-_ACLs">same utility for
security ACL configuration</a>. The match criteria for
SPAN and ERSPAN is usually an interface; for more granular match terms,
use <a href="#NetworkTroubleshooting-selective_spanning">selective spanning</a>.
The SPAN source interface can be a port, a subinterface or a bond
interface. Ingress traffic on interfaces can be matched, and on Mellanox
Spectrum switches, egress traffic can be matched. See the <a href="#NetworkTroubleshooting-span_limits">list of
limitations</a> below.</p>

<p>Cumulus Linux supports a maximum of 2 SPAN destinations. Multiple rules
(SPAN sources) can point to the same SPAN destination, although a given
SPAN source cannot specify 2 SPAN destinations. The SPAN destination
(MTP) interface can be a physical port, a subinterface, or a bond
interface. The SPAN/ERSPAN action is independent of security ACL
actions. If packets match both a security ACL rule and a SPAN rule, both
actions will be carried out.</p>

<p>Always place your rules files under <code>/etc/cumulus/acl/policy.d/</code>.</p>

<h3 id="limitations-for-span-erspan">Limitations for SPAN/ERSPAN</h3>

<ul>
<li>For Broadcom switches, Cumulus Linux supports a maximum of two SPAN
destinations.</li>
<li>For Mellanox Spectrum switches, Cumulus Linux supports only a single
SPAN destination in atomic mode or three SPAN destinations in
non-atomic mode.</li>
<li>Multiple rules (SPAN sources) can point to the same SPAN
destination, but a given SPAN source *cannot* specify two SPAN
destinations.</li>
<li>To configure SPAN or ERSPAN on a Tomahawk switch, you must enable
non-atomic update mode.</li>
<li>Mellanox switches reject SPAN ACL rules for an output interface that
is a subinterface.</li>
<li>Mirrored traffic is not guaranteed. If the MTP is congested,
mirrored packets might be discarded.</li>
<li>Cut-through mode is not supported for ERSPAN in Cumulus Linux on
switches using Broadcom Tomahawk, Trident II+ and Trident II ASICs.</li>
<li>On Broadcom switches, SPAN does not capture egress traffic.</li>
</ul>

<h3 id="configure-span-for-switch-ports">Configure SPAN for Switch Ports</h3>

<p>This section describes how to set up, install, verify and uninstall SPAN
rules. In the examples that follow, you will span (mirror) switch port
swp4 input traffic and swp4 output traffic to destination switch port
swp19.</p>

<p>First, create a rules file in <code>/etc/cumulus/acl/policy.d/</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo bash -c &#39;cat &lt;&lt;EOF &gt; /etc/cumulus/acl/policy.d/span.rules 
[iptables]
-A FORWARD --in-interface swp4 -j SPAN --dport swp19
-A FORWARD --out-interface swp4 -j SPAN --dport swp19
EOF&#39;</code></pre></div>
<p>Using <code>cl-acltool</code> with the <code>--out-interface</code> rule applies to transit
traffic only; it does not apply to traffic sourced from the switch.</p>

<p>Next, verify all the rules that are currently installed:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo iptables -L -v
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 DROP       all  --  swp+   any     240.0.0.0/5          anywhere            
    0     0 DROP       all  --  swp+   any     loopback/8           anywhere            
    0     0 DROP       all  --  swp+   any     base-address.mcast.net/8  anywhere            
    0     0 DROP       all  --  swp+   any     255.255.255.255      anywhere            
    0     0 SETCLASS   ospf --  swp+   any     anywhere             anywhere             SETCLASS  class:7
    0     0 POLICE     ospf --  any    any     anywhere             anywhere             POLICE  mode:pkt rate:2000 burst:2000
    0     0 SETCLASS   tcp  --  swp+   any     anywhere             anywhere             tcp dpt:bgp SETCLASS  class:7
    0     0 POLICE     tcp  --  any    any     anywhere             anywhere             tcp dpt:bgp POLICE  mode:pkt rate:2000 burst:2000
    0     0 SETCLASS   tcp  --  swp+   any     anywhere             anywhere             tcp spt:bgp SETCLASS  class:7
    0     0 POLICE     tcp  --  any    any     anywhere             anywhere             tcp spt:bgp POLICE  mode:pkt rate:2000 burst:2000
    0     0 SETCLASS   tcp  --  swp+   any     anywhere             anywhere             tcp dpt:5342 SETCLASS  class:7
    0     0 POLICE     tcp  --  any    any     anywhere             anywhere             tcp dpt:5342 POLICE  mode:pkt rate:2000 burst:2000
    0     0 SETCLASS   tcp  --  swp+   any     anywhere             anywhere             tcp spt:5342 SETCLASS  class:7
    0     0 POLICE     tcp  --  any    any     anywhere             anywhere             tcp spt:5342 POLICE  mode:pkt rate:2000 burst:2000
    0     0 SETCLASS   icmp --  swp+   any     anywhere             anywhere             SETCLASS  class:2
    0     0 POLICE     icmp --  any    any     anywhere             anywhere             POLICE  mode:pkt rate:100 burst:40
   15  5205 SETCLASS   udp  --  swp+   any     anywhere             anywhere             udp dpts:bootps:bootpc SETCLASS  class:2
   11  3865 POLICE     udp  --  any    any     anywhere             anywhere             udp dpt:bootps POLICE  mode:pkt rate:100 burst:100
    0     0 POLICE     udp  --  any    any     anywhere             anywhere             udp dpt:bootpc POLICE  mode:pkt rate:100 burst:100
    0     0 SETCLASS   tcp  --  swp+   any     anywhere             anywhere             tcp dpts:bootps:bootpc SETCLASS  class:2
    0     0 POLICE     tcp  --  any    any     anywhere             anywhere             tcp dpt:bootps POLICE  mode:pkt rate:100 burst:100
    0     0 POLICE     tcp  --  any    any     anywhere             anywhere             tcp dpt:bootpc POLICE  mode:pkt rate:100 burst:100
   17  1088 SETCLASS   igmp --  swp+   any     anywhere             anywhere             SETCLASS  class:6
   17  1156 POLICE     igmp --  any    any     anywhere             anywhere             POLICE  mode:pkt rate:300 burst:100
  394 41060 POLICE     all  --  swp+   any     anywhere             anywhere             ADDRTYPE match dst-type LOCAL POLICE  mode:pkt rate:1000 burst:1000 class:0
    0     0 POLICE     all  --  swp+   any     anywhere             anywhere             ADDRTYPE match dst-type IPROUTER POLICE  mode:pkt rate:400 burst:100 class:0
  988  279K SETCLASS   all  --  swp+   any     anywhere             anywhere             SETCLASS  class:0

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 DROP       all  --  swp+   any     240.0.0.0/5          anywhere            
    0     0 DROP       all  --  swp+   any     loopback/8           anywhere            
    0     0 DROP       all  --  swp+   any     base-address.mcast.net/8  anywhere            
    0     0 DROP       all  --  swp+   any     255.255.255.255      anywhere            
26864 4672K SPAN       all  --  swp4   any     anywhere             anywhere             dport:swp19  &lt;---- input packets on swp4

40722   47M SPAN       all  --  any    swp4    anywhere             anywhere             dport:swp19  &lt;---- output packets on swp4


Chain OUTPUT (policy ACCEPT 67398 packets, 5757K bytes)
 pkts bytes target     prot opt in     out     source               destination</code></pre></div>
<p>Install the rules:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo cl-acltool -i 
[sudo] password for cumulus:
Reading rule file /etc/cumulus/acl/policy.d/00control_plane.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/00control_plane.rules ...
Reading rule file /etc/cumulus/acl/policy.d/99control_plane_catch_all.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/99control_plane_catch_all.rules ...
Reading rule file /etc/cumulus/acl/policy.d/span.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/span.rules ...
Installing acl policy
done.</code></pre></div>
<p>Running the following command is incorrect and will remove <strong>all</strong>
existing control-plane rules or other installed rules and only install
the rules defined in <code>span.rules</code>:</p>

<pre><code>cumulus@switch:~$ sudo cl-acltool -i  -P /etc/cumulus/acl/policy.d/span.rules
</code></pre>

<p>Verify that the SPAN rules were installed:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo cl-acltool -L all | grep SPAN
38025 7034K SPAN       all  --  swp4   any     anywhere             anywhere             dport:swp19
50832   55M SPAN       all  --  any    swp4    anywhere             anywhere             dport:swp19</code></pre></div>
<h4 id="span-sessions-that-reference-an-outgoing-interface">SPAN Sessions that Reference an Outgoing Interface</h4>

<p>SPAN sessions that reference an outgoing interface create the mirrored
packets based on the ingress interface before the routing/switching
decision. For example, the following rule captures traffic that is
ultimately destined to leave swp2 but mirrors the packets when they
arrive on swp3. The rule transmits packets that reference the original
VLAN tag and source/destination MAC address at the time the packet is
originally received on swp3.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --out-interface swp2 -j SPAN --dport swp1</code></pre></div>
<h3 id="configure-span-for-bonds">Configure SPAN for Bonds</h3>

<p>This section describes how to configure SPAN for all packets going out
of <code>bond0</code> locally to <code>bond1</code>.</p>

<p>First, create a rules file in <code>/etc/cumulus/acl/policy.d/</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo bash -c &#39;cat &lt;&lt;EOF &gt; /etc/cumulus/acl/policy.d/span_bond.rules 
[iptables]
-A FORWARD --out-interface bond0 -j SPAN --dport bond1
EOF&#39;</code></pre></div>
<p>Using <code>cl-acltool</code> with the <code>--out-interface</code> rule applies to transit
traffic only; it does not apply to traffic sourced from the switch.</p>

<p>Install the rules:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo cl-acltool -i 
[sudo] password for cumulus:
Reading rule file /etc/cumulus/acl/policy.d/00control_plane.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/00control_plane.rules ...
Reading rule file /etc/cumulus/acl/policy.d/99control_plane_catch_all.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/99control_plane_catch_all.rules ...
Reading rule file /etc/cumulus/acl/policy.d/span_bond.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/span_bond.rules ...
Installing acl policy
done.</code></pre></div>
<p>Verify that the SPAN rules were installed:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo iptables -L -v | grep SPAN
   19  1938 SPAN       all  --  any    bond0   anywhere             anywhere             dport:bond1</code></pre></div>
<h3 id="configure-erspan">Configure ERSPAN</h3>

<p>This section describes how to configure ERSPAN for all packets coming in
from <code>swp1</code> to 12.0.0.2.</p>

<p>Cut-through Mode Support</p>

<p><a href="Buffer-and-Queue-Management_8363032.html#BufferandQueueManagement-cut_through_mode">Cut-through
mode</a> is <strong>not</strong> supported
for ERSPAN in Cumulus Linux on switches using Broadcom Tomahawk, Trident
II+ and Trident II ASICs.</p>

<p>Cut-through mode <strong>is</strong> supported for ERSPAN in Cumulus Linux on
switches using Mellanox Spectrum ASICs.</p>

<ol>
<li><p>First, create a rules file in <code>/etc/cumulus/acl/policy.d/</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo bash -c &#39;cat &lt;&lt;EOF &gt; /etc/cumulus/acl/policy.d/erspan.rules 
[iptables]
-A FORWARD --in-interface swp1 -j ERSPAN --src-ip 12.0.0.1 --dst-ip 12.0.0.2  --ttl 64
EOF&#39;</code></pre></div></li>

<li><p>Install the rules:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo cl-acltool -i
Reading rule file /etc/cumulus/acl/policy.d/00control_plane.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/00control_plane.rules ...
Reading rule file /etc/cumulus/acl/policy.d/99control_plane_catch_all.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/99control_plane_catch_all.rules ...
Reading rule file /etc/cumulus/acl/policy.d/erspan.rules ...
Processing rules in file /etc/cumulus/acl/policy.d/erspan.rules ...
Installing acl policy
done.</code></pre></div></li>

<li><p>Verify that the ERSPAN rules were installed:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo iptables -L -v | grep SPAN
   69  6804 ERSPAN     all  --  swp1   any     anywhere             anywhere             ERSPAN src-ip:12.0.0.1 dst-ip:12.0.0.2</code></pre></div>
<p>The <code>src-ip</code> option can be any IP address, whether it exists in the
routing table or not. The <code>dst-ip</code> option must be an IP address
reachable via the routing table. The destination IP address must be
reachable from a front-panel port, and not the management port. Use
<code>ping</code> or <code>ip route get &lt;ip&gt;</code> to verify that the destination IP
address is reachable. Setting the <code>--ttl</code> option is recommended.</p></li>
</ol>

<p>When using <a href="https://www.wireshark.org">Wireshark</a> to review the ERSPAN
output, Wireshark may report the message &ldquo;Unknown version, please report
or test to use fake ERSPAN preference&rdquo;, and the trace is unreadable. To
resolve this, go into the General preferences for Wireshark, then go to
<strong>Protocols</strong> &gt; <strong>ERSPAN</strong> and check the <strong>Force to decode fake
ERSPAN frame</strong> option.</p>

<h3 id="selective-spanning">Selective Spanning</h3>

<p>SPAN/ERSPAN traffic rules can be configured to limit the traffic that is
spanned, to reduce the volume of copied data.</p>

<p>Cumulus Linux supports selective spanning for <code>iptables</code> only.
<code>ip6tables</code> and <code>ebtables</code> are not supported.</p>

<p>The following matching fields are supported:</p>

<ul>
<li><p>IPv4 SIP/DIP</p></li>

<li><p>IP protocol</p></li>

<li><p>L4 (TCP/UDP) src/dst port</p></li>

<li><p>TCP flags</p></li>

<li><p>An ingress port/wildcard (swp+) can be specified in addition</p></li>
</ul>

<p>With ERSPAN, a maximum of two  <code>--src-ip --dst-ip</code> pairs are supported.
Exceeding this limit produces an error when you install the rules with
<code>cl-acltool</code>.</p>

<h4 id="span-examples">SPAN Examples</h4>

<ul>
<li><p>To mirror forwarded packets from all ports matching SIP 20.0.1.0 and
DIP 20.0.1.2 to port swp1s1:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -s 20.0.0.2 -d 20.0.1.2 -j SPAN --dport swp1s2</code></pre></div></li>

<li><p>To mirror icmp packets from all ports to swp1s2:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -s 20.0.0.2 -p icmp -j SPAN --dport swp1s2</code></pre></div></li>

<li><p>To mirror forwarded UDP packets received from port swp1s0, towards
DIP 20.0.1.2 and destination port 53:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp1s0 -d 20.0.1.2 -p udp --dport 53 -j SPAN --dport swp1s2</code></pre></div></li>

<li><p>To mirror all forwarded TCP packets with only SYN set:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -p tcp --tcp-flags ALL SYN -j SPAN --dport swp1s2</code></pre></div></li>

<li><p>To mirror all forwarded TCP packets with only FIN set:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -p tcp --tcp-flags ALL FIN -j SPAN --dport swp1s2</code></pre></div></li>
</ul>

<h4 id="erspan-examples">ERSPAN Examples</h4>

<ul>
<li><p>To mirror forwarded packets from all ports matching SIP 20.0.1.0 and
DIP 20.0.1.2:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -s 20.0.0.2 -d 20.0.1.2 -j ERSPAN --src-ip 90.0.0.1 --dst-ip 20.0.2.2</code></pre></div></li>

<li><p>To mirror ICMP packets from all ports:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -s 20.0.0.2 -p icmp -j ERSPAN --src-ip 90.0.0.1 --dst-ip 20.0.2.2</code></pre></div></li>

<li><p>To mirror forwarded UDP packets received from port swp1s0, towards
DIP 20.0.1.2 and destination port 53:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp1s0 -d 20.0.1.2 -p udp --dport 53 -j ERSPAN --src-ip 90.0.0.1 --dst-ip 20.0.2.2</code></pre></div></li>

<li><p>To mirror all forwarded TCP packets with only SYN set:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -p tcp --tcp-flags ALL SYN -j ERSPAN --src-ip 90.0.0.1 --dst-ip 20.0.2.2</code></pre></div></li>

<li><p>To mirror all forwarded TCP packets with only FIN set:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-A FORWARD --in-interface swp+ -p tcp --tcp-flags ALL FIN -j ERSPAN --src-ip 90.0.0.1 --dst-ip 20.0.2.2</code></pre></div></li>
</ul>

<h3 id="remove-span-rules">Remove SPAN Rules</h3>

<p>To remove your SPAN rules, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">#Remove rules file:
cumulus@switch:~$ sudo rm  /etc/cumulus/acl/policy.d/span.rules
#Reload the default rules
cumulus@switch:~$ sudo cl-acltool -i
cumulus@switch:~$</code></pre></div>
<p>To verify that the SPAN rules were removed:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo cl-acltool -L all | grep SPAN
cumulus@switch:~$</code></pre></div>
<h3 id="monitor-control-plane-traffic-with-tcpdump">Monitor Control Plane Traffic with tcpdump</h3>

<p>You can use <code>tcpdump</code> to monitor control plane traffic — traffic sent to
and coming from the switch CPUs. <code>tcpdump</code> does <strong>not</strong> monitor data
plane traffic; use <code>cl-acltool</code> instead (see above).</p>

<p>For more information on tcpdump, read <a href="http://www.tcpdump.org/#documentation">the <code>tcpdump</code>
documentation</a> and the 
<a href="http://www.tcpdump.org/manpages/tcpdump.1.html"><code>tcpdump</code> man page</a>.</p>

<p>The following example incorporates a few <code>tcpdump</code> options:</p>

<ul>
<li><code>-i bond0</code>, which captures packets from bond0 to the CPU and from
the CPU to bond0</li>
<li><code>host 169.254.0.2</code>, which filters for this IP address</li>
<li><code>-c 10</code>, which captures 10 packets then stops</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo tcpdump -i bond0 host 169.254.0.2 -c 10
tcpdump: WARNING: bond0: no IPv4 address assigned
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes
16:24:42.532473 IP 169.254.0.2 &gt; 169.254.0.1: ICMP echo request, id 27785, seq 6, length 64
16:24:42.532534 IP 169.254.0.1 &gt; 169.254.0.2: ICMP echo reply, id 27785, seq 6, length 64
16:24:42.804155 IP 169.254.0.2.40210 &gt; 169.254.0.1.5342: Flags [.], seq 266275591:266277039, ack 3813627681, win 58, options [nop,nop,TS val 590400681 ecr 530346691], length 1448
16:24:42.804228 IP 169.254.0.1.5342 &gt; 169.254.0.2.40210: Flags [.], ack 1448, win 166, options [nop,nop,TS val 530348721 ecr 590400681], length 0
16:24:42.804267 IP 169.254.0.2.40210 &gt; 169.254.0.1.5342: Flags [P.], seq 1448:1836, ack 1, win 58, options [nop,nop,TS val 590400681 ecr 530346691], length 388
16:24:42.804293 IP 169.254.0.1.5342 &gt; 169.254.0.2.40210: Flags [.], ack 1836, win 165, options [nop,nop,TS val 530348721 ecr 590400681], length 0
16:24:43.532389 IP 169.254.0.2 &gt; 169.254.0.1: ICMP echo request, id 27785, seq 7, length 64
16:24:43.532447 IP 169.254.0.1 &gt; 169.254.0.2: ICMP echo reply, id 27785, seq 7, length 64
16:24:43.838652 IP 169.254.0.1.59951 &gt; 169.254.0.2.5342: Flags [.], seq 2555144343:2555145791, ack 2067274882, win 58, options [nop,nop,TS val 530349755 ecr 590399688], length 1448
16:24:43.838692 IP 169.254.0.1.59951 &gt; 169.254.0.2.5342: Flags [P.], seq 1448:1838, ack 1, win 58, options [nop,nop,TS val 530349755 ecr 590399688], length 390
10 packets captured
12 packets received by filter
0 packets dropped by kernel</code></pre></div>
<h2 id="related-information">Related Information</h2>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Ping">en.wikipedia.org/wiki/Ping</a></li>
<li><a href="http://www.tcpdump.org">www.tcpdump.org</a></li>
<li><a href="https://en.wikipedia.org/wiki/Traceroute">en.wikipedia.org/wiki/Traceroute</a></li>
</ul>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#network-troubleshooting">Network Troubleshooting</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#check-reachability-using-ping">Check Reachability Using ping</a></li>
<li><a href="#print-route-trace-using-traceroute">Print Route Trace Using traceroute</a></li>
<li><a href="#manipulate-the-system-arp-cache">Manipulate the System ARP Cache</a></li>
<li><a href="#generate-traffic-using-mz">Generate Traffic Using mz</a></li>
<li><a href="#create-counter-acl-rules">Create Counter ACL Rules</a></li>
<li><a href="#configure-span-and-erspan">Configure SPAN and ERSPAN</a>
<ul>
<li><a href="#limitations-for-span-erspan">Limitations for SPAN/ERSPAN</a></li>
<li><a href="#configure-span-for-switch-ports">Configure SPAN for Switch Ports</a>
<ul>
<li><a href="#span-sessions-that-reference-an-outgoing-interface">SPAN Sessions that Reference an Outgoing Interface</a></li>
</ul></li>
<li><a href="#configure-span-for-bonds">Configure SPAN for Bonds</a></li>
<li><a href="#configure-erspan">Configure ERSPAN</a></li>
<li><a href="#selective-spanning">Selective Spanning</a>
<ul>
<li><a href="#span-examples">SPAN Examples</a></li>
<li><a href="#erspan-examples">ERSPAN Examples</a></li>
</ul></li>
<li><a href="#remove-span-rules">Remove SPAN Rules</a></li>
<li><a href="#monitor-control-plane-traffic-with-tcpdump">Monitor Control Plane Traffic with tcpdump</a></li>
</ul></li>
<li><a href="#related-information">Related Information</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
