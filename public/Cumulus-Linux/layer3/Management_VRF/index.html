<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Management v R F | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/" class="active">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Management v R F</strong>
</header>

      
<article class="markdown">

<h1 id="management-vrf">Management VRF</h1>

<p>*Management VRF* is a subset of
<a href="Virtual_Routing_and_Forwarding_-_VRF">VRF</a> (virtual routing tables and
forwarding) and provides a separation between the out-of-band management
network and the in-band data plane network. For all VRFs, the <em>main</em>
routing table is the default table for all of the data plane switch
ports. With management VRF, a second table, <em>mgmt</em>, is used for routing
through the  Ethernet ports of the switch. The <em>mgmt</em> name is special
cased to identify the management VRF from a data plane VRF. FIB rules
are installed for DNS servers because this is the typical deployment
case. </p>

<p>Cumulus Linux only supports eth0 as the management interface, or eth1,
depending on the switch platform. The Ethernet ports are software-only
parts that are not hardware accelerated by <code>switchd</code>. VLAN
subinterfaces, bonds, bridges, and the front panel switch ports are not
supported as management interfaces.</p>

<p>When management VRF is enabled, logins to the switch are set into the
management VRF context. IPv4 and IPv6 networking applications (for
example, Ansible, Chef, and <code>apt-get</code>) run by an administrator
communicate out the management network by default. This default context
does not impact services run through <code>systemd</code> and the <code>systemctl</code>
command, and does not impact commands examining the state of the switch,
such as the <code>ip</code> command to list links, neighbors, or routes.</p>

<p>The management VRF configurations in this chapter contain a localhost
loopback IP address (127.0.0.<sup>1</sup>&frasl;<sub>8</sub>). Adding the loopback address to the L3
domain of the management VRF prevents issues with applications that
expect the loopback IP address to exist in the VRF, such as NTP.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#ManagementVRF-enablevrfEnableManagementVRF">Enable Management VRF</a></li>
<li><a href="#ManagementVRF-servicesRunServiceswithintheManagementVRF">Run Services within the Management
VRF</a>

<ul>
<li><a href="#ManagementVRF-snmpdEnablePollingwithsnmpdinaManagementVRF">Enable Polling with snmpd in a Management
VRF</a></li>
<li><a href="#ManagementVRF-hsflowdEnablehsflowd">Enable hsflowd</a></li>
<li><a href="#ManagementVRF-pingortracerouteontheManagementVRF">ping or traceroute on the Management
VRF</a></li>
<li><a href="#ManagementVRF-RunServicesasaNon-rootUser">Run Services as a Non-root
User</a></li>
</ul></li>
<li><a href="#ManagementVRF-OSPFandBGP">OSPF and BGP</a></li>
<li><a href="#ManagementVRF-SSHwithinaManagementVRFContext">SSH within a Management VRF
Context</a></li>
<li><a href="#ManagementVRF-ViewtheRoutingTables">View the Routing Tables</a></li>
<li><a href="#ManagementVRF-mgmtInterfaceClass">mgmt Interface Class</a></li>
<li><a href="#ManagementVRF-ManagementVRFandDNS">Management VRF and DNS</a></li>
<li><a href="#ManagementVRF-Incompatibilitywithcl-ns-mgmt">Incompatibility with
cl-ns-mgmt</a></li>
</ul>

<h2 id="enable-management-vrf">Enable Management VRF</h2>

<p>To enable management VRF on eth0, complete the following steps:</p>

<p>Example Management VRF Configuration</p>

<p>The example NCLU commands below create a VRF called <em>mgmt</em>:</p>

<p>The management VRF must be named <code>mgmt</code> to differentiate from a data
plane VRF.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add vrf mgmt
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>The NCLU commands above create the following snippets in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">...
 
auto eth0
iface eth0 inet dhcp
    vrf mgmt

...
 
auto mgmt
iface mgmt
    address 127.0.0.1/8
    vrf-table auto
 
...</code></pre></div>
<p>When you commit the change to add the management VRF, all connections
over eth0 are dropped. This can impact any automation that might be
running, such as Ansible or Puppet scripts.</p>

<p>If you take down the management VRF using <code>ifdown</code>, to bring it back up
you need to do one of two things:</p>

<ul>
<li>Use <code>ifup --with-depends &lt;vrf&gt;</code></li>
<li>Use <code>ifreload -a</code></li>
</ul>

<p>For example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo ifdown mgmt
cumulus@switch:~$ sudo ifup --with-depends mgmt</code></pre></div>
<p>Running <code>ifreload -a</code> disconnects the session for any interface
configured as <em>auto</em>.</p>

<h2 id="run-services-within-the-management-vrf">Run Services within the Management VRF</h2>

<p>You can run a variety of services within the management VRF instead of
the default VRF. In most cases, you must stop and disable the instance
running in the default VRF before you can start the service in the
management VRF. This is because the instance running in the default VRF
owns the port across all VRFs. The list of services that must be
disabled in the default VRF are:</p>

<ul>
<li>chef-client</li>
<li>collectd</li>
<li>dhcpd</li>
<li>dhcrelay</li>
<li>hsflowd</li>
<li>netq-agent</li>
<li>ntp</li>
<li>puppet</li>
<li>snmpd</li>
<li>snmptrapd</li>
<li>ssh</li>
<li>zabbix-agent</li>
</ul>

<p>When you run a service inside the management VRF, that service
runs <strong>only</strong> on eth0; it no longer runs on any switch port. However,
you can keep the service running in the default VRF with a wildcard
for <a href="8362608.html#SimpleNetworkManagementProtocol(SNMP)Monitoring-agentAddress">agentAddress</a>.
This enables the service to run on <strong>all</strong> interfaces no matter which
VRF, so you don&rsquo;t have to run a different process for each VRF.</p>

<p>Some applications can work across all VRFs. The kernel provides a
<code>sysctl</code> that allows a single instance to accept connections over all
VRFs. For TCP, connected sockets are bound to the VRF on which the first
packet is received. This <code>sysctl</code> is enabled for Cumulus Linux.</p>

<p>To enable a service to run in the management VRF, do the following.
These steps use the NTP service, but you can use any of the services
listed above, except for <code>dhcrelay</code> (discussed
<a href="DHCP-Relays_8363036.html#DHCPRelays-multiple">here</a>) and <code>hsflowd</code>
(discussed <a href="#ManagementVRF-hsflowd">below</a>).</p>

<ol>
<li>Configure the management VRF as described in <a href="Management_VRF">the Enabling
Management VRF section above</a>.</li>

<li><p>If NTP is running, stop the service:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl stop ntp.service</code></pre></div></li>

<li><p>Disable NTP from starting automatically in the default VRF:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl disable ntp.service</code></pre></div></li>

<li><p>Start NTP in the management VRF.  </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl start ntp@mgmt.service</code></pre></div></li>

<li><p>Enable <code>ntp@mgmt</code> so that it starts when the switch boots:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl enable ntp@mgmt.service</code></pre></div></li>
</ol>

<p>After you enable <code>ntp@mgmt</code>, you can verify that NTP peers are active:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ntpq -pn
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
*38.229.71.1     204.9.54.119     2 u   42   64  377   31.275   -0.625   3.105
-104.131.53.252  209.51.161.238   2 u   47   64  377   16.381   -5.251   0.681
+45.79.10.228    200.98.196.212   2 u   44   64  377   42.998    0.115   0.585
+74.207.240.206  127.67.113.92    2 u   43   64  377   73.240   -1.623   0.320 </code></pre></div>
<h3 id="enable-polling-with-snmpd-in-a-management-vrf">Enable Polling with snmpd in a Management VRF</h3>

<p>When you enable <code>snmpd</code> to run in the management VRF, you need to
specify that VRF with NCLU so that <code>snmpd</code> listens on eth0 in the
management VRF; you can also configure snmpd to listen on other ports
with the NCLU listening-address vrf command.  As of Cumulus Linux 3.6,
SNMP configuration is VRF aware so snmpd can bind to multiple IP
addresses each configured with a particular VRFs (routing table). 
The <code>snmpd</code> daemon responds to polling requests on the interfaces of the
VRF on which the request came in.   SNMP version 1, 2c and 3 Traps and
(v3) Inform messages can be configured with NCLU.  See the chapter on
SNMP management with NCLU for detailed instructions on how to configure
SNMP with VRFs.</p>

<p>The message
<code>Duplicate IPv4 address detected, some interfaces may not be visible in IP-MIB</code>
displays after starting <code>snmpd</code> in the mgmt VRF. This is because the
IP-MIB assumes the same IP address cannot be used twice on the same
device; the IP-MIB is not VRF aware. This message is a warning that the
SNMP IP-MIB detects overlapping IP addresses on the system; it does
<em>not</em> indicate a problem and is non-impacting to the operation of the
switch.</p>

<h3 id="enable-hsflowd">Enable hsflowd</h3>

<p>If you are
using <a href="https://docs.cumulusnetworks.com/display/CL31/Monitoring+System+Statistics+and+Network+Traffic+with+sFlow">sFlow</a> to
monitor traffic in the management VRF, you need to complete the
following steps to enable sFlow.</p>

<ol>
<li><p>Add the <code>hsflowd</code> process to the <code>systemd</code> configuration file
in <code>/etc/vrf</code>. Edit the <code>/etc/vrf/systemd.conf</code> file with a text
editor.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo nano /etc/vrf/systemd.conf 
# Systemd-based services that are expected to be run in a VRF context.
#
# If changes are made to this file run systemctl daemon-reload
# to re-generate systemd files.
chef-client
collectd
dhcpd
dhcrelay
hsflowd  &lt;&lt;&lt; Add this line
ntp
puppet
snmpd
snmptrapd
ssh
zabbix-agent</code></pre></div></li>

<li><p>Stop the <code>hsflowd</code> daemon if it is running:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl stop hsflowd.service</code></pre></div></li>

<li><p>Disable <code>hsflowd</code> to ensure it does not start in the default VRF if
the system is rebooted:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl disable hsflowd.service</code></pre></div></li>

<li><p>Run the <code>daemon-reload</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl daemon-reload</code></pre></div></li>

<li><p>Start <code>hsflowd</code> in the the management VRF:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl start hsflowd@mgmt.service</code></pre></div></li>

<li><p>Enable <code>hsflowd@mgmt</code> so it starts when the switch boots:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl enable hsflowd@mgmt.service</code></pre></div></li>

<li><p>Verify that the <code>hsflowd</code> service is running in the management VRF:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ps aux | grep flow
root      7294  0.0  0.4  81320  2108 ?        Ssl  22:22   0:00 /usr/sbin/hsflowd
cumulus   7906  0.0  0.4  12728  2056 pts/0    S+   22:34   0:00 grep flow
cumulus@switch:~$ vrf task identify 7294
mgmt</code></pre></div></li>
</ol>

<h3 id="ping-or-traceroute-on-the-management-vrf">ping or traceroute on the Management VRF</h3>

<p>By default,  when you issue a <code>ping</code> or <code>traceroute</code>, the packet is sent
to the dataplane network (the main routing table). To
use <code>ping</code> or <code>traceroute</code> on the management network, use the <code>-I</code> flag
for ping and <code>-i</code> for <code>traceroute</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ ping -I mgmt</code></pre></div>
<p>Or:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo traceroute -i mgmt</code></pre></div>
<h3 id="run-services-as-a-non-root-user">Run Services as a Non-root User</h3>

<p>Sometimes you may want to run services in the management VRF as a
non-root user. To do so, you need to create a custom service based on
the original service file. </p>

<ol>
<li><p>Copy the original service file to its new name and store the file in
<code>/etc/systemd/system</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo cp /lib/systemd/system/myservice.service /etc/systemd/system/myservice.service </code></pre></div></li>

<li><p>If there is a <em>User</em> directive, comment it out. If it exists, you
can find it under <em>[Service]</em>.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo nano /etc/systemd/system/myservice.service 
 
[Unit]
Description=Example
Documentation=https://www.example.io/

[Service]
#User=username
ExecStart=/usr/local/bin/myservice agent -data-dir=/tmp/myservice -bind=192.168.0.11

[Install]
WantedBy=multi-user.target</code></pre></div></li>

<li><p>Modify the <em>ExecStart</em> line
to <code>/usr/bin/vrf exec mgmt /sbin/runuser -u USER -- COMMAND</code>. For
example, to have the <em>cumulus</em> user run the <em>foocommand</em>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">[Unit]
Description=Example
Documentation=https://www.example.io/

[Service]
#User=username
ExecStart=/usr/bin/vrf task exec mgmt /sbin/runuser -u cumulus -- foocommand

[Install]
WantedBy=multi-user.target</code></pre></div></li>

<li><p>Save and exit the file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">^O
^X
cumulus@switch:~$ </code></pre></div></li>

<li><p>Reload the service so the changes take effect: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl daemon-reload</code></pre></div></li>
</ol>

<h2 id="ospf-and-bgp">OSPF and BGP</h2>

<p>In general, no changes are required for either BGP or OSPF. FRRouting is
VRF-aware and automatically sends packets based on the switch port
routing table. This includes BGP peering via loopback interfaces. BGP
does routing lookups in the default table. However, depending on how
your routes are redistributed, you might want to perform the following
modification. </p>

<p>Management VRF uses the mgmt table, including local routes. It does not
affect how the routes are redistributed when using routing protocols
such as OSPF and BGP.</p>

<p>To redistribute the routes in your network, use the
<code>redistribute connected</code> command under BGP or OSPF. This enables the
directly-connected network out of eth0 to be advertised to its neighbor.</p>

<p>This also creates a route on the neighbor device to the management
network through the data plane, which might not be desired.</p>

<p>Cumulus Networks recommends you always use route maps to control the
advertised networks redistributed by the <code>redistribute connected</code>
command. For example, you can specify a route map to redistribute routes
in this way (for both BGP and OSPF):</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add routing route-map REDISTRIBUTE-CONNECTED deny 100 match interface eth0
cumulus@leaf01:~$ net add routing route-map REDISTRIBUTE-CONNECTED permit 1000</code></pre></div>
<p>These commands produce the following configuration snippet in the
<code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">&lt;routing protocol&gt; 
redistribute connected route-map REDISTRIBUTE-CONNECTED

route-map REDISTRIBUTE-CONNECTED deny 100
 match interface eth0
!
route-map REDISTRIBUTE-CONNECTED permit 1000</code></pre></div>
<h2 id="ssh-within-a-management-vrf-context">SSH within a Management VRF Context</h2>

<p>If you SSH to the switch through a switch port, SSH works as expected.
If you need to SSH from the device out of a switch port,
use <code>vrf exec default ssh &lt;ip_address_of_swp_port&gt;</code>. For example:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ sudo vrf exec default ssh 10.23.23.2 10.3.3.3</code></pre></div>
<h2 id="view-the-routing-tables">View the Routing Tables</h2>

<p>When you look at the routing table with <code>ip route show</code>, you are looking
at the switch port (<em>main</em>) table. You can also see the dataplane
routing table with <code>net show route vrf main</code>.</p>

<p>To look at information about eth0 (the management routing table),
use <code>net show route vrf mgmt</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ net show route vrf mgmt
default via 192.168.0.1 dev eth0

cumulus@switch:~$ net show route
default via 10.23.23.3 dev swp17  proto zebra  metric 20
10.3.3.3 via 10.23.23.3 dev swp17
10.23.23.0/24 dev swp17  proto kernel  scope link  src 10.23.23.2
192.168.0.0/24 dev eth0  proto kernel  scope link  src 192.168.0.11</code></pre></div>
<p>If you use <code>ip route get</code> to return information about a single route,
the command resolves over the <em>mgmt</em> table by default. To obtain
information about the route in the switching silicon, use: </p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ net show route &lt;addr&gt; </code></pre></div>
<p>To get the route for any VRF, run the following command: </p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ net show route vrf mgmt &lt;addr&gt;</code></pre></div>
<h2 id="mgmt-interface-class">mgmt Interface Class</h2>

<p>In <code>ifupdown2</code>, <a href="Interface-Configuration-and-Management_8363023.html#InterfaceConfigurationandManagement-classes">interface
classes</a> are
used to create a user-defined grouping for interfaces. The special
class <em>mgmt</em> is available to separate the management interfaces of the
switch from the data interfaces. This allows you to manage the data
interfaces by default using <code>ifupdown2</code> commands. Performing operations
on the <em>mgmt</em> interfaces requires specifying the <code>--allow-mgmt</code> option,
which prevents inadvertent outages on the management interfaces. Cumulus
Linux by default brings up all interfaces in both the *auto* (default)
class and the *mgmt* interface class when the switch boots.</p>

<p>The management VRF interface class is not supported if you are
configuring Cumulus Linux using
<a href="Network_Command_Line_Utility_-_NCLU">NCLU</a>.</p>

<p>You configure the management interface in
the <code>/etc/network/interfaces </code>file. In the example below, the management
interface, eth0 and the management VRF stanzas are added to the <em>mgmt</em>
interface class:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">auto lo
iface lo inet loopback 

allow-mgmt eth0
iface eth0 inet dhcp
    vrf mgmt
  
allow-mgmt mgmt
iface mgmt
    address 127.0.0.1/8
    vrf-table auto </code></pre></div>
<p>When you run <code>ifupdown2</code> commands against the interfaces in the mgmt
class, include <code>--allow=mgmt</code> with the commands. For example, to see
which interfaces are in the mgmt interface class, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ ifquery l --allow=mgmt
eth0
mgmt </code></pre></div>
<p>To reload the configurations for interfaces in the mgmt class, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ sudo ifreload --allow=mgmt</code></pre></div>
<p>You can still bring the management interface up and down
using <code>ifup eth0</code> and <code>ifdown eth0</code>. </p>

<h2 id="management-vrf-and-dns">Management VRF and DNS</h2>

<p>Cumulus Linux supports both DHCP and static DNS entries over management
VRF through IP FIB rules. These rules are added to direct lookups to the
DNS addresses out of the management VRF.</p>

<p>For DNS to use the management VRF, the static DNS entries must reference
the management VRF in the <code>/etc/resolv.conf</code> file. You cannot specify
the same DNS server address twice to associate it with different VRFs. </p>

<p>For example, to specify DNS servers and associate some of them with the
management VRF, run the following commands:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add dns nameserver ipv4 192.0.2.1
cumulus@switch:~$ net add dns nameserver ipv4 198.51.100.31 vrf mgmt
cumulus@switch:~$ net add dns nameserver ipv4 203.0.113.13 vrf mgmt
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration in the
<code>/etc/resolv.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ cat /etc/resolv.conf
nameserver 192.0.2.1
nameserver 198.51.100.31 # vrf mgmt
nameserver 203.0.113.13 # vrf mgmt</code></pre></div>
<p>Nameservers configured through DHCP are updated automatically.
Statically configured nameservers (configured in
the <code>/etc/resolv.conf</code> file) only get updated when you run
<code>ifreload -a</code>.</p>

<p>Because DNS lookups are forced out of the management interface using FIB
rules, this might affect data plane ports if overlapping addresses are
used. For example, when the DNS server IP address is learned over the
management VRF, a FIB rule is created for that IP address. When DHCP
relay is configured for the same IP address, a DHCP discover packet
received on the front panel port is forwarded out of the management
interface (eth0) even though a route is present out the front-panel
port.</p>

<p>If you don&rsquo;t specify a DNS server and you lose in band connectivity, DNS
will not work through the management VRF. Cumulus Linux does not assume
all DNS servers are reachable through the management VRF.</p>

<h2 id="incompatibility-with-cl-ns-mgmt">Incompatibility with cl-ns-mgmt</h2>

<p>Management VRF has replaced the management namespace functionality in
Cumulus Linux. The management namespace feature (used with
the <code>cl-ns-mgmt</code> utility) has been deprecated, and the <code>cl-ns-mgmt</code>
command has been removed.</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#management-vrf">Management VRF</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#enable-management-vrf">Enable Management VRF</a></li>
<li><a href="#run-services-within-the-management-vrf">Run Services within the Management VRF</a>
<ul>
<li><a href="#enable-polling-with-snmpd-in-a-management-vrf">Enable Polling with snmpd in a Management VRF</a></li>
<li><a href="#enable-hsflowd">Enable hsflowd</a></li>
<li><a href="#ping-or-traceroute-on-the-management-vrf">ping or traceroute on the Management VRF</a></li>
<li><a href="#run-services-as-a-non-root-user">Run Services as a Non-root User</a></li>
</ul></li>
<li><a href="#ospf-and-bgp">OSPF and BGP</a></li>
<li><a href="#ssh-within-a-management-vrf-context">SSH within a Management VRF Context</a></li>
<li><a href="#view-the-routing-tables">View the Routing Tables</a></li>
<li><a href="#mgmt-interface-class">mgmt Interface Class</a></li>
<li><a href="#management-vrf-and-dns">Management VRF and DNS</a></li>
<li><a href="#incompatibility-with-cl-ns-mgmt">Incompatibility with cl-ns-mgmt</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
