<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equal Cost Multipath Load Sharing Hardware E C M P | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.20b2cb98a9208e1e7497525a9f78f7f8eb0ca4b5f4551e9610f12c5b317e6be8.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/" class="active">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>
 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/">
    U I User Guide</a> 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/monitor_the_network/">
    Monitor the Network</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_alarm_events/Monitor_Alarm_Events/">Monitor Alarm Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_informational_events/Monitor_Informational_Events/">Monitor Informational Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_health/Monitor_Network_Health/">Monitor Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_inventory/Monitor_Network_Inventory/">Monitor Network Inventory</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_protocols/Monitor_Network_Layer_Protocols/">Monitor Network Layer Protocols</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_switches/Monitor_Switches/">Monitor Switches</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/netq_ui_overview/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/ui_preface/UI_Preface/">U I Preface</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/cli_user_guide/">
    Cli User Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/cli_user_guide/CLI_Preface/CLI_Preface/">C L I Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/automate_common_tasks/Automate_Common_and_Repetitive_Tasks/">Automate Common and Repetitive Tasks</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/command_line_overview/NetQ_Command_Line_Overview/">Net Q Command Line Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_containter_environments/Monitor_Container_Environments/">Monitor Container Environments</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_data_link_layer/Monitor_Data_Link_Layer_Devices_and_Protocols/">Monitor Data Link Layer Devices and Protocols</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_linux_hosts/Monitor_Linux_Hosts/">Monitor Linux Hosts</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_health/Monitor_Overall_Network_Health/">Monitor Overall Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_layer/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_physical_layer/Monitor_Physical_Layer_Components/">Monitor Physical Layer Components</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_switch_hardware/Monitor_Switch_Hardware_and_Software/">Monitor Switch Hardware and Software</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_virtual_overlays/Monitor_Virtual_Network_Overlays/">Monitor Virtual Network Overlays</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_Issues/">Resolve Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_MLAG_Issues/">Resolve M L a G Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/investiage_netq_issues/Investigate_NetQ_Issues/">Investigate Net Q Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/methods_for_diagnosing_issues/Methods_for_Diagnosing_Network_Issues/">Methods for Diagnosing Network Issues</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/deployment_guide/">
    Deployment Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/deployment_guide/config_optional_netq/Configuring_Optional_NetQ_Capabilities/">Configuring Optional Net Q Capabilities</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/deployment_preface/Deployment_Preface/">Deployment Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/install_netq/Install_NetQ/">Install Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/maintain_netq/Maintain_NetQ/">Maintain Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/netq_primer/Cumulus_NetQ_Primer/">Cumulus Net Q Primer</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/Release_Notes/Cumulus_NetQ_2.0_Release_Notes/">Cumulus Net Q 2.0 Release Notes</a>
    </li>
    
    <li>
      <a href="/NetQ/getting_started/Getting_Started_with_the_Cumulus_NetQ_Appliance/">Getting Started With the Cumulus Net Q Appliance</a>
    </li>
    
    <li>
      <a href="/NetQ/software_installation_guide/Cumulus_NetQ_Appliance_Software_Installation_Guide/">Cumulus Net Q Appliance Software Installation Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Equal Cost Multipath Load Sharing Hardware E C M P</strong>
</header>

      
<article class="markdown">

<h1 id="equal-cost-multipath-load-sharing-hardware-ecmp">Equal Cost Multipath Load Sharing - Hardware ECMP</h1>

<p>Cumulus Linux supports hardware-based <a href="http://en.wikipedia.org/wiki/Equal-cost_multi-path_routing">equal cost
multipath</a>
(ECMP) load sharing. ECMP is enabled by default in Cumulus Linux. Load
sharing occurs automatically for all routes with multiple next hops
installed. ECMP load sharing supports both IPv4 and IPv6 routes.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-EqualCostRouting">Equal Cost
Routing</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-ECMPHashing">ECMP
Hashing</a>

<ul>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-Usecl-ecmpcalctoDeterminetheHashResult">Use cl-ecmpcalc to Determine the Hash
Result</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-cl-ecmpcalcLimitations">cl-ecmpcalc
Limitations</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-ECMPHashBuckets">ECMP Hash
Buckets</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-ConfigureaHashSeedtoAvoidHashPolarization">Configure a Hash Seed to Avoid Hash
Polarization</a></li>
</ul></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-ResilientHashing">Resilient
Hashing</a>

<ul>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-ResilientHashBuckets">Resilient Hash
Buckets</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-RemoveNextHops">Remove Next
Hops</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-AddNextHops">Add Next
Hops</a></li>
<li><a href="#EqualCostMultipathLoadSharing-HardwareECMP-ConfigureResilientHashing">Configure Resilient
Hashing</a></li>
</ul></li>
</ul>

<h2 id="equal-cost-routing">Equal Cost Routing</h2>

<p>ECMP operates only on equal cost routes in the Linux routing table. </p>

<p>In this example, the 10.1.1.0/24 route has two possible next hops that
have been installed in the routing table:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">$ ip route show 10.1.1.0/24
10.1.1.0/24  proto zebra  metric 20
 nexthop via 192.168.1.1 dev swp1 weight 1 onlink
 nexthop via 192.168.2.1 dev swp2 weight 1 onlink</code></pre></div>
<p>For routes to be considered equal they must:</p>

<ul>
<li>Originate from the same routing protocol. Routes from different
sources are not considered equal. For example, a static route and an
OSPF route are not considered for ECMP load sharing.</li>
<li>Have equal cost. If two routes from the same protocol are unequal,
only the best route is installed in the routing table.</li>
</ul>

<p>The BGP <code>maximum-paths</code> setting is enabled, so multiple routes are
installed by default. See the <a href="Border-Gateway-Protocol---BGP_8362926.html#BorderGatewayProtocol-BGP-ecmp">ECMP
section</a>
of the BGP chapter for more information.</p>

<h2 id="ecmp-hashing">ECMP Hashing</h2>

<p>Once multiple routes are installed in the routing table, a hash is used
to determine which path a packet follows.  </p>

<p>Cumulus Linux hashes on the following fields:</p>

<ul>
<li>IP protocol</li>
<li>Ingress interface</li>
<li>Source IPv4 or IPv6 address</li>
<li>Destination IPv4 or IPv6 address</li>
</ul>

<p>For TCP/UDP frames, Cumulus Linux also hashes on:</p>

<ul>
<li>Source port</li>
<li>Destination port</li>
</ul>

<p><img src="attachments/8362929/8362930.png" alt="" />{width=&ldquo;500&rdquo;}</p>

<p>To prevent out of order packets, ECMP hashing is done on a per-flow
basis, which means that all packets with the same source and destination
IP addresses and the same source and destination ports always hash to
the same next hop. ECMP hashing does not keep a record of flow states.</p>

<p>ECMP hashing does not keep a record of packets that have hashed to each
next hop and does not guarantee that traffic sent to each next hop is
equal. </p>

<h3 id="use-cl-ecmpcalc-to-determine-the-hash-result">Use cl-ecmpcalc to Determine the Hash Result</h3>

<p>Since the hash is deterministic and always provides the same result for
the same input, you can query the hardware and determine the hash result
of a given input. This is useful when determining exactly which path a
flow takes through a network. </p>

<p>On Cumulus Linux, use the <code>cl-ecmpcalc</code> command to determine a hardware
hash result.</p>

<p>In order to use <code>cl-ecmpcalc</code>, all fields that are used in the hash must
be provided. This includes ingress interface, layer 3 source IP, layer 3
destination IP, layer 4 source port and layer 4 destination port. </p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">$ sudo cl-ecmpcalc -i swp1 -s 10.0.0.1 -d 10.0.0.1 -p tcp --sport 20000 --dport 80
ecmpcalc: will query hardware
swp3</code></pre></div>
<p>If any field is omitted, <code>cl-ecmpcalc</code> fails.</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">$ sudo cl-ecmpcalc -i swp1 -s 10.0.0.1 -d 10.0.0.1 -p tcp 
ecmpcalc: will query hardware
usage: cl-ecmpcalc [-h] [-v] [-p PROTOCOL] [-s SRC] [--sport SPORT] [-d DST] 
                   [--dport DPORT] [--vid VID] [-i IN_INTERFACE]
                   [--sportid SPORTID] [--smodid SMODID] [-o OUT_INTERFACE]
                   [--dportid DPORTID] [--dmodid DMODID] [--hardware] 
                   [--nohardware] [-hs HASHSEED]
                   [-hf HASHFIELDS [HASHFIELDS ...]]
                   [--hashfunction {crc16-ccitt,crc16-bisync}] [-e EGRESS]
                   [-c MCOUNT]
cl-ecmpcalc: error: --sport and --dport required for TCP and UDP frames</code></pre></div>
<h3 id="cl-ecmpcalc-limitations">cl-ecmpcalc Limitations</h3>

<p><code>cl-ecmpcalc</code> can only take input interfaces that can be converted to a
single physical port in the port tab file, like the physical switch
ports (swp). Virtual interfaces like bridges, bonds, and subinterfaces
are not supported.</p>

<p><code>cl-ecmpcalc</code> is supported only on switches with the <a href="http://cumulusnetworks.com/hcl/">Mellanox Spectrum
and the Broadcom Maverick, Tomahawk, Trident II, Trident II+ and
Trident3</a> chipsets.</p>

<h3 id="ecmp-hash-buckets">ECMP Hash Buckets</h3>

<p>When multiple routes are installed in the routing table, each route is
assigned to an ECMP <em>bucket</em>. When the ECMP hash is executed the result
of the hash determines which bucket gets used.</p>

<p>In the following example, 4 next hops exist. Three different flows are
hashed to different hash buckets. Each next hop is assigned to a unique
hash bucket.</p>

<p><img src="attachments/8362929/8362936.png" alt="" />{width=&ldquo;500&rdquo;}</p>

<h4 id="add-a-next-hop">Add a Next Hop</h4>

<p>When a next hop is added, a new hash bucket is created. The assignment
of next hops to hash buckets, as well as the hash result, may change
when additional next hops are added. </p>

<p><img src="attachments/8362929/8362935.png" alt="" />{width=&ldquo;500&rdquo;}<br />
A new next hop is added and a new hash bucket is created. As a result,
the hash and hash bucket assignment changed, causing the existing flows
to be sent to different next hops.</p>

<h4 id="remove-a-next-hop">Remove a Next Hop</h4>

<p>When a next hop is removed, the remaining hash bucket assignments may
change, again, potentially changing the next hop selected for an
existing flow. </p>

<p><img src="attachments/8362929/8362932.png" alt="" />{width=&ldquo;500&rdquo;}     
 <img src="attachments/8362929/8362931.png" alt="" />{width=&ldquo;500&rdquo;}<br />
A next hop fails and the next hop and hash bucket are removed. The
remaining next hops may be reassigned.</p>

<p>In most cases, the modification of hash buckets has no impact on traffic
flows as traffic is being forward to a single end host. In deployments
where multiple end hosts are using the same IP address (anycast),
<em>resilient hashing</em> must be used.</p>

<h3 id="configure-a-hash-seed-to-avoid-hash-polarization">Configure a Hash Seed to Avoid Hash Polarization</h3>

<p>It is useful to have a unique hash seed for each switch. This helps
avoid <em>hash polarization</em>, a type of network congestion that occurs when
multiple data flows try to reach a switch using the same switch ports. </p>

<p>The hash seed is set by the <code>ecmp_hash_seed</code> parameter in
the <code>/etc/cumulus/datapath/traffic.conf</code> file. It is an integer with a
value from 0 to 4294967295. If you don&rsquo;t specify a value for it,
<code>switchd</code> creates a randomly generated seed instead.</p>

<p>To set the hash seed to <em>50</em> for example, run the following commands:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add forwarding ecmp hash-seed 50
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration in the
<code>/etc/cumulus/datapath/traffic.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ cat /etc/cumulus/datapath/traffic.conf

...

#Specify the hash seed for Equal cost multipath entries
ecmp_hash_seed = 50

...
cumulus@leaf01:~$</code></pre></div>
<p> </p>

<h2 id="resilient-hashing">Resilient Hashing</h2>

<p>In Cumulus Linux, when a next hop fails or is removed from an ECMP pool,
the hashing or hash bucket assignment can change. For deployments where
there is a need for flows to always use the same next hop, like TCP
anycast deployments, this can create session failures. </p>

<p>The ECMP hash performed with resilient hashing is exactly the same as
the default hashing mode. Only the method in which next hops are
assigned to hash buckets differs.</p>

<p>Resilient hashing supports both IPv4 and IPv6 routes.</p>

<p>Resilient hashing is not enabled by default. See below for steps on
configuring it.</p>

<p>Resilient hashing prevents disruptions when next hops are removed. It
does not prevent disruption when next hops are added.</p>

<p>Resilient hashing is supported only on switches with the <a href="http://cumulusnetworks.com/hcl/">Broadcom
Tomahawk, Trident II, Trident II+, and Trident3 as well as Mellanox
Spectrum</a> chipsets. You can
run <code>net show system </code>to determine the chipset.</p>

<p> </p>

<h3 id="resilient-hash-buckets">Resilient Hash Buckets</h3>

<p>When resilient hashing is configured, a fixed number of buckets are
defined. Next hops are then assigned in round robin fashion to each of
those buckets. In this example, 12 buckets are created and four next
hops are assigned.</p>

<p><img src="attachments/8362929/8362928.png" alt="" />{width=&ldquo;500&rdquo;}</p>

<h3 id="remove-next-hops">Remove Next Hops</h3>

<p>Unlike default ECMP hashing, when a next hop needs to be removed, the
number of hash buckets does not change. </p>

<p><img src="attachments/8362929/8362934.png" alt="" />{width=&ldquo;500&rdquo;}<br />
With 12 buckets assigned and four next hops, instead of reducing the
number of buckets — which would impact flows to known good hosts — the
remaining next hops replace the failed next hop.</p>

<p><img src="attachments/8362929/8362937.png" alt="" />{width=&ldquo;500&rdquo;}</p>

<p>After the failed next hop is removed, the remaining next hops are
installed as replacements. This prevents impact to any flows that hash
to working next hops.</p>

<h3 id="add-next-hops">Add Next Hops</h3>

<p>Resilient hashing does not prevent possible impact to existing flows
when new next hops are added. Due to the fact there are a fixed number
of buckets, a new next hop requires reassigning next hops to buckets. </p>

<p><img src="attachments/8362929/8362933.png" alt="" />{width=&ldquo;500&rdquo;}</p>

<p>As a result, some flows may hash to new next hops, which can impact
anycast deployments.</p>

<h3 id="configure-resilient-hashing">Configure Resilient Hashing</h3>

<p>Resilient hashing is not enabled by default. When resilient hashing is
enabled, 65,536 buckets are created to be shared among all ECMP groups.
An ECMP group is a list of unique next hops that are referenced by
multiple ECMP routes.</p>

<p>An ECMP route counts as a single route with multiple next hops. The
following example is considered to be a single ECMP route:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">$ ip route show 10.1.1.0/24
10.1.1.0/24  proto zebra  metric 20
 nexthop via 192.168.1.1 dev swp1 weight 1 onlink
 nexthop via 192.168.2.1 dev swp2 weight 1 onlink</code></pre></div>
<p>All ECMP routes must use the same number of buckets (the number of
buckets cannot be configured per ECMP route).</p>

<p>The number of buckets can be configured as 64, 128, 256, 512 or 1024;
the default is 128:</p>

<table>
<thead>
<tr>
<th>Number of Hash Buckets</th>
<th>Number of Supported ECMP Groups</th>
</tr>
</thead>

<tbody>
<tr>
<td>64</td>
<td>1024</td>
</tr>

<tr>
<td><strong>128</strong></td>
<td><strong>512</strong></td>
</tr>

<tr>
<td>256</td>
<td>256</td>
</tr>

<tr>
<td>512</td>
<td>128</td>
</tr>

<tr>
<td>1024</td>
<td>64</td>
</tr>
</tbody>
</table>

<p>A larger number of ECMP buckets reduces the impact on adding new next
hops to an ECMP route. However, the system supports fewer ECMP routes.
If the maximum number of ECMP routes have been installed, new ECMP
routes log an error and are not installed. </p>

<p>To enable resilient hashing, edit <code>/etc/cumulus/datapath/traffic.conf</code>:</p>

<ol>
<li><p>Enable resilient hashing:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain"># Enable resilient hashing
resilient_hash_enable = TRUE</code></pre></div></li>

<li><p><strong>(Optional)</strong> Edit the number of hash buckets:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain"># Resilient hashing flowset entries per ECMP group
# Valid values - 64, 128, 256, 512, 1024
resilient_hash_entries_ecmp = 256</code></pre></div></li>

<li><p><a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">Restart</a>
the <code>switchd</code> service:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ sudo systemctl restart switchd.service</code></pre></div></li>
</ol>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362935.png">ECMP Hash
Bucket Added.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362936.png">ECMP Hash
Bucket.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362937.png">Reshash
Restore.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362928.png">Reshash bucket
assignment.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362930.png">Packet
Hash.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362931.png">Hash
Post-Failure.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362932.png">Hash
Failure.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362933.png">Reshash
Add.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362929/8362934.png">Reshash
Failure.png</a> (image/png)</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#equal-cost-multipath-load-sharing-hardware-ecmp">Equal Cost Multipath Load Sharing - Hardware ECMP</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#equal-cost-routing">Equal Cost Routing</a></li>
<li><a href="#ecmp-hashing">ECMP Hashing</a>
<ul>
<li><a href="#use-cl-ecmpcalc-to-determine-the-hash-result">Use cl-ecmpcalc to Determine the Hash Result</a></li>
<li><a href="#cl-ecmpcalc-limitations">cl-ecmpcalc Limitations</a></li>
<li><a href="#ecmp-hash-buckets">ECMP Hash Buckets</a>
<ul>
<li><a href="#add-a-next-hop">Add a Next Hop</a></li>
<li><a href="#remove-a-next-hop">Remove a Next Hop</a></li>
</ul></li>
<li><a href="#configure-a-hash-seed-to-avoid-hash-polarization">Configure a Hash Seed to Avoid Hash Polarization</a></li>
</ul></li>
<li><a href="#resilient-hashing">Resilient Hashing</a>
<ul>
<li><a href="#resilient-hash-buckets">Resilient Hash Buckets</a></li>
<li><a href="#remove-next-hops">Remove Next Hops</a></li>
<li><a href="#add-next-hops">Add Next Hops</a></li>
<li><a href="#configure-resilient-hashing">Configure Resilient Hashing</a></li>
</ul></li>
<li><a href="#attachments">Attachments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
