<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Routing | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.20b2cb98a9208e1e7497525a9f78f7f8eb0ca4b5f4551e9610f12c5b317e6be8.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/" class="active">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>
 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/">
    U I User Guide</a> 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/monitor_the_network/">
    Monitor the Network</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_alarm_events/Monitor_Alarm_Events/">Monitor Alarm Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_informational_events/Monitor_Informational_Events/">Monitor Informational Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_health/Monitor_Network_Health/">Monitor Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_inventory/Monitor_Network_Inventory/">Monitor Network Inventory</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_protocols/Monitor_Network_Layer_Protocols/">Monitor Network Layer Protocols</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_switches/Monitor_Switches/">Monitor Switches</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/netq_ui_overview/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/ui_preface/UI_Preface/">U I Preface</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/cli_user_guide/">
    Cli User Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/cli_user_guide/CLI_Preface/CLI_Preface/">C L I Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/automate_common_tasks/Automate_Common_and_Repetitive_Tasks/">Automate Common and Repetitive Tasks</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/command_line_overview/NetQ_Command_Line_Overview/">Net Q Command Line Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_containter_environments/Monitor_Container_Environments/">Monitor Container Environments</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_data_link_layer/Monitor_Data_Link_Layer_Devices_and_Protocols/">Monitor Data Link Layer Devices and Protocols</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_linux_hosts/Monitor_Linux_Hosts/">Monitor Linux Hosts</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_health/Monitor_Overall_Network_Health/">Monitor Overall Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_layer/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_physical_layer/Monitor_Physical_Layer_Components/">Monitor Physical Layer Components</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_switch_hardware/Monitor_Switch_Hardware_and_Software/">Monitor Switch Hardware and Software</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_virtual_overlays/Monitor_Virtual_Network_Overlays/">Monitor Virtual Network Overlays</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_Issues/">Resolve Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_MLAG_Issues/">Resolve M L a G Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/investiage_netq_issues/Investigate_NetQ_Issues/">Investigate Net Q Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/methods_for_diagnosing_issues/Methods_for_Diagnosing_Network_Issues/">Methods for Diagnosing Network Issues</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/deployment_guide/">
    Deployment Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/deployment_guide/config_optional_netq/Configuring_Optional_NetQ_Capabilities/">Configuring Optional Net Q Capabilities</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/deployment_preface/Deployment_Preface/">Deployment Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/install_netq/Install_NetQ/">Install Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/maintain_netq/Maintain_NetQ/">Maintain Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/netq_primer/Cumulus_NetQ_Primer/">Cumulus Net Q Primer</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/Release_Notes/Cumulus_NetQ_2.0_Release_Notes/">Cumulus Net Q 2.0 Release Notes</a>
    </li>
    
    <li>
      <a href="/NetQ/getting_started/Getting_Started_with_the_Cumulus_NetQ_Appliance/">Getting Started With the Cumulus Net Q Appliance</a>
    </li>
    
    <li>
      <a href="/NetQ/software_installation_guide/Cumulus_NetQ_Appliance_Software_Installation_Guide/">Cumulus Net Q Appliance Software Installation Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Routing</strong>
</header>

      
<article class="markdown">

<h1 id="routing">Routing</h1>

<p>This chapter discusses routing on switches running Cumulus Linux.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#Routing-ManageStaticRoutes">Manage Static Routes</a>

<ul>
<li><a href="#Routing-StaticMulticastRoutes">Static Multicast Routes</a></li>
<li><a href="#Routing-StaticRoutingviaiproute">Static Routing via ip route</a></li>
<li><a href="#Routing-ApplyaRouteMapforRouteUpdates">Apply a Route Map for Route
Updates</a></li>
</ul></li>
<li><a href="#Routing-ConfigureaGatewayorDefaultRoute">Configure a Gateway or Default
Route</a></li>
<li><a href="#Routing-SupportedRouteTableEntries">Supported Route Table Entries</a>

<ul>
<li><a href="#Routing-uftForwardingTableProfiles">Forwarding Table Profiles</a></li>
<li><a href="#Routing-NumberofSupportedRouteEntries,byPlatform">Number of Supported Route Entries, by
Platform</a></li>
<li><a href="#Routing-tcamTCAMResourceProfilesforMellanoxSwitches">TCAM Resource Profiles for Mellanox
Switches</a></li>
</ul></li>
<li><a href="#Routing-CaveatsandErrata">Caveats and Errata</a>

<ul>
<li><a href="#Routing-Don'tDeleteRoutesviaLinuxShell">Don&rsquo;t Delete Routes via Linux
Shell</a></li>
<li><a href="#Routing-AddIPv6DefaultRoutewithsrcAddressoneth0FailswithoutAddingDelay">Add IPv6 Default Route with src Address on eth0 Fails without
Adding
Delay</a></li>
</ul></li>
<li><a href="#Routing-RelatedInformation">Related Information</a></li>
</ul>

<h2 id="manage-static-routes">Manage Static Routes</h2>

<p>You manage static routes
using <a href="Network_Command_Line_Utility_-_NCLU">NCLU</a> or the Cumulus Linux
<code>ip route</code> command. The routes are added to the
<a href="https://frrouting.org">FRRouting</a> routing table, and are then updated
into the kernel routing table as well.</p>

<p>To add a static route, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add routing route 203.0.113.0/24 198.51.100.2
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration in the
<code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">!
ip route 203.0.113.0/24 198.51.100.2
!</code></pre></div>
<p>To delete a static route, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net del routing route 203.0.113.0/24 198.51.100.2
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>To view static routes, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show route static 
RIB entry for static
====================
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, T - Table,
       &gt; - selected route, * - FIB route
S&gt;* 203.0.113.0/24 [1/0] via 198.51.100.2, swp3</code></pre></div>
<h3 id="static-multicast-routes">Static Multicast Routes</h3>

<p>Static mroutes are also managed with NCLU, or with the <code>ip route</code>
command. To add an mroute:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add routing mroute 230.0.0.0/24
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration in the
<code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">!
ip mroute 230.0.0.0/24
!</code></pre></div>
<p>To delete an mroute, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net del routing mroute 230.0.0.0/24
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>To view mroutes, open the FRRouting CLI, and run the following command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo vtysh
switch# show ip rpf 230.0.0.0
Routing entry for 230.0.0.0/24 using Multicast RIB
  Known via &#34;static&#34;, distance 1, metric 0, best
  * directly connected, swp31s0</code></pre></div>
<h3 id="static-routing-via-ip-route">Static Routing via ip route</h3>

<p>A static route can also be created by
adding <code>post-up ip route add </code>command to a switch port configuration.
For example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp3 ip address 198.51.100.1/24
cumulus@switch:~$ net add interface swp3 post-up routing route add 203.0.113.0/24 via 198.51.100.2
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands produce the following configuration in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">auto swp3
iface swp3
    address 198.51.100.1/24
    post-up ip route add 203.0.113.0/24 via 198.51.100.2</code></pre></div>
<p>If an IPv6 address is assigned to a DOWN interface, the associated route
is still installed into the routing table. The type of IPv6 address
doesn&rsquo;t matter: link local, site local and global all exhibit the same
problem. </p>

<p>If the interface is bounced up and down, then the routes are no longer
in the route table.</p>

<p>The <code>ip route</code> command allows manipulating the kernel routing table
directly from the Linux shell. See <code>man ip(8)</code> for
details. FRRouting monitors the kernel routing table changes and updates
its own routing table accordingly.</p>

<p>To display the routing table:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ ip route show
default via 10.0.1.2 dev eth0
10.0.1.0/24 dev eth0  proto kernel  scope link  src 10.0.1.52
192.0.2.0/24 dev swp1  proto kernel  scope link  src 192.0.2.12
192.0.2.10/24 via 192.0.2.1 dev swp1  proto zebra  metric 20
192.0.2.20/24  proto zebra  metric 20
     nexthop via 192.0.2.1  dev swp1 weight 1
     nexthop via 192.0.2.2  dev swp2 weight 1
192.0.2.30/24 via 192.0.2.1 dev swp1  proto zebra  metric 20
192.0.2.40/24 dev swp2  proto kernel  scope link  src 192.0.2.42
192.0.2.50/24 via 192.0.2.2 dev swp2  proto zebra  metric 20
192.0.2.60/24 via 192.0.2.2 dev swp2  proto zebra  metric 20
192.0.2.70/24  proto zebra  metric 30
     nexthop via 192.0.2.1  dev swp1 weight 1
     nexthop via 192.0.2.2  dev swp2 weight 1
198.51.100.0/24 dev swp3  proto kernel  scope link  src 198.51.100.1
198.51.100.10/24 dev swp4  proto kernel  scope link  src 198.51.100.11
198.51.100.20/24 dev br0  proto kernel  scope link  src 198.51.100.21</code></pre></div>
<h3 id="apply-a-route-map-for-route-updates">Apply a Route Map for Route Updates</h3>

<p>To apply a <a href="http://www.nongnu.org/quagga/docs/docs-multi/Route-Map.html#Route-Map">route
map</a> to filter
route updates from Zebra into the Linux kernel:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:$ net add routing protocol static route-map &lt;route-map-name&gt;</code></pre></div>
<h2 id="configure-a-gateway-or-default-route">Configure a Gateway or Default Route</h2>

<p>On each switch, it&rsquo;s a good idea to create a <em>gateway</em> or <em>default
route</em> for traffic destined outside the switch&rsquo;s subnet, or local
network. All such traffic passes through the gateway, which is a host on
the same network that routes packets to their destination beyond the
local network. </p>

<p>In the following example, you create a default route in the routing
table — 0.0.0.0/0 — which indicates any IP address can get sent to the
gateway, which is another switch with the IP address 10.1.0.1.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add routing route 0.0.0.0/0 10.1.0.1
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h2 id="supported-route-table-entries">Supported Route Table Entries</h2>

<p>Cumulus Linux — via <code>switchd</code> — advertises the maximum number of route
table entries that are supported on a given switch architecture,
including:</p>

<ul>
<li>L3 IPv4 LPM (longest prefix match) entries, which have a mask that
is less than /32</li>
<li>L3 IPv6 LPM entries, which have a mask that is /64 or less</li>
<li>L3 IPv6 LPM entries, which have a mask that is greater than /64</li>
<li>L3 IPv4 neighbor (or host) entries, which are the next hops seen in
<code>ip neighbor</code></li>
<li>L3 IPv6 neighbor entries, which are the next hops seen
in <code>ip -6 neighbor</code></li>
<li>ECMP next hops, which are IP address entries in a router&rsquo;s routing
table that specify the next closest/most optimal router in its
routing path</li>
<li>MAC addresses</li>
</ul>

<p>In addition, switches on the Tomahawk, Trident II, Trident II+, and
Trident3 platforms are configured to manage route table entries using
Algorithm Longest Prefix Match (ALPM). In ALPM mode, the hardware can
store significantly more route entries.</p>

<p>You can use
<a href="Resource_Diagnostics_Using_cl-resource-query"><code>cl-resource-query</code></a> to
determine the current table sizes on a given switch.</p>

<h3 id="forwarding-table-profiles">Forwarding Table Profiles</h3>

<p>Mellanox Spectrum and some Broadcom ASICs provide the ability to
configure the allocation of forwarding table resources and mechanisms.
Cumulus Linux provides a number of generalized profiles for the
platforms described below. These profiles work only with layer 2 and
layer 3 unicast forwarding.</p>

<p>Cumulus Linux defines these profiles as <em>default</em>, <em>l</em>
<em>2-heavy</em>, *v4-lpm-heavy* and <em>v6-lpm-heavy</em>. Choose the profile that
best suits your network architecture and specify the profile name for
the <code>forwarding_table.profile</code> variable in
the <code>/etc/cumulus/datapath/traffic.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ cat /etc/cumulus/datapath/traffic.conf | grep forwarding_table -B 4
# Manage shared forwarding table allocations
# Valid profiles - 
# default, l2-heavy, v4-lpm-heavy, v6-lpm-heavy
#
forwarding_table.profile = default</code></pre></div>
<p>After you specify a different
profile, <a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">restart <code>switchd</code></a>
 for the change to take effect. You can see the forwarding table
profile when you run <code>cl-resource-query</code>.</p>

<p>Broadcom ASICs other than Maverick, Tomahawk/Tomahawk+, Trident II,
Trident II+, and Trident3 support only the *default* profile.</p>

<p>For Broadcom ASICs, the maximum number of IP multicast entries is 8k.</p>

<h3 id="number-of-supported-route-entries-by-platform">Number of Supported Route Entries, by Platform</h3>

<p>The following tables list the number of MAC addresses, layer 3 neighbors
and LPM routes validated for each forwarding table profile for the
various supported platforms. If you are not specifying any profiles as
described above, the <em>default</em> values are the ones that the switch will
use.</p>

<p>The values in the following tables reflect results from our testing on
the different platforms we support, and may differ from published
manufacturers&rsquo; specifications provided about these chipsets.</p>

<h4 id="mellanox-spectrum-switches">Mellanox Spectrum Switches</h4>

<table>
<thead>
<tr>
<th>Profile</th>
<th>MAC Addresses</th>
<th>L3 Neighbors</th>
<th>Longest Prefix Match (LPM)</th>
</tr>
</thead>

<tbody>
<tr>
<td>default</td>
<td>40k</td>
<td>32k (IPv4) and 16k (IPv6)</td>
<td>64k (IPv4) or 28k (IPv6-long) </td>
</tr>

<tr>
<td>l2-heavy</td>
<td>88k</td>
<td>48k (IPv4) and 40k (IPv6)</td>
<td>8k (IPv4) and 8k (IPv6-long)</td>
</tr>

<tr>
<td>l2-heavy-1</td>
<td>180K</td>
<td>8k (IPv4) and 8k (IPv6)</td>
<td>8k (IPv4) and 8k (IPv6-long)</td>
</tr>

<tr>
<td>v4-lpm-heavy</td>
<td>8k</td>
<td>8k (IPv4) and 16k (IPv6)</td>
<td>80k (IPv4) and 16k (IPv6-long)</td>
</tr>

<tr>
<td>v4-lpm-heavy-1</td>
<td>8k</td>
<td>8k (IPv4) and 2k (IPv6)</td>
<td>176k (IPv4) and 2k (IPv6-long)</td>
</tr>

<tr>
<td>v6-lpm-heavy</td>
<td>40k</td>
<td>8k (IPv4) and 40k (IPv6)</td>
<td>8k (IPv4) and 64k (IPv6-long)</td>
</tr>
</tbody>
</table>

<h4 id="broadcom-tomahawk-tomahawk-switches">Broadcom Tomahawk/Tomahawk+ Switches</h4>

<table>
<thead>
<tr>
<th>Profile</th>
<th>MAC Addresses</th>
<th>L3 Neighbors</th>
<th>Longest Prefix Match (LPM)</th>
</tr>
</thead>

<tbody>
<tr>
<td>default</td>
<td>40k</td>
<td>40k</td>
<td>64k (IPv4) or 8k (IPv6-long)</td>
</tr>

<tr>
<td>l2-heavy</td>
<td>72k</td>
<td>72k</td>
<td>8k (IPv4) or 2k (IPv6-long)</td>
</tr>

<tr>
<td>v4-lpm-heavy, v6-lpm-heavy</td>
<td>8k</td>
<td>8k</td>
<td>128k (IPv4) or 20k (IPv6-long)</td>
</tr>
</tbody>
</table>

<h4 id="broadcom-trident-ii-trident-ii-trident3-switches">Broadcom Trident II/Trident II+/Trident3 Switches</h4>

<table>
<thead>
<tr>
<th>Profile</th>
<th>MAC Addresses</th>
<th>L3 Neighbors</th>
<th>Longest Prefix Match (LPM)</th>
</tr>
</thead>

<tbody>
<tr>
<td>default</td>
<td>32k</td>
<td>16k </td>
<td>128k (IPv4) or 20k (IPv6-long)</td>
</tr>

<tr>
<td>l2-heavy</td>
<td>160k</td>
<td>96k </td>
<td>8k (IPv4) or 2k (IPv6-long) </td>
</tr>

<tr>
<td>v4-lpm-heavy, v6-lpm-heavy</td>
<td>32k</td>
<td>16k </td>
<td>128k (IPv4) or 20k (IPv6-long)  </td>
</tr>
</tbody>
</table>

<h4 id="broadcom-helix4-switches">Broadcom Helix4 Switches</h4>

<p>Note that Helix4 switches do not have profiles</p>

<table>
<thead>
<tr>
<th>MAC Addresses</th>
<th>L3 Neighbors</th>
<th>Longest Prefix Match (LPM)</th>
</tr>
</thead>

<tbody>
<tr>
<td>24k</td>
<td>12k</td>
<td>7.8k (IPv4) or 2k (IPv6-long)</td>
</tr>
</tbody>
</table>

<p>For Broadcom switches, IPv4 and IPv6 entries are not carved in separate
spaces so it is not possible to define explicit numbers in the L3
Neighbors column of the tables shown above. However, note that an IPv6
entry takes up twice the space of an IPv4 entry.</p>

<h3 id="tcam-resource-profiles-for-mellanox-switches">TCAM Resource Profiles for Mellanox Switches</h3>

<p>The Mellanox Spectrum ASIC provides the ability to configure the TCAM
resource allocation, which is shared between IP multicast forwarding
entries and ACL tables. Cumulus Linux provides a number of general
profiles for this platform: <em>default</em>, *ipmc-heavy* and <em>acl-heavy</em>.
Choose the profile that best suits your network architecture and specify
that profile name in the <code>tcam_resource.profile</code> variable in
the <code>/usr/lib/python2.7/dist-packages/cumulus/__chip_config/mlx/datapath.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ cat /usr/lib/python2.7/dist-packages/cumulus/__chip_config/mlx/datapath.conf | grep -B3 &#34;tcam_resource&#34;
#TCAM resource forwarding profile


    1. Valid profiles -
    2. default, ipmc-heavy, acl-heavy, ipmc-max
       tcam_resource.profile = default</code></pre></div>
<p>After you specify a different
profile, <a href="https://docs.cumulusnetworks.com/display/DOCS/Configuring+switchd#Configuringswitchd-restartswitchd">restart <code>switchd</code> </a> for
the change to take effect.</p>

<p>When <a href="Netfilter---ACLs_8362563.html#Netfilter-ACLs-nonatomic">nonatomic
updates</a> are
enabled (that is, the <code>acl.non_atomic_update_mode</code> is set
to *TRUE* in <code>/etc/cumulus/switchd.conf</code> file), the maximum number of
mroute and ACL entries for each profile are as follows:</p>

<table>
<thead>
<tr>
<th>Profile</th>
<th>Mroute Entries</th>
<th>ACL Entries</th>
</tr>
</thead>

<tbody>
<tr>
<td>default</td>
<td>1000</td>
<td>500 (IPv6) or 1000 (IPv4)</td>
</tr>

<tr>
<td>ipmc-heavy</td>
<td>8500</td>
<td>1000 (IPv6) or 1500 (IPv4)</td>
</tr>

<tr>
<td>acl-heavy</td>
<td>450</td>
<td>2000 (IPv6) or 3500 (IPv4)</td>
</tr>

<tr>
<td>ipmc-max</td>
<td>13000</td>
<td>1000 (IPv6) or 2000 (IPv4)</td>
</tr>
</tbody>
</table>

<p>When <a href="Netfilter---ACLs_8362563.html#Netfilter-ACLs-nonatomic">nonatomic
updates</a> are
disabled (that is, the <code>acl.non_atomic_update_mode</code> is set
to *FALSE* in <code>/etc/cumulus/switchd.conf</code> file), the maximum number of
mroute and ACL entries for each profile are as follows:</p>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Profile</th>
<th>Mroute Entries</th>
<th>ACL Entries</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>default</td>
<td>1000</td>
<td>250 (IPv6) or 500 (IPv4)</td>
</tr>
<tr class="even">
<td>ipmc-heavy</td>
<td><p>8500</p></td>
<td>500 (IPv6) or 750 (IPv4)</td>
</tr>
<tr class="odd">
<td>acl-heavy</td>
<td>450</td>
<td>1000 (IPv6) or 1750 (IPv4)</td>
</tr>
<tr class="even">
<td>ipmc-max</td>
<td>13000</td>
<td>500 (IPv6) or 1000 (IPv4)</td>
</tr>
</tbody>
</table>

<h2 id="caveats-and-errata">Caveats and Errata</h2>

<h3 id="don-t-delete-routes-via-linux-shell">Don&rsquo;t Delete Routes via Linux Shell</h3>

<p>Static routes added via FRRouting can be deleted via Linux shell. This
operation, while possible, should be avoided. Routes added by
FRRouting should only be deleted by FRRouting, otherwise FRRouting might
not be able to clean up all its internal state completely and incorrect
routing can occur as a result.</p>

<h3 id="add-ipv6-default-route-with-src-address-on-eth0-fails-without-adding-delay">Add IPv6 Default Route with src Address on eth0 Fails without Adding Delay</h3>

<p>Attempting to install an IPv6 default route on eth0 with a source
address fails at reboot or when running <code>ifup</code> on eth0. </p>

<p>The first execution of  <code>ifup -dv</code> returns this warning and does not
install the route:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ sudo ifup -dv eth0
warning: eth0: post-up cmd &#39;/sbin/ip route add default via 2001:620:5ca1:160::1 /
src 2001:620:5ca1:160::45 dev eth0&#39; failed (RTNETLINK answers: Invalid argument)&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code></pre></div>
<p>Running <code>ifup</code> a second time on eth0 successfully installs the route. </p>

<p>There are two ways you can work around this issue. </p>

<ul>
<li><p>Add a sleep 2 to the eth0 interface in <code>/etc/network/interfaces</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ net add interface eth0 ipv6 address 2001:620:5ca1:160::45/64 post-up /bin/sleep 2s
cumulus@switch:~$ net add interface eth0 post-up /sbin/ip route add default via 2001:620:5ca1:160::1 src 2001:620:5ca11:160::45 dev eth0</code></pre></div></li>

<li><p>Exclude the <code>src</code> parameter to the <code>ip route add</code> that causes the
need for the delay. If the <code>src</code> parameter is removed, the route is
added correctly.</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ net add interface eth0 post-up /sbin/ip route add default via 2001:620:5ca1:160::1 dev eth0</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@switch:~$ ifdown eth0
Stopping NTP server: ntpd.
Starting NTP server: ntpd.
cumulus@switch:~$ ip -6 r s
cumulus@switch:~$ ifup eth0
Stopping NTP server: ntpd.
Starting NTP server: ntpd.
cumulus@switch:~$ ip -6 r s
2001:620:5ca1:160::/64 dev eth0  proto kernel  metric 256 
fe80::/64 dev eth0  proto kernel  metric 256 
default via 2001:620:5ca1:160::1 dev eth0  metric 1024 </code></pre></div></li>
</ul>

<h2 id="related-information">Related Information</h2>

<ul>
<li>-   <a href="http://linux-ip.net/html/tools-ip-route.html">Linux IP - ip route
    command</a>

<ul>
<li><a href="https://frrouting.org/user-guide/zebra.html#static-route-commands">FRRouting docs - static route
commands</a></li>
</ul></li>
</ul>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#routing">Routing</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#manage-static-routes">Manage Static Routes</a>
<ul>
<li><a href="#static-multicast-routes">Static Multicast Routes</a></li>
<li><a href="#static-routing-via-ip-route">Static Routing via ip route</a></li>
<li><a href="#apply-a-route-map-for-route-updates">Apply a Route Map for Route Updates</a></li>
</ul></li>
<li><a href="#configure-a-gateway-or-default-route">Configure a Gateway or Default Route</a></li>
<li><a href="#supported-route-table-entries">Supported Route Table Entries</a>
<ul>
<li><a href="#forwarding-table-profiles">Forwarding Table Profiles</a></li>
<li><a href="#number-of-supported-route-entries-by-platform">Number of Supported Route Entries, by Platform</a>
<ul>
<li><a href="#mellanox-spectrum-switches">Mellanox Spectrum Switches</a></li>
<li><a href="#broadcom-tomahawk-tomahawk-switches">Broadcom Tomahawk/Tomahawk+ Switches</a></li>
<li><a href="#broadcom-trident-ii-trident-ii-trident3-switches">Broadcom Trident II/Trident II+/Trident3 Switches</a></li>
<li><a href="#broadcom-helix4-switches">Broadcom Helix4 Switches</a></li>
</ul></li>
<li><a href="#tcam-resource-profiles-for-mellanox-switches">TCAM Resource Profiles for Mellanox Switches</a></li>
</ul></li>
<li><a href="#caveats-and-errata">Caveats and Errata</a>
<ul>
<li><a href="#don-t-delete-routes-via-linux-shell">Don&rsquo;t Delete Routes via Linux Shell</a></li>
<li><a href="#add-ipv6-default-route-with-src-address-on-eth0-fails-without-adding-delay">Add IPv6 Default Route with src Address on eth0 Fails without Adding Delay</a></li>
</ul></li>
<li><a href="#related-information">Related Information</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
