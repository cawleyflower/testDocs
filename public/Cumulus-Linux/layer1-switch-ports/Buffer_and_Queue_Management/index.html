<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buffer and Queue Management | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.20b2cb98a9208e1e7497525a9f78f7f8eb0ca4b5f4551e9610f12c5b317e6be8.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/" class="active">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>
 
  <ul>
    
    <li><a href="/NetQ/Cumulus_NetQ_UI_User_Guide/">
    Cumulus Net Q U I User Guide</a> 
  <ul>
    
    <li><a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/">
    Monitor the Network</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/Monitor_Alarm_Events/">Monitor Alarm Events</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/Monitor_Informational_Events/">Monitor Informational Events</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/Monitor_Network_Health/">Monitor Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/Monitor_Network_Inventory/">Monitor Network Inventory</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/monitor_the_network/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/Monitor_Switches/">Monitor Switches</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/UI_Preface/">U I Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/Cumulus_NetQ_UI_User_Guide/Validate_Network_Protocol_and_Service_Operations/">Validate Network Protocol and Service Operations</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/cli_user_guide/">
    Cli User Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/cli_user_guide/CLI_Preface/CLI_Preface/">C L I Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/automate_common_tasks/Automate_Common_and_Repetitive_Tasks/">Automate Common and Repetitive Tasks</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/command_line_overview/NetQ_Command_Line_Overview/">Net Q Command Line Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_containter_environments/Monitor_Container_Environments/">Monitor Container Environments</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_data_link_layer/Monitor_Data_Link_Layer_Devices_and_Protocols/">Monitor Data Link Layer Devices and Protocols</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_linux_hosts/Monitor_Linux_Hosts/">Monitor Linux Hosts</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_health/Monitor_Overall_Network_Health/">Monitor Overall Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_layer/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_physical_layer/Monitor_Physical_Layer_Components/">Monitor Physical Layer Components</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_switch_hardware/Monitor_Switch_Hardware_and_Software/">Monitor Switch Hardware and Software</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_virtual_overlays/Monitor_Virtual_Network_Overlays/">Monitor Virtual Network Overlays</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_Issues/">Resolve Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_MLAG_Issues/">Resolve M L a G Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/investiage_netq_issues/Investigate_NetQ_Issues/">Investigate Net Q Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/methods_for_diagnosing_issues/Methods_for_Diagnosing_Network_Issues/">Methods for Diagnosing Network Issues</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/deployment_guide/">
    Deployment Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/deployment_guide/config_optional_netq/Configuring_Optional_NetQ_Capabilities/">Configuring Optional Net Q Capabilities</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/deployment_preface/Deployment_Preface/">Deployment Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/install_netq/Install_NetQ/">Install Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/maintain_netq/Maintain_NetQ/">Maintain Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/netq_primer/Cumulus_NetQ_Primer/">Cumulus Net Q Primer</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/Release_Notes/Cumulus_NetQ_2.0_Release_Notes/">Cumulus Net Q 2.0 Release Notes</a>
    </li>
    
    <li>
      <a href="/NetQ/getting_started/Getting_Started_with_the_Cumulus_NetQ_Appliance/">Getting Started With the Cumulus Net Q Appliance</a>
    </li>
    
    <li>
      <a href="/NetQ/software_installation_guide/Cumulus_NetQ_Appliance_Software_Installation_Guide/">Cumulus Net Q Appliance Software Installation Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Buffer and Queue Management</strong>
</header>

      
<article class="markdown">

<h1 id="buffer-and-queue-management">Buffer and Queue Management</h1>

<p>Hardware datapath configuration manages packet buffering, queueing
and scheduling in hardware. There are two configuration input files:</p>

<ul>
<li><code>/etc/cumulus/datapath/traffic.conf</code>, which describes priority
groups and assigns the scheduling algorithm and weights</li>

<li><p><code>/usr/lib/python2.7/dist-packages/cumulus/__chip_config/[bcm|mlx]/datapath.conf</code>,
which assigns buffer space and egress queues</p>

<p>While it&rsquo;s possible to change the buffer limits in the datapath.conf
file, Cumulus Networks strongly recommends you <a href="https://support.cumulusnetworks.com/hc/en-us/requests/new">work with a Cumulus
support engineer</a> to do so.</p></li>
</ul>

<p>Each packet is assigned to an ASIC Class of Service (CoS) value based on
the packet&rsquo;s priority value stored in the 802.1p (Class of Service)
or DSCP (Differentiated Services Code Point) header field. The choice to
schedule packets based on COS or DSCP is a configurable option in the
<code>/etc/cumulus/datapath/traffic.conf</code> file.</p>

<p>Priority groups include:</p>

<ul>
<li><em>Control</em>: Highest priority traffic</li>
<li><em>Service</em>: Second-highest priority traffic</li>
<li><em>Bulk</em>: All remaining traffic</li>
</ul>

<p>The scheduler is configured to use a hybrid scheduling algorithm. It
applies strict priority to control traffic queues and a weighted round
robin selection from the remaining queues. Unicast packets and multicast
packets with the same priority value are assigned to separate queues,
which are assigned equal scheduling weights.</p>

<p>Datapath configuration takes effect when you initialize <code>switchd</code>.
Changes to the <code>traffic.conf</code> file require you to <a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">restart the
<code>switchd</code></a>
service.</p>

<p>You can configure Quality of Service (QoS) for switches on the following
platforms only:</p>

<ul>
<li>Broadcom Helix4, Tomahawk, Trident II, Trident II+ and Trident3</li>
<li>Mellanox Spectrum</li>
</ul>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#BufferandQueueManagement-Commands">Commands</a></li>
<li><a href="#BufferandQueueManagement-ExampleConfigurationFile">Example Configuration
File</a></li>
<li><a href="#BufferandQueueManagement-ConfigureTrafficMarkingthroughACLRules">Configure Traffic Marking through ACL
Rules</a></li>
<li><a href="#BufferandQueueManagement-pfcConfigurePriorityFlowControl">Configure Priority Flow
Control</a></li>
<li><a href="#BufferandQueueManagement-PortGroups">Port Groups</a></li>
<li><a href="#BufferandQueueManagement-pauseConfigureLinkPause">Configure Link
Pause</a></li>
<li><a href="#BufferandQueueManagement-cut_through_modeConfigureCut-throughModeandStoreandForwardSwitching">Configure Cut-through Mode and Store and Forward
Switching</a></li>
<li><a href="#BufferandQueueManagement-ecnConfigureExplicitCongestionNotification">Configure Explicit Congestion
Notification</a></li>
<li><a href="#BufferandQueueManagement-CheckInterfaceBufferStatus">Check Interface Buffer
Status</a></li>
<li><a href="#BufferandQueueManagement-RelatedInformation">Related Information</a></li>
</ul>

<h2 id="commands">Commands</h2>

<p>If you modify the configuration in the
<code>/etc/cumulus/datapath/traffic.conf</code> file, you must
<a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">restart <code>switchd</code></a>
for the changes to take effect:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl restart switchd.service</code></pre></div>
<h2 id="example-configuration-file">Example Configuration File</h2>

<p>The following example <code>/etc/cumulus/datapath/traffic.conf</code> datapath
configuration file applies to 10G, 40G, and 100G switches on Broadcom
Tomahawk, Trident II, Trident II+, or Trident3 and Mellanox
Spectrum <a href="http://cumulusnetworks.com/hcl/">platforms</a> only. However, see
the note above for all the supported ASICs.</p>

<p>Keep in mind the following about the configuration:</p>

<ul>
<li>Regarding the default source packet fields and mapping, each
selected packet field should have a block of mapped values. Any
packet field value that is not specified in the configuration is
assigned to a default internal switch priority. The configuration
applies to every forwarding port unless a custom remark
configuration is defined for that port (see below).</li>
<li>Regarding the default remark packet fields and mapping, each
selected packet field should have a block of mapped values. Any
internal switch priority value that is not specified in the
configuration is assigned to a default packet field value. The
configuration applies to every forwarding port unless a custom
remark configuration is defined for that port (see below).</li>
<li>Per-port source packet fields and mapping apply to the designated
set of ports.</li>
<li>Per-port remark packet fields and mapping apply to the designated
set of ports.</li>
</ul>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click to
view sample traffic.conf file &hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ cat /etc/cumulus/datapath/traffic.conf
# 
# /etc/cumulus/datapath/traffic.conf
#                                                                              
 
# packet header field used to determine the packet priority level          
# fields include {802.1p, dscp}
traffic.packet_priority_source_set = [802.1p,dscp]                                 
                                        
# remark packet priority value                                             
# fields include {802.1p, none}                                            
# remark packet priority value
# fields include {802.1p, dscp}
traffic.packet_priority_remark_set = [802.1p,dscp]
 
# packet priority remark values assigned from each internal cos value
# internal cos values {cos_0..cos_7}
# (internal cos 3 has been reserved for CPU-generated traffic)
#
# 802.1p values = {0..7}
 
traffic.cos_0.priority_remark.8021p = [1]
traffic.cos_1.priority_remark.8021p = [0]
traffic.cos_2.priority_remark.8021p = [3]
traffic.cos_3.priority_remark.8021p = [2]
traffic.cos_4.priority_remark.8021p = [4]
traffic.cos_5.priority_remark.8021p = [5]
traffic.cos_6.priority_remark.8021p = [7]
traffic.cos_7.priority_remark.8021p = [6]
 
# dscp values = {0..63}
traffic.cos_0.priority_remark.dscp = [1]
traffic.cos_1.priority_remark.dscp = [9]
traffic.cos_2.priority_remark.dscp = [17]
traffic.cos_3.priority_remark.dscp = [25]
traffic.cos_4.priority_remark.dscp = [33]
traffic.cos_5.priority_remark.dscp = [41]
traffic.cos_6.priority_remark.dscp = [49]
traffic.cos_7.priority_remark.dscp = [57]
 
# Per-port remark packet fields and mapping: applies to the designated set of ports.
remark.port_group_list = [remark_port_group]
remark.remark_port_group.packet_priority_remark_set = [802.1p,dscp]
remark.remark_port_group.port_set = swp1-swp4,swp6
remark.remark_port_group.cos_0.priority_remark.dscp = [2]
remark.remark_port_group.cos_1.priority_remark.dscp = [10]
remark.remark_port_group.cos_2.priority_remark.dscp = [18]
remark.remark_port_group.cos_3.priority_remark.dscp = [26]
remark.remark_port_group.cos_4.priority_remark.dscp = [34]
remark.remark_port_group.cos_5.priority_remark.dscp = [42]
remark.remark_port_group.cos_6.priority_remark.dscp = [50]
remark.remark_port_group.cos_7.priority_remark.dscp = [58]                     
                                                                             
# packet priority values assigned to each internal cos value              
# internal cos values {cos_0..cos_7}                                   
# (internal cos 3 has been reserved for CPU-generated traffic)      
#   
# 802.1p values = {0..7}
traffic.cos_0.priority_source.8021p = [0]
traffic.cos_1.priority_source.8021p = [1]
traffic.cos_2.priority_source.8021p = [2]
traffic.cos_3.priority_source.8021p = []
traffic.cos_4.priority_source.8021p = [3,4]
traffic.cos_5.priority_source.8021p = [5]
traffic.cos_6.priority_source.8021p = [6]
traffic.cos_7.priority_source.8021p = [7]
 
# dscp values = {0..63}
traffic.cos_0.priority_source.dscp = [0,1,2,3,4,5,6,7]
traffic.cos_1.priority_source.dscp = [8,9,10,11,12,13,14,15]
traffic.cos_2.priority_source.dscp = []
traffic.cos_3.priority_source.dscp = []
traffic.cos_4.priority_source.dscp = []
traffic.cos_5.priority_source.dscp = []
traffic.cos_6.priority_source.dscp = []
traffic.cos_7.priority_source.dscp = [56,57,58,59,60,61,62,63]          
 
# Per-port source packet fields and mapping: applies to the designated set of ports.
source.port_group_list = [source_port_group]
source.source_port_group.packet_priority_source_set = [802.1p,dscp]
source.source_port_group.port_set = swp1-swp4,swp6
source.source_port_group.cos_0.priority_source.8021p = [7]
source.source_port_group.cos_1.priority_source.8021p = [6]
source.source_port_group.cos_2.priority_source.8021p = [5]
source.source_port_group.cos_3.priority_source.8021p = [4]
source.source_port_group.cos_4.priority_source.8021p = [3]
source.source_port_group.cos_5.priority_source.8021p = [2]
source.source_port_group.cos_6.priority_source.8021p = [1]
source.source_port_group.cos_7.priority_source.8021p = [0]            
                                                              
# priority groups                                             
traffic.priority_group_list = [control, service, bulk]        
                                                              
# internal cos values assigned to each priority group         
# each cos value should be assigned exactly once              
# internal cos values {0..7}                                  
priority_group.control.cos_list = [7]                         
priority_group.service.cos_list = [2]                         
priority_group.bulk.cos_list = [0,1,3,4,5,6] 
 
# to configure priority flow control on a group of ports:
# -- assign cos value(s) to the cos list
# -- add or replace a port group names in the port group list
# -- for each port group in the list
#    -- populate the port set, e.g.
#       swp1-swp4,swp8,swp50s0-swp50s3
#    -- set a PFC buffer size in bytes for each port in the group
#    -- set the xoff byte limit (buffer limit that triggers PFC frame transmit to start)
#    -- set the xon byte delta (buffer limit that triggers PFC frame transmit to stop)
#    -- enable PFC frame transmit and/or PFC frame receive
# priority flow control
# pfc.port_group_list = [pfc_port_group]
# pfc.pfc_port_group.cos_list = []
# pfc.pfc_port_group.port_set = swp1-swp4,swp6
# pfc.pfc_port_group.port_buffer_bytes = 25000
# pfc.pfc_port_group.xoff_size = 10000
# pfc.pfc_port_group.xon_delta = 2000
# pfc.pfc_port_group.tx_enable = true
# pfc.pfc_port_group.rx_enable = true                 
                                                              
# to configure pause on a group of ports: 
# -- add or replace port group names in the port group list
# -- for each port group in the list
#    -- populate the port set, e.g.
#       swp1-swp4,swp8,swp50s0-swp50s3
#    -- set a pause buffer size in bytes for each port in the group
#    -- set the xoff byte limit (buffer limit that triggers pause frames transmit to start)
#    -- set the xon byte delta (buffer limit that triggers pause frames transmit to stop)
 
# link pause 
# link_pause.port_group_list = [pause_port_group]
# link_pause.pause_port_group.port_set = swp1-swp4,swp6
# link_pause.pause_port_group.port_buffer_bytes = 25000
# link_pause.pause_port_group.xoff_size = 10000
# link_pause.pause_port_group.xon_delta = 2000
# link_pause.pause_port_group.rx_enable = true
# link_pause.pause_port_group.tx_enable = true                   
  
# scheduling algorithm: algorithm values = {dwrr}
scheduling.algorithm = dwrr 
  
# traffic group scheduling weight
# weight values = {0..127}     
# &#39;0&#39; indicates strict priority
priority_group.control.weight = 0
priority_group.service.weight = 32
priority_group.bulk.weight = 16                     
                                                          
# To turn on/off Denial of service (DOS) prevention checks
dos_enable = false                                
                                                  
# Cut-through is disabled by default on all chips with the exception of
# Spectrum. On Spectrum cut-through cannot be disabled.
#cut_through_enable = false
                                                  
# Enable resilient hashing                        
#resilient_hash_enable = FALSE                    
                                                  
# Resilient hashing flowset entries per ECMP group
# Valid values - 64, 128, 256, 512, 1024
#resilient_hash_entries_ecmp = 128   
                             
# Enable symmetric hashing   
#symmetric_hash_enable = TRUE
 
# Set sflow/sample ingress cpu packet rate and burst in packets/sec 
# Values: {0..16384} 
#sflow.rate = 16384  
#sflow.burst = 16384 
 
#Specify the maximum number of paths per route entry. 
#  Maximum paths supported is 200. 
#  Default value 0 takes the number of physical ports as the max path size. 
#ecmp_max_paths = 0
 
#Specify the hash seed for Equal cost multipath entries
# Default value 0
# Value Rang: {0..4294967295}
#ecmp_hash_seed = 42
 
# Specify the forwarding table resource allocation profile, applicable
# only on platforms that support universal forwarding resources.
#
# /usr/cumulus/sbin/cl-rsource-query reports the allocated table sizes
# based on the profile setting.
# 
#   Values: one of {&#39;default&#39;, &#39;l2-heavy&#39;, &#39;v4-lpm-heavy&#39;, &#39;v6-lpm-heavy&#39;}
#   Default value: &#39;default&#39;
#   Note: some devices may support more modes, please consult user
#         guide for more details
#
#forwarding_table.profile = default</code></pre></div>
<p>On Mellanox Spectrum switches, packet priority remark must be enabled on
the <strong>ingress</strong> port. A packet received on a remark-enabled port is
remarked according to the priority mapping configured on the <strong>egress</strong>
port. If packet priority remark is configured the same way on every
port, the default configuration example above is correct. However,
per-port customized configurations require two port groups: one for the
ingress ports and one for the egress ports, as below:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">remark.port_group_list = [ingress_remark_group, egress_remark_group]
remark.ingress_remark_group.packet_priority_remark_set = [dscp]
remark.remark_port_group.port_set = swp1-swp4,swp6
remark.egress_remark_group.port_set = swp10-swp20
remark.egress_remark_group.cos_0.priority_remark.dscp = [2]
remark.egress_remark_group.cos_1.priority_remark.dscp = [10]
remark.egress_remark_group.cos_2.priority_remark.dscp = [18]
remark.egress_remark_group.cos_3.priority_remark.dscp = [26]
remark.egress_remark_group.cos_4.priority_remark.dscp = [34]
remark.egress_remark_group.cos_5.priority_remark.dscp = [42]
remark.egress_remark_group.cos_6.priority_remark.dscp = [50]
remark.egress_remark_group.cos_7.priority_remark.dscp = [58]</code></pre></div>
<h2 id="configure-traffic-marking-through-acl-rules">Configure Traffic Marking through ACL Rules</h2>

<p>You can mark traffic for egress packets through <code>iptables</code> or
<code>ip6tables</code> rule classifications. To enable these rules, you do one of
the following:</p>

<ul>
<li>Mark DSCP values in egress packets.</li>
<li>Mark 802.1p CoS values in egress packets.</li>
</ul>

<p>To enable traffic marking, use <code>cl-acltool</code>. Add the <code>-p</code> option to
specify the location of the policy file. By default, if you don&rsquo;t
include the <code>-p</code> option, <code>cl-acltool</code> looks for the policy file in
<code>/etc/cumulus/acl/policy.d/</code>.</p>

<p>The <code>iptables</code>-/<code>ip6tables</code>-based marking is supported via the following
action extension:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-j SETQOS --set-dscp 10 --set-cos 5</code></pre></div>
<p>For <code>ebtables</code>, the setqos keyword must be in lowercase, as in:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">[ebtables]
-A FORWARD -o swp5 -j setqos --set-cos 5</code></pre></div>
<p>You can specify one of the following targets for SETQOS/setqos:</p>

<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>&ndash;set-cos INT</td>
<td>Sets the datapath resource/queuing class value. Values are defined in <a href="http://en.wikipedia.org/wiki/IEEE_P802.1p">IEEE_P802.1p</a>.</td>
</tr>

<tr>
<td>&ndash;set-dscp value</td>
<td>Sets the DSCP field in packet header to a value, which can be either a decimal or hex value.</td>
</tr>

<tr>
<td>&ndash;set-dscp-class class</td>
<td>Sets the DSCP field in the packet header to the value represented by the DiffServ class value. This class can be EF, BE or any of the CSxx or AFxx classes.</td>
</tr>
</tbody>
</table>

<p>You can specify either <code>--set-dscp</code> or <code>--set-dscp-class</code>, but not both.</p>

<p>Here are two example rules:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">[iptables]
-t mangle -A FORWARD --in-interface swp+ -p tcp --dport bgp -j SETQOS --set-dscp 10 --set-cos 5

[ip6tables]
-t mangle -A FORWARD --in-interface swp+ -j SETQOS --set-dscp 10</code></pre></div>
<p>You can put the rule in either the <em>mangle</em> table or the default
<em>filter</em> table; the mangle table and filter table are put into separate
TCAM slices in the hardware.</p>

<p>To put the rule in the mangle table, include <code>-t mangle</code>; to put the
rule in the filter table, omit <code>-t mangle</code>.</p>

<h2 id="configure-priority-flow-control">Configure Priority Flow Control</h2>

<p><em>Priority flow control</em>, as defined in the <a href="http://www.ieee802.org/1/pages/802.1bb.html">IEEE 802.1Qbb
standard</a>, provides a
link-level flow control mechanism that can be controlled independently
for each Class of Service (CoS) with the intention to ensure no data
frames are lost when congestion occurs in a bridged network.</p>

<p>PFC is not supported on switches with the Helix4 ASIC.</p>

<p>PFC is a layer 2 mechanism that prevents congestion by throttling packet
transmission. When PFC is enabled for received packets on a set of
switch ports, the switch detects congestion in the ingress buffer of the
receiving port and signals the upstream switch to stop sending traffic.
If the upstream switch has PFC enabled for packet transmission on the
designated priorities, it responds to the downstream switch and stops
sending those packets for a period of time. </p>

<p>PFC operates between two adjacent neighbor switches; it does not provide
end-to-end flow control. However, when an upstream neighbor throttles
packet transmission, it could build up packet congestion and propagate
PFC frames further upstream: eventually the sending server could receive
PFC frames and stop sending traffic for a time.</p>

<p>The PFC mechanism can be enabled for individual switch priorities on
specific switch ports for RX and/or TX traffic. The switch port’s
ingress buffer occupancy is used to measure congestion. If congestion is
present, the switch transmits flow control frames to the upstream
switch. Packets with priority values that do not have PFC configured are
not counted during congestion detection; neither do they get throttled
by the upstream switch when it receives flow control frames.</p>

<p>PFC congestion detection is implemented on the switch using xoff and xon
threshold values for the specific ingress buffer which is used by the
targeted switch priorities. When a packet enters the buffer and the
buffer occupancy is above the xoff threshold, the switch transmits an
Ethernet PFC frame to the upstream switch to signal packet transmission
should stop. When the buffer occupancy drops below the xon threshold,
the switch sends another PFC frame upstream to signal that packet
transmission can resume. (PFC frames contain a quanta value to indicate
a timeout value for the upstream switch: packet transmission can resume
after the timer has expired, or when a PFC frame with quanta == 0 is
received from the downstream switch.)</p>

<p>After the downstream switch has sent a PFC frame upstream, it continues
to receive packets until the upstream switch receives and responds to
the PFC frame. The downstream ingress buffer must be large enough to
store those additional packets after the xoff threshold has been
reached.</p>

<p>Before Cumulus Linux 3.1.1, PFC was designated as a *lossless* priority
group. The lossless priority group has been removed from Cumulus Linux.</p>

<p>Priority flow control is fully supported on both
<a href="https://cumulusnetworks.com/support/linux-hardware-compatibility-list/?CPUType=x86_64&amp;Brand=broadcomtrident&amp;Brand=broadcomtridentplus&amp;SwitchSilicon=broadcomtrident2&amp;Brand=broadcomtrident2plus&amp;Brand=broadcomtriumph2">Broadcom</a>
and <a href="https://cumulusnetworks.com/support/linux-hardware-compatibility-list/?Brand=mellanox">Mellanox
switches</a>.</p>

<p>PFC is disabled by default in Cumulus Linux. Enabling priority flow
control (PFC) requires configuring the following settings in
<code>/etc/cumulus/datapath/traffic.conf</code> on the switch:</p>

<ul>
<li>Specifying the name of the port group in <code>pfc.port_group_list</code> in
brackets; for example, <em>pfc.port_group_list =
[pfc_port_group]</em>.</li>
<li>Assigning a CoS value to the port group
in <code>pfc.pfc_port_group.cos_list</code> setting. Note that
<em>pfc_port_group</em> is the name of a port group you specified above
and is used throughout the following settings.</li>
<li>Populating the port group with its member ports
in <code>pfc.pfc_port_group.port_set</code>.</li>
<li>Setting a PFC buffer size in <code>pfc.pfc_port_group.port_buffer_bytes</code>.
This is the maximum number of bytes allocated for storing bursts of
packets, guaranteed at the ingress port. The default is <em>25000</em>
bytes.</li>
<li>Setting the xoff byte limit in <code>pfc.pfc_port_group.xoff_size</code>. This
is a threshold for the PFC buffer; when this limit is reached, an
xoff transition is initiated, signaling the upstream port to stop
sending traffic, during which time packets continue to arrive due to
the latency of the communication. The default is <em>10000</em> bytes.</li>
<li>Setting the xon delta limit in <code>pfc.pfc_port_group.xon_delta</code>. This
is the number of bytes to subtract from the xoff limit, which
results in a second threshold at which the egress port resumes
sending traffic. After the xoff limit is reached and the upstream
port stops sending traffic, the buffer begins to drain. When the
buffer reaches 8000 bytes (assuming default xoff and xon settings),
the egress port signals that it can start receiving traffic again.
The default is <em>2000</em> bytes.</li>
<li>Enabling the egress port to signal the upstream port to stop sending
traffic (<code>pfc.pfc_port_group.tx_enable</code>). The default is <em>true</em>.</li>
<li>Enabling the egress port to receive notifications and act on
them (<code>pfc.pfc_port_group.rx_enable</code>). The default is <em>true</em>.</li>
<li>The switch priority value(s) are mapped to the specific ingress
buffer for each targeted switch port. Cumulus Linux looks at either
the 802.1p bits or the IP layer DSCP bits depending on which is
configured in the <code>traffic.conf</code> file to map packets to internal
switch priority values.</li>
</ul>

<p>The following configuration example shows PFC configured for ports swp1
through swp4 and swp6:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"># to configure priority flow control on a group of ports:
# -- assign cos value(s) to the cos list
# -- add or replace a port group names in the port group list
# -- for each port group in the list
#    -- populate the port set, e.g.
#       swp1-swp4,swp8,swp50s0-swp50s3
#    -- set a PFC buffer size in bytes for each port in the group
#    -- set the xoff byte limit (buffer limit that triggers PFC frame transmit to start)
#    -- set the xon byte delta (buffer limit that triggers PFC frame transmit to stop)
#    -- enable PFC frame transmit and/or PFC frame receive
# priority flow control
pfc.port_group_list = [pfc_port_group]
pfc.pfc_port_group.cos_list = []
pfc.pfc_port_group.port_set = swp1-swp4,swp6
pfc.pfc_port_group.port_buffer_bytes = 25000
pfc.pfc_port_group.xoff_size = 10000
pfc.pfc_port_group.xon_delta = 2000
pfc.pfc_port_group.tx_enable = true
pfc.pfc_port_group.rx_enable = true       </code></pre></div>
<h2 id="port-groups">Port Groups</h2>

<p>A *port group* refers to one or more sequences of contiguous ports.
Multiple port groups can be defined by:</p>

<ul>
<li>Adding a comma-separated list of port group names to the
port_group_list.</li>
<li>Adding the port_set, rx_enable, and tx_enable configuration lines
for each port group.</li>
</ul>

<p>You can specify the set of ports in a port group in comma-separated
sequences of contiguous ports; you can see which ports are contiguous
in <code>/var/lib/cumulus/porttab</code>. The syntax supports:</p>

<ul>
<li>A single port (swp1s0 or swp5)</li>
<li>A sequence of regular swp ports (swp2-swp5)</li>
<li>A sequence within a breakout swp port (swp6s0-swp6s3)</li>

<li><p>A sequence of regular and breakout ports, provided they are all in a
contiguous range. For example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">...
swp2
swp3
swp4
swp5
swp6s0
swp6s1
swp6s2
swp6s3
swp7
...</code></pre></div></li>
</ul>

<p><a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">Restart <code>switchd</code> </a>to
allow the PFC configuration changes to take effect:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl restart switchd.service</code></pre></div>
<h2 id="configure-link-pause">Configure Link Pause</h2>

<p>The PAUSE frame is a flow control mechanism that halts the transmission
of the transmitter for a specified period of time. A server or other
network node within the data center may be receiving traffic faster than
it can handle it, thus the PAUSE frame. In Cumulus Linux, individual
ports can be configured to execute link pause by:</p>

<ul>
<li>Transmitting pause frames when its ingress buffers become congested
(TX pause enable) and/or</li>
<li>Responding to received pause frames (RX pause enable).</li>
</ul>

<p>Link pause is disabled by default. Enabling link pause requires
configuring settings in <code>/etc/cumulus/datapath/traffic.conf</code>, similar to
how you configure <a href="Buffer_and_Queue_Management">priority flow control</a>.
The settings are explained in that section as well.</p>

<p>What&rsquo;s the difference between link pause and priority flow control?</p>

<p>Priority flow control is applied to an individual priority group for a
specific ingress port.</p>

<p>Link pause (also known as port pause or global pause) is applied to all
the traffic for a specific ingress port.</p>

<p>Here is an example configuration that enables both types of link pause
for swp1 through swp4 and swp6:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"># to configure pause on a group of ports: 
# -- add or replace port group names in the port group list
# -- for each port group in the list
#    -- populate the port set, e.g.
#       swp1-swp4,swp8,swp50s0-swp50s3
#    -- set a pause buffer size in bytes for each port in the group
#    -- set the xoff byte limit (buffer limit that triggers pause frames transmit to start)
#    -- set the xon byte delta (buffer limit that triggers pause frames transmit to stop)

# link pause 
link_pause.port_group_list = [pause_port_group]
link_pause.pause_port_group.port_set = swp1-swp4,swp6
link_pause.pause_port_group.port_buffer_bytes = 25000
link_pause.pause_port_group.xoff_size = 10000
link_pause.pause_port_group.xon_delta = 2000
link_pause.pause_port_group.rx_enable = true
link_pause.pause_port_group.tx_enable = true                   </code></pre></div>
<p><a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">Restart
<code>switchd</code></a>
to allow link pause configuration changes to take effect:</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"><span class="n">cumulus</span><span class="nv">@switch:</span><span class="o">~</span><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">switchd</span><span class="o">.</span><span class="n">service</span></code></pre></div>
<h2 id="configure-cut-through-mode-and-store-and-forward-switching">Configure Cut-through Mode and Store and Forward Switching</h2>

<p>Cut-through mode is disabled in Cumulus Linux by default on switches
with Broadcom ASICs. With cut-though mode enabled and link pause is
asserted, Cumulus Linux generates a TOVR and TUFL ERROR; certain error
counters increment on a given physical port.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo ethtool -S swp49 | grep Error
HwIfInDot3LengthErrors: 0
HwIfInErrors: 0
HwIfInDot3FrameErrors: 0
SoftInErrors: 0
SoftInFrameErrors: 0
HwIfOutErrors: 35495749
SoftOutErrors: 0

cumulus@switch:~$ sudo ethtool -S swp50 | grep Error
HwIfInDot3LengthErrors: 3038098
HwIfInErrors: 297595762
HwIfInDot3FrameErrors: 293710518</code></pre></div>
<p>To work around this issue, disable link pause or disable cut-through
mode in <code>/etc/cumulus/datapath/traffic.conf</code>.</p>

<p>To disable link pause, comment out the <code>link_pause*</code> section
in <code>/etc/cumulus/datapath/traffic.conf</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo nano /etc/cumulus/datapath/traffic.conf 
#link_pause.port_group_list = [port_group_0]
#link_pause.port_group_0.port_set = swp45-swp54
#link_pause.port_group_0.rx_enable = true
#link_pause.port_group_0.tx_enable = true</code></pre></div>
<p>To enable store and forward switching,
set <code>cut_through_enable</code> to *false* in <code>/etc/cumulus/datapath/traffic.conf</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo nano /etc/cumulus/datapath/traffic.conf 
cut_through_enable = false</code></pre></div>
<h2 id="configure-explicit-congestion-notification">Configure Explicit Congestion Notification</h2>

<p><em>Explicit Congestion Notification</em> (ECN) is defined by <a href="https://tools.ietf.org/html/rfc3168">RFC
3168</a>. ECN gives a Cumulus Linux
switch the ability to mark a packet to signal impending congestion
instead of dropping the packet outright, which is how TCP typically
behaves when ECN is not enabled.</p>

<p>ECN is a layer 3 end-to-end congestion notification mechanism only.
Packets can be marked as <em>ECN-capable transport</em> (ECT) by the sending
server. If congestion is observed by any switch while the packet is
getting forwarded, the ECT-enabled packet can be marked by the switch to
indicate the congestion. The end receiver can respond to the ECN-marked
packets by signaling the sending server to slow down transmission. The
sending server marks a packet <em>ECT</em> by setting the least 2 significant
bits in an IP header <code>DiffServ</code> (ToS) field to <em>01</em> or <em>10</em>. A packet
that has the least 2 significant bits set to <em>00</em> indicates a
non-ECT-enabled packet. </p>

<p>The ECN mechanism on a switch only marks packets to notify the end
receiver. It does not take any other action or change packet handling in
any way, nor does it respond to packets that have already been marked
ECN by an upstream switch.</p>

<p><strong>On Trident II switches only</strong>, if ECN is enabled on a specific queue,
the ASIC also enables RED on the same queue. If the packet is ECT marked
(the ECN bits are 01 or 10), the ECN mechanism executes as described
above. However, if it is entering an ECN-enabled queue but is not ECT
marked (the ECN bits are 00), then the RED mechanism uses the same
threshold and probability values to decide whether to drop the packet.
Packets entering a non-ECN-enabled queue do not get marked or dropped
due to ECN or RED in any case.</p>

<p>ECN is implemented on the switch using minimum and maximum threshold
values for the egress queue length. When a packet enters the queue and
the average queue length is between the minimum and maximum threshold
values, a configurable probability value will determine whether the
packet will be marked. If the average queue length is above the maximum
threshold value, the packet is always marked.</p>

<p>The downstream switches with ECN enabled perform the same actions as the
traffic is received. If the ECN bits are set, they remain set. The only
way to overwrite ECN bits is to enable it — that is, set the ECN bits to
<em>11</em>.</p>

<p>ECN is supported on <a href="https://cumulusnetworks.com/hcl">Broadcom Tomahawk, Trident II, Trident II+ and
Trident3, and Mellanox Spectrum
switches</a> only.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click to
learn how to configure ECN &hellip;</p>

<p>ECN is disabled by default in Cumulus Linux. You can enable ECN for
individual switch priorities on specific switch ports. ECN requires
configuring the following settings
in <code>/etc/cumulus/datapath/traffic.conf</code> on the switch:</p>

<ul>
<li>Specifying the name of the port group in <code>ecn.port_group_list</code> in
brackets; for example, <code>ecn.port_group_list = [ecn_port_group]</code>.</li>
<li>Assigning a CoS value to the port group
in <code>ecn.ecn_port_group.cos_list</code>. If the CoS value of a packet
matches the value of this setting, then ECN is applied. Note
that *ecn_port_group* is the name of a port group you specified
above. </li>
<li>Populating the port group with its member ports
(<code>ecn.ecn_port_group.port_set</code>), where *ecn_port_group* is the
name of the port group you specified above. Congestion is measured
on the egress port queue for the ports listed here, using the
average queue length: if congestion is present, a packet entering
the queue may be marked to indicate that congestion was observed.
Marking a packet involves setting the least 2 significant bits in
the IP header DiffServ (ToS) field to <em>11</em>. </li>
<li>The switch priority value(s) are mapped to specific egress queues
for the target switch ports.  </li>
<li>The <code>ecn.ecn_port_group.probability</code> value indicates the probability
of a packet being marked if congestion is experienced.</li>
</ul>

<p>The following configuration example shows ECN configured for ports swp1
through swp4 and swp6:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"># Explicit Congestion Notification
# to configure ECN on a group of ports:
# -- add or replace port group names in the port group list
# -- assign cos value(s) to the cos list  *ECN will only be applied to traffic matching this COS*
# -- for each port group in the list
#    -- populate the port set, e.g.
#       swp1-swp4,swp8,swp50s0-swp50s3
 ecn.port_group_list = [ecn_port_group]
 ecn.ecn_port_group.cos_list = [0]
 ecn.ecn_port_group.port_set = swp1-swp4,swp6
 ecn.ecn_port_group.min_threshold_bytes = 40000
 ecn.ecn_port_group.max_threshold_bytes = 200000
 ecn.ecn_port_group.probability = 100</code></pre></div>
<p><a href="Configuring-switchd_8362561.html#Configuringswitchd-restartswitchd">Restart <code>switchd</code> </a>to allow
the ECN configuration changes to take effect:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo systemctl restart switchd.service</code></pre></div>
<h2 id="check-interface-buffer-status">Check Interface Buffer Status</h2>

<p>On Mellanox switches, you can collect a fine-grained history of queue
lengths using histograms maintained by the ASIC; see the <a href="ASIC_Monitoring">ASIC
monitoring chapter</a> for details.</p>

<p>On Broadcom switches, the buffer status is not visible currently.</p>

<h2 id="related-information">Related Information</h2>

<ul>
<li><a href="http://ipset.netfilter.org/iptables-extensions.man.html">iptables-extensions man
page</a></li>
</ul>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#buffer-and-queue-management">Buffer and Queue Management</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#commands">Commands</a></li>
<li><a href="#example-configuration-file">Example Configuration File</a></li>
<li><a href="#configure-traffic-marking-through-acl-rules">Configure Traffic Marking through ACL Rules</a></li>
<li><a href="#configure-priority-flow-control">Configure Priority Flow Control</a></li>
<li><a href="#port-groups">Port Groups</a></li>
<li><a href="#configure-link-pause">Configure Link Pause</a></li>
<li><a href="#configure-cut-through-mode-and-store-and-forward-switching">Configure Cut-through Mode and Store and Forward Switching</a></li>
<li><a href="#configure-explicit-congestion-notification">Configure Explicit Congestion Notification</a></li>
<li><a href="#check-interface-buffer-status">Check Interface Buffer Status</a></li>
<li><a href="#related-information">Related Information</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
