<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Snapshots | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/" class="active">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Using Snapshots</strong>
</header>

      
<article class="markdown">

<h1 id="using-snapshots">Using Snapshots</h1>

<p>Cumulus Linux supports the ability to take snapshots of the complete
file system as well as the ability to roll back to a previous snapshot.
Snapshots are performed automatically right before and after you upgrade
Cumulus Linux using <a href="Upgrading-Cumulus-Linux_8362647.html#UpgradingCumulusLinux-apt_upgrade">package
install</a>,
and right before and after you commit a switch configuration using
<a href="Network_Command_Line_Utility_-_NCLU">NCLU</a>. In addition, you can take a
snapshot at any time. You can roll back the entire file system to a
specific snapshot or just retrieve specific files.  </p>

<p>The primary snapshot components include:</p>

<ul>
<li><a href="https://btrfs.wiki.kernel.org/index.php/Main_Page">btrfs</a> — an
underlying file system in Cumulus Linux, which supports snapshots.</li>
<li><a href="http://snapper.io/documentation.html">snapper</a> — a userspace
utility to create and manage snapshots on demand as well as taking
snapshots automatically before and after
running <code>apt-get upgrade|install|remove|dist-upgrade</code>. You can use
<code>snapper</code> to roll back to earlier snapshots, view existing
snapshots, or delete one or more snapshots.</li>
<li><a href="Network_Command_Line_Utility_-_NCLU">NCLU</a> — takes snapshots
automatically before and after committing network configurations.
You can use NCLU to roll back to earlier snapshots, view existing
snapshots, or delete one or more snapshots.</li>
</ul>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#UsingSnapshots-InstalltheSnapshotPackage">Install the Snapshot
Package</a></li>
<li><a href="#UsingSnapshots-TakeandManageSnapshots">Take and Manage Snapshots</a>

<ul>
<li><a href="#UsingSnapshots-ViewAvailableSnapshots">View Available
Snapshots</a></li>
<li><a href="#UsingSnapshots-ViewDifferencesbetweenSnapshots">View Differences between
Snapshots</a></li>
<li><a href="#UsingSnapshots-DeleteSnapshots">Delete Snapshots</a></li>
</ul></li>
<li><a href="#UsingSnapshots-rollbackRollBacktoEarlierSnapshots">Roll Back to Earlier
Snapshots</a>

<ul>
<li><a href="#UsingSnapshots-RollBackwithsnapper">Roll Back with snapper</a></li>
</ul></li>
<li><a href="#UsingSnapshots-ConfigureAutomaticTime-basedSnapshots">Configure Automatic Time-based
Snapshots</a></li>
<li><a href="#UsingSnapshots-CaveatsandErrata">Caveats and Errata</a></li>
</ul>

<h2 id="install-the-snapshot-package">Install the Snapshot Package</h2>

<p>If you are upgrading from a version of Cumulus Linux earlier than
version 3.2, you need to install the <code>cumulus-snapshot</code> package before
you can use snapshots.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo -E apt-get update
cumulus@switch:~$ sudo -E apt-get install cumulus-snapshot
cumulus@switch:~$ sudo -E apt-get upgrade</code></pre></div>
<h2 id="take-and-manage-snapshots">Take and Manage Snapshots</h2>

<p>Snapshots are taken automatically:</p>

<ul>
<li>Before and after you update your switch configuration by running the
NCLU <code>net commit</code> command.</li>
<li>Before and after you update Cumulus Linux
by running <code>apt-get upgrade|install|remove|dist-upgrade</code>, via
<code>snapper</code>.</li>
</ul>

<p>You can also take snapshots as needed using the <code>snapper</code> utility. Run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper create -d SNAPSHOT_NAME</code></pre></div>
<p>For more information about using <code>snapper</code>, run <code>snapper --help</code> or
<code>man snapper(8)</code>.</p>

<h3 id="view-available-snapshots">View Available Snapshots</h3>

<p>You can use both NCLU and <code>snapper</code> to view available snapshots on the
switch. </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show commit history 
  #  Date                             Description
---  -------------------------------  --------------------------------------
 20  Thu 01 Dec 2016 01:43:29 AM UTC  nclu pre  &#39;net commit&#39; (user cumulus)
 21  Thu 01 Dec 2016 01:43:31 AM UTC  nclu post &#39;net commit&#39; (user cumulus)
 22  Thu 01 Dec 2016 01:44:18 AM UTC  nclu pre  &#39;20 rollback&#39; (user cumulus)
 23  Thu 01 Dec 2016 01:44:18 AM UTC  nclu post &#39;20 rollback&#39; (user cumulus)
 24  Thu 01 Dec 2016 01:44:22 AM UTC  nclu pre  &#39;22 rollback&#39; (user cumulus)
 31  Fri 02 Dec 2016 12:18:08 AM UTC  nclu pre  &#39;ACL&#39; (user cumulus)
 32  Fri 02 Dec 2016 12:18:10 AM UTC  nclu post &#39;ACL&#39; (user cumulus)</code></pre></div>
<p>However, <code>net show commit history</code> only displays snapshots taken when
you update your switch configuration. It does not list any snapshots
taken directly with <code>snapper</code>. To see all the snapshots on the switch,
run the <code>sudo snapper list</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper list
Type   | #  | Pre # | Date                            | User | Cleanup | Description                            | Userdata     
-------+----+-------+---------------------------------+------+---------+----------------------------------------+--------------
single | 0  |       |                                 | root |         | current                                |              
single | 1  |       | Sat 24 Sep 2016 01:45:36 AM UTC | root |         | first root filesystem                  |              
pre    | 20 |       | Thu 01 Dec 2016 01:43:29 AM UTC | root | number  | nclu pre  &#39;net commit&#39; (user cumulus)  |              
post   | 21 | 20    | Thu 01 Dec 2016 01:43:31 AM UTC | root | number  | nclu post &#39;net commit&#39; (user cumulus)  |              
pre    | 22 |       | Thu 01 Dec 2016 01:44:18 AM UTC | root | number  | nclu pre  &#39;20 rollback&#39; (user cumulus) |              
post   | 23 | 22    | Thu 01 Dec 2016 01:44:18 AM UTC | root | number  | nclu post &#39;20 rollback&#39; (user cumulus) |              
single | 26 |       | Thu 01 Dec 2016 11:23:06 PM UTC | root |         | test_snapshot                          |              
pre    | 29 |       | Thu 01 Dec 2016 11:55:16 PM UTC | root | number  | pre-apt                                | important=yes
post   | 30 | 29    | Thu 01 Dec 2016 11:55:21 PM UTC | root | number  | post-apt                               | important=yes
pre    | 31 |       | Fri 02 Dec 2016 12:18:08 AM UTC | root | number  | nclu pre  &#39;ACL&#39; (user cumulus)         |              
post   | 32 | 31    | Fri 02 Dec 2016 12:18:10 AM UTC | root | number  | nclu post &#39;ACL&#39; (user cumulus)         |            </code></pre></div>
<h3 id="view-differences-between-snapshots">View Differences between Snapshots</h3>

<p>To see a line by line comparison of changes between two snapshots, run
the <code>sudo snapper diff</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-diff" data-lang="diff">cumulus@switch:~$ sudo snapper diff 20..21
<span class="gd">--- /.snapshots/20/snapshot/etc/cumulus/acl/policy.d/50_nclu_acl.rules  2016-11-30 23:00:42.675092103 +0000
</span><span class="gd"></span><span class="gi">+++ /.snapshots/21/snapshot/etc/cumulus/acl/policy.d/50_nclu_acl.rules  2016-12-01 01:43:30.029171289 +0000
</span><span class="gi"></span><span class="gu">@@ -1,7 +0,0 @@
</span><span class="gu"></span><span class="gd">-[iptables]
</span><span class="gd">-# control-plane: acl ipv4 EXAMPLE1 inbound
</span><span class="gd">--A INPUT --in-interface swp+ -j ACCEPT -p tcp -s 10.0.0.11/32 -d 10.0.0.12/32 --dport 110
</span><span class="gd">-
</span><span class="gd">-# swp1: acl ipv4 EXAMPLE1 inbound
</span><span class="gd">--A FORWARD --in-interface swp1 --out-interface swp2 -j ACCEPT -p tcp -s 10.0.0.11/32 -d 10.0.0.12/32 --dport 110
</span><span class="gd">-
</span><span class="gd">--- /.snapshots/20/snapshot/var/lib/cumulus/nclu/nclu_acl.conf  2016-11-30 23:00:18.030079000 +0000
</span><span class="gd"></span><span class="gi">+++ /.snapshots/21/snapshot/var/lib/cumulus/nclu/nclu_acl.conf  2016-12-01 00:23:10.096136000 +0000
</span><span class="gi"></span><span class="gu">@@ -1,8 +1,3 @@
</span><span class="gu"></span><span class="gd">-acl ipv4 EXAMPLE1 priority 10 accept tcp 10.0.0.11/32 10.0.0.12/32 pop3 outbound-interface swp2
</span><span class="gd"></span> 
<span class="gd">-control-plane
</span><span class="gd">-    acl ipv4 EXAMPLE1 inbound
</span><span class="gd"></span> 
<span class="gd">-iface swp1
</span><span class="gd">-    acl ipv4 EXAMPLE1 inbound
</span></code></pre></div>
<p>You can view the diff for a single file by specifying the name in the
command:</p>
<div class="highlight"><pre class="chroma"><code class="language-diff" data-lang="diff">cumulus@switch:~$ sudo snapper diff 20..21 /var/lib/cumulus/nclu/nclu_acl.conf 
<span class="gd">--- /.snapshots/20/snapshot/var/lib/cumulus/nclu/nclu_acl.conf  2016-11-30 23:00:18.030079000 +0000
</span><span class="gd"></span><span class="gi">+++ /.snapshots/21/snapshot/var/lib/cumulus/nclu/nclu_acl.conf  2016-12-01 00:23:10.096136000 +0000
</span><span class="gi"></span><span class="gu">@@ -1,8 +1,3 @@
</span><span class="gu"></span><span class="gd">-acl ipv4 EXAMPLE1 priority 10 accept tcp 10.0.0.11/32 10.0.0.12/32 pop3 outbound-interface swp2
</span><span class="gd"></span> 
<span class="gd">-control-plane
</span><span class="gd">-    acl ipv4 EXAMPLE1 inbound
</span><span class="gd"></span> 
<span class="gd">-iface swp1
</span><span class="gd">-    acl ipv4 EXAMPLE1 inbound
</span></code></pre></div>
<p>For a higher level view; for example, to display the names of changed,
added, or deleted files only, run the <code>sudo snapper status</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper status 20..21
c..... /etc/cumulus/acl/policy.d/50_nclu_acl.rules
c..... /var/lib/cumulus/nclu/nclu_acl.conf</code></pre></div>
<h3 id="delete-snapshots">Delete Snapshots</h3>

<p>You can remove one or more snapshots using NCLU or snapper. </p>

<p>Take care when deleting a snapshot. You cannot restore a snapshot after
you delete it.</p>

<p>To remove a single snapshot or a range of snapshots created with NCLU,
run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net commit delete SNAPSHOT|SNAPSHOT1-SNAPSHOT2</code></pre></div>
<p>To remove a single snapshot or a range of snapshots using <code>snapper</code>,
run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper delete SNAPSHOT|SNAPSHOT1-SNAPSHOT2</code></pre></div>
<p>Snapshot 0 is the running configuration. You cannot roll back to it or
delete it. However, you can take a snapshot of it. </p>

<p>Snapshot 1 is the root file system.</p>

<p>The <code>snapper</code> utility preserves a number of snapshots and automatically
deletes older snapshots after the limit is reached. It does this in two
ways.</p>

<p>By default, <code>snapper</code> preserves 10 snapshots that are
labeled <em>important</em>. A snapshot is labeled important if it is created
when you run <code>apt-get</code>. To change this number, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper set-config NUMBER_LIMIT_IMPORTANT=&lt;NUM&gt;</code></pre></div>
<p>Always make <code>NUMBER_LIMIT_IMPORTANT</code> an even number as two snapshots are
always taken before and after an upgrade. This does not apply to
<code>NUMBER_LIMIT</code>, described next.</p>

<p><code>snapper</code> also deletes unlabeled snapshots. By default, <code>snapper</code>
preserves five snapshots. To change this number, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper set-config NUMBER_LIMIT=&lt;NUM&gt;</code></pre></div>
<p>You can prevent snapshots from being taken automatically before and
after
running <code>apt-get upgrade|install|remove|dist-upgrade</code>. Edit <code>/etc/cumulus/apt-snapshot.conf</code> and
set:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">APT_SNAPSHOT_ENABLE=no</code></pre></div>
<h2 id="roll-back-to-earlier-snapshots">Roll Back to Earlier Snapshots</h2>

<p>If you need to restore Cumulus Linux to an earlier state, you can roll
back to an older snapshot.</p>

<p>For a snapshot created with NCLU, you can revert to the configuration
prior to a specific snapshot listed in the output from
<code>net show commit history</code> by running <code>net rollback SNAPSHOT_NUMBER</code>. For
example, if you have snapshots 10, 11 and 12 in your commit history and
you run <code>net rollback 11</code>, the switch configuration reverts to the
configuration captured by snapshot 10.</p>

<p>You can also revert to the previous snapshot by specifying last by
running <code>net rollback last</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net rollback SNAPSHOT_NUMBER|last</code></pre></div>
<p>If you provided a description when you committed changes, mentioning a
description rolls the configuration back to the commit prior to the
specified description. For example, consider the following commit
history:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show commit history 
 #  Date                             Description
--  -------------------------------  --------------------------------
10  Tue 06 Nov 2018 12:07:14 AM UTC  nclu &#34;net commit&#34; (user cumulus)
12  Tue 06 Nov 2018 10:19:50 PM UTC  nclu rocket
14  Tue 06 Nov 2018 10:20:22 PM UTC  nclu turtle </code></pre></div>
<p>Running <code>net rollback description turtle</code> rolls the configuration back
to the state it was in when you ran <code>net commit description rocket</code>.</p>

<h3 id="roll-back-with-snapper">Roll Back with snapper</h3>

<p>For any snapshot on the switch, you can use <code>snapper</code> to roll back to a
specific snapshot. When running <code>snapper rollback</code>, you must reboot the
switch for the rollback to complete:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper rollback SNAPSHOT_NUMBER
cumulus@switch:~$ sudo reboot</code></pre></div>
<p>You can revert to an earlier version of a specific file instead of
rolling back the whole file system:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper undochange 31..32 /etc/cumulus/acl/policy.d/50_nclu_acl.rules</code></pre></div>
<p>You can also copy the file directly from the snapshot directory:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ cp /.snapshots/32/snapshot/etc/cumulus/acl/policy.d/50_nclu_acl.rules /etc/cumulus/acl/policy.d/</code></pre></div>
<h2 id="configure-automatic-time-based-snapshots">Configure Automatic Time-based Snapshots</h2>

<p>You can configure Cumulus Linux to take hourly snapshots. Enable
<code>TIMELINE_CREATE</code> in the snapper configuration:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo snapper set-config TIMELINE_CREATE=yes
cumulus@switch:~$ sudo snapper get-config                                                                                            
Key                    | Value
-----------------------+------
ALLOW_GROUPS           |      
ALLOW_USERS            |      
BACKGROUND_COMPARISON  | yes  
EMPTY_PRE_POST_CLEANUP | yes  
EMPTY_PRE_POST_MIN_AGE | 1800 
FSTYPE                 | btrfs
NUMBER_CLEANUP         | yes  
NUMBER_LIMIT           | 5    
NUMBER_LIMIT_IMPORTANT | 10   
NUMBER_MIN_AGE         | 1800 
QGROUP                 |      
SPACE_LIMIT            | 0.5  
SUBVOLUME              | /    
SYNC_ACL               | no   
TIMELINE_CLEANUP       | yes  
TIMELINE_CREATE        | yes  
TIMELINE_LIMIT_DAILY   | 5    
TIMELINE_LIMIT_HOURLY  | 5    
TIMELINE_LIMIT_MONTHLY | 5    
TIMELINE_LIMIT_YEARLY  | 5    
TIMELINE_MIN_AGE       | 1800 </code></pre></div>
<h2 id="caveats-and-errata">Caveats and Errata</h2>

<p>You might notice that the root partition is mounted multiple times. This
is due to the way the <code>btrfs</code> file system handles subvolumes, mounting
the root partition once for each subvolume. <code>btrfs</code> keeps one subvolume
for each snapshot taken, which stores the snapshot data. While all
snapshots are subvolumes, not all subvolumes are snapshots.</p>

<p>Cumulus Linux excludes a number of directories when taking a snapshot of
the root file system (and from any rollbacks):</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Directory</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>/home</code></td>
<td>This directory is excluded to avoid user data loss on rollbacks.</td>
</tr>
<tr class="even">
<td><code>/var/log, /var/support</code></td>
<td><p>The log file and Cumulus support location. These directories are excluded from snapshots to allow post-rollback analysis.</p></td>
</tr>
<tr class="odd">
<td><code>/tmp, /var/tmp</code></td>
<td><p>There is no need to rollback temporary files.</p></td>
</tr>
<tr class="even">
<td><code>/opt, /var/opt</code></td>
<td><p>Third-party software is installed typically in <code>/opt</code>. Exclude <code>/opt</code> to avoid re-installing these applications after rollbacks.</p></td>
</tr>
<tr class="odd">
<td><code>/srv</code></td>
<td><p>This directory contains data for HTTP and FTP servers. Exclude this directory to avoid server data loss on rollbacks.</p></td>
</tr>
<tr class="even">
<td><code>/usr/local</code></td>
<td><p>This directory is used when installing locally built software. Exclude this directory to avoid re-installing this software after rollbacks.</p></td>
</tr>
<tr class="odd">
<td><code>/var/spool</code></td>
<td><p>Exclude this directory to avoid loss of mail after a rollback.</p></td>
</tr>
<tr class="even">
<td><code>/var/lib/libvirt/images</code></td>
<td><p>This is the default directory for libvirt VM images. Exclude this directory from the snapshot. Additionally, disable Copy-On-Write (COW) for this subvolume as COW and VM image I/O access patterns are not compatible.</p></td>
</tr>
<tr class="odd">
<td><p><code>/boot/grub/i386-pc, /boot/grub/x86_64-efi, /boot/grub/arm-uboot</code></p></td>
<td><p>The GRUB kernel modules must stay in sync with the GRUB kernel installed in the master boot record or UEFI system partition.</p></td>
</tr>
</tbody>
</table>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#using-snapshots">Using Snapshots</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#install-the-snapshot-package">Install the Snapshot Package</a></li>
<li><a href="#take-and-manage-snapshots">Take and Manage Snapshots</a>
<ul>
<li><a href="#view-available-snapshots">View Available Snapshots</a></li>
<li><a href="#view-differences-between-snapshots">View Differences between Snapshots</a></li>
<li><a href="#delete-snapshots">Delete Snapshots</a></li>
</ul></li>
<li><a href="#roll-back-to-earlier-snapshots">Roll Back to Earlier Snapshots</a>
<ul>
<li><a href="#roll-back-with-snapper">Roll Back with snapper</a></li>
</ul></li>
<li><a href="#configure-automatic-time-based-snapshots">Configure Automatic Time-based Snapshots</a></li>
<li><a href="#caveats-and-errata">Caveats and Errata</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
