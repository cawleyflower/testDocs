<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Center Host to to R Architecture | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/" class="active">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Data Center Host to to R Architecture</strong>
</header>

      
<article class="markdown">

<h1 id="data-center-host-to-tor-architecture">Data Center Host to ToR Architecture</h1>

<p>This chapter discusses the various architectures and strategies
available from the top of rack (ToR) switches all the way down to the
server hosts.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#DataCenterHosttoToRArchitecture-Layer2-Architecture">Layer 2 -
Architecture</a>

<ul>
<li><a href="#DataCenterHosttoToRArchitecture-TraditionalSpanningTree-SingleAttached">Traditional Spanning Tree - Single
Attached</a></li>
<li><a href="#DataCenterHosttoToRArchitecture-mlagMLAG">MLAG</a></li>
</ul></li>
<li><a href="#DataCenterHosttoToRArchitecture-Layer3Architecture">Layer 3
Architecture</a>

<ul>
<li><a href="#DataCenterHosttoToRArchitecture-Single-attachedHosts">Single-attached
Hosts</a></li>
<li><a href="#DataCenterHosttoToRArchitecture-RedistributeNeighbor">Redistribute
Neighbor</a></li>
<li><a href="#DataCenterHosttoToRArchitecture-RoutingontheHost">Routing on the
Host</a></li>
<li><a href="#DataCenterHosttoToRArchitecture-RoutingontheVM">Routing on the
VM</a></li>
<li><a href="#DataCenterHosttoToRArchitecture-VirtualRouter">Virtual Router</a></li>
<li><a href="#DataCenterHosttoToRArchitecture-AnycastwithManualRedistribution">Anycast with Manual
Redistribution</a></li>
</ul></li>
<li><a href="#DataCenterHosttoToRArchitecture-NetworkVirtualization">Network
Virtualization</a></li>
</ul>

<h2 id="layer-2-architecture">Layer 2 - Architecture</h2>

<h3 id="traditional-spanning-tree-single-attached">Traditional Spanning Tree - Single Attached</h3>

<p><strong><img src="attachments/8362991/8362994.png" alt="" />{height=&ldquo;250&rdquo;}</strong></p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><a href="Bonding_-_Link_Aggregation">Bond</a>/Etherchannel is not configured on host to multiple switches (bonds can still occur but only to one switch at a time), so leaf01 and leaf02 see two different MAC addresses.</p>
<p><strong>Configurations</strong></p>
<div id="expander-644593864" class="expand-container">
<div id="expander-control-644593864" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />Click here to expand...
</div>
<div id="expander-content-644593864" class="expand-content">
<p><strong>leaf01 Config</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto bridge
iface bridge
  bridge-vlan-aware yes
  bridge-ports swp1 peerlink
  bridge-vids 1-2000
  bridge-stp on

auto bridge.10
iface bridge.10
  address 10.1.10.2/24

auto peerlink
iface peerlink
    bond-slaves glob swp49-50

auto swp1
iface swp1
  mstpctl-portadminedge yes
  mstpctl-bpduguard yes</code></pre>
</div>
</div>
<p><strong>Example Host Config (Ubuntu)</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto eth1
iface eth1 inet manual

auto eth1.10
iface eth1.10 inet manual

auto eth2
iface eth1 inet manual

auto eth2.20
iface eth2.20 inet manual

auto br-10
iface br-10 inet manual
  bridge-ports eth1.10 vnet0

auto br-20
iface br-20 inet manual
  bridge-ports eth2.20 vnet1</code></pre>
</div>
</div>
</div>
</div></td>
<td><p><strong>Benefits</strong></p>
<ul>
<li>Established technology
<ul>
<li>Interoperability with other vendors</li>
<li>Easy configuration for customer</li>
<li>Immense documentation from multiple vendors and industry</li>
</ul></li>
<li>Ability to use <a href="Spanning_Tree_and_Rapid_Spanning_Tree">spanning tree</a> commands
<ul>
<li>mstpctl-portadminedge</li>
<li><a href="Spanning-Tree-and-Rapid-Spanning-Tree_8362689.html#SpanningTreeandRapidSpanningTree-bpdu">BPDU guard</a></li>
</ul></li>
<li>Layer 2 reachability to all VMs</li>
</ul>
<p><strong>Caveats</strong></p>
<ul>
<li>The load balancing mechanism on the host can cause problems. If there is only host pinning to each NIC, there are no problems, but if you are doing a bond, you need to look at an MLAG solution.</li>
<li>No active-active host links. Some operating systems allow HA (NIC failover), but this still does not utilize all the bandwidth. VMs are using one NIC, not two.</li>
</ul></td>
</tr>
</tbody>
</table>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Active-Active Mode</strong></th>
<th><strong>Active-Passive Mode</strong></th>
<th><p><strong>L2 to L3 Demarcation</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li>None (not possible with traditional spanning tree)</li>
</ul>
<p> </p></td>
<td><ul>
<li><a href="Virtual_Router_Redundancy_-_VRR">VRR</a></li>
</ul>
<p><strong><br />
</strong></p></td>
<td><ul>
<li>ToR layer (recommended)</li>
<li>Spine layer</li>
<li>Core/edge/exit</li>
</ul>
<div id="expander-1489816171" class="expand-container">
<div id="expander-control-1489816171" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />More Info...
</div>
<div id="expander-content-1489816171" class="expand-content">
<p>VRR can be configured on a pair of switches at any level in the network. However, the higher up the network you configure it, the larger the L2 domain becomes. The benefit here is L2 reachability. The drawback is the L2 domain is more difficult to troubleshoot, does not scale as well, and the pair of switches running VRR needs to carry the entire MAC address table of everything below it in the network. Minimizing the L2 domain as much as possible is recommended by Cumulus Professional Services. <a href="https://docs.google.com/presentation/d/1l1d_6iUF7RTUHTSAmGuLwm3WCUXTNdFjndCLLxzBSOU/edit?usp=sharing">See this presentation for more information</a>.</p>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="mlag">MLAG</h3>

<p><strong><img src="attachments/8362991/8363001.png" alt="" />{height=&ldquo;150&rdquo;}</strong></p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><a href="Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a> (multi-chassis link aggregation) is when both uplinks are utilized at the same time. VRR gives the ability for both spines to act as gateways simultaneously for HA (high availability) and <a href="LNV_VXLAN_Active-Active_Mode">active-active mode</a> (both are being used at the same time).</p>
<p><strong>Configurations</strong></p>
<div id="expander-1718241577" class="expand-container">
<div id="expander-control-1718241577" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />Click here to expand...
</div>
<div id="expander-content-1718241577" class="expand-content">
<p><strong>leaf01 Config</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto bridge
iface bridge
  bridge-vlan-aware yes
  bridge-ports host-01 peerlink
  bridge-vids 1-2000
  bridge-stp on

auto bridge.10
iface bridge.10
  address 172.16.1.2/24
  address-virtual 44:38:39:00:00:10 172.16.1.1/24

auto peerlink
iface peerlink
    bond-slaves glob swp49-50

auto peerlink.4094
iface peerlink.4094
    address 169.254.1.2
    clagd-enable yes
    clagd-peer-ip 169.254.1.2
    clagd-system-mac 44:38:39:FF:40:94

auto host-01
iface host-01
  bond-slaves swp1
  clag-id 1
  {bond-defaults removed for brevity}</code></pre>
</div>
</div>
<p><strong>Example Host Config (Ubuntu)</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto bond0
iface bond0 inet manual
  bond-slaves eth0 eth1
  {bond-defaults removed for brevity}

auto bond0.10
iface bond0.10 inet manual

auto vm-br10
iface vm-br10 inet manual
  bridge-ports bond0.10 vnet0</code></pre>
</div>
</div>
</div>
</div></td>
<td><p><strong>Benefits</strong></p>
<ul>
<li>100% of links utilized</li>
</ul>
<p><strong>Caveats</strong></p>
<ul>
<li>More complicated (more moving parts)</li>
<li>More configuration</li>
<li>No interoperability between vendors</li>
<li>ISL (inter-switch link) required</li>
</ul>
<p><strong>Additional Comments</strong></p>
<ul>
<li>Can be done with either the <a href="Ethernet_Bridging_-_VLANs">traditional</a> or <a href="VLAN-aware_Bridge_Mode">VLAN-aware</a> bridge driver depending on overall STP needs</li>
<li>There are a few different solutions including Cisco VPC and Arista MLAG, but none of them interoperate and are very vendor specific</li>
<li><a href="https://cumulusnetworks.com/media/resources/validated-design-guides/Cumulus-Linux-Layer-2-HA-Validated-Design-Guide_v1.0.0.pdf">Cumulus Networks Layer 2 HA validated design guide</a></li>
</ul></td>
</tr>
</tbody>
</table>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Active-Active Mode</strong></th>
<th><strong>Active-Passive Mode</strong></th>
<th><strong>L2-&gt;L3 Demarcation</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li><a href="Virtual_Router_Redundancy_-_VRR">VRR</a></li>
</ul></td>
<td><p>None</p></td>
<td><ul>
<li>ToR layer (recommended)</li>
<li>Spine layer</li>
<li>Core/edge/exit</li>
</ul></td>
</tr>
</tbody>
</table>

<h2 id="layer-3-architecture">Layer 3 Architecture</h2>

<h3 id="single-attached-hosts">Single-attached Hosts</h3>

<p><img src="attachments/8362991/8362995.png" alt="" />{height=&ldquo;250&rdquo;}</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>The server (physical host) has only has one link to one ToR switch.</p>
<p><strong>Configurations</strong></p>
<div id="expander-1118744947" class="expand-container">
<div id="expander-control-1118744947" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />Click here to expand...
</div>
<div id="expander-content-1118744947" class="expand-content">
<p><strong>leaf01 Config</strong></p>
<p><code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto swp1
iface swp1
  address 172.16.1.1/30</code></pre>
</div>
</div>
<p><code>/etc/frr/frr.conf</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>router ospf
  router-id 10.0.0.11
interface swp1
  ip ospf area 0</code></pre>
</div>
</div>
<p><strong>leaf02 Config</strong></p>
<p><code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto swp1
iface swp1
  address 172.16.2.1/30</code></pre>
</div>
</div>
<p><code>/etc/frr/frr.conf</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>router ospf
  router-id 10.0.0.12
interface swp1
  ip ospf area 0</code></pre>
</div>
</div>
<p><strong>host1 Example Config (Ubuntu)</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto eth1
iface eth1 inet static
  address 172.16.1.2/30
  up ip route add 0.0.0.0/0 nexthop via 172.16.1.1</code></pre>
</div>
</div>
<p><strong>host2 Example Config (Ubuntu)</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto eth1
iface eth1 inet static
  address 172.16.2.2/30
  up ip route add 0.0.0.0/0 nexthop via 172.16.2.1</code></pre>
</div>
</div>
</div>
</div></td>
<td><p><strong><strong>Benefits</strong></strong></p>
<ul>
<li>Relatively simple network configuration</li>
<li>No STP</li>
<li>No MLAG</li>
<li>No L2 loops</li>
<li>No crosslink between leafs</li>
<li>Greater route scaling and flexibility</li>
</ul>
<p><strong><strong>Caveats</strong></strong></p>
<ul>
<li>No redundancy for ToR, upgrades would cause downtime</li>
<li>Many customers do not have software to support application layer redundancy</li>
</ul>
<p><strong>Additional Comments</strong></p>
<ul>
<li>For additional bandwidth links between host and leaf may be bonded</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>FHR (First Hop Redundancy)</strong></td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td><ul>
<li>No redundancy, uses single ToR as gateway.</li>
</ul></td>
<td><ul>
<li><a href="https://cumulusnetworks.com/media/cumulus/pdf/technical/validated-design-guides/Big-Data-Cumulus-Linux-Validated-Design-Guide.pdf">Big Data validated design guide</a> uses single attached ToR</li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="redistribute-neighbor">Redistribute Neighbor</h3>

<p><img src="attachments/8362991/8363000.png" alt="" />{height=&ldquo;250&rdquo;}</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><a href="https://support.cumulusnetworks.com/hc/en-us/articles/204339077">Redistribute neighbor</a> daemon grabs ARP entries dynamically, utilizes redistribute table for FRRouting to grab these dynamic entries and redistribute them into the fabric.</p>
<p> </p></td>
<td><p><strong>Benefits</strong></p>
<ul>
<li>Configuration in FRRouting is simple (route-map + redist table)</li>
<li>Supported by Cumulus Networks</li>
</ul>
<p><strong>Caveats</strong></p>
<ul>
<li>Silent hosts don't receive traffic (depending on ARP).</li>
<li>IPv4 only.</li>
<li>If two VMs are on same L2 domain, they could learn about each other directly rather than utilizing gateway, which causes problems (VM migration for example, or getting their network routed). Put hosts on /32 (no other L2 adjacency).</li>
<li>VM move does not trigger route withdrawal from original leaf (4 hour timeout).</li>
<li>Clearing ARP impacts routing. May not be obvious.</li>
<li>No L2 adjacency between servers without VXLAN.</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>FHR (First Hop Redundancy)</strong></td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td><ul>
<li>Equal cost route installed on server/host/hypervisor to both ToRs to load balance evenly.</li>
<li>For host/VM/container mobility, use the same default route on all hosts (such as x.x.x.1) but don't distribute or advertise the .1 on the ToR into the fabric. This allows the VM to use the same gateway no matter which pair of leafs it is cabled to.</li>
</ul></td>
<td><ul>
<li><a href="https://cumulusnetworks.com/blog/introducing-rdnbr/">Cumulus Networks blog post introducing redistribute neighbor</a></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="routing-on-the-host">Routing on the Host</h3>

<p><strong><img src="attachments/8362991/8362992.png" alt="" />{height=&ldquo;250&rdquo;}</strong></p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Routing on the host means there is a routing application (such as <a href="FRRouting_Overview">FRRouting</a>) either on the bare metal host (no VMs/containers) or the hypervisor (for example, Ubuntu with KVM). This is highly recommended by the Cumulus Networks Professional Services team.</p></td>
<td><p><strong>Benefits</strong></p>
<ul>
<li>No requirement for MLAG</li>
<li>No spanning-tree or layer 2 domain</li>
<li>No loops</li>
<li>3 or more ToRs can be used instead of usual 2</li>
<li>Host and VM mobility</li>
<li>Traffic engineering can be used to migrate traffic from one ToR to another for upgrading both hardware and software</li>
</ul>
<p><strong>Caveats</strong></p>
<ul>
<li>Certain hypervisors or host OSes might not support a routing application like FRRouting and will require a virtual router on the hypervisor</li>
<li>No L2 adjacnecy between servers without VXLAN</li>
</ul>
<p> </p></td>
</tr>
<tr class="even">
<td><strong>FHR (First Hop Redundancy)</strong></td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td><ul>
<li>The first hop is still the ToR, just like redistribute neighbor</li>
<li><p>A default route can be advertised by all leaf/ToRs for dynamic ECMP paths</p></li>
</ul></td>
<td><ul>
<li><a href="https://support.cumulusnetworks.com/hc/en-us/articles/213177027-Installing-the-Cumulus-Linux-Quagga-Package-on-an-Ubuntu-Server">Installing the Cumulus Linux FRRouting Package on an Ubuntu Server</a></li>
<li><a href="Configuring_FRRouting">Configuring FRRouting</a></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="routing-on-the-vm">Routing on the VM</h3>

<p><img src="attachments/8362991/8362993.png" alt="" />{height=&ldquo;250&rdquo;}</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Instead of routing on the hypervisor, each virtual machine utilizes its own routing stack.</p>
<p> </p></td>
<td><p><strong>Benefits</strong></p>
<ul>
<li>In addition to routing on host:
<ul>
<li>Hypervisor/base OS does not need to be able to do routing</li>
<li>VMs can be authenticated into routing fabric</li>
</ul></li>
</ul>
<p><strong><strong>Caveats</strong></strong></p>
<ul>
<li>All VMs must be capable of routing</li>
<li>Scale considerations might need to be taken into an account —<br />
instead of one routing process, there are as many as there are VMs</li>
<li>No L2 adjacency between servers without VXLAN</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>FHR (First Hop Redundancy)</strong></td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td><ul>
<li>The first hop is still the ToR, just like redistribute neighbor </li>
<li>Multiple ToRs (2+) can be used</li>
</ul></td>
<td><ul>
<li><a href="https://support.cumulusnetworks.com/hc/en-us/articles/213177027-Installing-the-Cumulus-Linux-Quagga-Package-on-an-Ubuntu-Server">Installing the Cumulus Linux FRRouting Package on an Ubuntu Server</a></li>
<li><a href="Configuring_FRRouting">Configuring FRRouting</a></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="virtual-router">Virtual Router</h3>

<p><img src="attachments/8362991/8362990.png" alt="" />{height=&ldquo;250&rdquo;}</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Virtual router (vRouter) runs as a VM on the hypervisor/host, sends routes to the ToR using BGP or <a href="Open_Shortest_Path_First_-_OSPF">OSPF</a>.</p>
<p> </p></td>
<td><p><strong><strong>Benefits</strong></strong></p>
<p>In addition to routing on a host:</p>
<ul>
<li>Multi-tenancy can work (multiple customers sharing same racks)</li>
<li>Base OS does not need to be routing capable</li>
</ul>
<p><strong><strong>Caveats</strong></strong></p>
<ul>
<li><a href="Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP">ECMP</a> might not work correctly (load balancing to multiple ToRs); Linux kernel in older versions is not capable of ECMP per flow (does it per packet)</li>
<li>No L2 adjacency between servers without VXLAN</li>
</ul>
<p> </p></td>
</tr>
<tr class="even">
<td><strong>FHR (First Hop Redundancy)</strong></td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td><ul>
<li>The gateway would be the vRouter, which has two routes out (two ToRs)</li>
<li>Multiple vRouters could be used</li>
</ul></td>
<td><ul>
<li><a href="https://support.cumulusnetworks.com/hc/en-us/articles/213177027-Installing-the-Cumulus-Linux-Quagga-Package-on-an-Ubuntu-Server">Installing the Cumulus Linux FRRouting Package on an Ubuntu Server</a></li>
<li><a href="Configuring_FRRouting">Configuring FRRouting</a></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="anycast-with-manual-redistribution">Anycast with Manual Redistribution</h3>

<p><img src="attachments/8362991/8362997.png" alt="" />{height=&ldquo;150&rdquo;}</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>In contrast to routing on the host (preferred), this method allows a user to route <strong>to</strong> the host. The ToRs are the gateway, as with redistribute neighbor, except because there is no daemon running, the networks must be manually configured under the routing process. There is a potential to black hole unless a script is run to remove the routes when the host no longer responds.</p>
<p><strong>Configurations</strong></p>
<div id="expander-1245332030" class="expand-container">
<div id="expander-control-1245332030" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />Click here to expand...
</div>
<div id="expander-content-1245332030" class="expand-content">
<p><strong>leaf01 Config</strong></p>
<p><code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto swp1
iface swp1
  address 172.16.1.1/30</code></pre>
</div>
</div>
<p><code>/etc/frr/frr.conf</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>router ospf
  router-id 10.0.0.11
interface swp1
  ip ospf area 0</code></pre>
</div>
</div>
<p><strong>leaf02 Config</strong></p>
<p><code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto swp2
iface swp2
  address 172.16.1.1/30</code></pre>
</div>
</div>
<p><code>/etc/frr/frr.conf</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>router ospf
  router-id 10.0.0.12
interface swp1
  ip ospf area 0</code></pre>
</div>
</div>
<p><strong>Example Host Config (Ubuntu)</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback

auto lo:1
iface lo:1 inet static
  address 172.16.1.2/32
  up ip route add 0.0.0.0/0 nexthop via 172.16.1.1 dev eth0 onlink nexthop via 172.16.1.1 dev eth1 onlink

auto eth1
iface eth2 inet static
  address 172.16.1.2/32

auto eth2
iface eth2 inet static
  address 172.16.1.2/32</code></pre>
</div>
</div>
</div>
</div>
<p> </p>
<p> </p></td>
<td><p><strong><strong>Benefits</strong></strong></p>
<ul>
<li>Most benefits of routing <strong>on</strong> the host </li>
<li>No requirement for host to run routing</li>
<li>No requirement for redistribute neighbor</li>
</ul>
<p><strong><strong>Caveats</strong></strong></p>
<ul>
<li>Removing a subnet from one ToR and re-adding it to another (hence, network statements from your router process) is a manual process</li>
<li>Network team and server team would have to be in sync, or server team controls the ToR, or automation is being used whenever VM migration happens</li>
<li>When using VMs/containers it is very easy to black hole traffic, as the leafs continue to advertise prefixes even when VM is down</li>
<li>No L2 adjacency between servers without VXLAN</li>
</ul>
<p> </p></td>
</tr>
<tr class="even">
<td><strong>FHR (First Hop Redundancy)</strong></td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td><ul>
<li>The gateways would be the ToRs, exactly like redistribute neighbor with an equal cost route installed</li>
</ul></td>
<td> </td>
</tr>
</tbody>
</table>

<h2 id="network-virtualization">Network Virtualization</h2>

<p><strong>LNV with MLAG</strong></p>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th> </th>
<th>Summary</th>
<th>More Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> </td>
<td><p>The host runs LACP (Etherchannel/bond) to the pair of ToRs. <a href="Lightweight_Network_Virtualization_Overview">LNV</a> (Lightweight Network Virtualization) then transports the L2 bridges across an L3 fabric.</p>
<p><strong>Configurations</strong></p>
<div id="expander-1408316602" class="expand-container">
<div id="expander-control-1408316602" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />Click here to expand...
</div>
<div id="expander-content-1408316602" class="expand-content">
<p><strong>leaf01 Config</strong></p>
<p><code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback 
  address 10.0.0.11/32
  vxrd-src-ip 10.0.0.11
  vxrd-svcnode-ip 10.10.10.10
  clagd-vxlan-anycast-ip 36.0.0.11

auto vni-10
iface vni-10 
  vxlan-id 10 
  vxlan-local-tunnelip 10.0.0.11

auto br-10 
iface br-10
  bridge-ports swp1 vni-10</code></pre>
</div>
</div>
<p><strong>leaf02 Config</strong></p>
<p><code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback 
  address 10.0.0.12/32
  Vxrd-src-ip 10.0.0.12
  vxrd-svcnode-ip 10.10.10.10
  clagd-vxlan-anycast-ip 36.0.0.11

auto vni-10
iface vni-10 
  vxlan-id 10 
  vxlan-local-tunnelip 10.0.0.12

auto br-10 
iface br-10
  bridge-ports swp1 vni-10</code></pre>
</div>
</div>
</div>
</div></td>
<td><p><strong><strong>Benefits</strong></strong></p>
<ul>
<li>Layer 2 domain is reduced to the pair of ToRs</li>
<li>Aggregation layer is all L3 (VLANs do not have to exist on spine switches)</li>
<li>Greater route scaling and flexibility</li>
<li>High availability</li>
</ul>
<p><strong><strong>Caveats</strong></strong></p>
<ul>
<li>Needs MLAG (with the same caveats from the <a href="#DataCenterHosttoToRArchitecture-mlag">MLAG section</a> above) and <a href="Spanning_Tree_and_Rapid_Spanning_Tree">spanning tree</a></li>
</ul>
<p> </p></td>
</tr>
</tbody>
</table>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Active-Active Mode</strong></th>
<th><strong>Active-Passive Mode</strong></th>
<th><strong>Demarcation</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li><a href="Virtual_Router_Redundancy_-_VRR">VRR</a></li>
</ul></td>
<td><p>None</p></td>
<td><ul>
<li>ToR layer or exit leafs</li>
</ul></td>
</tr>
<tr class="even">
<td> </td>
<td> </td>
<td><strong>More Information</strong></td>
</tr>
<tr class="odd">
<td> </td>
<td> </td>
<td><ul>
<li><a href="Lightweight_Network_Virtualization_Overview">Cumulus Linux Lightweight Network Virtualization (LNV) documentation</a></li>
</ul></td>
</tr>
</tbody>
</table>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362991/8363008.png">image2015-12-17
15:47:2.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362991/8363007.png">image2015-12-17
16:24:1.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363006.png">mac-pinning.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363005.png">redist-neigh.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363004.png">routingonvm.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363003.png">mlaglnv.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363002.png">singlenic.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363001.png">mlag.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8363000.png">redisneigh.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362999.png">routehost.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362998.png">routevm.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362997.png">anycast.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362996.png">lnvmlag.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362991/8362995.png">Screen Shot
2016-04-04 at 4.00.28 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362994.png">singleattach.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362993.png">routingvm.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362992.png">routingonhost.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362991/8362990.png">vrouter.png</a> (image/png)</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#data-center-host-to-tor-architecture">Data Center Host to ToR Architecture</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#layer-2-architecture">Layer 2 - Architecture</a>
<ul>
<li><a href="#traditional-spanning-tree-single-attached">Traditional Spanning Tree - Single Attached</a></li>
<li><a href="#mlag">MLAG</a></li>
</ul></li>
<li><a href="#layer-3-architecture">Layer 3 Architecture</a>
<ul>
<li><a href="#single-attached-hosts">Single-attached Hosts</a></li>
<li><a href="#redistribute-neighbor">Redistribute Neighbor</a></li>
<li><a href="#routing-on-the-host">Routing on the Host</a></li>
<li><a href="#routing-on-the-vm">Routing on the VM</a></li>
<li><a href="#virtual-router">Virtual Router</a></li>
<li><a href="#anycast-with-manual-redistribution">Anycast with Manual Redistribution</a></li>
</ul></li>
<li><a href="#network-virtualization">Network Virtualization</a></li>
<li><a href="#attachments">Attachments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
