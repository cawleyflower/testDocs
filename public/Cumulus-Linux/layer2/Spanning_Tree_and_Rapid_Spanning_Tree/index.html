<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spanning Tree and Rapid Spanning Tree | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.20b2cb98a9208e1e7497525a9f78f7f8eb0ca4b5f4551e9610f12c5b317e6be8.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/" class="active">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>
 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/">
    U I User Guide</a> 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/monitor_the_network/">
    Monitor the Network</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_alarm_events/Monitor_Alarm_Events/">Monitor Alarm Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_informational_events/Monitor_Informational_Events/">Monitor Informational Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_health/Monitor_Network_Health/">Monitor Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_inventory/Monitor_Network_Inventory/">Monitor Network Inventory</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_protocols/Monitor_Network_Layer_Protocols/">Monitor Network Layer Protocols</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_switches/Monitor_Switches/">Monitor Switches</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/netq_ui_overview/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/ui_preface/UI_Preface/">U I Preface</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/cli_user_guide/">
    Cli User Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/cli_user_guide/CLI_Preface/CLI_Preface/">C L I Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/automate_common_tasks/Automate_Common_and_Repetitive_Tasks/">Automate Common and Repetitive Tasks</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/command_line_overview/NetQ_Command_Line_Overview/">Net Q Command Line Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_containter_environments/Monitor_Container_Environments/">Monitor Container Environments</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_data_link_layer/Monitor_Data_Link_Layer_Devices_and_Protocols/">Monitor Data Link Layer Devices and Protocols</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_linux_hosts/Monitor_Linux_Hosts/">Monitor Linux Hosts</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_health/Monitor_Overall_Network_Health/">Monitor Overall Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_layer/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_physical_layer/Monitor_Physical_Layer_Components/">Monitor Physical Layer Components</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_switch_hardware/Monitor_Switch_Hardware_and_Software/">Monitor Switch Hardware and Software</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_virtual_overlays/Monitor_Virtual_Network_Overlays/">Monitor Virtual Network Overlays</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_Issues/">Resolve Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_MLAG_Issues/">Resolve M L a G Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/investiage_netq_issues/Investigate_NetQ_Issues/">Investigate Net Q Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/methods_for_diagnosing_issues/Methods_for_Diagnosing_Network_Issues/">Methods for Diagnosing Network Issues</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/deployment_guide/">
    Deployment Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/deployment_guide/config_optional_netq/Configuring_Optional_NetQ_Capabilities/">Configuring Optional Net Q Capabilities</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/deployment_preface/Deployment_Preface/">Deployment Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/install_netq/Install_NetQ/">Install Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/maintain_netq/Maintain_NetQ/">Maintain Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/netq_primer/Cumulus_NetQ_Primer/">Cumulus Net Q Primer</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/Release_Notes/Cumulus_NetQ_2.0_Release_Notes/">Cumulus Net Q 2.0 Release Notes</a>
    </li>
    
    <li>
      <a href="/NetQ/getting_started/Getting_Started_with_the_Cumulus_NetQ_Appliance/">Getting Started With the Cumulus Net Q Appliance</a>
    </li>
    
    <li>
      <a href="/NetQ/software_installation_guide/Cumulus_NetQ_Appliance_Software_Installation_Guide/">Cumulus Net Q Appliance Software Installation Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Spanning Tree and Rapid Spanning Tree</strong>
</header>

      
<article class="markdown">

<h1 id="spanning-tree-and-rapid-spanning-tree">Spanning Tree and Rapid Spanning Tree</h1>

<p>Spanning tree protocol (STP) is always recommended in layer 2 topologies
as it prevents bridge loops and broadcast radiation on a bridged
network. STP also provides redundant links for automatic failover when
an active link fails. STP is enabled by default in Cumulus Linux.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#SpanningTreeandRapidSpanningTree-SupportedModes">Supported Modes</a>

<ul>
<li><a href="#SpanningTreeandRapidSpanningTree-STPforaVLAN-awareBridge">STP for a VLAN-aware
Bridge</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-STPwithinaTraditionalModeBridge">STP within a Traditional Mode
Bridge</a></li>
</ul></li>
<li><a href="#SpanningTreeandRapidSpanningTree-ViewBridgeandSTPStatusandLogs">View Bridge and STP Status and
Logs</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-CustomizeSpanningTreeProtocol">Customize Spanning Tree
Protocol</a>

<ul>
<li><a href="#SpanningTreeandRapidSpanningTree-SpanningTreePriority">Spanning Tree
Priority</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-PortAdminEdge(PortFastMode)">PortAdminEdge (PortFast
Mode)</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-PortAutoEdge">PortAutoEdge</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-bpduBPDUGuard">BPDU Guard</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-BridgeAssurance">Bridge
Assurance</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-BPDUFilter">BPDU Filter</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-StormControl">Storm Control</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-paramsSpanningTreeParameterList">Spanning Tree Parameter
List</a></li>
<li><a href="#SpanningTreeandRapidSpanningTree-CaveatsandErrata">Caveats and
Errata</a></li>
</ul></li>
<li><a href="#SpanningTreeandRapidSpanningTree-RelatedInformation">Related
Information</a></li>
</ul>

<h2 id="supported-modes">Supported Modes</h2>

<p>The STP modes Cumulus Linux supports vary depending upon whether
the traditional or VLAN-aware bridge driver mode is in use.</p>

<ul>
<li>Bridges configured in* <a href="VLAN-aware_Bridge_Mode">VLAN-aware</a> *mode
operate <strong>only</strong> in RSTP mode. </li>
<li>Bridges configured in <a href="Traditional_Bridge_Mode"><em>traditional</em>
mode</a> operate in both PVST and PVRST mode.
The default is set to PVRST. Each traditional bridge has its own
separate STP instance.</li>
</ul>

<h3 id="stp-for-a-vlan-aware-bridge">STP for a VLAN-aware Bridge</h3>

<p>VLAN-aware* *bridges only operate in RSTP mode. STP bridge protocol data
units (BPDUs) are transmitted on the native VLAN.</p>

<p>If a bridge running RSTP (802.1w) receives a common STP (802.1D) BPDU,
it falls back to 802.1D operation automatically. RSTP interoperates with
MST seamlessly, creating a single instance of spanning tree, which
transmits BPDUs on the native VLAN. RSTP treats the MST domain as one
giant switch.</p>

<p>When connecting a VLAN-aware bridge to a proprietary PVST+ switch using
STP, VLAN 1 must be allowed on all 802.1Q trunks that interconnect them,
regardless of the configured native VLAN. This is because only VLAN 1
enables the switches to address the BPDU frames to the IEEE multicast
MAC address. The proprietary switch might be configured like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">switchport trunk allowed vlan 1-100</code></pre></div>
<h3 id="stp-within-a-traditional-mode-bridge">STP within a Traditional Mode Bridge</h3>

<p>Per VLAN Spanning Tree (PVST) creates a spanning tree instance for a
bridge. Rapid PVST (PVRST) supports RSTP enhancements for each spanning
tree instance. To use PVRST with a traditional bridge, you must create a
bridge corresponding to the untagged native VLAN and all the physical
switch ports must be part of the same VLAN. </p>

<p>When connected to a switch that has a native VLAN configuration, the
native VLAN <strong>must</strong> be configured to be VLAN 1 only for maximum
interoperability.</p>

<h2 id="view-bridge-and-stp-status-and-logs">View Bridge and STP Status and Logs</h2>

<p>To check STP status for a bridge, run
the <code>net show bridge spanning-tree</code> command:</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click to
reveal the output &hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show bridge spanning-tree 
bridge CIST info
  enabled         yes
  bridge id       1.000.44:38:39:FF:40:90
  designated root 1.000.44:38:39:FF:40:90
  regional root   1.000.44:38:39:FF:40:90
  root port       none
  path cost     0          internal path cost   0
  max age       20         bridge max age       20
  forward delay 15         bridge forward delay 15
  tx hold count 6          max hops             20
  hello time    2          ageing time          300
  force protocol version     rstp
  time since topology change 253343s
  topology change count      4
  topology change            no
  topology change port       peerlink
  last topology change port  leaf03-04

bridge:exit01-02 CIST info
  enabled            no                      role                 Disabled
  port id            8.004                   state                discarding
  external port cost 305                     admin external cost  0
  internal port cost 305                     admin internal cost  0
  designated root    1.000.44:38:39:00:00:27 dsgn external cost   0
  dsgn regional root 1.000.44:38:39:00:00:27 dsgn internal cost   0
  designated bridge  1.000.44:38:39:00:00:27 designated port      8.004
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        2                       Num TX TCN           0
  Num RX BPDU        0                       Num RX TCN           0
  Num Transition FWD 0                       Num Transition BLK   2
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          primary                 clag dual conn mac   00:00:00:00:00:00
  clag remote portID F.FFF                   clag system mac      44:38:39:FF:40:90
bridge:leaf01-02 CIST info
  enabled            yes                     role                 Designated
  port id            8.003                   state                forwarding
  external port cost 10000                   admin external cost  0
  internal port cost 10000                   admin internal cost  0
  designated root    1.000.44:38:39:FF:40:90 dsgn external cost   0
  dsgn regional root 1.000.44:38:39:FF:40:90 dsgn internal cost   0
  designated bridge  1.000.44:38:39:FF:40:90 designated port      8.003
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        253558                  Num TX TCN           2
  Num RX BPDU        253373                  Num RX TCN           4
  Num Transition FWD 126675                  Num Transition BLK   126694
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          primary                 clag dual conn mac   44:38:39:FF:40:94
  clag remote portID F.FFF                   clag system mac      44:38:39:FF:40:90
bridge:leaf03-04 CIST info
  enabled            yes                     role                 Designated
  port id            8.001                   state                forwarding
  external port cost 10000                   admin external cost  0
  internal port cost 10000                   admin internal cost  0
  designated root    1.000.44:38:39:FF:40:90 dsgn external cost   0
  dsgn regional root 1.000.44:38:39:FF:40:90 dsgn internal cost   0
  designated bridge  1.000.44:38:39:FF:40:90 designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        130960                  Num TX TCN           6
  Num RX BPDU        4                       Num RX TCN           1
  Num Transition FWD 2                       Num Transition BLK   1
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          primary                 clag dual conn mac   44:38:39:FF:40:93
  clag remote portID F.FFF                   clag system mac      44:38:39:FF:40:90
bridge:peerlink CIST info
  enabled            yes                     role                 Designated
  port id            F.002                   state                forwarding
  external port cost 10000                   admin external cost  0
  internal port cost 10000                   admin internal cost  0
  designated root    1.000.44:38:39:FF:40:90 dsgn external cost   0
  dsgn regional root 1.000.44:38:39:FF:40:90 dsgn internal cost   0
  designated bridge  1.000.44:38:39:FF:40:90 designated port      F.002
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        126700                  Num TX TCN           2
  Num RX BPDU        6                       Num RX TCN           3
  Num Transition FWD 2                       Num Transition BLK   1
  bpdufilter port    no                     
  clag ISL           yes                     clag ISL Oper UP     yes
  clag role          primary                 clag dual conn mac   00:00:00:00:00:00
  clag remote portID F.FFF                   clag system mac      44:38:39:FF:40:90</code></pre></div>
<p>Use Linux to check spanning tree status (advanced):</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Using Linux
to check STP status &hellip;</p>

<p><code>mstpctl</code> is the utility provided by the <code>mstpd</code> service to configure
STP. The <code>mstpd</code> daemon is an open source project used by Cumulus Linux
to implement IEEE802.1D 2004 and IEEE802.1Q 2011. </p>

<p><code>mstpd</code> is started by default when the switch boots. <code>mstpd</code> logs and
errors are located in <code>/var/log/syslog</code>.</p>

<p><code>mstpd</code> is the preferred utility for interacting with STP on Cumulus
Linux. <code>brctl</code> also provides certain methods for configuring STP;
however, they are not as complete as the tools offered in <code>mstpd</code> and
<a href="https://support.cumulusnetworks.com/hc/en-us/articles/212153658-brctl-showstp-Shows-Carrier-Down-Ports-as-Blocking">output from brctl can be
misleading</a>
in some cases.</p>

<p>To get the bridge state, use:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo brctl show
 bridge name     bridge id               STP enabled     interfaces
 bridge          8000.001401010100       yes             swp1
                                                         swp4
                                                         swp5</code></pre></div>
<p>To show the <code>mstpd</code> bridge state, run this command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show bridge spanning-tree
 bridge CIST info
  enabled         yes
  bridge id       F.000.00:14:01:01:01:00
  designated root F.000.00:14:01:01:01:00
  regional root   F.000.00:14:01:01:01:00
  root port       none
  path cost     0          internal path cost   0
  max age       20         bridge max age       20
  forward delay 15         bridge forward delay 15
  tx hold count 6          max hops             20
  hello time    2          ageing time          200
  force protocol version     rstp
  time since topology change 90843s
  topology change count      4
  topology change            no
  topology change port       swp4
  last topology change port  swp5</code></pre></div>
<p>To show the <code>mstpd</code> bridge port state, run this command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo mstpctl showport bridge
 E swp1 8.001 forw F.000.00:14:01:01:01:00 F.000.00:14:01:01:01:00 8.001 Desg
   swp4 8.002 forw F.000.00:14:01:01:01:00 F.000.00:14:01:01:01:00 8.002 Desg
 E swp5 8.003 forw F.000.00:14:01:01:01:00 F.000.00:14:01:01:01:00 8.003 Desg

cumulus@switch:~$ net show bridge spanning-tree
 
...
 bridge:swp1 CIST info
  enabled            yes                     role                 Designated
  port id            8.001                   state                forwarding
  external port cost 2000                    admin external cost  0
  internal port cost 2000                    admin internal cost  0
  designated root    F.000.00:14:01:01:01:00 dsgn external cost   0
  dsgn regional root F.000.00:14:01:01:01:00 dsgn internal cost   0
  designated bridge  F.000.00:14:01:01:01:00 designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     yes                     topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        45772                   Num TX TCN           4
  Num RX BPDU        0                       Num RX TCN           0
  Num Transition FWD 2                       Num Transition BLK   2</code></pre></div>
<h2 id="customize-spanning-tree-protocol">Customize Spanning Tree Protocol</h2>

<p>There are a number of ways you can customize STP in Cumulus Linux.
Exercise extreme caution with many of the settings below to prevent
malfunctions in STP loop avoidance.</p>

<h3 id="spanning-tree-priority">Spanning Tree Priority</h3>

<p>If you have a multiple spanning tree instance (MSTI 0, also known as a
common spanning tree, or CST), you can set the *tree priority* for a
bridge. The bridge with the lowest priority is elected the <em>root
bridge</em>. The priority must be a number between *0* and *61440* and must
be a multiple of 4096; the default is <em>32768</em>.</p>

<p>To set the tree priority, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bridge stp treeprio 8192
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>Cumulus Linux supports MSTI 0 only. It does not support MSTI 1 through
15.</p>

<h3 id="portadminedge-portfast-mode">PortAdminEdge (PortFast Mode)</h3>

<p>*PortAdminEdge* is equivalent to the PortFast feature offered by other
vendors. It enables or disables the <em>initial edge state</em> of a port in a
bridge.</p>

<p>All ports configured with PortAdminEdge bypass the listening and
learning states to move immediately to forwarding.</p>

<p>Using PortAdminEdge mode has the potential to cause loops if it is not
accompanied by the <a href="#SpanningTreeandRapidSpanningTree-bpdu">BPDU guard</a>
feature.</p>

<p>While it is common for edge ports to be configured as access ports for a
simple end host, this is not mandatory. In the data center, edge ports
typically connect to servers, which might pass both tagged and untagged
traffic.</p>

<p>Example VLAN-aware Bridge Configuration</p>

<p>To configure PortAdminEdge mode, use the <code>bpduguard</code> and <code>portadminedge</code>
NCLU configuration commands:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp5 stp bpduguard
cumulus@switch:~$ net add interface swp5 stp portadminedge
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>The NCLU commands above create the following code snippet:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto swp5
iface swp5
    mstpctl-bpduguard yes
    mstpctl-portadminedge yes</code></pre></div>
<p>Example Traditional Bridge Configuration</p>

<p>For a bridge in <a href="Ethernet_Bridging_-_VLANs">traditional mode</a>,
configure <code>PortAdminEdge</code> under the bridge stanza
in <code>/etc/network/interfaces</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto br2
iface br2 inet static
  bridge-ports swp1 swp2 swp3 swp4
  mstpctl-bpduguard swp1=yes swp2=yes swp3=yes swp4=yes
  mstpctl-portadminedge swp1=yes swp2=yes swp3=yes swp4=yes</code></pre></div>
<p>To load the new configuration, run <code>ifreload -a</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo ifreload -a</code></pre></div>
<h3 id="portautoedge">PortAutoEdge</h3>

<p>*PortAutoEdge* is an enhancement to the
standard PortAdminEdge (PortFast) mode, which allows for the automatic
detection of edge ports. PortAutoEdge enables and disables the *auto
transition* to/from the edge state of a port in a bridge. </p>

<p>Edge ports and access ports are not the same thing. Edge ports
transition directly to the forwarding state and skip the listening and
learning stages. Upstream topology change notifications are not
generated when an edge port&rsquo;s link changes state. Access ports only
forward untagged traffic; however, there is no such restriction on edge
ports, which can forward both tagged and untagged traffic.</p>

<p>When a BPDU is received on a port configured with portautoedge, the port
ceases to be in the edge port state and transitions into a normal STP
port. When BPDUs are no longer received on the interface, the port
becomes an edge port, and transitions through the discarding and
learning states before resuming forwarding.</p>

<p>PortAutoEdge is enabled by default in Cumulus Linux.</p>

<p>To disable PortAutoEdge for an interface, run the
<code>net add interface &lt;port&gt; stp portautoedge no</code> command. The following
example disables PortAutoEdge on swp1:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp1 stp portautoedge no
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>To re-enable PortAutoEdge for an interface, run
the the <code>net del interface &lt;port&gt; stp portautoedge no</code> command. The
following example re-enables PortAutoEdge on swp1: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net del interface swp1 stp portautoedge no
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h3 id="bpdu-guard">BPDU Guard</h3>

<p>To protect the spanning tree topology from unauthorized switches
affecting the forwarding path, you can configure *BPDU guard* (Bridge
Protocol Data Unit). One very common example is when someone hooks up a
new switch to an access port off of a leaf switch. If this new switch is
configured with a low priority, it could become the new root switch and
affect the forwarding path for the entire layer 2 topology.</p>

<p>Example BPDU Guard Configuration</p>

<p>To configure BPDU guard, set the <code>bpduguard</code> value for the interface:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp5 stp bpduguard
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>This creates the following stanza in the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto swp5
iface swp5
    mstpctl-bpduguard yes</code></pre></div>
<h4 id="recover-a-port-disabled-by-bpdu-guard">Recover a Port Disabled by BPDU Guard</h4>

<p>If a BPDU is received on the port, STP will bring down the port and log
an error in <code>/var/log/syslog</code>. The following is a sample error:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">mstpd: error, MSTP_IN_rx_bpdu: bridge:bond0 Recvd BPDU on BPDU Guard Port - Port Down</code></pre></div>
<p>To determine whether BPDU guard is configured, or if a BPDU has been
received, run:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show bridge spanning-tree | grep bpdu
 bpdu guard port    yes                     bpdu guard error     yes</code></pre></div>
<p>The only way to recover a port that has been placed in the disabled
state is to manually un-shut or bring up the port
with <code>sudo ifup </code> <code>[port]</code>, as shown in the example below.</p>

<p>Bringing up the disabled port does not fix the problem if the
configuration on the connected end-station has not been rectified.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf2$ mstpctl showportdetail bridge bond0
bridge:bond0 CIST info
  enabled            no                      role                 Disabled
  port id            8.001                   state                discarding
  external port cost 305                     admin external cost  0
  internal port cost 305                     admin internal cost  0
  designated root    8.000.6C:64:1A:00:4F:9C dsgn external cost   0
  dsgn regional root 8.000.6C:64:1A:00:4F:9C dsgn internal cost   0
  designated bridge  8.000.6C:64:1A:00:4F:9C designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    10                      disputed             no
  bpdu guard port    yes                      bpdu guard error     yes
  network port       no                      BA inconsistent      no
  Num TX BPDU        3                       Num TX TCN           2
  Num RX BPDU        488                     Num RX TCN           2
  Num Transition FWD 1                       Num Transition BLK   2
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          unknown                 clag dual conn mac   0:0:0:0:0:0
  clag remote portID F.FFF                   clag system mac      0:0:0:0:0:0


cumulus@leaf2$ sudo ifup bond0


cumulus@leaf2$ mstpctl showportdetail bridge bond0
bridge:bond0 CIST info
  enabled            yes                     role                 Root
  port id            8.001                   state                forwarding
  external port cost 305                     admin external cost  0
  internal port cost 305                     admin internal cost  0
  designated root    8.000.6C:64:1A:00:4F:9C dsgn external cost   0
  dsgn regional root 8.000.6C:64:1A:00:4F:9C dsgn internal cost   0
  designated bridge  8.000.6C:64:1A:00:4F:9C designated port      8.001
  admin edge port    no                      auto edge port       yes
  oper edge port     no                      topology change ack  no
  point-to-point     yes                     admin point-to-point auto
  restricted role    no                      restricted TCN       no
  port hello time    2                       disputed             no
  bpdu guard port    no                      bpdu guard error     no
  network port       no                      BA inconsistent      no
  Num TX BPDU        3                       Num TX TCN           2
  Num RX BPDU        43                      Num RX TCN           1
  Num Transition FWD 1                       Num Transition BLK   0
  bpdufilter port    no                     
  clag ISL           no                      clag ISL Oper UP     no
  clag role          unknown                 clag dual conn mac   0:0:0:0:0:0
  clag remote portID F.FFF                   clag system mac      0:0:0:0:0:0</code></pre></div>
<h3 id="bridge-assurance">Bridge Assurance</h3>

<p>On a point-to-point link where RSTP is running, if you want to detect
unidirectional links and put the port in a discarding state (in error),
you can enable bridge assurance on the port by enabling a port type
network. The port would be in a bridge assurance inconsistent state
until a BPDU is received from the peer. You need to configure the port
type network on both the ends of the link in order for bridge assurance
to operate properly.</p>

<p>The default setting for bridge assurance is off. This means that there
is no difference between disabling bridge assurance on an interface and
not configuring bridge assurance on an interface.</p>

<p>Example Bridge Assurance Configuration</p>

<p>To enable bridge assurance on an interface, add the <code>portnetwork</code> option
to the interface:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp1 stp portnetwork
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>This creates the following interface stanza:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto swp1
iface swp1
    mstpctl-portnetwork yes</code></pre></div>
<p>You can monitor logs for bridge assurance messages by doing the
following:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo grep -in assurance /var/log/syslog | grep mstp
 1365:Jun 25 18:03:17 mstpd: br1007:swp1.1007 Bridge assurance inconsistent</code></pre></div>
<h3 id="bpdu-filter">BPDU Filter</h3>

<p>You can enable  <code>bpdufilter</code> on a switch port, which filters BPDUs in
both directions. This effectively disables STP on the port as no BPDUs
are transiting.</p>

<p>Using BDPU filter inappropriately can cause layer 2 loops. Use this
feature deliberately and with extreme caution.</p>

<p>Example BPDU Filter Configuration</p>

<p>To configure the BPDU filter, add the <code>portbpdufilter</code> option to the
interface:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add interface swp6 stp portbpdufilter
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following stanza in the
<code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto swp6
iface swp6
    mstpctl-portbpdufilter yes</code></pre></div>
<h3 id="storm-control">Storm Control</h3>

<p>*Storm control* provides protection against excessive inbound BUM
(broadcast, unknown unicast, multicast) traffic on layer 2 switch port
interfaces, which can cause poor network performance.</p>

<p>You configure storm control for each physical port by
<a href="Configuring_switchd">configuring <code>switchd</code></a>. For example, to enable
unicast and multicast storm control at 400 packets per second (pps) and
3000 pps, respectively, for swp1, run the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo sh -c &#39;echo 400 &gt; /cumulus/switchd/config/interface/swp1/storm_control/unknown_unicast&#39;
cumulus@switch:~$ sudo sh -c &#39;echo 3000 &gt; /cumulus/switchd/config/interface/swp1/storm_control/multicast&#39;
 </code></pre></div>
<h3 id="spanning-tree-parameter-list">Spanning Tree Parameter List</h3>

<p>Spanning tree parameters are defined in the
IEEE <a href="http://standards.ieee.org/findstds/standard/802.1D-2004.html">802.1D</a>, <a href="http://standards.ieee.org/findstds/standard/802.1Q-2018.html">802.1Q</a> specifications.</p>

<p>The table below describes the STP configuration parameters available in
Cumulus Linux.  For a comparison of STP parameter configuration
between <code>mstpctl</code> and other vendors,<a href="https://support.cumulusnetworks.com/hc/en-us/articles/206908397"> read this knowledge base
article</a>.</p>

<p>Most of these parameters are blacklisted in the <code>ifupdown_blacklist</code>
section of the<code>/etc/</code><code>netd.conf</code> file. Before you configure these
parameters, you must <a href="https://docs.cumulusnetworks.com/display/DRAFT40/Network+Command+Line+Utility+-+NCLU#NetworkCommandLineUtility-NCLU-conf">edit the
file</a>
to remove them from the blacklist.</p>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>NCLU Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mstpctl-maxage</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp maxage &lt;seconds&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>maximum age</em> of the bridge in seconds. The default is <em>20</em>. The maximum age must meet the condition 2 * (Bridge Forward Delay - 1 second) &gt;= Bridge Max Age.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-ageing</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp ageing &lt;seconds&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the Ethernet (MAC) address <em>ageing time</em> for the bridge in seconds when the running version is STP, but not RSTP/MSTP. The default is <em>1800</em>.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-fdelay</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp fdelay &lt;seconds&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>bridge forward delay</em> time in seconds. The default value is <em>15</em>. The bridge forward delay must meet the condition 2 * (Bridge Forward Delay - 1 second) &gt;= Bridge Max Age.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-maxhops</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp maxhops &lt;max_hops&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>maximum hops</em> for the bridge. The default is <em>20.</em></p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-txholdcount</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp txholdcount &lt;hold_count&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>bridge transmit hold count</em>. The default value is <em>6</em>.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-forcevers</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp forcevers RSTP|STP</code></pre>
</div>
</div></td>
<td><p>Sets the <em>force STP version</em> of the bridge to either RSTP/STP. MSTP is not supported currently. The default is <em>RSTP</em>.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-treeprio         </code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp treeprio &lt;priority&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>tree priority</em> of the bridge for an MSTI (multiple spanning tree instance). The priority value is a number between 0 and 61440 and must be a multiple of 4096. The bridge with the lowest priority is elected the <em>root bridge</em>. The default is <em>32768</em>.</p>
<div>
<div>
<p>Cumulus Linux supports MSTI 0 only. It does not support MSTI 1 through 15.</p>
</div>
</div></td>
</tr>
<tr class="even">
<td><code>mstpctl-hello</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add bridge stp hello &lt;seconds&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>bridge hello time</em> in seconds. The default is <em>2</em>.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-portpathcost</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portpathcost &lt;cost&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>port cost</em> of the interface. The default is <em>0</em>.</p>
<p><code>mstpd</code> supports only long mode; 32 bits for the path cost.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-treeportprio</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp treeportprio &lt;priority&gt;</code></pre>
</div>
</div></td>
<td><p>Sets the <em>priority</em> of the interface for the MSTI. The priority value is a number between 0 and 240 and must be a multiple of 16. The default is <em>128</em>.</p>
<div>
<div>
<p>Cumulus Linux supports MSTI 0 only. It does not support MSTI 1 through 15.</p>
</div>
</div></td>
</tr>
<tr class="odd">
<td><code>mstpctl-portadminedge</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portadminedge</code></pre>
</div>
</div></td>
<td><p>Enables or disables the <em>initial edge state</em> of the interface in the bridge. The default is <em>no</em>.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-portautoedge</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portautoedge no</code></pre>
</div>
</div></td>
<td><p>Enables or disables the <em>auto transition</em> to and from the edge state of the interface in the bridge. The default is <em>yes</em>.</p>
<p><em>portautoedge</em> is an enhancement to the standard PortAdminEdge (PortFast) mode, which allows for the automatic detection of edge ports.</p>
<div>
<div>
<p>Edge ports and access ports are not the same thing. Edge ports transition directly to the forwarding state and skip the listening and learning stages. Upstream topology change notifications are not generated when an edge port's link changes state. Access ports only forward untagged traffic; however, there is no such restriction on edge ports, which can forward both tagged and untagged traffic.</p>
</div>
</div>
<p>When a BPDU is received on a port configured with PortAutoEdge, the port ceases to be in the edge port state and transitions into a normal STP port.</p>
<p>When BPDUs are no longer received on the interface, the port becomes an edge port, and transitions through the discarding and learning states before resuming forwarding.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-portp2p</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portp2p yes|no</code></pre>
</div>
</div></td>
<td><p>Enables or disables the <em>point-to-point detection mode</em> of the interface in the bridge. The default is <em>auto</em>.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-portrestrrole</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portrestrrole</code></pre>
</div>
</div></td>
<td><p>Enables or disables the ability of the interface in the bridge to take the <em>root role</em>. The default is <em>no</em>.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-portrestrtcn</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portrestrtcn</code></pre>
</div>
</div></td>
<td><p>Enables or disables the ability of the interface in the bridge to propagate <em>received topology change notifications</em>. The default is <em>no</em>.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-portnetwork</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portnetwork</code></pre>
</div>
</div></td>
<td><p>Enables or disables the <em>bridge assurance capability</em> for a network interface. The default is <em>no</em>.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-bpduguard</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp bpduguard</code></pre>
</div>
</div></td>
<td><p>Enables or disables the <em>BPDU guard configuration</em> of the interface in the bridge. The default is <em>no</em>.</p>
<p>See above.</p></td>
</tr>
<tr class="even">
<td><code>mstpctl-portbpdufilter</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp portbpdufilter</code></pre>
</div>
</div></td>
<td><p>Enables or disables the <em>BPDU filter</em> functionality for an interface in the bridge. The default is no.</p></td>
</tr>
<tr class="odd">
<td><code>mstpctl-treeportcost</code></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>net add interface &lt;interface&gt; stp treeportcost &lt;port_cost&gt;</code></pre>
</div>
</div></td>
<td>Sets the spanning tree <em>port cost</em> to a value from 0 to 255. The default is <em>0</em>.</td>
</tr>
</tbody>
</table>

<h3 id="caveats-and-errata">Caveats and Errata</h3>

<p>MSTP is not supported currently because Cumulus Linux only supports MSTI
0 (not MSTI 1 through 15). However, interoperability with MSTP networks
can be accomplished using PVRSTP or PVSTP.</p>

<h2 id="related-information">Related Information</h2>

<p>The source code for <code>mstpd</code>/<code>mstpctl</code> was written by <a href="mailto:vitas%40nppfactor.kiev.ua">Vitalii
Demianets</a> and is hosted at the URL
below.</p>

<ul>
<li><a href="https://github.com/mstpd/mstpd">Sourceforge - mstpd project</a></li>
<li><a href="http://en.wikipedia.org/wiki/Spanning_Tree_Protocol">Wikipedia - Spanning Tree
Protocol</a></li>
<li>brctl(8)</li>
<li>bridge-utils-interfaces(5)</li>
<li>ifupdown-addons-interfaces(5)</li>
<li>mstpctl(8)</li>
<li>mstpctl-utils-interfaces(5)</li>
</ul>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#spanning-tree-and-rapid-spanning-tree">Spanning Tree and Rapid Spanning Tree</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#supported-modes">Supported Modes</a>
<ul>
<li><a href="#stp-for-a-vlan-aware-bridge">STP for a VLAN-aware Bridge</a></li>
<li><a href="#stp-within-a-traditional-mode-bridge">STP within a Traditional Mode Bridge</a></li>
</ul></li>
<li><a href="#view-bridge-and-stp-status-and-logs">View Bridge and STP Status and Logs</a></li>
<li><a href="#customize-spanning-tree-protocol">Customize Spanning Tree Protocol</a>
<ul>
<li><a href="#spanning-tree-priority">Spanning Tree Priority</a></li>
<li><a href="#portadminedge-portfast-mode">PortAdminEdge (PortFast Mode)</a></li>
<li><a href="#portautoedge">PortAutoEdge</a></li>
<li><a href="#bpdu-guard">BPDU Guard</a>
<ul>
<li><a href="#recover-a-port-disabled-by-bpdu-guard">Recover a Port Disabled by BPDU Guard</a></li>
</ul></li>
<li><a href="#bridge-assurance">Bridge Assurance</a></li>
<li><a href="#bpdu-filter">BPDU Filter</a></li>
<li><a href="#storm-control">Storm Control</a></li>
<li><a href="#spanning-tree-parameter-list">Spanning Tree Parameter List</a></li>
<li><a href="#caveats-and-errata">Caveats and Errata</a></li>
</ul></li>
<li><a href="#related-information">Related Information</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
