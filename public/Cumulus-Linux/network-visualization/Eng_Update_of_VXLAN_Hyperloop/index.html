<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eng Update of v X L a N Hyperloop | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/" class="active">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Eng Update of v X L a N Hyperloop</strong>
</header>

      
<article class="markdown">

<h1 id="eng-update-of-vxlan-hyperloop">Eng Update of VXLAN Hyperloop</h1>

<p>This chapter describes how to configure VXLAN gateways using a loopback
cable (called a <em>hyperloop</em>) on non-RIOT (VXLAN routing) capable ASICs
running Cumulus Linux.  </p>

<p>The Broadcom Trident II and Tomahawk ASICs have a limitation where a
layer 2 bridge that contains a VXLAN interface cannot also have an IP
address assigned to it. This is an expected limitation with this ASIC
because of the ordering of the decapsulation. A packet that is
decapsulated will already have passed the portion of the ASIC capable of
reading the IP address lookup (for example, VXLAN lookup occurs before
IP address lookup). Contact your <a href="mailto:sales@cumulusnetworks.com">sales
team </a>if there is any confusion. Refer
to the <a href="https://wiki.cumulusnetworks.com/cumulusnetworks.com/hcl">Cumulus Networks Hardware Compatibility
List </a>to
determine which ASIC is running on the switch.</p>

<p><strong>This limitation does not exist in some ASICs.</strong> For example, the
Trident II+ provides the <a href="https://www.broadcom.com/press/release.php?id=s907324">RIOT (Routing In/Out of
Tunnels)</a> feature;
see <a href="VXLAN_Routing">VXLAN Routing</a> for more information. </p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#EngUpdateofVXLANHyperloop-reqsRequirements">Requirements</a></li>

<li><p><a href="#EngUpdateofVXLANHyperloop-HyperloopUseCases">Hyperloop Use Cases</a></p>

<ul>
<li><a href="#EngUpdateofVXLANHyperloop-hyperloopExitaVXLANwithaHyperloop">Exit a VXLAN with a
Hyperloop</a></li>
<li>-   <a href="#EngUpdateofVXLANHyperloop-PacketFlowDiagram">Packet Flow
Diagram</a></li>
<li><a href="#EngUpdateofVXLANHyperloop-TridentIIandTomahawkswitchdFlag">Trident II and Tomahawk switchd
Flag</a></li>
</ul></li>

<li><p><a href="#EngUpdateofVXLANHyperloop-VXLANHyperloopTroubleshootingMatrix">VXLAN Hyperloop Troubleshooting
Matrix</a></p>

<ul>
<li><a href="#EngUpdateofVXLANHyperloop-AreHER(HeadEndReplication)entriesbeingprogrammedintothebridgefdbtable?">Are HER (Head End Replication) entries being programmed into
the bridge fdb
table?</a></li>
<li><a href="#EngUpdateofVXLANHyperloop-IfyouareusinganMLAGVTEP(dualattached),isitsetupcorrectly?">If you are using an MLAG VTEP (dual attached), is it set up
correctly?</a></li>
<li><a href="#EngUpdateofVXLANHyperloop-CanyoupingfromhosttohostonthesameVXLAN?">Can you ping from host to host on the same
VXLAN?</a></li>
<li><a href="#EngUpdateofVXLANHyperloop-IstheSVIonaphysicalinterfaceoronatraditionalbridge?">Is the SVI on a physical interface or on a traditional
bridge? </a></li>
<li><a href="#EngUpdateofVXLANHyperloop-Istheportpluggedincorrectly?">Is the port plugged in
correctly?</a></li>
<li><a href="#EngUpdateofVXLANHyperloop-IstheVRRMACaddressuniquepersubnet?">Is the VRR MAC address unique per
subnet?</a></li>
</ul></li>
</ul>

<h2 id="requirements">Requirements</h2>

<ul>
<li>VXLAN hyperloop only works on an ASIC capable of encapsulating and
decapsulating VXLAN traffic, which includes:

<ul>
<li>Broadcom Tomahawk</li>
<li>Broadcom Trident II</li>
<li>Broadcom Trident II+</li>
<li>Mellanox Spectrum</li>
</ul></li>
<li>VXLAN hyperloop is supported on Cumulus Linux 3.2.1 and later. Make
sure to <a href="Upgrading_Cumulus_Linux">upgrade to the latest version</a> of
Cumulus Linux. </li>

<li><p>If you are using <a href="Ethernet_Virtual_Private_Network_-_EVPN">EVPN</a>,
you must be running FRRouting version eau8. Use
the <code>dpkg -l</code> command to check the FRRouting version:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:mgmt-vrf:~$ dpkg -l frr
Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name                     Version           Architecture      Description
+++-========================-=================-=================-=====================================================
ii  frr                      1.0.0+cl3eau8     amd64             BGP/OSPF/RIP routing daemon</code></pre></div>
<p>If you are not running the correct version of FRRouting for
EVPN, <a href="Ethernet_Virtual_Private_Network_-_EVPN">follow these
directions</a> to upgrade.</p></li>
</ul>

<h2 id="hyperloop-use-cases">Hyperloop Use Cases</h2>

<p>Without native VXLAN routing support, external gateways, firewalls, or
routers are attached to a VTEP do the routing, as in the diagram below.</p>

<p>It is very common in network virtualization environments for firewalls
to sit on internal VXLAN-tied VLANs as well as external VLANs that are
routed out to the internet. Consider the following illustration. No
special configuration is needed on the switch because the firewall acts
as the gateway between the internal VLAN (VLAN20/VNI-20) and the
routable external VLAN 10. VLAN 10 could have an SVI (switch virtual
interface) configured to route out of the VLAN. This also has the
benefit in cases where a VXLAN represents a tenant (or a purposely
separated application) — you want to keep the firewall between VXLANs so
that traffic can be filtered and sanitized to the network operator&rsquo;s
specification. </p>

<p><img src="attachments/8362882/8362886.png" alt="" />{height=&ldquo;250&rdquo;}</p>

<p>With integrated VXLAN routing and bridging using a hyperloop:</p>

<ul>
<li>You can avoid having to use external gateways or routers. A
hyperloop provides the ability to do integrated VXLAN routing on a
non-RIOT (VXLAN routing) ASIC.  </li>
<li>If applications are hosted on the switch and require layer 3
connectivity, you can use a hyperloop to provide reachability for
this application as well.</li>
</ul>

<p>Do <strong>not</strong> use a hyperloop under these circumstances:</p>

<ul>
<li>If the external firewall is used for routing and security (as shown
above), then there is no need for an external loopback as the
firewall provides routing across subnets.</li>
<li>If bandwidth for the traffic to be routed is so large that you
cannot provision such high bandwidth using a hyperloop, use
dedicated gateways connected to exit leafs instead. </li>
<li>If north-south routing involves edge router functionality, then that
functionality cannot be provided by leaf switches; it requires
dedicated edge gateways to achieve the same result, like NAT.</li>
</ul>

<h3 id="exit-a-vxlan-with-a-hyperloop">Exit a VXLAN with a Hyperloop</h3>

<p>This limitation means a physical cable must be attached from one port on
leaf1 to another port on leaf1. One port is a layer 3 port while the
other is a member of the bridge. The native VLAN (VLAN ID 1) must be
tagged for all traffic going to the hyperloop ports.</p>

<p>For example, following the configuration above, for a layer 3 address to
be used as the gateway for vni-10, configure the following on exit01:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@exit01:~$ sudo nano /etc/network/interfaces
 
auto lo
iface lo inet loopback
   address 10.0.0.11/32
 
## some output removed for brevity (such as peerlink and host-facing bonds) ##
 
auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports inside server01 server02 vni-10 vni-20 peerlink
    bridge-vids 100 200
    bridge-pvid 1             # sets native VLAN to 1, an unused VLAN
    mstpctl-treeprio 8192
 
auto outside
iface outside
    bond-slaves swp45 swp47
    alias hyperloop outside 
    mstpctl-bpduguard yes
    mstpctl-portbpdufilter yes
 
auto inside
iface inside
    bond-slaves swp46 swp48
    alias hyperloop inside 
    mstpctl-bpduguard yes
    mstpctl-portbpdufilter yes
 
auto VLAN100GW
iface VLAN100GW
    bridge_ports outside.100
    address 172.16.100.2/24
    alias VXLAN GW 100 Linux Bridge
    address-virtual 44:38:39:FF:01:90 172.16.100.1/24

auto VLAN200GW
iface VLAN200GW
   bridge_ports outside.200
   address 172.16.200.2/24
   alias VXLAN GW 200 Linux Bridge
   address-virtual 44:38:39:FF:02:90 172.16.200.1/24 
 
auto vni-10
iface vni-10
    vxlan-id 10
    vxlan-local-tunnelip 10.0.0.11
    bridge-access 100
 
auto vni-20
iface vni-20
    vxlan-id 20
    vxlan-local-tunnelip 10.0.0.11
    bridge-access 200</code></pre></div>
<h3 id="packet-flow-diagram">Packet Flow Diagram</h3>

<p><img src="attachments/8362882/8362887.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<h3 id="trident-ii-and-tomahawk-switchd-flag">Trident II and Tomahawk switchd Flag</h3>

<p>For the Broadcom Trident II and Tomahawk ASICs to be able to have a
hyperloop work correctly, you must configure the following <code>switchd</code>
flag. This change is not needed on any other hardware ASIC.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@exit01:mgmt-vrf:/root$ sudo nano /etc/cumulus/switchd.conf
hal.bcm.per_vlan_router_mac_lookup = TRUE</code></pre></div>
<p>Restart <code>switchd</code> for the change to take place:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@exit01:mgmt-vrf:/root$ sudo systemctl restart switchd.service</code></pre></div>
<p>Restarting <code>switchd</code> is a disruptive change and affects data plane
network traffic.</p>

<p>Setting <code>hal.bcm.per_vlan_router_mac_lookup = TRUE</code> limits the Trident
II switch to a configurable 512 local IP addresses (SVIs and so forth).
Use this only as a last resort. This is only a limitation on this
specific ASIC type.</p>

<h2 id="vxlan-hyperloop-troubleshooting-matrix">VXLAN Hyperloop Troubleshooting Matrix</h2>

<p>Before you follow these troubleshooting steps, make sure your switch
meets the <a href="#EngUpdateofVXLANHyperloop-reqs">requirements specified
above</a>.</p>

<h3 id="are-her-head-end-replication-entries-being-programmed-into-the-bridge-fdb-table">Are HER (Head End Replication) entries being programmed into the bridge fdb table?</h3>

<p>Check for 00:00:00:00:00:00 entries for each VXLAN using
the <code>bridge fdb show</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf03:mgmt-vrf:~$ bridge fdb show | grep 00:00:00:00:00:00
00:00:00:00:00:00 dev vni-40 dst 10.10.10.30 self permanent
00:00:00:00:00:00 dev vni-40 dst 10.10.10.40 self permanent
00:00:00:00:00:00 dev vni-1 dst 10.10.10.30 self permanent
00:00:00:00:00:00 dev vni-1 dst 10.10.10.40 self permanent
00:00:00:00:00:00 dev vni-30 dst 10.10.10.30 self permanent
00:00:00:00:00:00 dev vni-30 dst 10.10.10.40 self permanent
00:00:00:00:00:00 dev vni-20 dst 10.10.10.30 self permanent
00:00:00:00:00:00 dev vni-20 dst 10.10.10.40 self permanent
00:00:00:00:00:00 dev vni-50 dst 10.10.10.30 self permanent
00:00:00:00:00:00 dev vni-50 dst 10.10.10.40 self permanent
00:00:00:00:00:00 dev vni-10 dst 10.10.10.30 self permanent
00:00:00:00:00:00 dev vni-10 dst 10.10.10.40 self permanent</code></pre></div>
<p>or use <a href="Comparing_NCLU_and_vtysh_Commands">NCLU</a>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf03:mgmt-vrf:~$ net show bridge macs
VLAN      Master    Interface    MAC                TunnelDest    State      Flags    LastSeen
--------  --------  -----------  -----------------  ------------  ---------  -------  ----------------
1         bridge    server03     90:e2:ba:7e:96:d9                                    00:01:07
untagged            vni-1        00:00:00:00:00:00  10.10.10.30   permanent  self     4 days, 22:25:42
untagged            vni-1        00:00:00:00:00:00  10.10.10.40   permanent  self     4 days, 22:25:42
untagged            vni-10       00:00:00:00:00:00  10.10.10.30   permanent  self     4 days, 22:25:42
untagged            vni-10       00:00:00:00:00:00  10.10.10.40   permanent  self     4 days, 22:25:42
untagged            vni-20       00:00:00:00:00:00  10.10.10.30   permanent  self     4 days, 22:25:42
untagged            vni-20       00:00:00:00:00:00  10.10.10.40   permanent  self     4 days, 22:25:42
untagged            vni-30       00:00:00:00:00:00  10.10.10.30   permanent  self     4 days, 22:25:42
untagged            vni-30       00:00:00:00:00:00  10.10.10.40   permanent  self     4 days, 22:25:42
untagged            vni-40       00:00:00:00:00:00  10.10.10.30   permanent  self     4 days, 22:25:42
untagged            vni-40       00:00:00:00:00:00  10.10.10.40   permanent  self     4 days, 22:25:42
untagged            vni-50       00:00:00:00:00:00  10.10.10.30   permanent  self     4 days, 22:25:42
untagged            vni-50       00:00:00:00:00:00  10.10.10.40   permanent  self     4 days, 22:25:42
untagged  bridge    peerlink     2c:60:0c:72:eb:a0                permanent           5 days, 00:53:13
untagged  bridge    server03     2c:60:0c:72:eb:70                permanent           5 days, 00:53:13
untagged  bridge    vni-1        86:c9:5c:cc:88:54                permanent           4 days, 22:28:23
untagged  bridge    vni-10       32:d5:3a:99:36:f7                permanent           4 days, 22:28:23
untagged  bridge    vni-20       9a:91:5a:7e:0f:e8                permanent           4 days, 22:28:23
untagged  bridge    vni-30       6a:33:ff:fd:ca:34                permanent           4 days, 22:28:23
untagged  bridge    vni-40       e2:1f:a4:7c:75:2b                permanent           4 days, 22:28:23
untagged  bridge    vni-50       d6:df:b4:85:4d:55                permanent           4 days, 22:28:23</code></pre></div>
<p>If you are not seeing HER entries, make sure that:</p>

<ul>
<li>You are using
either <a href="Lightweight_Network_Virtualization_Overview">LNV</a> <strong>OR</strong>
EVPN. You cannot use both at the same time.</li>
<li>You are not using any VNI/VXLAN values over 65535. For example,
VXLAN 70000 is not supported in Cumulus Linux.</li>
<li>You are not using the reserved VLAN range; the default is 3000-3999.
This range is stored in the <code>resv_vlan_range</code> variable in
the <code>/etc/cumulus/switchd.conf</code> file.</li>
</ul>

<h3 id="if-you-are-using-an-mlag-vtep-dual-attached-is-it-set-up-correctly">If you are using an MLAG VTEP (dual attached), is it set up correctly?</h3>

<p>Check the outputs. Often, when VXLAN is considered to be non-working, it
is actually due to an incorrect setup on the server OS, whether it is
Ubuntu, Microsoft Windows, or RHEL.</p>

<p><img src="attachments/8362882/8362885.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<h3 id="can-you-ping-from-host-to-host-on-the-same-vxlan">Can you ping from host to host on the same VXLAN?</h3>

<p>In the following network diagram, can server01 ping to server03 on any
of the VLANs (VLAN1, VLAN100, VLAN200)?<br />
<img src="attachments/8362882/8362883.png" alt="" />{height=&ldquo;400&rdquo;}<br />
If you cannot even ping from server to server, this is not a VXLAN
gateway problem but a problem with the network itself. You must resolve
the network problem before you make a VXLAN gateway, with or without a
hyperloop. </p>

<p>Only proceed past this point if you can get server to server
connectivity on the same VXLAN.</p>

<h3 id="is-the-svi-on-a-physical-interface-or-on-a-traditional-bridge">Is the SVI on a physical interface or on a traditional bridge? </h3>

<p>The SVI (switch virtual interface) IP address for a hyperloop MUST be on
a traditional bridge. Follow the configuration guidelines above.</p>

<h3 id="is-the-port-plugged-in-correctly">Is the port plugged in correctly?</h3>

<p>Use the <code>lldpctl</code> or <code>net show lldp</code> commands to see which ports are
hooked up:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf03:mgmt-vrf:~$ net show lldp
Local Port    Speed    Mode                 Remote Port        Remote  Host     Summary
------------  -------  -------------  ----  -----------------  ---------------  -------------------------
eth0          1G       Mgmt           ====  swp42              oob-mgmt-switch  IP: 10.50.100.53/24(DHCP)
swp1          10G      BondMember     ====  90:e2:ba:7e:96:d8  server03         Master: server03(UP)
swp49         40G      BondMember     ====  swp49              leaf04           Master: peerlink(UP)
swp50         40G      BondMember     ====  swp50              leaf04           Master: peerlink(UP)
swp51         40G      NotConfigured  ====  swp3               spine01
swp52         40G      NotConfigured  ====  swp3               spine02
swp53         40G      NotConfigured  ====  swp54              leaf03
swp54         40G      NotConfigured  ====  swp53              leaf03</code></pre></div>
<p>Notice above that swp53 and swp54 are a loopback cable (hyperloop) where
it is connected to itself.</p>

<h3 id="is-the-vrr-mac-address-unique-per-subnet">Is the VRR MAC address unique per subnet?</h3>

<p>Make sure that <a href="Virtual_Router_Redundancy_-_VRR">VRR is configured
correctly</a> and that each MAC address is
unique per VLAN.</p>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362881.png">image2017-3-3
9:44:48.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362883.png">2017 Brand Ref
EVPN Demo (1).png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362884.png">2017 Brand Ref
EVPN Demo.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362885.png">Screen Shot
2017-03-29 at 10.41.39 AM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362886.png">image2017-3-9
14:52:21.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362887.png">Screen Shot
2017-03-09 at 1.32.01 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362888.png">Screen Shot
2017-03-09 at 12.39.53 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362889.png">image2017-3-3
13:16:54.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362890.png">image2017-3-3
13:12:25.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362891.png">image2017-3-3
13:7:1.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362882/8362892.png">multipleleafs.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362882/8362893.png">multipleleafs2.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362882/8362894.png">spinepair.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362895.png">image2017-3-3
10:57:45.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362882/8362896.png">image2017-3-3
9:45:42.png</a> (image/png)</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#eng-update-of-vxlan-hyperloop">Eng Update of VXLAN Hyperloop</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#hyperloop-use-cases">Hyperloop Use Cases</a>
<ul>
<li><a href="#exit-a-vxlan-with-a-hyperloop">Exit a VXLAN with a Hyperloop</a></li>
<li><a href="#packet-flow-diagram">Packet Flow Diagram</a></li>
<li><a href="#trident-ii-and-tomahawk-switchd-flag">Trident II and Tomahawk switchd Flag</a></li>
</ul></li>
<li><a href="#vxlan-hyperloop-troubleshooting-matrix">VXLAN Hyperloop Troubleshooting Matrix</a>
<ul>
<li><a href="#are-her-head-end-replication-entries-being-programmed-into-the-bridge-fdb-table">Are HER (Head End Replication) entries being programmed into the bridge fdb table?</a></li>
<li><a href="#if-you-are-using-an-mlag-vtep-dual-attached-is-it-set-up-correctly">If you are using an MLAG VTEP (dual attached), is it set up correctly?</a></li>
<li><a href="#can-you-ping-from-host-to-host-on-the-same-vxlan">Can you ping from host to host on the same VXLAN?</a></li>
<li><a href="#is-the-svi-on-a-physical-interface-or-on-a-traditional-bridge">Is the SVI on a physical interface or on a traditional bridge? </a></li>
<li><a href="#is-the-port-plugged-in-correctly">Is the port plugged in correctly?</a></li>
<li><a href="#is-the-vrr-mac-address-unique-per-subnet">Is the VRR MAC address unique per subnet?</a></li>
</ul></li>
<li><a href="#attachments">Attachments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
