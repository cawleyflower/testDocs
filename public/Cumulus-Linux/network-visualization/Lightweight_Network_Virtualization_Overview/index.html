<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lightweight Network Virtualization Overview | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/" class="active">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Lightweight Network Virtualization Overview</strong>
</header>

      
<article class="markdown">

<h1 id="lightweight-network-virtualization-overview">Lightweight Network Virtualization Overview</h1>

<p>Lightweight Network Virtualization (LNV) is a technique for
deploying <a href="Network_Virtualization">VXLANs</a> without a central controller
on bare metal switches. This solution requires no external controller or
software suite; it runs the VXLAN service and registration daemons on
Cumulus Linux itself. The data path between bridge entities is
established on top of a layer 3 fabric by means of a simple service node
coupled with traditional MAC address learning.</p>

<p>To see an example of a full solution before reading the following
background information, <a href="LNV_Full_Example">read this chapter</a>.</p>

<p>LNV is a lightweight controller option. <a href="https://support.cumulusnetworks.com/hc/en-us/requests/new">Contact Cumulus
Networks</a>
with your scale requirements so we can make sure this is the right fit
for you. There are also other controller options that can work on
Cumulus Linux.</p>

<p>You cannot use LNV and EVPN at the same time.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-LNVConcepts">LNV
Concepts</a>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-AcquiretheForwardingDatabaseattheServiceNode">Acquire the Forwarding Database at the Service
Node</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-MACLearningandFlooding">MAC Learning and
Flooding</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-BUMTraffic">BUM
Traffic</a></li>
</ul></li>
<li><a href="#LightweightNetworkVirtualizationOverview-Requirements">Requirements</a>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-HardwareRequirements">Hardware
Requirements</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-ConfigurationRequirements">Configuration
Requirements</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-InstalltheLNVPackages">Install the LNV
Packages</a></li>
</ul></li>
<li><a href="#LightweightNetworkVirtualizationOverview-SampleLNVConfiguration">Sample LNV
Configuration</a>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-NetworkConnectivity">Network Connectivity</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-Layer3IPAddressing">Layer 3 IP
Addressing</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-Layer3Fabric">Layer 3
Fabric</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-HostConfiguration">Host
Configuration</a></li>
</ul></li>
<li><a href="#LightweightNetworkVirtualizationOverview-mappingConfiguretheVLANtoVXLANMapping">Configure the VLAN to VXLAN
Mapping</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-VerifytheVLANtoVXLANMapping">Verify the VLAN to VXLAN
Mapping</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-EnableandManageServiceNodeandRegistrationDaemons">Enable and Manage Service Node and Registration
Daemons</a>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-EnabletheServiceNodeDaemon">Enable the Service Node
Daemon</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-EnabletheRegistrationDaemon">Enable the Registration
Daemon</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-ChecktheDaemonStatus">Check the Daemon
Status</a></li>
</ul></li>
<li><a href="#LightweightNetworkVirtualizationOverview-regnodeConfiguretheRegistrationNode">Configure the Registration
Node</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-ConfiguretheServiceNode">Configure the Service
Node</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-VerifiyandTroubleshoot">Verifiy and
Troubleshoot</a>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-VerifytheRegistrationNodeDaemon">Verify the Registration Node
Daemon </a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-VerifytheServiceNodeDaemon">Verify the Service Node
Daemon</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-VerifyTrafficFlowandCheckCounters">Verify Traffic Flow and Check
Counters</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-PingtoTestConnectivity">Ping to Test
Connectivity</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-TroubleshootwithMACAddresses">Troubleshoot with MAC
Addresses</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-ChecktheServiceNodeConfiguration">Check the Service Node
Configuration</a></li>
</ul></li>
<li><a href="#LightweightNetworkVirtualizationOverview-loadbalancingAdvancedLNVUsage">Advanced LNV
Usage</a>

<ul>
<li><a href="#LightweightNetworkVirtualizationOverview-ScaleLNVbyLoadBalancingwithAnycast">Scale LNV by Load Balancing with
Anycast</a></li>
<li><a href="#LightweightNetworkVirtualizationOverview-RestartNetworkRemovesvxsndAnycastIPAddressfromLoopbackInterface">Restart Network Removes vxsnd Anycast IP Address from Loopback
Interface</a></li>
</ul></li>
<li><a href="#LightweightNetworkVirtualizationOverview-RelatedInformation">Related
Information</a></li>
</ul>

<h2 id="lnv-concepts">LNV Concepts</h2>

<p>Consider the following example deployment:</p>

<p><img src="attachments/8362706/8362708.png" alt="" />{width=&ldquo;300&rdquo;} </p>

<p>The two switches running Cumulus Linux, called leaf1 and leaf2, each
have a bridge configured. These two bridges contain the physical switch
port interfaces connecting to the servers as well as the logical VXLAN
interface associated with the bridge. By creating a logical VXLAN
interface on both leaf switches, the switches become <em>VTEPs</em> (virtual
tunnel end points). The IP address associated with this VTEP is most
commonly configured as its loopback address; in the image above, the
loopback address is 10.2.1.1 for leaf1 and 10.2.1.2 for leaf2.</p>

<h3 id="acquire-the-forwarding-database-at-the-service-node">Acquire the Forwarding Database at the Service Node</h3>

<p>To connect these two VXLANs together and forward BUM (Broadcast,
Unknown-unicast, Multicast) packets to members of a VXLAN, the service
node needs to acquire the addresses of all the VTEPs for every VXLAN it
serves. The service node daemon does this through a registration daemon
running on each leaf switch that contains a VTEP participating in LNV.
The registration process informs the service node of all the VXLANs to
which the switch belongs.</p>

<h3 id="mac-learning-and-flooding">MAC Learning and Flooding</h3>

<p>With LNV, as with traditional bridging of physical LANs or VLANs, a
bridge automatically learns the location of hosts as a side effect of
receiving packets on a port. </p>

<p>For example, when server1 sends a layer 2 packet to server3, leaf2
learns that the MAC address for server1 is located on that particular
VXLAN and the VXLAN interface learns that the IP address of the VTEP for
server1 is 10.2.1.1. So when server3 sends a packet to server1, the
bridge on leaf2 forwards the packet out of the port to the VXLAN
interface and the VXLAN interface sends it, encapsulated in a UDP
packet, to the address 10.2.1.1.</p>

<p>But what if server3 sends a packet to some address that has yet to send
it a packet (server2, for example)? In this case, the VXLAN interface
sends the packet to the service node, which sends a copy to every other
VTEP that belongs to the same VXLAN. This is called <em>service node
replication</em> and is one of two techniques for handling BUM (Broadcast
Unknown-unicast and Multicast) traffic.</p>

<h3 id="bum-traffic">BUM Traffic</h3>

<p>Cumulus Linux has two ways of handling BUM (Broadcast Unknown-unicast
and Multicast) traffic: </p>

<ul>
<li>Head end replication</li>
<li>Service node replication</li>
</ul>

<p>Head end replication is enabled by default in Cumulus Linux. </p>

<p>You cannot have both service node and head end replication configured
simultaneously, as this causes the BUM traffic to be duplicated; both
the source VTEP and the service node send their own copy of each packet
to every remote VTEP.</p>

<h4 id="head-end-replication">Head End Replication</h4>

<p>The Broadcom switch with the Tomahawk, Trident II+, and Trident II ASIC
and the Mellanox switch with the Spectrum ASIC are capable of head end
replication (HER), which is the ability to generate all the BUM traffic
in hardware. The most scalable solution available with LNV is to have
each VTEP (top of rack switch) generate all of its own BUM traffic
instead of relying on an external service node. HER is enabled by
default in Cumulus Linux.</p>

<p>Cumulus Linux verified support for up to 128 VTEPs with head end
replication.</p>

<p>To disable head end replication, edit the <code>/etc/vxrd.conf</code> file and
set <code>head_rep</code> to <em>False</em>.</p>

<h4 id="service-node-replication">Service Node Replication</h4>

<p>Cumulus Linux also supports service node replication for VXLAN BUM
packets. This is useful with LNV if you have more than 128 VTEPs.
However, it is not recommended because it forces the spine switches
running the <code>vxsnd</code> (service node daemon) to replicate the packets in
software instead of in hardware, unlike head end replication. If you are
not using a controller but have more than 128 VTEPs, contact <a href="mailto:support@cumulusnetworks.com">Cumulus
Networks</a>. </p>

<p>To enable service node replication:</p>

<ol>
<li>Disable head end replication; set <code>head_rep</code> to <em>False</em> in
the <code>/etc/vxrd.conf</code> file.</li>

<li><p>Configure a service node IP address for every VXLAN interface using
the <code>vxlan-svcnodeip</code> parameter:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add vxlan VXLAN vxlan svcnodeip IP_ADDRESS</code></pre></div>
<p>You only specify this parameter when head end replication is
disabled. For the loopback, the parameter is still named
<code>vxrd-svcnode-ip</code>.</p></li>

<li><p>Edit the <code>/etc/vxsnd.conf</code> file and configure the following:</p>

<ul>
<li><p>Set the same service node IP address that you configured in the
previous step:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">svcnode_ip = &lt;&gt;</code></pre></div></li>

<li><p>To forward VXLAN data traffic, set the following variable to
<em>True</em>:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">enable_vxlan_listen = true</code></pre></div></li>
</ul></li>
</ol>

<h2 id="requirements">Requirements</h2>

<h3 id="hardware-requirements">Hardware Requirements</h3>

<ul>
<li>Broadcom switches with the Tomahawk, Trident II+, or Trident II ASIC
or Mellanox switches with the Spectrum ASIC running Cumulus Linux
2.5.4 or later. Please refer to the Cumulus Networks <a href="http://cumulusnetworks.com/support/linux-hardware-compatibility-list/">hardware
compatibility
list</a>
for a list of supported switch models.</li>
</ul>

<h3 id="configuration-requirements">Configuration Requirements</h3>

<ul>
<li>The VXLAN has an associated <strong>V</strong>XLAN <strong>N</strong>etwork <strong>I</strong>dentifier
(VNI), also interchangeably called a VXLAN ID.</li>
<li>The VNI cannot be 0 or 16777215, as these two numbers are reserved
values under Cumulus Linux.</li>
<li>The VXLAN link and physical interfaces are added to the bridge to
create the association between the port, VLAN, and VXLAN instance.</li>
<li>Each bridge on the switch has only one VXLAN interface. Cumulus
Linux does not support more than one VXLAN link in a bridge;
however, a switch can have multiple bridges.</li>
<li>An SVI (Switch VLAN Interface) or layer 3 address on the bridge is
not supported. For example, you cannot ping from the leaf1 SVI to
the leaf2 SVI through the VXLAN tunnel; you need to use server1 and
server2 to verify.</li>
</ul>

<h3 id="install-the-lnv-packages">Install the LNV Packages</h3>

<p><code>vxfld</code> is installed by default on all new installations of Cumulus
Linux 3.x. If you are upgrading from an earlier version, run
<code>sudo -E apt-get install python-vxfld</code> to install the LNV package.</p>

<h2 id="sample-lnv-configuration">Sample LNV Configuration</h2>

<p>The following images illustrate the configuration that is referenced
throughout this chapter.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Physical Cabling Diagram</p>
<p><img src="attachments/8362706/8362711.png" class="image-center" width="300" /></p></td>
<td><p>Network Virtualization Diagram</p>
<p><img src="attachments/8362706/8362710.png" height="250" /></p></td>
</tr>
</tbody>
</table>

<p>Want to try out configuring LNV and do not have a Cumulus Linux switch?
Check out <a href="https://cumulusnetworks.com/cumulus-vx/">Cumulus VX</a>.</p>

<h3 id="network-connectivity">Network Connectivity</h3>

<p>There must be full network connectivity before you can configure LNV.
The layer 3 IP addressing information as well as the OSPF configuration
(<code>/etc/frr/frr.conf</code>) below is provided to make the LNV example easier
to understand.</p>

<p>OSPF is not a requirement for LNV, LNV just requires layer 3
connectivity. With Cumulus Linux this can be achieved with static
routes, OSPF or BGP.</p>

<h3 id="layer-3-ip-addressing">Layer 3 IP Addressing</h3>

<p>Here is the configuration for the IP addressing information used in this
example.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click here
to expand&hellip;</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ net add interface swp49 ip address 10.1.1.2/30
cumulus@spine1:~$ net add interface swp50 ip address 10.1.1.6/30
cumulus@spine1:~$ net add interface swp51 ip address 10.1.1.50/30
cumulus@spine1:~$ net add interface swp52 ip address 10.1.1.54/30
cumulus@spine1:~$ net add loopback lo ip address 10.2.1.3/32
cumulus@spine1:~$ net pending
cumulus@spine1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
  address 10.2.1.3/32
 
auto eth0
iface eth0 inet dhcp

auto swp49
iface swp49
  address 10.1.1.2/30
 
auto swp50
iface swp50
  address 10.1.1.6/30
 
auto swp51
iface swp51
  address 10.1.1.50/30
 
auto swp52
iface swp52
  address 10.1.1.54/30</code></pre>
</div>
</div></td>
<td><p><strong>spine2:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine2:~$ net add interface swp49 ip address 10.1.1.18/30
cumulus@spine2:~$ net add interface swp50 ip address 10.1.1.22/30
cumulus@spine2:~$ net add interface swp51 ip address 10.1.1.34/30
cumulus@spine2:~$ net add interface swp52 ip address 10.1.1.38/30
cumulus@spine2:~$ net add loopback lo ip address 10.2.1.4/32
cumulus@spine2:~$ net pending
cumulus@spine2:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine2:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
  address 10.2.1.4/32
 
auto eth0
iface eth0 inet dhcp

auto swp49
iface swp49 
 address 10.1.1.18/30
 
auto swp50
iface swp50 
 address 10.1.1.22/30
 
auto swp51
iface swp51 
address 10.1.1.34/30
 
auto swp52
iface swp52 
address 10.1.1.38/30</code></pre>
</div>
</div></td>
</tr>
<tr class="even">
<td><p><strong>leaf1:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ net add interface swp1 breakout 4x 
cumulus@leaf1:~$ net add interface swp1s0 ip address 10.1.1.1/30
cumulus@leaf1:~$ net add interface swp1s1 ip address 10.1.1.5/30
cumulus@leaf1:~$ net add interface swp1s2 ip address 10.1.1.33/30
cumulus@leaf1:~$ net add interface swp1s3 ip address 10.1.1.37/30
cumulus@leaf1:~$ net add loopback lo ip address 10.2.1.1/32
cumulus@leaf1:~$ net pending
cumulus@leaf1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
  address 10.2.1.1/32
 
auto eth0
iface eth0 inet dhcp
 
auto swp1s0
iface swp1s0
  address 10.1.1.1/30

auto swp1s1
iface swp1s1
  address 10.1.1.5/30

auto swp1s2
iface swp1s2
  address 10.1.1.33/30

auto swp1s3
iface swp1s3
  address 10.1.1.37/30</code></pre>
</div>
</div></td>
<td><p><strong>leaf2:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ net add interface swp1 breakout 4x 
cumulus@leaf2:~$ net add interface swp1s0 ip address 10.1.1.17/30
cumulus@leaf2:~$ net add interface swp1s1 ip address 10.1.1.21/30
cumulus@leaf2:~$ net add interface swp1s2 ip address 10.1.1.49/30
cumulus@leaf2:~$ net add interface swp1s3 ip address 10.1.1.53/30
cumulus@leaf2:~$ net add loopback lo ip address 10.2.1.2/32
cumulus@leaf2:~$ net pending
cumulus@leaf2:~$ net commit </code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
  address 10.2.1.2/32
 
auto eth0
iface eth0 inet dhcp
 
auto swp1s0
iface swp1s0
 address 10.1.1.17/30
              
auto swp1s1
iface swp1s1
 address 10.1.1.21/30
              
auto swp1s2
iface swp1s2
 address 10.1.1.49/30
              
auto swp1s3
iface swp1s3
 address 10.1.1.53/30</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="layer-3-fabric">Layer 3 Fabric</h3>

<p>The service nodes and registration nodes must all be routable between
each other. The layer 3 fabric on Cumulus Linux can either be
<a href="Border_Gateway_Protocol_-_BGP">BGP</a> or
<a href="Open_Shortest_Path_First_-_OSPF">OSPF</a>.  In this example, OSPF is used
to demonstrate full reachability. Click to expand the FRRouting
configurations below.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click to
expand the OSPF configuration &hellip;</p>

<p>FRRouting configuration using OSPF:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ net add ospf network 10.2.1.3/32 area 0.0.0.0
cumulus@spine1:~$ net add interface swp49 ospf network point-to-point
cumulus@spine1:~$ net add interface swp50 ospf network point-to-point
cumulus@spine1:~$ net add interface swp51 ospf network point-to-point
cumulus@spine1:~$ net add interface swp52 ospf network point-to-point
cumulus@spine1:~$ net add interface swp49 ospf area 0.0.0.0
cumulus@spine1:~$ net add interface swp50 ospf area 0.0.0.0
cumulus@spine1:~$ net add interface swp51 ospf area 0.0.0.0
cumulus@spine1:~$ net add interface swp52 ospf area 0.0.0.0
cumulus@spine1:~$ net add ospf router-id 10.2.1.3
cumulus@spine1:~$ net pending
cumulus@spine1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>interface swp49
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp50
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp51
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp52
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
router ospf
 ospf router-id 10.2.1.3
 network 10.2.1.3/32 area 0.0.0.0</code></pre>
</div>
</div></td>
<td><p><strong>spine2:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine2:~$ net add ospf network 10.2.1.4/32 area 0.0.0.0
cumulus@spine2:~$ net add interface swp49 ospf network point-to-point
cumulus@spine2:~$ net add interface swp50 ospf network point-to-point
cumulus@spine2:~$ net add interface swp51 ospf network point-to-point
cumulus@spine2:~$ net add interface swp52 ospf network point-to-point
cumulus@spine2:~$ net add interface swp49 ospf area 0.0.0.0
cumulus@spine2:~$ net add interface swp50 ospf area 0.0.0.0
cumulus@spine2:~$ net add interface swp51 ospf area 0.0.0.0
cumulus@spine2:~$ net add interface swp52 ospf area 0.0.0.0
cumulus@spine2:~$ net add ospf router-id 10.2.1.4
cumulus@spine2:~$ net pending
cumulus@spine2:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>interface swp49
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp50
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp51
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp52
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
router ospf
 ospf router-id 10.2.1.4
 network 10.2.1.4/32 area 0.0.0.0</code></pre>
</div>
</div></td>
</tr>
<tr class="even">
<td><p><strong>leaf1:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ net add ospf network 10.2.1.1/32 area 0.0.0.0
cumulus@leaf1:~$ net add interface swp1s0 ospf network point-to-point
cumulus@leaf1:~$ net add interface swp1s1 ospf network point-to-point
cumulus@leaf1:~$ net add interface swp1s2 ospf network point-to-point
cumulus@leaf1:~$ net add interface swp1s3 ospf network point-to-point
cumulus@leaf1:~$ net add interface swp1s0 ospf area 0.0.0.0
cumulus@leaf1:~$ net add interface swp1s1 ospf area 0.0.0.0
cumulus@leaf1:~$ net add interface swp1s2 ospf area 0.0.0.0
cumulus@leaf1:~$ net add interface swp1s3 ospf area 0.0.0.0
cumulus@leaf1:~$ net add ospf router-id 10.2.1.1
cumulus@leaf1:~$ net pending
cumulus@leaf1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>interface swp1s0
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s1
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s2
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s3
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
router ospf
 ospf router-id 10.2.1.1

 network 10.2.1.1/32 area 0.0.0.0</code></pre>
</div>
</div></td>
<td><p><strong>leaf2:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ net add ospf network 10.2.1.2/32 area 0.0.0.0
cumulus@leaf2:~$ net add interface swp1s0 ospf network point-to-point
cumulus@leaf2:~$ net add interface swp1s1 ospf network point-to-point
cumulus@leaf2:~$ net add interface swp1s2 ospf network point-to-point
cumulus@leaf2:~$ net add interface swp1s3 ospf network point-to-point
cumulus@leaf2:~$ net add interface swp1s0 ospf area 0.0.0.0
cumulus@leaf2:~$ net add interface swp1s1 ospf area 0.0.0.0
cumulus@leaf2:~$ net add interface swp1s2 ospf area 0.0.0.0
cumulus@leaf2:~$ net add interface swp1s3 ospf area 0.0.0.0
cumulus@leaf2:~$ net add ospf router-id 10.2.1.2
cumulus@leaf2:~$ net pending
cumulus@leaf2:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>interface swp1s0
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s1
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s2
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s3
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
router ospf
 ospf router-id 10.2.1.2

 network 10.2.1.2/32 area 0.0.0.0</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="host-configuration">Host Configuration</h3>

<p>In this example, the servers are running Ubuntu 14.04. There needs to be
a trunk mapped from server1 and server2 to the respective switch. In
Ubuntu this is done with subinterfaces. You can expand the
configurations below.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click to
expand the host configurations &hellip;</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>server1:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto eth3.10
iface eth3.10 inet static
  address 10.10.10.1/24

auto eth3.20
iface eth3.20 inet static
  address 10.10.20.1/24

auto eth3.30
iface eth3.30 inet static
  address 10.10.30.1/24</code></pre>
</div>
</div></td>
<td><p><strong>server2:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto eth3.10
iface eth3.10 inet static
  address 10.10.10.2/24

auto eth3.20
iface eth3.20 inet static
  address 10.10.20.2/24

auto eth3.30
iface eth3.30 inet static
  address 10.10.30.2/24</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<p>On Ubuntu, it is more reliable to use <code>ifup</code> and <code>if down</code> to bring the
interfaces up and down individually, rather than restarting networking
entirely (there is no equivalent to <code>if reload</code> like there is in Cumulus
Linux):</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@server1:~$ sudo ifup eth3.10
Set name-type for VLAN subsystem. Should be visible in /proc/net/vlan/config
Added VLAN with VID == 10 to IF -:eth3:-
cumulus@server1:~$ sudo ifup eth3.20
Set name-type for VLAN subsystem. Should be visible in /proc/net/vlan/config
Added VLAN with VID == 20 to IF -:eth3:-
cumulus@server1:~$ sudo ifup eth3.30
Set name-type for VLAN subsystem. Should be visible in /proc/net/vlan/config
Added VLAN with VID == 30 to IF -:eth3:-</code></pre></div>
<h2 id="configure-the-vlan-to-vxlan-mapping">Configure the VLAN to VXLAN Mapping</h2>

<p>Configure the VLANs and associated VXLANs. In this example, there are 3
VLANs and 3 VXLAN IDs (VNIs). VLANs 10, 20 and 30 are used and
associated with VNIs 10, 2000 and 30 respectively. The loopback address,
used as the <code>vxlan-local-tunnelip</code>, is the only difference between leaf1
and leaf2 for this demonstration.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>leaf1:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ net add loopback lo ip address 10.2.1.1/32
cumulus@leaf1:~$ net add loopback lo vxrd-src-ip 10.2.1.1
cumulus@leaf1:~$ net add loopback lo vxrd-svcnode-ip 10.2.1.3
cumulus@leaf1:~$ net add vxlan vni-10 vxlan id 10
cumulus@leaf1:~$ net add vxlan vni-10 vxlan local-tunnelip 10.2.1.1
cumulus@leaf1:~$ net add vxlan vni-10 bridge access 10
cumulus@leaf1:~$ net add vxlan vni-2000 vxlan id 2000
cumulus@leaf1:~$ net add vxlan vni-2000 vxlan local-tunnelip 10.2.1.1
cumulus@leaf1:~$ net add vxlan vni-2000 bridge access 20
cumulus@leaf1:~$ net add vxlan vni-30 vxlan id 30
cumulus@leaf1:~$ net add vxlan vni-30 vxlan local-tunnelip 10.2.1.1
cumulus@leaf1:~$ net add vxlan vni-30 bridge access 30
cumulus@leaf1:~$ net add bridge bridge ports swp32s0.10
cumulus@leaf1:~$ net pending 
cumulus@leaf1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo 
  address 10.2.1.1/32
  vxrd-src-ip 10.2.1.1
 
auto swp32s0.10
iface swp32s0.10
 
auto bridge
iface bridge
  bridge-ports vni-10 vni-2000 vni-30
  bridge-vids 10 20 30
  bridge-vlan-aware yes
 
auto vni-10
iface vni-10
  bridge-access 10
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes 
  vxlan-id 10
  vxlan-local-tunnelip 10.2.1.1

auto vni-2000
iface vni-2000
  bridge-access 20
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes
  vxlan-id 2000
  vxlan-local-tunnelip 10.2.1.1

auto vni-30
iface vni-30
  bridge-access 30
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes
  vxlan-id 30
  vxlan-local-tunnelip 10.2.1.1</code></pre>
</div>
</div></td>
<td><p><strong>leaf2:</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ net add loopback lo ip address 10.2.1.2/32
cumulus@leaf2:~$ net add loopback lo vxrd-src-ip 10.2.1.2
cumulus@leaf2:~$ net add loopback lo vxrd-svcnode-ip 10.2.1.3
cumulus@leaf2:~$ net add vxlan vni-10 vxlan id 10
cumulus@leaf2:~$ net add vxlan vni-10 vxlan local-tunnelip 10.2.1.2
cumulus@leaf2:~$ net add vxlan vni-10 bridge access 10
cumulus@leaf2:~$ net add vxlan vni-2000 vxlan id 2000
cumulus@leaf2:~$ net add vxlan vni-2000 vxlan local-tunnelip 10.2.1.2
cumulus@leaf2:~$ net add vxlan vni-2000 bridge access 20
cumulus@leaf2:~$ net add vxlan vni-30 vxlan id 30
cumulus@leaf2:~$ net add vxlan vni-30 vxlan local-tunnelip 10.2.1.2
cumulus@leaf2:~$ net add vxlan vni-30 bridge access 30
cumulus@leaf1:~$ net add bridge bridge ports swp32s0.10
cumulus@leaf2:~$ net pending 
cumulus@leaf2:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo
  address 10.2.1.2/32 
  vxrd-src-ip 10.2.1.2
 
auto swp32s0.10
iface swp32s0.10
 
auto bridge
iface bridge
  bridge-ports vni-10 vni-2000 vni-30
  bridge-vids 10 20 30
  bridge-vlan-aware yes

auto vni-10
iface vni-10
  bridge-access 10
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes
  vxlan-id 10
  vxlan-local-tunnelip 10.2.1.2

auto vni-2000
iface vni-2000
  bridge-access 20
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes
  vxlan-id 2000
  vxlan-local-tunnelip 10.2.1.2
 
auto vni-30
iface vni-30
  bridge-access 30
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes
  vxlan-id 30
  vxlan-local-tunnelip 10.2.1.2</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<p>Why is vni-2000 not vni-20? For example, why not tie VLAN 20 to VNI 20,
or why was 2000 used? VXLANs and VLANs do not need to be the same
number. However if you are using fewer than 4096 VLANs, there is no
reason not to make it easy and correlate VLANs to VXLANs. It is
completely up to you.</p>

<h2 id="verify-the-vlan-to-vxlan-mapping">Verify the VLAN to VXLAN Mapping</h2>

<p>Use the <code>brctl show</code> command to see the physical and logical interfaces
associated with that bridge:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ brctl show
bridge name bridge id           STP enabled     interfaces
bridge      8000.443839008404   yes             swp32s0.10
                                                vni-10
                                                vni-2000
                                                vni-30</code></pre></div>
<p>As with any logical interfaces on Linux, the name does not matter (other
than a 15-character limit). To verify the associated VNI for the logical
name, use the <code>ip -d link show</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ ip -d link show vni-10
43: vni-10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-10 state UNKNOWN mode DEFAULT
    link/ether 02:ec:ec:bd:7f:c6 brd ff:ff:ff:ff:ff:ff
    vxlan id 10 srcport 32768 61000 dstport 4789 ageing 1800
    bridge_slave</code></pre></div>
<p>The *vxlan id 10 *indicates the VXLAN ID/VNI is indeed 10 as the logical
name suggests.</p>

<h2 id="enable-and-manage-service-node-and-registration-daemons">Enable and Manage Service Node and Registration Daemons</h2>

<p>Every VTEP must run the registration daemon (<code>vxrd</code>). Typically, every
leaf switch acts as a VTEP.  A minimum of 1 switch (a switch not already
acting as a VTEP) must run the service node daemon (<code>vxsnd</code>). The
instructions for enabling these daemons follows.</p>

<h3 id="enable-the-service-node-daemon">Enable the Service Node Daemon</h3>

<p>The service node daemon (<code>vxsnd)</code> is included in the Cumulus Linux
repository as <code>vxfld-vxsnd</code>. The service node daemon can run on any
switch running Cumulus Linux as long as that switch is not also a VXLAN
VTEP. In this example, enable the service node only on
the spine1 switch, then restart the service.</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@spine1:~$ sudo systemctl enable vxsnd.service
cumulus@spine1:~$ sudo systemctl restart vxsnd.service</code></pre></div>
<p>Do not run <code>vxsnd</code> on a switch that is already acting as a VTEP.</p>

<h3 id="enable-the-registration-daemon">Enable the Registration Daemon</h3>

<p>The registration daemon (<code>vxrd</code>) is included in the Cumulus Linux
package as  <code>vxfld-vxrd</code>. The registration daemon must run on each VTEP
participating in LNV, so you must enable it on every TOR (leaf)
switch acting as a VTEP, then restart the <code>vxrd</code> daemon. For example, on
leaf1:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@leaf1:~$ sudo systemctl enable vxrd.service
cumulus@leaf1:~$ sudo systemctl restart vxrd.service</code></pre></div>
<p>Then enable and restart the <code>vxrd</code> daemon on leaf2:</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@leaf2:~$ sudo systemctl enable vxrd.service
cumulus@leaf2:~$ sudo systemctl restart vxrd.service</code></pre></div>
<h3 id="check-the-daemon-status">Check the Daemon Status</h3>

<p>To determine if the daemon is running, use the
<code>systemctl status &lt;daemon name&gt;.service</code> command.</p>

<p>For the service node daemon:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@spine1:~$ sudo systemctl status vxsnd.service
● vxsnd.service - Lightweight Network Virt Discovery Svc and Replicator
   Loaded: loaded (/lib/systemd/system/vxsnd.service; enabled)
   Active: active (running) since Wed 2016-05-11 11:42:55 UTC; 10min ago
 Main PID: 774 (vxsnd)
   CGroup: /system.slice/vxsnd.service
           └─774 /usr/bin/python /usr/bin/vxsnd

May 11 11:42:55 cumulus vxsnd[774]: INFO: Starting (pid 774) ...</code></pre></div>
<p>For the registration daemon:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ sudo systemctl status vxrd.service 
● vxrd.service - Lightweight Network Virtualization Peer Discovery Daemon
   Loaded: loaded (/lib/systemd/system/vxrd.service; enabled)
   Active: active (running) since Wed 2016-05-11 11:42:55 UTC; 10min ago
 Main PID: 929 (vxrd)
   CGroup: /system.slice/vxrd.service
           └─929 /usr/bin/python /usr/bin/vxrd

May 11 11:42:55 cumulus vxrd[929]: INFO: Starting (pid 929) ...</code></pre></div>
<h2 id="configure-the-registration-node">Configure the Registration Node</h2>

<p>The registration node was configured earlier in
<code>/etc/network/interfaces</code> in the <a href="#LightweightNetworkVirtualizationOverview-mapping">VXLAN
mapping</a> section
above; no additional configuration is typically needed. However, if you
need to modify the registration node configuration, edit
<code>/etc/vxrd.conf</code>.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Configuring
the registration node in /etc/vxrd.conf &hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ sudo nano /etc/vxrd.conf</code></pre></div>
<p>Then edit the <code>svcnode_ip</code> variable:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">svcnode_ip = 10.2.1.3</code></pre></div>
<p>Then perform the same on leaf2:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf2:~$ sudo nano /etc/vxrd.conf</code></pre></div>
<p>And again edit the <code>svcnode_ip</code> variable:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">svcnode_ip = 10.2.1.3</code></pre></div>
<p>Enable, then restart the registration node daemon for the change to take
effect:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ sudo systemctl enable vxrd.service
cumulus@leaf1:~$ sudo systemctl restart vxrd.service</code></pre></div>
<p>Restart the daemon on leaf2:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf2:~$ sudo systemctl enable vxrd.service
cumulus@leaf2:~$ sudo systemctl restart vxrd.service</code></pre></div>
<p>The complete list of options you can configure is listed below:</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Registration
node options &hellip;</p>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>loglevel</td>
<td>The log level: DEBUG, INFO, WARNING, ERROR, CRITICAL.</td>
<td>INFO</td>
</tr>
<tr class="even">
<td>logdest</td>
<td>The destination for log messages. The destination can be a file name, <code>stdout</code>, or <code>syslog</code>.</td>
<td>syslog</td>
</tr>
<tr class="odd">
<td>logfilesize</td>
<td>The log file size in bytes. Used when <code>logdest</code> is a file name.</td>
<td>512000</td>
</tr>
<tr class="even">
<td>logbackupcount</td>
<td>The maximum number of log files stored on the disk. Used when <code>logdest</code> is a file name.</td>
<td>14</td>
</tr>
<tr class="odd">
<td>pidfile</td>
<td>The PIF file location for the <code>vxrd</code> daemon.</td>
<td>/var/run/vxrd.pid</td>
</tr>
<tr class="even">
<td>udsfile</td>
<td>The file name for the Unix domain socket used for management.</td>
<td>/var/run/vxrd.sock</td>
</tr>
<tr class="odd">
<td>vxfld_port</td>
<td>The UDP port used for VXLAN control messages.</td>
<td>10001</td>
</tr>
<tr class="even">
<td>svcnode_ip</td>
<td><p>The address to which registration daemons send control messages for registration and or BUM packets for replication. You can also configure this option in the <code>/etc/network/interfaces</code> file with the <code>vxrd-svcnode-ip</code> keyword.</p></td>
<td> </td>
</tr>
<tr class="odd">
<td>holdtime</td>
<td><p>The hold time (in seconds) for soft state, which is how long the service node waits before ageing out an IP address for a VNI. The <code>vxrd</code> includes this in the register messages it sends to a <code>vxsnd</code>.</p></td>
<td>90 seconds</td>
</tr>
<tr class="even">
<td>src_ip</td>
<td>The local IP address to bind to for receiving control traffic from the service node daemon.</td>
<td> </td>
</tr>
<tr class="odd">
<td>refresh_rate</td>
<td><p>The number of times to refresh within the hold time. The higher this number, the more lost UDP refresh messages can be tolerated.</p></td>
<td>3 seconds</td>
</tr>
<tr class="even">
<td>config_check_rate</td>
<td>The number of seconds to poll the system for current VXLAN membership.</td>
<td>5 seconds</td>
</tr>
<tr class="odd">
<td>head_rep</td>
<td>Enables self replication. Instead of using the service node to replicate BUM packets, it is done in hardware on the VTEP switch.</td>
<td>true</td>
</tr>
</tbody>
</table>

<p>Use <em>1</em>, <em>yes</em>, <em>true</em>, or <em>on</em> for True for each relevant option. Use
<em>0</em>, <em>no</em>, <em>false</em>, or <em>off</em> for False.</p>

<h2 id="configure-the-service-node">Configure the Service Node</h2>

<p>To configure the service node daemon, edit the <code>/etc/vxsnd.conf</code>
configuration file.</p>

<p>For the example configuration, default values are used, except for the
<code>svcnode_ip</code> field.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@spine1:~$ sudo nano /etc/vxsnd.conf</code></pre></div>
<p>The address field is set to the loopback address of the switch running
the <code>vxsnd</code> daemon.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">svcnode_ip = 10.2.1.3</code></pre></div>
<p>Enable, then restart the service node daemon for the change to take
effect:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@spine1:~$ sudo systemctl enable vxsnd.service
cumulus@spine1:~$ sudo systemctl restart vxsnd.service</code></pre></div>
<p>The complete list of options you can configure is listed below:</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click here
to expand&hellip;</p>

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>loglevel</td>
<td>The log level: DEBUG, INFO, WARNING, ERROR, CRITICAL.</td>
<td>INFO</td>
</tr>
<tr class="even">
<td>logdest</td>
<td>The destination for log messages. The destination can be a file name, <code>stdout</code>, or <code>syslog</code>.</td>
<td>syslog</td>
</tr>
<tr class="odd">
<td>logfilesize</td>
<td>The log file size in bytes. Used when <code>logdest</code> is a file name.</td>
<td>512000</td>
</tr>
<tr class="even">
<td>logbackupcount</td>
<td>The maximum number of log files stored on disk. Used when <code>logdest</code> is a file name.</td>
<td>14</td>
</tr>
<tr class="odd">
<td>pidfile</td>
<td>The PID file location for the <code>vxrd</code> daemon.</td>
<td>/var/run/vxrd.pid</td>
</tr>
<tr class="even">
<td>udsfile</td>
<td>The file name for the Unix domain socket used for management.</td>
<td>/var/run/vxrd.sock</td>
</tr>
<tr class="odd">
<td>vxfld_port</td>
<td>The UDP port used for VXLAN control messages.</td>
<td>10001</td>
</tr>
<tr class="even">
<td>svcnode_ip</td>
<td><p>The address to which registration daemons send control messages for registration and or BUM packets for replication.</p></td>
<td>0.0.0.0</td>
</tr>
<tr class="odd">
<td>holdtime</td>
<td><p>The holdtime (in seconds) for soft state. This option is used when sending a register message to peers in response to learning a &lt;vni, addr&gt; from a VXLAN data packet.</p></td>
<td>90</td>
</tr>
<tr class="even">
<td>src_ip</td>
<td><p>The local IP address to bind to for receiving inter-vxsnd control traffic.</p></td>
<td>0.0.0.0</td>
</tr>
<tr class="odd">
<td>svcnode_peers</td>
<td><p>A space-separated list of IP addresses with which the <code>vxsnd</code> shares its state.</p></td>
<td> </td>
</tr>
<tr class="even">
<td>enable_vxlan_listen</td>
<td><p>When set to true, the service node listens for VXLAN data traffic.</p></td>
<td>true</td>
</tr>
<tr class="odd">
<td>install_svcnode_ip</td>
<td><p>When set to true, the <code>snd_peer_address</code> gets installed on the loopback interface. It gets withdrawn when the <code>vxsnd</code> is not in service. If set to true, you must define the <code>snd_peer_address</code> configuration variable.</p></td>
<td>false</td>
</tr>
<tr class="even">
<td>age_check</td>
<td>Number of seconds to wait before checking the database to age out stale entries.</td>
<td>90 seconds</td>
</tr>
</tbody>
</table>

<p>Use <em>1</em>, <em>yes</em>, <em>true,</em> or <em>on</em> for True for each relevant option. Use
<em>0</em>, <em>no</em>, <em>false,</em> or <em>off</em> for False.</p>

<h2 id="verifiy-and-troubleshoot">Verifiy and Troubleshoot</h2>

<h3 id="verify-the-registration-node-daemon">Verify the Registration Node Daemon </h3>

<p>Use the <code>vxrdctl vxlans</code> <strong> </strong>command to see the configured VNIs, the
local address being used to source the VXLAN tunnel, and the service
node being used.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ vxrdctl vxlans
VNI     Local Addr       Svc Node
===     ==========       ========
 10      10.2.1.1        10.2.1.3
 30      10.2.1.1        10.2.1.3
2000      10.2.1.1        10.2.1.3</code></pre>
</div>
</div></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ vxrdctl vxlans
VNI     Local Addr       Svc Node
===     ==========       ========
 10      10.2.1.2        10.2.1.3
 30      10.2.1.2        10.2.1.3
2000      10.2.1.2        10.2.1.3</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<p>Use the <code>vxrdctl peers</code> command to see configured VNIs and all VTEPs
(leaf switches) within the network that have them configured.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ vxrdctl peers
VNI         Peer Addrs
===         ==========
10          10.2.1.1, 10.2.1.2
30          10.2.1.1, 10.2.1.2
2000        10.2.1.1, 10.2.1.2</code></pre>
</div>
</div></td>
<td><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ vxrdctl peers
VNI         Peer Addrs
===         ==========
10          10.2.1.1, 10.2.1.2
30          10.2.1.1, 10.2.1.2
2000        10.2.1.1, 10.2.1.2</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<p>When head end replication mode is disabled, the command does not work.</p>

<p>Use the <code>vxrdctl peers </code>command to see the other VTEPs (leaf switches)
and the VNIs with which they are associated. This does not show anything
unless you enabled head end replication mode by setting the <code>head_rep</code>
option to <em>True</em>. Otherwise, replication is done by the service node.</p>
<div class="highlight"><pre class="chroma"><code class="language-plain" data-lang="plain">cumulus@leaf2:~$ vxrdctl peers
Head-end replication is turned off on this device.
This command will not provide any output</code></pre></div>
<h3 id="verify-the-service-node-daemon">Verify the Service Node Daemon</h3>

<p>Use the <code>vxsndctl fdb</code> command to verify which VNIs belong to which VTEP
(leaf switches).</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@spine1:~$ vxsndctl fdb
VNI    Address     Ageout
===    =======     ======
 10    10.2.1.1        82
 10    10.2.1.2        77
 30    10.2.1.1        82
 30    10.2.1.2        77
2000    10.2.1.1        82
2000    10.2.1.2        77</code></pre></div>
<h3 id="verify-traffic-flow-and-check-counters">Verify Traffic Flow and Check Counters</h3>

<p>VXLAN transit traffic information is stored in a flat file located
in <code>/cumulus/switchd/run/stats/vxlan/all</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ cat /cumulus/switchd/run/stats/vxlan/all
VNI                             : 10
Network In Octets               : 1090
Network In Packets              : 8
Network Out Octets              : 1798
Network Out Packets             : 13
Total In Octets                 : 2818
Total In Packets                : 27
Total Out Octets                : 3144
Total Out Packets               : 39
VN Interface                    : vni: 10, swp32s0.10
Total In Octets                 : 1728
Total In Packets                : 19
Total Out Octets                : 552
Total Out Packets               : 18
VNI                             : 30
Network In Octets               : 828
Network In Packets              : 6
Network Out Octets              : 1224
Network Out Packets             : 9
Total In Octets                 : 2374
Total In Packets                : 23
Total Out Octets                : 2300
Total Out Packets               : 32
VN Interface                    : vni: 30, swp32s0.30
Total In Octets                 : 1546
Total In Packets                : 17
Total Out Octets                : 552
Total Out Packets               : 17
VNI                             : 2000
Network In Octets               : 676
Network In Packets              : 5
Network Out Octets              : 1072
Network Out Packets             : 8
Total In Octets                 : 2030
Total In Packets                : 20
Total Out Octets                : 2042
Total Out Packets               : 30
VN Interface                    : vni: 2000, swp32s0.20
Total In Octets                 : 1354
Total In Packets                : 15
Total Out Octets                : 446</code></pre></div>
<h3 id="ping-to-test-connectivity">Ping to Test Connectivity</h3>

<p>To test the connectivity across the VXLAN tunnel with an ICMP echo
request (ping), make sure to ping from the server rather than the switch
itself.</p>

<p>SVIs (switch VLAN interfaces) are not supported when using VXLAN. There
cannot be an IP address on the bridge that also contains a VXLAN.</p>

<p>Following is the IP address information used in this example
configuration.</p>

<table>
<thead>
<tr>
<th>VNI</th>
<th>server1</th>
<th>server2</th>
</tr>
</thead>

<tbody>
<tr>
<td>10</td>
<td>10.10.10.1</td>
<td>10.10.10.2</td>
</tr>

<tr>
<td>2000</td>
<td>10.10.20.1</td>
<td>10.10.20.2</td>
</tr>

<tr>
<td>30</td>
<td>10.10.30.1</td>
<td>10.10.30.2</td>
</tr>
</tbody>
</table>

<p>Test connectivity between VNI 10 connected servers by pinging from
server1:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@server1:~$ ping 10.10.10.2
PING 10.10.10.2 (10.10.10.2) 56(84) bytes of data.
64 bytes from 10.10.10.2: icmp_seq=1 ttl=64 time=3.90 ms
64 bytes from 10.10.10.2: icmp_seq=2 ttl=64 time=0.202 ms
64 bytes from 10.10.10.2: icmp_seq=3 ttl=64 time=0.195 ms
^C
--- 10.10.10.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 0.195/1.432/3.900/1.745 ms
cumulus@server1:~$</code></pre></div>
<p>The other VNIs were also tested and can be viewed in the expanded output
below.</p>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}Click here
to expand&hellip;</p>

<p>Test connectivity between VNI-2000 connected servers by pinging from
server1:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@server1:~$ ping 10.10.20.2
PING 10.10.20.2 (10.10.20.2) 56(84) bytes of data.
64 bytes from 10.10.20.2: icmp_seq=1 ttl=64 time=1.81 ms
64 bytes from 10.10.20.2: icmp_seq=2 ttl=64 time=0.194 ms
64 bytes from 10.10.20.2: icmp_seq=3 ttl=64 time=0.206 ms
^C
--- 10.10.20.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2000ms
rtt min/avg/max/mdev = 0.194/0.739/1.819/0.763 ms</code></pre></div>
<p>Test connectivity between VNI-30 connected servers by pinging from
server1:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@server1:~$ ping 10.10.30.2
PING 10.10.30.2 (10.10.30.2) 56(84) bytes of data.
64 bytes from 10.10.30.2: icmp_seq=1 ttl=64 time=1.85 ms
64 bytes from 10.10.30.2: icmp_seq=2 ttl=64 time=0.239 ms
64 bytes from 10.10.30.2: icmp_seq=3 ttl=64 time=0.185 ms
64 bytes from 10.10.30.2: icmp_seq=4 ttl=64 time=0.212 ms
^C
--- 10.10.30.2 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3000ms
rtt min/avg/max/mdev = 0.185/0.622/1.853/0.711 ms</code></pre></div>
<h3 id="troubleshoot-with-mac-addresses">Troubleshoot with MAC Addresses</h3>

<p>Because there is no SVI, there is no way to ping from the server to the
directly attached leaf (top of rack) switch without cabling the switch
to itself. The easiest way to see if the server can reach the leaf
switch is to check the MAC address table of the leaf switch.</p>

<p>First, obtain the MAC address of the server:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@server1:~$ ip addr show eth3.10 | grep ether
    link/ether 90:e2:ba:55:f0:85 brd ff:ff:ff:ff:ff:ff</code></pre></div>
<p>Next, check the MAC address table of the leaf switch:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ brctl showmacs br-10
port name mac addr      vlan    is local?   ageing timer
vni-10    46:c6:57:fc:1f:54 0   yes        0.00
swp32s0.10 90:e2:ba:55:f0:85    0   no        75.87
vni-10    90:e2:ba:7e:a9:c1 0   no        75.87
swp32s0.10 ec:f4:bb:fc:67:a1    0   yes        0.00</code></pre></div>
<p><em>90:e2:ba:55:f0:85</em> appears in the MAC address table, which indicates
that connectivity is occurring between leaf1 and server1.</p>

<h3 id="check-the-service-node-configuration">Check the Service Node Configuration</h3>

<p>Use the <code>ip -d link show</code> command to verify the service node, VNI, and
administrative state of a particular logical VNI interface:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf1:~$ ip -d link show vni-10
35: vni-10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-10 state UNKNOWN mode DEFAULT
    link/ether 46:c6:57:fc:1f:54 brd ff:ff:ff:ff:ff:ff
    vxlan id 10 remote 10.2.1.3 local 10.2.1.1 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.2.1.3
    bridge_slave</code></pre></div>
<h2 id="advanced-lnv-usage">Advanced LNV Usage</h2>

<h3 id="scale-lnv-by-load-balancing-with-anycast">Scale LNV by Load Balancing with Anycast</h3>

<p>The above configuration assumes a single service node, which can quickly
be overwhelmed by BUM traffic. To load balance BUM traffic across
multiple service nodes,
use <a href="http://en.wikipedia.org/wiki/Anycast">Anycast</a>. Anycast enables BUM
traffic to reach the topologically nearest service node instead of
overwhelming a single service node.</p>

<h4 id="enable-the-service-node-daemon-on-additional-spine-switches">Enable the Service Node Daemon on Additional Spine Switches</h4>

<p>In this example, spine1 already has the service node daemon enabled.
Enable it on the spine2 switch, then restart the <code>vxsnd</code> daemon:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@spine2:~$ sudo systemctl enable vxsnd.service
cumulus@spine2:~$ sudo systemctl restart vxsnd.service</code></pre></div>
<h4 id="configure-the-anycast-address-on-all-participating-service-nodes">Configure the Anycast Address on All Participating Service Nodes</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1:</strong></p>
<p>Add the 10.10.10.10/32 address to the loopback address:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ net add loopback lo ip address 10.10.10.10/32
cumulus@spine1:~$ net pending
cumulus@spine1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.3/32
  address 10.10.10.10/32</code></pre>
</div>
</div>
<p>Verify the IP address is configured:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ ip addr show lo
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet 10.2.1.3/32 scope global lo
    inet 10.10.10.10/32 scope global lo
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div></td>
<td><p><strong>spine2:</strong></p>
<p>Add the 10.10.10.10/32 address to the loopback address:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine2:~$ net add loopback lo ip address 10.10.10.10/32
cumulus@spine2:~$ net pending
cumulus@spine2:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.4/32
  address 10.10.10.10/32</code></pre>
</div>
</div>
<p>Verify the IP address is configured:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine2:~$ ip addr show lo
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet 10.2.1.4/32 scope global lo
    inet 10.10.10.10/32 scope global lo
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="configure-the-service-node-vxsnd-conf-file">Configure the Service Node vxsnd.conf File</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1:</strong></p>
<p>Use a text editor to edit the network configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ sudo nano /etc/vxsnd.conf</code></pre>
</div>
</div>
<p>Change the following values:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>svcnode_ip = 10.10.10.10
 
svcnode_peers = 10.2.1.4
 
src_ip = 10.2.1.3</code></pre>
</div>
</div>
<p>This sets the address on which the service node listens to VXLAN messages to the configured Anycast address and sets it to sync with spine2.</p>
<p>Enable, then restart the <code>vxsnd</code> daemon:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ sudo systemctl enable vxsnd.service
cumulus@spine1:~$ sudo systemctl restart vxsnd.service</code></pre>
</div>
</div></td>
<td><p><strong>spine2:</strong></p>
<p>Use a text editor to edit the network configuration:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine2:~$ sudo nano /etc/vxsnd.conf</code></pre>
</div>
</div>
<p>Change the following values:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>svcnode_ip = 10.10.10.10

svcnode_peers = 10.2.1.3

src_ip = 10.2.1.4</code></pre>
</div>
</div>
<p>This sets the address on which the service node listens to VXLAN messages to the configured Anycast address and sets it to sync with spine1.</p>
<p>Enable, then restart the <code>vxsnd</code> daemon:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine1:~$ sudo systemctl enable vxsnd.service
cumulus@spine1:~$ sudo systemctl restart vxsnd.service</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="reconfigure-the-vteps-leafs-to-use-the-anycast-address">Reconfigure the VTEPs (Leafs) to Use the Anycast Address</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>leaf1:</strong></p>
<p>Change the <code>vxrd-svcnode-ip</code> field to the anycast address:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ net add loopback lo vxrd-svcnode-ip 10.10.10.10
cumulus@leaf1:~$ net pending
cumulus@leaf1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.1
  vxrd-svcnode-ip 10.10.10.10</code></pre>
</div>
</div>
<p>Verify the new service node is configured:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ ip -d link show vni-10
35: vni-10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-10 state UNKNOWN mode DEFAULT
    link/ether 46:c6:57:fc:1f:54 brd ff:ff:ff:ff:ff:ff
    vxlan id 10 remote 10.10.10.10 local 10.2.1.1 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.10.10.10
    bridge_slave

cumulus@leaf1:~$ ip -d link show vni-2000
39: vni-2000: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-20 state UNKNOWN mode DEFAULT
    link/ether 4a:fd:88:c3:fa:df brd ff:ff:ff:ff:ff:ff
    vxlan id 2000 remote 10.10.10.10 local 10.2.1.1 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.10.10.10
    bridge_slave

cumulus@leaf1:~$ ip -d link show vni-30
37: vni-30: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-30 state UNKNOWN mode DEFAULT
    link/ether 3e:b3:dc:f3:bd:2b brd ff:ff:ff:ff:ff:ff
    vxlan id 30 remote 10.10.10.10 local 10.2.1.1 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.10.10.10
    bridge_slave</code></pre>
</div>
</div>
<div>
<div>
<p>The <code>svcnode</code> 10.10.10.10 means the interface has the correct service node configured.</p>
</div>
</div>
<p>Use the <code>vxrdctl vxlans</code> command to check the service node:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ vxrdctl vxlans
VNI     Local Addr       Svc Node
===     ==========       ========
 10      10.2.1.1        10.2.1.3
 30      10.2.1.1        10.2.1.3
2000      10.2.1.1        10.2.1.3</code></pre>
</div>
</div></td>
<td><p><strong>leaf2:</strong></p>
<p>Change the <code>vxrd-svcnode-ip</code> field to the anycast address:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf1:~$ net add loopback lo vxrd-svcnode-ip 10.10.10.10
cumulus@leaf1:~$ net pending
cumulus@leaf1:~$ net commit</code></pre>
</div>
</div>
<p>These commands create the following configuration in the <code>/etc/network/interfaces</code> file:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.2
  vxrd-svcnode-ip 10.10.10.10</code></pre>
</div>
</div>
<p>Verify the new service node is configured:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ ip -d link show vni-10
35: vni-10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-10 state UNKNOWN mode DEFAULT
    link/ether 4e:03:a7:47:a7:9d brd ff:ff:ff:ff:ff:ff
    vxlan id 10 remote 10.10.10.10 local 10.2.1.2 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.10.10.10
    bridge_slave

cumulus@leaf2:~$ ip -d link show vni-2000
39: vni-2000: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-20 state UNKNOWN mode DEFAULT
    link/ether 72:3a:bd:06:00:b7 brd ff:ff:ff:ff:ff:ff
    vxlan id 2000 remote 10.10.10.10 local 10.2.1.2 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.10.10.10
    bridge_slave

cumulus@leaf2:~$ ip -d link show vni-30
37: vni-30: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-30 state UNKNOWN mode DEFAULT
    link/ether 22:65:3f:63:08:bd brd ff:ff:ff:ff:ff:ff
    vxlan id 30 remote 10.10.10.10 local 10.2.1.2 srcport 32768 61000 dstport 4789 ageing 1800 svcnode 10.10.10.10
    bridge_slave</code></pre>
</div>
</div>
<div>
<div>
<p>The <code>svcnode</code> 10.10.10.10 means the interface has the correct service node configured.</p>
</div>
</div>
<p>Use the <code>vxrdctl vxlans</code> command to check the service node:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf2:~$ vxrdctl vxlans
VNI     Local Addr       Svc Node
===     ==========       ========
 10      10.2.1.2        10.2.1.3
 30      10.2.1.2        10.2.1.3
2000      10.2.1.2        10.2.1.3</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="test-connectivity">Test Connectivity</h4>

<p>Repeat the ping tests from the previous section. Here is the table again
for reference:</p>

<table>
<thead>
<tr>
<th>VNI</th>
<th>server1</th>
<th>server2</th>
</tr>
</thead>

<tbody>
<tr>
<td>10</td>
<td>10.10.10.1</td>
<td>10.10.10.2</td>
</tr>

<tr>
<td>2000</td>
<td>10.10.20.1</td>
<td>10.10.20.2</td>
</tr>

<tr>
<td>30</td>
<td>10.10.30.1</td>
<td>10.10.30.2</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@server1:~$ ping 10.10.10.2
PING 10.10.10.2 (10.10.10.2) 56(84) bytes of data.
64 bytes from 10.10.10.2: icmp_seq=1 ttl=64 time=5.32 ms
64 bytes from 10.10.10.2: icmp_seq=2 ttl=64 time=0.206 ms
^C
--- 10.10.10.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.206/2.767/5.329/2.562 ms
 
PING 10.10.20.2 (10.10.20.2) 56(84) bytes of data.
64 bytes from 10.10.20.2: icmp_seq=1 ttl=64 time=1.64 ms
64 bytes from 10.10.20.2: icmp_seq=2 ttl=64 time=0.187 ms
^C
--- 10.10.20.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.187/0.914/1.642/0.728 ms
 
cumulus@server1:~$ ping 10.10.30.2
PING 10.10.30.2 (10.10.30.2) 56(84) bytes of data.
64 bytes from 10.10.30.2: icmp_seq=1 ttl=64 time=1.63 ms
64 bytes from 10.10.30.2: icmp_seq=2 ttl=64 time=0.191 ms
^C
--- 10.10.30.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.191/0.913/1.635/0.722 ms</code></pre></div>
<h3 id="restart-network-removes-vxsnd-anycast-ip-address-from-loopback-interface">Restart Network Removes vxsnd Anycast IP Address from Loopback Interface</h3>

<p>If you have not configured a loopback anycast IP address in
the <code>/etc/network/interfaces</code> file, but you have enabled the <code>vxsnd</code>
(service node daemon) log to automatically add anycast IP addresses,
when you restart networking (with <code>systemctl restart networking</code>), the
anycast IP address gets removed from the loopback interface.</p>

<p>To prevent this issue from occurring, specify an anycast IP address for
the loopback interface in both the <code>/etc/network/interfaces</code> file and
the <code>vxsnd.conf</code> file. This way, in case <code>vxsnd</code> fails, you can withdraw
the IP address.</p>

<h2 id="related-information">Related Information</h2>

<ul>
<li><a href="https://tools.ietf.org/html/rfc7348">tools.ietf.org/html/rfc7348</a></li>
<li><a href="http://en.wikipedia.org/wiki/Anycast">en.wikipedia.org/wiki/Anycast</a></li>

<li><p><a href="Network_Virtualization">Network virtualization chapter, Cumulus Linux user
guide</a></p>

<ul>
<li><a href="Static_VXLAN_Configurations">Static VXLAN Configurations</a>

<ul>
<li><a href="Static_VXLAN_Tunnels">Static VXLAN Tunnels</a></li>
<li><a href="Static_MAC_Bindings_with_VXLAN">Static MAC Bindings with
VXLAN</a></li>
</ul></li>
<li><a href="Lightweight_Network_Virtualization_Overview">Lightweight Network Virtualization
Overview</a>

<ul>
<li><a href="LNV_VXLAN_Active-Active_Mode">LNV VXLAN Active-Active Mode</a></li>
<li><a href="LNV_Full_Example">LNV Full Example</a></li>
</ul></li>
<li><a href="Ethernet_Virtual_Private_Network_-_EVPN">Ethernet Virtual Private Network -
EVPN</a></li>
<li><a href="VXLAN_Routing">VXLAN Routing</a></li>
<li><a href="Virtualization_Integrations">Virtualization Integrations</a>

<ul>
<li><a href="Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack">Integrating Hardware VTEPs with Midokura MidoNet and
OpenStack</a></li>
<li><a href="Integrating_Hardware_VTEPs_with_VMware_NSX-V">Integrating Hardware VTEPs with VMware
NSX-V</a></li>
<li><a href="Integrating_Hardware_VTEPs_with_VMware_NSX-MH">Integrating Hardware VTEPs with VMware
NSX-MH</a></li>
<li><a href="OVSDB_Server_High_Availability">OVSDB Server High
Availability</a></li>
</ul></li>
<li><a href="VXLAN_Scale">VXLAN Scale</a></li>
<li><a href="VXLAN_Tunnel_DSCP_Operations_—_DRAFT">VXLAN Tunnel DSCP Operations
— DRAFT</a></li>
<li><a href="Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs">Hybrid Cloud Connectivity with QinQ and
VXLANs</a></li>
<li><a href="Eng_Update_of_VXLAN_Hyperloop">Eng Update of VXLAN Hyperloop</a></li>
</ul></li>
</ul>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362706/8362710.png">Screen Shot
2015-04-20 at 10.02.37 AM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362706/8362711.png">Screen Shot
2015-04-20 at 10.02.57 AM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362706/8362712.png">Screen Shot
2015-04-17 at 2.59.30 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362706/8362713.png">Screen Shot
2015-04-17 at 2.28.44 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362706/8362708.png">Screen Shot
2015-04-23 at 5.00.38 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362706/8362709.png">Screen Shot
2015-04-22 at 1.58.50 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362706/8362707.png">UD-783bad.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362706/8362705.png">UD-783good.png</a> (image/png)</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#lightweight-network-virtualization-overview">Lightweight Network Virtualization Overview</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#lnv-concepts">LNV Concepts</a>
<ul>
<li><a href="#acquire-the-forwarding-database-at-the-service-node">Acquire the Forwarding Database at the Service Node</a></li>
<li><a href="#mac-learning-and-flooding">MAC Learning and Flooding</a></li>
<li><a href="#bum-traffic">BUM Traffic</a>
<ul>
<li><a href="#head-end-replication">Head End Replication</a></li>
<li><a href="#service-node-replication">Service Node Replication</a></li>
</ul></li>
</ul></li>
<li><a href="#requirements">Requirements</a>
<ul>
<li><a href="#hardware-requirements">Hardware Requirements</a></li>
<li><a href="#configuration-requirements">Configuration Requirements</a></li>
<li><a href="#install-the-lnv-packages">Install the LNV Packages</a></li>
</ul></li>
<li><a href="#sample-lnv-configuration">Sample LNV Configuration</a>
<ul>
<li><a href="#network-connectivity">Network Connectivity</a></li>
<li><a href="#layer-3-ip-addressing">Layer 3 IP Addressing</a></li>
<li><a href="#layer-3-fabric">Layer 3 Fabric</a></li>
<li><a href="#host-configuration">Host Configuration</a></li>
</ul></li>
<li><a href="#configure-the-vlan-to-vxlan-mapping">Configure the VLAN to VXLAN Mapping</a></li>
<li><a href="#verify-the-vlan-to-vxlan-mapping">Verify the VLAN to VXLAN Mapping</a></li>
<li><a href="#enable-and-manage-service-node-and-registration-daemons">Enable and Manage Service Node and Registration Daemons</a>
<ul>
<li><a href="#enable-the-service-node-daemon">Enable the Service Node Daemon</a></li>
<li><a href="#enable-the-registration-daemon">Enable the Registration Daemon</a></li>
<li><a href="#check-the-daemon-status">Check the Daemon Status</a></li>
</ul></li>
<li><a href="#configure-the-registration-node">Configure the Registration Node</a></li>
<li><a href="#configure-the-service-node">Configure the Service Node</a></li>
<li><a href="#verifiy-and-troubleshoot">Verifiy and Troubleshoot</a>
<ul>
<li><a href="#verify-the-registration-node-daemon">Verify the Registration Node Daemon </a></li>
<li><a href="#verify-the-service-node-daemon">Verify the Service Node Daemon</a></li>
<li><a href="#verify-traffic-flow-and-check-counters">Verify Traffic Flow and Check Counters</a></li>
<li><a href="#ping-to-test-connectivity">Ping to Test Connectivity</a></li>
<li><a href="#troubleshoot-with-mac-addresses">Troubleshoot with MAC Addresses</a></li>
<li><a href="#check-the-service-node-configuration">Check the Service Node Configuration</a></li>
</ul></li>
<li><a href="#advanced-lnv-usage">Advanced LNV Usage</a>
<ul>
<li><a href="#scale-lnv-by-load-balancing-with-anycast">Scale LNV by Load Balancing with Anycast</a>
<ul>
<li><a href="#enable-the-service-node-daemon-on-additional-spine-switches">Enable the Service Node Daemon on Additional Spine Switches</a></li>
<li><a href="#configure-the-anycast-address-on-all-participating-service-nodes">Configure the Anycast Address on All Participating Service Nodes</a></li>
<li><a href="#configure-the-service-node-vxsnd-conf-file">Configure the Service Node vxsnd.conf File</a></li>
<li><a href="#reconfigure-the-vteps-leafs-to-use-the-anycast-address">Reconfigure the VTEPs (Leafs) to Use the Anycast Address</a></li>
<li><a href="#test-connectivity">Test Connectivity</a></li>
</ul></li>
<li><a href="#restart-network-removes-vxsnd-anycast-ip-address-from-loopback-interface">Restart Network Removes vxsnd Anycast IP Address from Loopback Interface</a></li>
</ul></li>
<li><a href="#related-information">Related Information</a></li>
<li><a href="#attachments">Attachments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
