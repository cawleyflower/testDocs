<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ethernet Virtual Private Network E v P N | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.20b2cb98a9208e1e7497525a9f78f7f8eb0ca4b5f4551e9610f12c5b317e6be8.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/" class="active">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>
 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/">
    U I User Guide</a> 
  <ul>
    
    <li><a href="/NetQ/UI_User_Guide/monitor_the_network/">
    Monitor the Network</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_alarm_events/Monitor_Alarm_Events/">Monitor Alarm Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_informational_events/Monitor_Informational_Events/">Monitor Informational Events</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_health/Monitor_Network_Health/">Monitor Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_inventory/Monitor_Network_Inventory/">Monitor Network Inventory</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_the_network/monitor_network_protocols/Monitor_Network_Layer_Protocols/">Monitor Network Layer Protocols</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/UI_User_Guide/monitor_switches/Monitor_Switches/">Monitor Switches</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/netq_ui_overview/NetQ_User_Interface_Overview/">Net Q User Interface Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/UI_User_Guide/ui_preface/UI_Preface/">U I Preface</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/cli_user_guide/">
    Cli User Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/cli_user_guide/CLI_Preface/CLI_Preface/">C L I Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/automate_common_tasks/Automate_Common_and_Repetitive_Tasks/">Automate Common and Repetitive Tasks</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/command_line_overview/NetQ_Command_Line_Overview/">Net Q Command Line Overview</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_containter_environments/Monitor_Container_Environments/">Monitor Container Environments</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_data_link_layer/Monitor_Data_Link_Layer_Devices_and_Protocols/">Monitor Data Link Layer Devices and Protocols</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_linux_hosts/Monitor_Linux_Hosts/">Monitor Linux Hosts</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_health/Monitor_Overall_Network_Health/">Monitor Overall Network Health</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_network_layer/Monitor_Network_Protocols_and_Services/">Monitor Network Protocols and Services</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_physical_layer/Monitor_Physical_Layer_Components/">Monitor Physical Layer Components</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_switch_hardware/Monitor_Switch_Hardware_and_Software/">Monitor Switch Hardware and Software</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/monitor_virtual_overlays/Monitor_Virtual_Network_Overlays/">Monitor Virtual Network Overlays</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_Issues/">Resolve Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/Resolve_MLAG_Issues/">Resolve M L a G Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/investiage_netq_issues/Investigate_NetQ_Issues/">Investigate Net Q Issues</a>
    </li>
    
    <li>
      <a href="/NetQ/cli_user_guide/resolve_issues/methods_for_diagnosing_issues/Methods_for_Diagnosing_Network_Issues/">Methods for Diagnosing Network Issues</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/NetQ/deployment_guide/">
    Deployment Guide</a> 
  <ul>
    

    
    <li>
      <a href="/NetQ/deployment_guide/config_optional_netq/Configuring_Optional_NetQ_Capabilities/">Configuring Optional Net Q Capabilities</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/deployment_preface/Deployment_Preface/">Deployment Preface</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/install_netq/Install_NetQ/">Install Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/maintain_netq/Maintain_NetQ/">Maintain Net Q</a>
    </li>
    
    <li>
      <a href="/NetQ/deployment_guide/netq_primer/Cumulus_NetQ_Primer/">Cumulus Net Q Primer</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/NetQ/Release_Notes/Cumulus_NetQ_2.0_Release_Notes/">Cumulus Net Q 2.0 Release Notes</a>
    </li>
    
    <li>
      <a href="/NetQ/getting_started/Getting_Started_with_the_Cumulus_NetQ_Appliance/">Getting Started With the Cumulus Net Q Appliance</a>
    </li>
    
    <li>
      <a href="/NetQ/software_installation_guide/Cumulus_NetQ_Appliance_Software_Installation_Guide/">Cumulus Net Q Appliance Software Installation Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>Ethernet Virtual Private Network E v P N</strong>
</header>

      
<article class="markdown">

<h1 id="ethernet-virtual-private-network-evpn">Ethernet Virtual Private Network - EVPN</h1>

<p>VXLAN is the de facto technology for implementing network virtualization
in the data center, enabling layer 2 segments to be extended over an IP
core (the underlay). The initial definition of VXLAN (<a href="https://tools.ietf.org/html/rfc7348">RFC
7348</a>) did not include any control
plane and relied on a flood-and-learn approach for MAC address learning.
An alternate deployment model was to use a controller or a technology
such as <a href="https://docs.cumulusnetworks.com/display/DOCS/Lightweight+Network+Virtualization+-+LNV+Overview">Lightweight Network Virtualization
(LNV)</a> in Cumulus
Linux.</p>

<p>You cannot use EVPN and LNV at the same time.</p>

<p>Ethernet Virtual Private Network (EVPN) is a standards-based control
plane for <a href="Network_Virtualization">VXLAN</a> defined in <a href="https://tools.ietf.org/html/rfc7432">RFC
7432</a> and <a href="https://datatracker.ietf.org/doc/draft-ietf-bess-evpn-overlay/">draft-ietf-bess-evpn-overlay</a> that
allows for building and deploying VXLANs at scale. It relies on
multi-protocol BGP (MP-BGP) for exchanging information and is based on
BGP-MPLS IP VPNs (<a href="https://tools.ietf.org/html/rfc4364">RFC 4364</a>). It
has provisions to enable not only bridging between end systems in the
same layer 2 segment but also routing between different segments
(subnets). There is also inherent support for multi-tenancy. EVPN is
often referred to as the means of implementing <em>controller-less VXLAN</em>.</p>

<p>Cumulus Linux fully supports EVPN as the control plane for VXLAN,
including for both intra-subnet bridging and inter-subnet routing. Key
features include:</p>

<ul>
<li>VNI membership exchange between VTEPs using EVPN type-3 (Inclusive
multicast Ethernet tag) routes.</li>
<li>Exchange of host MAC and IP addresses using EVPN type-2 (MAC/IP
advertisement) routes.</li>
<li>Support for host/VM mobility (MAC and IP moves) through exchange of
the MAC Mobility Extended community.</li>
<li>Support for dual-attached hosts via <a href="LNV_VXLAN_Active-Active_Mode">VXLAN active-active
mode</a>. MAC synchronization between the
peer switches is done
using <a href="Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a>.</li>

<li><p>Support for ARP/ND suppression, which provides VTEPs with the
ability to suppress ARP flooding over VXLAN tunnels.</p></li>

<li><p>Support for exchange of static (sticky) MAC addresses through EVPN.</p></li>

<li><p>Support for distributed symmetric routing between different subnets.</p></li>

<li><p>Support for distributed asymmetric routing between different
subnets.</p></li>

<li><p>Support for centralized routing.</p></li>

<li><p>Support for prefix-based routing using EVPN type-5 routes (EVPN IP
prefix route)</p></li>

<li><p>Support for layer 3 multi-tenancy.</p></li>

<li><p>Support for IPv6 tenant routing.</p></li>

<li><p>Symmetric routing, asymmetric routing and prefix-based routing are
supported for both IPv4 and IPv6 hosts and prefixes.</p></li>

<li><p>ECMP support for overlay networks on RIOT-capable Broadcom switches
(Trident 3, Maverick, Trident 2+) in addition to Mellanox
Spectrum-A1 and Tomahawk switches.</p></li>
</ul>

<p>EVPN address-family is supported with both eBGP and iBGP peering. If the
underlay routing is provisioned using eBGP, the same eBGP session can
also be used to carry EVPN routes. For example, in a typical 2-tier Clos
network topology where the leaf switches are the VTEPs, if eBGP sessions
are in use between the leaf and spine switches for the underlay routing,
the same sessions can be used to exchange EVPN routes; the spine
switches merely act as &ldquo;route forwarders&rdquo; and do not install any
forwarding state as they are not VTEPs. When EVPN routes are exchanged
over iBGP peering, OSPF can be used as the IGP or the next hops can also
be resolved using iBGP. </p>

<p>You can provision and manage EVPN
using <a href="Network_Command_Line_Utility_-_NCLU">NCLU</a>.</p>

<p>For Cumulus Linux 3.4 and later releases, the routing control plane
(including EVPN) is installed as part of the
<a href="https://frrouting.org/">FRRouting</a> (FRR) package. For more information
about FRR, refer to the <a href="https://docs.cumulusnetworks.com/display/DOCS/FRRouting+Overview">FRR
Overview</a>.</p>

<p>For information about VXLAN routing, including platform and hardware
limitations, see <a href="VXLAN_Routing">VXLAN Routing</a>.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-BasicEVPNConfiguration">Basic EVPN
Configuration</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-EnableEVPNbetweenBGPNeighbors">Enable EVPN between BGP
Neighbors</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-allvnisAdvertiseAllVNIs">Advertise All
VNIs</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-RD-auto-derivationAuto-derivationofRDsandRTs">Auto-derivation of RDs and
RTs</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-RD-user-definedUser-definedRDsandRTs">User-defined RDs and
RTs</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-EnableEVPNinaniBGPEnvironmentwithanOSPFUnderlay">Enable EVPN in an iBGP Environment with an OSPF
Underlay</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-DisableDataPlaneMACLearningoverVXLANTunnels">Disable Data Plane MAC Learning over VXLAN
Tunnels</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-BUMTraffic">BUM Traffic</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-arpARPandNDSuppression">ARP and ND
Suppression</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-UFTProfilesOtherthantheDefault">UFT Profiles Other than the
Default</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ND_extended_communitySupportforEVPNNeighborDiscovery(ND)ExtendedCommunity">Support for EVPN Neighbor Discovery (ND) Extended
Community</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-EVPNandVXLANActive-activeMode">EVPN and VXLAN Active-active
Mode</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-Active-activeVTEPAnycastIPBehavior">Active-active VTEP Anycast IP
Behavior</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-FailureScenarioBehaviors">Failure Scenario
Behaviors</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-Inter-subnetRouting">Inter-subnet
Routing</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-centralizedCentralizedRouting">Centralized
Routing</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-asymmetricAsymmetricRouting">Asymmetric
Routing</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-symmetricSymmetricRouting">Symmetric
Routing</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-PBR_type5Prefix-basedRouting—EVPNType-5Routes">Prefix-based Routing — EVPN Type-5
Routes</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ConfiguretheSwitchtoInstallEVPNType-5Routes">Configure the Switch to Install EVPN Type-5
Routes</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-AnnounceEVPNType-5Routes">Announce EVPN Type-5
Routes</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-EVPNType-5RoutingwithAsymmetricRouting">EVPN Type-5 Routing with Asymmetric
Routing</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ControlWhichRIBRoutesAreInjectedintoEVPN">Control Which RIB Routes Are Injected into
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-OriginateDefaultEVPNType-5Routes">Originate Default EVPN Type-5
Routes</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-EVPNEnhancements">EVPN
Enhancements</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-Static(Sticky)MACAddresses">Static (Sticky) MAC
Addresses</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-filter_evpn_route_typeFilterEVPNRoutesBasedonType">Filter EVPN Routes Based on
Type</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-MAC-mobilityExtendedMobility">Extended
Mobility</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-dadDuplicateAddressDetection">Duplicate Address
Detection</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-EVPNOperationalCommands">EVPN Operational
Commands</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-GeneralLinuxCommandsRelatedtoEVPN">General Linux Commands Related to
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-GeneralBGPOperationalCommandsRelevanttoEVPN">General BGP Operational Commands Relevant to
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-DisplayEVPNaddress-familyPeers">Display EVPN address-family
Peers</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-DisplayVNIsinEVPN">Display VNIs in
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExamineLocalandRemoteMACAddressesforaVNIinEVPN">Examine Local and Remote MAC Addresses for a VNI in
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExamineLocalandRemoteNeighborsforaVNIinEVPN">Examine Local and Remote Neighbors for a VNI in
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExamineRemoteRouterMACsinEVPN">Examine Remote Router MACs in
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExamineGatewayNextHopsinEVPN">Examine Gateway Next Hops in
EVPN</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-DisplaytheVRFRoutingTableinFRR">Display the VRF Routing Table in
FRR</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-DisplaytheGlobalBGPEVPNRoutingTable">Display the Global BGP EVPN Routing
Table</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-DisplayaSpecificEVPNRoute">Display a Specific EVPN
Route</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-Displaytheper-VNIEVPNRoutingTable">Display the per-VNI EVPN Routing
Table</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-Displaytheper-VRFBGPRoutingTable">Display the per-VRF BGP Routing
Table</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExamineMACMoves">Examine MAC
Moves</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExamineStickyMACAddresses">Examine Sticky MAC
Addresses</a></li>
</ul></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-Troubleshooting">Troubleshooting</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-caveatsCaveats">Caveats</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ExampleConfigurations">Example
Configurations</a>

<ul>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-BasicClos(4x2)forBridging">Basic Clos (4x2) for
Bridging</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ClosConfigurationwithMLAGandCentralizedRouting">Clos Configuration with MLAG and Centralized
Routing</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-ClosConfigurationwithMLAGandEVPNAsymetricRouting">Clos Configuration with MLAG and EVPN Asymetric
Routing</a></li>
<li><a href="#EthernetVirtualPrivateNetwork-EVPN-BasicClosConfigurationwithEVPNSymmetricRouting">Basic Clos Configuration with EVPN Symmetric
Routing</a></li>
</ul></li>
</ul>

<h2 id="basic-evpn-configuration">Basic EVPN Configuration</h2>

<p>The following steps represent the fundamental configuration to use EVPN
as the control plane for VXLAN. These steps are in addition to
configuring VXLAN interfaces, attaching them to a bridge, and mapping
VLANs to VNIs.</p>

<ol>
<li>Enable EVPN route exchange (that is, address-family layer 2
VPN/EVPN) between BGP peers.</li>
<li>Enable EVPN on the system to advertise VNIs and host reachability
information (MAC addresses learned on associated VLANs) to BGP
peers.</li>
<li>Disable MAC learning on VXLAN interfaces as EVPN is responsible for
installing remote MACs.</li>
</ol>

<p>Additional configuration is necessary to enable ARP/ND suppression,
provision inter-subnet routing, and so on. The configuration depends on
the deployment scenario. You can also configure various other BGP
parameters.</p>

<h3 id="enable-evpn-between-bgp-neighbors">Enable EVPN between BGP Neighbors</h3>

<p>You enable EVPN between <a href="Border_Gateway_Protocol_-_BGP">BGP</a> neighbors
by adding the address family *evpn* to the existing neighbor
address-family activation command. </p>

<p>For a non-VTEP device that is merely participating in EVPN route
exchange, such as a spine switch (the network deployment uses hop-by-hop
eBGP or the switch is acting as an iBGP route reflector), activating the
interface for the EVPN address family is the fundamental configuration
needed in <a href="FRRouting_Overview">FRRouting</a>. Additional configuration
options for specific scenarios are described later on in this chapter.</p>

<p>The other BGP neighbor address-family-specific configurations supported
for EVPN are <code>allowas-in</code> and <code>route-reflector-client</code>.</p>

<p>To configure an EVPN route exchange with a BGP peer, you must activate
the peer or peer-group within the EVPN address-family:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp autonomous-system 65000
cumulus@switch:~$ net add bgp neighbor swp1 interface remote-as external
cumulus@switch:~$ net add bgp l2vpn evpn neighbor swp1 activate
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>Adjust the <code>remote-as</code> above to be appropriate for your environment.</p>

<p>The command syntax <code>bgp evpn</code> is also permitted for backwards
compatibility with prior versions of Cumulus Linux, but the syntax
<code>bgp l2vpn evpn</code> is recommended to standardize the BGP address-family
configuration to the AFI/SAFI format.</p>

<p>The above commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">router bgp 65000
 neighbor swp1 interface remote-as external
 address-family l2vpn evpn
  neighbor swp1 activate</code></pre></div>
<p>The above configuration does not result in BGP knowing about the local
VNIs defined on the system and advertising them to peers. This requires
additional configuration, <a href="#EthernetVirtualPrivateNetwork-EVPN-allvnis">as described
below</a>.</p>

<h3 id="advertise-all-vnis">Advertise All VNIs</h3>

<p>A single configuration variable enables the BGP control plane for all
VNIs configured on the switch. Set the variable <code>advertise-all-vni</code> to
provision all locally configured VNIs to be advertised by the BGP
control plane. FRR is not aware of any local VNIs and MACs and hosts
(neighbors) associated with those VNIs until <code>advertise-all-vni</code> is
configured.</p>

<p>To build upon the previous example, run the following commands to
advertise all VNIs:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp autonomous-system 65000
cumulus@switch:~$ net add bgp neighbor swp1 interface remote-as external
cumulus@switch:~$ net add bgp l2vpn evpn neighbor swp1 activate 
cumulus@switch:~$ net add bgp l2vpn evpn advertise-all-vni
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>Adjust the <code>remote-as</code> above to be appropriate for your environment.</p>

<p>The above commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">router bgp 65000
 neighbor swp1 interface remote-as external
 address-family l2vpn evpn
  neighbor swp1 activate
  advertise-all-vni</code></pre></div>
<p>This configuration is only needed on leaf switches that are VTEPs. EVPN
routes received from a BGP peer are accepted, even without this explicit
EVPN configuration. These routes are maintained in the global EVPN
routing table. However, they only become effective (that is, imported
into the per-VNI routing table and appropriate entries installed in the
kernel) when the VNI corresponding to the received route is locally
known.</p>

<h3 id="auto-derivation-of-rds-and-rts">Auto-derivation of RDs and RTs</h3>

<p>When a local VNI is learned by FRR and there is no explicit
configuration for that VNI in FRR, the route distinguisher (RD) and
import and export route targets (RTs) for this VNI are automatically
derived — the RD uses “RouterId:VNI-Index” and the import and export RTs
use “AS:VNI”. The RD and RTs are used in the EVPN route exchange. The RD
disambiguates EVPN routes in different VNIs (as they may have the same
MAC and/or IP address) while the RTs describe the VPN membership for the
route. The &ldquo;VNI-Index&rdquo; used for the RD is a unique, internally generated
number for a VNI. It solely has local significance; on remote switches,
its only role is for route disambiguation. This number is used instead
of the VNI value itself because this number has to be less than or equal
to 65535. In the RT, the AS part is always encoded as a 2-byte value to
allow room for a large VNI. If the router has a 4-byte AS, only the
lower 2 bytes are used. This ensures a unique RT for different VNIs
while having the same RT for the same VNI across routers in the same
AS. </p>

<p>For eBGP EVPN peering, the peers are in a different AS so using an
automatic RT of &ldquo;AS:VNI&rdquo; does not work for route import. Therefore, the
import RT is treated as &ldquo;*:VNI&rdquo; to determine which received routes are
applicable to a particular VNI. This only applies when the import RT is
auto-derived and not configured.</p>

<h3 id="user-defined-rds-and-rts">User-defined RDs and RTs</h3>

<p>EVPN also supports manual configuration of RDs and RTs, if you don&rsquo;t
want them derived automatically. To manually define RDs and RTs, use
the <code>vni</code> option within NCLU to configure the switch:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp l2vpn evpn vni 10200 rd 172.16.100.1:20
cumulus@switch:~$ net add bgp l2vpn evpn vni 10200 route-target import 65100:20
cumulus@switch:~$ net add bgp l2vpn evpn advertise-all-vni
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text"> address-family l2vpn evpn
  advertise-all-vni
  vni 10200
   rd 172.16.100.1:20
   route-target import 65100:20</code></pre></div>
<p>These commands are per VNI and must be specified under
<code>address-family l2vpn evpn</code> in BGP.</p>

<p>If you delete the RD or RT later, it reverts back to its corresponding
default value.</p>

<p>You can configure multiple RT values for import or export for a VNI. In
addition, you can configure both the import and export route targets
with a single command by using <code>route-target both</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp evpn vni 10400 route-target import 100:400
cumulus@switch:~$ net add bgp evpn vni 10400 route-target import 100:500
cumulus@switch:~$ net add bgp evpn vni 10500 route-target both 65000:500
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>The above commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">address-family l2vpn evpn
  vni 10400
    route-target import 100:400
    route-target import 100:500
  vni 10500
    route-target import 65000:500
    route-target export 65000:500</code></pre></div>
<h3 id="enable-evpn-in-an-ibgp-environment-with-an-ospf-underlay">Enable EVPN in an iBGP Environment with an OSPF Underlay</h3>

<p>EVPN can be deployed with an <a href="Open_Shortest_Path_First_-_OSPF">OSPF</a> or
static route underlay if needed. This is a more complex configuration
than using eBGP. In this case, iBGP advertises EVPN routes directly
between VTEPs, and the spines are unaware of EVPN or BGP.</p>

<p>The leaf switches peer with each other in a full mesh within the EVPN
address family without using route reflectors. The leafs generally peer
to their loopback addresses, which are advertised in OSPF. The receiving
VTEP imports routes into a specific VNI with a matching route target
community.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp autonomous-system 65020
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.2 remote-as internal
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.3 remote-as internal
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.4 remote-as internal
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.2 activate 
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.3 activate 
cumulus@switch:~$ net add bgp evpn neighbor 10.1.1.4 activate 
cumulus@switch:~$ net add bgp evpn advertise-all-vni
cumulus@switch:~$ net add ospf router-id 10.1.1.1
cumulus@switch:~$ net add loopback lo ospf area 0.0.0.0
cumulus@switch:~$ net add ospf passive-interface lo
cumulus@switch:~$ net add interface swp50 ospf area 0.0.0.0
cumulus@switch:~$ net add interface swp51 ospf area 0.0.0.0
cumulus@switch:~$ net add interface swp50 ospf network point-to-point
cumulus@switch:~$ net add interface swp51 ospf network point-to-point
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">interface lo
 ip ospf area 0.0.0.0
!
interface swp50
 ip ospf area 0.0.0.0
 ip ospf network point-to-point

interface swp51
 ip ospf area 0.0.0.0
 ip ospf network point-to-point
!
router bgp 65020
 neighbor 10.1.1.2 remote-as internal
 neighbor 10.1.1.3 remote-as internal
 neighbor 10.1.1.4 remote-as internal
 !
 address-family l2vpn evpn
  neighbor 10.1.1.2 activate
  neighbor 10.1.1.3 activate
  neighbor 10.1.1.4 activate
  advertise-all-vni
 exit-address-family
 !
Router ospf
    Ospf router-id 10.1.1.1
    Passive-interface lo</code></pre></div>
<h3 id="disable-data-plane-mac-learning-over-vxlan-tunnels">Disable Data Plane MAC Learning over VXLAN Tunnels</h3>

<p>When EVPN is provisioned, you must disable data plane MAC learning for
VXLAN interfaces because the purpose of EVPN is to exchange MACs between
VTEPs in the control plane. In the <code>/etc/network/interfaces</code> file,
configure the <code>bridge-learning</code> value to <em>off</em>:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add vxlan vni200 vxlan id 10200
cumulus@switch:~$ net add vxlan vni200 vxlan local-tunnelip 10.0.0.1
cumulus@switch:~$ net add vxlan vni200 bridge access 200
cumulus@switch:~$ net add vxlan vni200 bridge learning off
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following code snippet in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto vni200
iface vni200
    bridge-access 200
    bridge-learning off
    vxlan-id 10200
    vxlan-local-tunnelip 10.0.0.1</code></pre></div>
<p>For a bridge in <a href="Traditional_Bridge_Mode">traditional mode</a>, you must
edit the bridge configuration in the <code>/etc/network/interfaces</code> file
using a text editor: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto bridge1
iface bridge1
    bridge-ports swp3.100 swp4.100 vni100
    bridge-learning vni100=off</code></pre></div>
<h3 id="bum-traffic">BUM Traffic</h3>

<p>With EVPN, the only method of handling BUM traffic is <a href="Lightweight-Network-Virtualization-Overview_8362706.html#LightweightNetworkVirtualizationOverview-head-end">Head End
Replication
(HER)</a>.
HER is enabled by default, as it is when Lightweight Network
Virtualization (LNV) is used.</p>

<h2 id="arp-and-nd-suppression">ARP and ND Suppression</h2>

<p>ARP suppression in an EVPN context refers to the ability of a VTEP to
suppress ARP flooding over VXLAN tunnels as much as possible. Instead, a
local proxy handles ARP requests received from locally attached hosts
for remote hosts. ARP suppression is the implementation for IPv4; ND
suppression is the implementation for IPv6. </p>

<p>On switches with the Mellanox Spectrum chipset, ND suppression only
functions with the Spectrum A1 chip.</p>

<p>ARP and ND suppression are not enabled by default. You configure ARP/ND
suppression on a VXLAN interface. You also need to create an SVI for the
neighbor entry.</p>

<p>When ARP and ND suppression are enabled, you need to configure layer 3
interfaces even if the switch is configured only for layer 2 (that is,
you are not using VXLAN routing). To avoid unnecessary layer 3
information from being installed, Cumulus Networks recommends you
configure the <code>ip forward off</code> or <code>ip6 forward off</code> options as
appropriate on the VLANs. See the example configuration below.</p>

<p>To configure ARP or ND suppression,
use <a href="Network_Command_Line_Utility_-_NCLU">NCLU</a>. Here is an example
configuration using two VXLANs (10100 and 10200) and two VLANs (100 and
200).</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bridge bridge ports vni100,vni200
cumulus@switch:~$ net add bridge bridge vids 100,200
cumulus@switch:~$ net add vxlan vni100 vxlan id 10100
cumulus@switch:~$ net add vxlan vni200 vxlan id 10200
cumulus@switch:~$ net add vxlan vni100 bridge learning off
cumulus@switch:~$ net add vxlan vni200 bridge learning off
cumulus@switch:~$ net add vxlan vni100 bridge access 100
cumulus@switch:~$ net add vxlan vni100 bridge arp-nd-suppress on
cumulus@switch:~$ net add vxlan vni200 bridge arp-nd-suppress on
cumulus@switch:~$ net add vxlan vni200 bridge access 200
cumulus@switch:~$ net add vxlan vni100 vxlan local-tunnelip 10.0.0.1
cumulus@switch:~$ net add vxlan vni200 vxlan local-tunnelip 10.0.0.1
cumulus@switch:~$ net add vlan 100 ip forward off
cumulus@switch:~$ net add vlan 100 ipv6 forward off
cumulus@switch:~$ net add vlan 200 ip forward off
cumulus@switch:~$ net add vlan 200 ipv6 forward off
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto bridge
iface bridge
    bridge-ports vni100 vni200
    bridge-stp on
    bridge-vids 100 200
    bridge-vlan-aware yes

auto vlan100
iface vlan100
    ip6-forward off
    ip-forward off
    vlan-id 100
    vlan-raw-device bridge

auto vlan200
iface vlan200
    ip6-forward off
    ip-forward off
    vlan-id 200
    vlan-raw-device bridge
 
auto vni100
iface vni100
    bridge-access 100
    bridge-arp-nd-suppress on
    bridge-learning off
    vxlan-id 10100
    vxlan-local-tunnelip 10.0.0.1
 
auto vni200
iface vni200
     bridge-learning off
     bridge-access 200
     bridge-arp-nd-suppress on
     vxlan-id 10200
     vxlan-local-tunnelip 10.0.0.1</code></pre></div>
<p>For a bridge in <a href="Traditional_Bridge_Mode">traditional mode</a>, you must
edit the bridge configuration in the <code>/etc/network/interfaces</code> file
using a text editor: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto bridge1
iface bridge1
    bridge-ports swp3.100 swp4.100 vni100
    bridge-learning vni100=off
    bridge-arp-nd-suppress vni100=on
    ip6-forward off
    ip-forward off </code></pre></div>
<h3 id="uft-profiles-other-than-the-default">UFT Profiles Other than the Default</h3>

<p>When deploying EVPN and VXLAN using a hardware profile other than the
default UFT profile, ensure that the Linux kernel ARP sysctl
settings <code>gc_thresh2</code> and <code>gc_thresh3</code> are both set to a value larger
than the number of neighbor (ARP/ND) entries anticipated in the
deployment.</p>

<p>To configure these settings, edit the <code>/etc/sysctl.d/neigh.conf</code> file.
If your network has more hosts than the values used in the example
below, change the sysctl entries accordingly.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ sudo nano /etc/sysctl.d/neigh.conf
...
net.ipv4.neigh.default.gc_thresh3=14336
net.ipv6.neigh.default.gc_thresh3=16384
net.ipv4.neigh.default.gc_thresh2=7168
net.ipv6.neigh.default.gc_thresh2=8192
...</code></pre></div>
<p>After you save your settings, reboot the switch to apply the new
configuration.</p>

<h3 id="support-for-evpn-neighbor-discovery-nd-extended-community">Support for EVPN Neighbor Discovery (ND) Extended Community</h3>

<p>In an EVPN VXLAN deployment with ARP and ND suppression where the VTEPs
are only configured for layer 2, EVPN needs to carry additional
information for the attached devices so proxy ND can provide the correct
information to attached hosts. Without this information, hosts might not
be able to configure their default routers or might lose their existing
default router information.<br />
Cumulus Linux supports the EVPN Neighbor Discovery (ND) Extended
Community with a type field value of 0x06, a sub-type field value of
0x08 (ND Extended Community), and a router flag; this enables the switch
to determine if a particular IPv6-MAC pair belongs to a host or a
router.</p>

<h4 id="router-flag">Router Flag</h4>

<p>The router flag (R-bit) is used in following scenarios:</p>

<ul>
<li>In a centralized VXLAN routing configuration with a gateway router.</li>
<li>In a layer 2 switch deployment with ARP/ND suppression.</li>
</ul>

<p>When the MAC/IP (type-2) route contains the IPv6-MAC pair and the R-bit
is set, the route belongs to a router. If the R-bit is set to zero, the
route belongs to a host. If the router is in a local LAN segment, the
switch implementing the proxy ND function learns of this information by
snooping on neighbor advertisement messages for the associated IPv6
address. This information is then exchanged with other EVPN peers by
using the ND extended community in BGP updates.</p>

<p>To show the EVPN arp-cache that gets populated by the neighbor table and
see if the IPv6-MAC entry belongs to a router, run this command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:mgmt-vrf:~$ net show evpn arp-cache vni 101 ip fe80::202:ff:fe00:11
IP: fe80::202:ff:fe00:11
 Type: remote
 State: active
 MAC: 00:02:00:00:00:11
 Remote VTEP: 10.0.0.134
 Flags: Router
 Local Seq: 0 Remote Seq: 0</code></pre></div>
<p>To show the BGP routing table entry for the IPv6-MAC EVPN route with the
ND extended community, run this command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:mgmt-vrf:~$ net show bgp l2vpn evpn route vni 101 mac 00:02:00:00:00:11 ip fe80::202:ff:fe00:11
BGP routing table entry for [2]:[0]:[0]:[48]:[00:02:00:00:00:11]:[128]:[fe80::202:ff:fe00:11]
Paths: (1 available, best #1)
  Not advertised to any peer
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:11]:[128]:[fe80::202:ff:fe00:11] VNI 101
  Imported from 1.1.1.2:2:[2]:[0]:[0]:[48]:[00:02:00:00:00:11]:[128]:[fe80::202:ff:fe00:11]
  65002
    10.0.0.134 from leaf2(swp53s0) (10.0.0.134)
       Origin IGP, valid, external, bestpath-from-AS 65002, best
       Extended Community: RT:65002:101 ET:8 ND:Router Flag
       AddPath ID: RX 0, TX 18
       Last update: Thu Aug 30 14:12:09 2018</code></pre></div>
<h2 id="evpn-and-vxlan-active-active-mode">EVPN and VXLAN Active-active Mode</h2>

<p>No additional EVPN-specific configuration is needed for <a href="LNV_VXLAN_Active-Active_Mode">VXLAN
active-active mode</a>. Both switches in
the <a href="Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a> pair establish EVPN
peering with other EVPN speakers (for example, with spine switches, if
using hop-by-hop eBGP) and inform about their locally known VNIs and
MACs. When MLAG is active, both switches announce this information with
the shared anycast IP address. </p>

<p>The active-active configuration, make sure that:</p>

<ul>
<li>The <code>clagd-vxlan-anycast-ip</code> parameter is under the <a href="LNV-VXLAN-Active-Active-Mode_8362725.html#LNVVXLANActive-ActiveMode-anycast">loopback
stanza</a> on
both peers.</li>
<li>The anycast address is advertised to the routed fabric from both
peers.</li>
<li>The <a href="LNV-VXLAN-Active-Active-Mode_8362725.html#LNVVXLANActive-ActiveMode-example">VNIs</a> are
configured identically on both peers.
However, <code>vxlan-local-</code>tunnelip must be sourced from unique loopback stanza IP address
of the switch.</li>
<li>The <a href="LNV-VXLAN-Active-Active-Mode_8362725.html#LNVVXLANActive-ActiveMode-example">peerlink</a> must
belong to the bridge.</li>
</ul>

<p>MLAG synchronizes information between the two switches in the MLAG pair;
EVPN does not synchronize.</p>

<h3 id="active-active-vtep-anycast-ip-behavior">Active-active VTEP Anycast IP Behavior</h3>

<p>You must provision each individual switch within an MLAG pair with a
virtual IP address in the form of an anycast IP address for VXLAN
data-path termination. The VXLAN termination address is an anycast IP
address that you configure as a <code>clagd</code> parameter
(<code>clagd-vxlan-anycast-ip</code>) under the loopback
interface. <code>clagd</code> dynamically adds and removes this address as the
loopback interface address as follows:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>1</td>
<td><p>When the switches boot up, <code>ifupdown2 </code>places all VXLAN interfaces in a <a href="#EthernetVirtualPrivateNetwork-EVPN-proto_down">PROTO_DOWN state</a>. The configured anycast addresses are not yet configured.</p></td>
</tr>
<tr class="even">
<td>2</td>
<td><p>MLAG peering takes place and a successful VXLAN interface consistency check between the switches occurs.</p></td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>clagd</code> (the daemon responsible for MLAG) adds the anycast address to the loopback interface. It then changes the local IP address of the VXLAN interface from a unique address to the anycast virtual IP address and puts the interface in an UP state. </td>
</tr>
</tbody>
</table>

<h3 id="failure-scenario-behaviors"><strong>Failure Scenario Behaviors</strong></h3>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Scenario</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>The peer link goes down.</td>
<td><p>The primary MLAG switch continues to keep all VXLAN interfaces up with the anycast IP address while the secondary switch brings down all VXLAN interfaces and places them in a PROTO_DOWN state. The secondary MLAG switch removes the anycast IP address from the loopback interface and changes the local IP address of the VXLAN interface to the configured unique IP address.</p></td>
</tr>
<tr class="even">
<td>One of the switches goes down.</td>
<td><p>The other operational switch continues to use the anycast IP address.</p></td>
</tr>
<tr class="odd">
<td><code>clagd</code>  is stopped.</td>
<td><p>All VXLAN interfaces are put in a PROTO_DOWN state. The anycast IP address is removed from the loopback interface and the local IP addresses of the VXLAN interfaces are changed from the anycast IP address to unique non-virtual IP addresses.</p></td>
</tr>
<tr class="even">
<td>MLAG peering could not be established between the switches.</td>
<td><p><code>clagd</code> brings up all the VXLAN interfaces after the reload timer expires with the configured anycast IP address. This allows the VXLAN interface to be up and running on both switches even though peering is not established.</p></td>
</tr>
<tr class="odd">
<td>When the peer link goes down but the peer switch is up (i.e. the backup link is active).</td>
<td>All VXLAN interfaces are put into a PROTO_DOWN state on the secondary switch.</td>
</tr>
<tr class="even">
<td>A configuration mismatch between the MLAG switches</td>
<td>The VXLAN interface is placed into a PROTO_DOWN state on the secondary switch.</td>
</tr>
</tbody>
</table>

<h2 id="inter-subnet-routing">Inter-subnet Routing</h2>

<p>There are multiple models in EVPN for routing between different subnets
(VLANs), also known as inter-VLAN routing. These models arise due to the
following considerations:</p>

<ul>
<li>Does every VTEP act as a layer 3 gateway and do routing, or only
specific VTEPs do routing?</li>
<li>Is routing done only at the ingress of the VXLAN tunnel or is it
done at both the ingress and the egress of the VXLAN tunnel?</li>
</ul>

<p>These models are:</p>

<ul>
<li><strong>Centralized routing: </strong>Specific VTEPs act as designated layer 3
gateways and perform routing between subnets; other VTEPs just
perform bridging.</li>
<li><strong>Distributed asymmetric routing: </strong>Every VTEP participates in
routing, but all routing is done at the ingress VTEP; the egress
VTEP only performs bridging.</li>
<li><strong>Distributed symmetric routing: </strong>Every VTEP participates in
routing and routing is done at both the ingress VTEP and the egress
VTEP.</li>
</ul>

<p>Distributed routing — asymmetric or symmetric — is commonly deployed
with the VTEPs configured with an *anycast IP/MAC address* for each
subnet. That is, each VTEP that has a particular subnet is configured
with the same IP/MAC for that subnet. Such a model facilitates easy
host/VM mobility as there is no need to change the host/VM configuration
when it moves from one VTEP to another.</p>

<p>EVPN in Cumulus Linux supports all of the routing models listed above.
The models are described further in the following sections.</p>

<p>All routing happens in the context of a tenant VRF (<a href="Virtual_Routing_and_Forwarding_-_VRF">virtual routing and
forwarding</a>). A VRF instance is
provisioned for each tenant, and the subnets of the tenant are
associated with that VRF (the corresponding SVI is attached to the VRF).
Inter-subnet routing for each tenant occurs within the context of that
tenant&rsquo;s VRF and is separate from the routing for other tenants.</p>

<p>When configuring <a href="VXLAN_Routing">VXLAN routing</a>, Cumulus Networks
recommends enabling ARP suppression on all VXLAN interfaces. Otherwise,
when a locally attached host ARPs for the gateway, it will receive
multiple responses, one from each anycast gateway.</p>

<h3 id="centralized-routing">Centralized Routing</h3>

<p>In centralized routing, a specific VTEP is configured to act as the
default gateway for all the hosts in a particular subnet throughout the
EVPN fabric. It is common to provision a pair of VTEPs in active-active
mode as the default gateway, using an anycast IP/MAC address for each
subnet. All subnets need to be configured on such gateway VTEP(s). When
a host in one subnet wants to communicate with a host in another subnet,
it addresses the packets to the gateway VTEP. The ingress VTEP (to which
the source host is attached) bridges the packets to the gateway VTEP
over the corresponding VXLAN tunnel. The gateway VTEP performs the
routing to the destination host and post-routing, the packet gets
bridged to the egress VTEP (to which the destination host is attached).
The egress VTEP then bridges the packet on to the destination host.</p>

<h4 id="advertising-the-default-gateway">Advertising the Default Gateway</h4>

<p>To enable centralized routing, you must configure the gateway VTEPs to
advertise their IP/MAC address. Use the <code>advertise-default-gw command</code>,
as shown below.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add bgp autonomous-system 65000
cumulus@leaf01:~$ net add bgp l2vpn evpn advertise-default-gw
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit</code></pre></div>
<p>These commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">router bgp 65000
  address-family l2vpn evpn
   advertise-default-gw
  exit-address-family</code></pre></div>
<ul>
<li><p>You can deploy centralized routing at the VNI level. Therefore, you
can configure the <code>advertise-default-gw</code> command per VNI so that
centralized routing is used for some VNIs while distributed routing
(described below) is used for other VNIs. This type of configuration
is not recommended unless the deployment requires it.</p></li>

<li><p>When centralized routing is in use, even if the source host and
destination host are attached to the same VTEP, the packets travel
to the gateway VTEP to get routed and then come back.</p></li>
</ul>

<h3 id="asymmetric-routing">Asymmetric Routing</h3>

<p>In distributed asymmetric routing, each VTEP acts as a layer 3 gateway,
performing routing for its attached hosts. The routing is called
asymmetric because only the ingress VTEP performs routing, the egress
VTEP only performs the bridging. Asymmetric routing is easy to deploy as
it can be achieved with only host routing and does not involve any
interconnecting VNIs. However, each VTEP must be provisioned with all
VLANs/VNIs — the subnets between which communication can take place;
this is required even if there are no locally-attached hosts for a
particular VLAN.</p>

<p>The only additional configuration required to implement asymmetric
routing beyond the standard configuration for a layer 2 VTEP described
earlier is to ensure that each VTEP has all VLANs (and corresponding
VNIs) provisioned on it and the SVI for each such VLAN is configured
with an anycast IP/MAC address.</p>

<h3 id="symmetric-routing">Symmetric Routing</h3>

<p>In distributed symmetric routing, each VTEP acts as a layer 3 gateway,
performing routing for its attached hosts. This is the same as in
asymmetric routing. The difference is that with symmetric routing, both
the ingress VTEP and egress VTEP route the packets. Therefore, it can be
compared to the traditional routing behavior of routing to a next hop
router. In the VXLAN encapsulated packet, the inner destination MAC
address is set to the router MAC address of the egress VTEP as an
indication that the egress VTEP is the next hop and also needs to
perform routing. All routing happens in the context of a tenant (VRF).
For a packet received by the ingress VTEP from a locally attached host,
the SVI interface corresponding to the VLAN determines the VRF. For a
packet received by the egress VTEP over the VXLAN tunnel, the VNI in the
packet has to specify the VRF. For symmetric routing, this is a VNI
corresponding to the tenant and is different from either the source VNI
or the destination VNI. This VNI is referred to as the layer 3 VNI or
interconnecting VNI; it has to be provisioned by the operator and is
exchanged through the EVPN control plane. In order to make the
distinction clear, the regular VNI, which is used to map a VLAN, is
referred to as the layer 2 VNI.</p>

<p>L3-VNI</p>

<ul>
<li>There is a one-to-one mapping between a layer 3 VNI and a tenant
(VRF).</li>
<li>The VRF to layer 3 VNI mapping has to be consistent across all
VTEPs. The layer 3 VNI has to be provisioned by the operator.</li>
<li>Layer 3 VNI and layer 2 VNI cannot share the same number space.</li>
<li>In an MLAG configuration, the SVI used for the layer 3 VNI cannot be
part of the bridge. This ensures that traffic tagged with that VLAN
ID is not forwarded on the peer link or other trunks.</li>
</ul>

<p>In an EVPN symmetric routing configuration, when a type-2 (MAC/IP) route
is announced, in addition to containing two VNIs (the layer 2 VNI and
the layer 3 VNI), the route also contains separate RTs for layer 2 and
layer 3. The layer 3 RT associates the route with the tenant VRF. By
default, this is auto-derived in a similar way to the layer 2 RT, using
the layer 3 VNI instead of the layer 2 VNI; however you can also
explicitly configure it.</p>

<p>For EVPN symmetric routing, additional configuration is required:</p>

<ol>
<li>Configure a per-tenant VXLAN interface that specifies the layer 3
VNI for the tenant. This VXLAN interface is part of the bridge and
router MAC addresses of remote VTEPs is installed over this
interface.</li>
<li>Configure an SVI (layer 3 interface) corresponding to the per-tenant
VXLAN interface. This is attached to the tenant&rsquo;s VRF. Remote host
routes for symmetric routing are installed over this SVI.</li>
<li>Specify the mapping of VRF to layer 3 VNI. This configuration is for
the BGP control plane.</li>
</ol>

<h4 id="vxlan-interface-corresponding-to-the-layer-3-vni">VXLAN Interface Corresponding to the Layer 3 VNI</h4>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add vxlan vni104001 vxlan id 104001
cumulus@leaf01:~$ net add vxlan vni104001 bridge access 4001
cumulus@leaf01:~$ net add vxlan vni104001 vxlan local-tunnelip 10.0.0.11
cumulus@leaf01:~$ net add vxlan vni104001 bridge learning off
cumulus@leaf01:~$ net add vxlan vni104001 bridge arp-nd-suppress on
cumulus@leaf01:~$ net add bridge bridge ports vni104001
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit</code></pre></div>
<p>The above commands create the following snippet in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto vni104001
iface vni104001
    bridge-access 4001
    bridge-arp-nd-suppress on
    bridge-learning off
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.11
 
auto bridge
iface bridge
    bridge-ports vni104001
    bridge-vlan-aware yes</code></pre></div>
<h4 id="svi-for-the-layer-3-vni">SVI for the Layer 3 VNI</h4>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add vlan 4001 vrf turtle
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit</code></pre></div>
<p>These commands create the following snippet in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf turtle</code></pre></div>
<p>When two VTEPs are operating in VXLAN active-active mode and performing
symmetric routing, you need to configure the router MAC corresponding to
each layer 3 VNI to ensure both VTEPs use the same MAC address. Specify
the <code>hwaddress</code> (MAC address) for the SVI corresponding to the layer 3
VNI. Use the same address on both switches in the MLAG pair. Cumulus
Networks recommends you use the MLAG system MAC address.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add vlan 4001 hwaddress 44:39:39:FF:40:94</code></pre></div>
<p>This command creates the following snippet in the
<code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto vlan4001
iface vlan4001
    hwaddress 44:39:39:FF:40:94
    vlan-id 4001
    vlan-raw-device bridge
    vrf turtle</code></pre></div>
<h4 id="vrf-to-layer-3-vni-mapping">VRF to Layer 3 VNI Mapping</h4>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add vrf turtle vni 104001
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit</code></pre></div>
<p>These commands create the following configuration snippet in
the <code>/etc/frr/frr.conf</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">vrf turtle
 vni 104001
!</code></pre></div>
<h4 id="configure-rd-and-rts-for-the-tenant-vrf">Configure RD and RTs for the Tenant VRF</h4>

<p>If you do not want the RD and RTs (layer 3 RTs) for the tenant VRF to be
derived automatically, you can configure them manually by specifying
them under the <code>l2vpn evpn</code> address family for that specific VRF. For
example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp vrf tenant1 l2vpn evpn rd 172.16.100.1:20
cumulus@switch:~$ net add bgp vrf tenant1 l2vpn evpn route-target import 65100:20
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration snippet in the
<code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">router bgp &lt;as&gt; vrf tenant1
 address-family l2vpn evpn
  rd 172.16.100.1:20
  route-target import 65100:20</code></pre></div>
<p>The tenant VRF RD and RTs are different from the RD and RTs for the
layer 2 VNI, which are described in <a href="#EthernetVirtualPrivateNetwork-EVPN-RD-auto-derivation">Auto-derivation of RDs and
RTs</a> and
<a href="#EthernetVirtualPrivateNetwork-EVPN-RD-user-defined">User-defined RDs and
RTs</a>, above.</p>

<h4 id="advertise-the-locally-attached-subnets">Advertise the Locally-attached Subnets</h4>

<p>Symmetric routing presents a problem in the presence of silent hosts. If
the ingress VTEP does not have the destination subnet and the host route
is not advertised for the destination host, the ingress VTEP cannot
route the packet to its destination. This problem can be overcome by
having VTEPs announce the subnet prefixes corresponding to their
connected subnets in addition to announcing host routes. These routes
will be announced as EVPN prefix (type-5) routes.</p>

<p>To advertise locally attached subnets, you must:</p>

<ol>
<li>Enable advertisement of EVPN prefix (type-5) routes. Refer
to <a href="#EthernetVirtualPrivateNetwork-EVPN-PBR_type5">Prefix-based Routing — EVPN Type-5
Routes</a>, below.</li>
<li>Ensure that the routes corresponding to the connected subnets are
known in the BGP VRF routing table by injecting them using
the <code>network</code> command or redistributing them using
the <code>redistribute connected</code> command.</li>
</ol>

<p>This configuration is recommended only if the deployment is known to
have silent hosts. It is also recommended that you enable on only one
VTEP per subnet, or two for redundancy.</p>

<p>An earlier version of this chapter referred to the
<code>advertise-subnet</code> command. That command is deprecated and should not be
used.</p>

<h2 id="prefix-based-routing-evpn-type-5-routes">Prefix-based Routing — EVPN Type-5 Routes</h2>

<p>EVPN in Cumulus Linux supports prefix-based routing using EVPN type-5
(prefix) routes. Type-5 routes (or prefix routes) are primarily used to
route to destinations outside of the data center fabric.</p>

<p>EVPN prefix routes carry the layer 3 VNI and router MAC address and
follow the symmetric routing model for routing to the destination
prefix.</p>

<p>When connecting to a WAN edge router to reach destinations outside the
data center, it is highly recommended that specific border/exit leaf
switches be deployed to originate the type-5 routes.</p>

<p>On switches with the Mellanox Spectrum chipset, centralized routing,
symmetric routing and prefix-based routing only function with the
Spectrum A1 chip.</p>

<p>If you are using a Broadcom Trident II+ switch as a border/exit leaf,
see <a href="#EthernetVirtualPrivateNetwork-EVPN-caveats">caveats</a>, below for a
necessary workaround; the workaround only applies to Trident II+
switches, not Tomahawk or Spectrum.</p>

<h3 id="configure-the-switch-to-install-evpn-type-5-routes">Configure the Switch to Install EVPN Type-5 Routes</h3>

<p>For a switch to be able to install EVPN type-5 routes into the routing
table, it must be configured with the layer 3 VNI related information.
This configuration is the same as for symmetric routing. You need to:</p>

<ol>
<li>Configure a per-tenant VXLAN interface that specifies the layer 3
VNI for the tenant. This VXLAN interface is part of the bridge;
router MAC addresses of remote VTEPs are installed over this
interface.</li>
<li>Configure an SVI (layer 3 interface) corresponding to the per-tenant
VXLAN interface. This is attached to the tenant&rsquo;s VRF. The remote
prefix routes are installed over this SVI.</li>
<li>Specify the mapping of the VRF to layer 3 VNI. This configuration is
for the BGP control plane.</li>
</ol>

<h3 id="announce-evpn-type-5-routes">Announce EVPN Type-5 Routes</h3>

<p>The following configuration is needed in the tenant VRF to announce IP
prefixes in BGP&rsquo;s RIB as EVPN type-5 routes.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@bl1:~$ net add bgp vrf vrf1 l2vpn evpn advertise ipv4 unicast
cumulus@bl1:~$ net pending
cumulus@bl1:~$ net commit</code></pre></div>
<p>These commands create the following snippet in
the <code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">router bgp 65005 vrf vrf1
  address-family l2vpn evpn
    advertise ipv4 unicast
  exit-address-family
end</code></pre></div>
<h3 id="evpn-type-5-routing-with-asymmetric-routing">EVPN Type-5 Routing with Asymmetric Routing</h3>

<p>Asymmetric routing is an ideal choice when all VLANs (subnets) are
configured on all leaf switches. It simplifies the routing configuration
and eliminates the potential need for advertising subnet routes to
handle silent hosts. However, most deployments need access to external
networks to reach the Internet or global destinations, or to do
subnet-based routing between pods or data centers; this requires EVPN
type-5 routes. </p>

<p>Cumulus Linux supports EVPN type-5 routes for prefix-based routing in
asymmetric configurations within the pod or data center by providing an
option to use the layer 3 VNI only for type-5 routes; type-2 routes
(host routes) only use the layer 2 VNI.</p>

<p>The following example commands show how to use the layer 3 VNI for
type-5 routes only:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net add vrf turtle vni 104001 prefix-routes-only
cumulus@leaf01:~$ net pending
cumulus@leaf01:~$ net commit</code></pre></div>
<p>These commands create the following snippet in
the <code>/etc/frr/frr.conf</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">vrf turtle
  vni 104001 prefix-routes-only</code></pre></div>
<h3 id="control-which-rib-routes-are-injected-into-evpn">Control Which RIB Routes Are Injected into EVPN</h3>

<p>By default, when announcing IP prefixes in the BGP RIB as EVPN type-5
routes, all routes in the BGP RIB are picked for advertisement as EVPN
type-5 routes. You can use a route map to allow selective advertisement
of routes from the BGP RIB as EVPN type-5 routes.</p>

<p>The following command adds a route map filter to IPv4 EVPN type-5 route
advertisement:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp vrf turtle l2vpn evpn advertise ipv4 unicast route-map map1
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h3 id="originate-default-evpn-type-5-routes">Originate Default EVPN Type-5 Routes</h3>

<p>Cumulus Linux supports originating EVPN default type-5 routes. The
default type-5 route is originated from a border (exit) leaf and
advertised to all the other leafs within the pod. Any leaf within the
pod follows the default route towards the border leaf for all external
traffic (towards the Internet or a different pod).</p>

<p>To originate a default type-5 route in EVPN, you need to execute
FRRouting commands. The following shows an example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">switch(config)# router bgp 650030 vrf vrf1
switch(config-router)# address-family l2vpn evpn
switch(config-router-af)# default-originate ipv4
switch(config-router-af)# default-originate ipv6
switch(config-router-af)# exit
switch(config-router)# exit
switch(config)# exit
switch# write memory</code></pre></div>
<h2 id="evpn-enhancements">EVPN Enhancements</h2>

<h3 id="static-sticky-mac-addresses">Static (Sticky) MAC Addresses</h3>

<p>MAC addresses that are intended to be pinned to a particular VTEP can be
provisioned on the VTEP as a static bridge FDB entry. EVPN picks up
these MAC addresses and advertises them to peers as remote static MACs.
You configure static bridge FDB entries for sticky MACs under the bridge
configuration using NCLU:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bridge post-up bridge fdb add 00:11:22:33:44:55 dev swp1 vlan 101 master static
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<p>These commands create the following configuration in
the <code>/etc/network/interfaces</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto bridge
iface bridge
    bridge-ports swp1 vni10101
    bridge-vids 101
    bridge-vlan-aware yes
    post-up bridge fdb add 00:11:22:33:44:55 dev swp1 vlan 101 master static</code></pre></div>
<p>For a bridge in <a href="Traditional_Bridge_Mode">traditional mode</a>, you must
edit the bridge configuration in the <code>/etc/network/interfaces</code> file
using a text editor: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto br101
iface br101
    bridge-ports swp1.101 vni10101
    bridge-learning vni10101=off
    post-up bridge fdb add 00:11:22:33:44:55 dev swp1.101 master static</code></pre></div>
<h3 id="filter-evpn-routes-based-on-type">Filter EVPN Routes Based on Type</h3>

<p>In many situations, it is desirable to only exchange EVPN routes of a
particular type. For example, a common deployment scenario for large
data centers is to sub-divide the data center into multiple pods with
full host mobility within a pod but only do prefix-based routing across
pods. This can be achieved by only exchanging EVPN type-5 routes across
pods.</p>

<p>To filter EVPN routes based on the route-type and allow only certain
types of EVPN routes to be advertised in the fabric, use these commands:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">net add routing route-map &lt;route_map_name&gt; (deny|permit) &lt;1-65535&gt; match evpn default-route
net add routing route-map &lt;route_map_name&gt; (deny|permit) &lt;1-65535&gt; match evpn route-type (macip|prefix|multicast)</code></pre></div>
<p>The following example command configures EVPN to advertise type-5 routes
only:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add routing route-map map1 permit 1 match evpn route-type prefix
cumulus@switch:~$ net pending
cumulus@switch:~$ net commit</code></pre></div>
<h3 id="extended-mobility">Extended Mobility</h3>

<p>Cumulus Linux support for host and virtual machine mobility in an EVPN
deployment has been enhanced to handle scenarios where the IP to MAC
binding for a host or virtual machine changes across the move. This is
referred to as <em>extended mobility</em>. The simple mobility scenario where a
host or virtual machine with a binding of <code>IP1</code>, <code>MAC1</code> moves from one
rack to another has been supported in previous releases of Cumulus
Linux. The EVPN enhancements support additional scenarios where a host
or virtual machine with a binding of <code>IP1</code>, <code>MAC1</code> moves and takes on a
new binding of <code>IP2</code>, <code>MAC1</code> or <code>IP1</code>, <code>MAC2</code>. The EVPN protocol
mechanism to handle extended mobility continues to use the MAC mobility
extended community and is the same as the standard mobility procedures.
Extended mobility defines how the sequence number in this attribute is
computed when binding changes occur.</p>

<p>Extended mobility not only supports virtual machine <em>moves</em>, but also a
scenario where one virtual machine shuts down and another is provisioned
on a different rack that uses the IP address or the MAC address of the
previous virtual machine. For example, in an EVPN deployment with
OpenStack, where virtual machines for a tenant are provisioned and shut
down very dynamically, a new virtual machine can use the same IP address
as an earlier virtual machine but with a different MAC address.</p>

<p>The support for extended mobility is enabled by default and does not
require any additional configuration.</p>

<p>You can examine the sequence numbers associated with a host or virtual
machine MAC address and IP address with NCLU commands. For example:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn mac vni 10100 mac 00:02:00:00:00:42
MAC: 00:02:00:00:00:42
 Remote VTEP: 10.0.0.2
 Local Seq: 0 Remote Seq: 3
 Neighbors:
    10.1.1.74 Active</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn arp vni 10100 ip 10.1.1.74
IP: 10.1.1.74
 Type: local
 State: active
 MAC: 44:39:39:ff:00:24
 Local Seq: 2 Remote Seq: 3</code></pre></div>
<h3 id="duplicate-address-detection">Duplicate Address Detection</h3>

<p>Cumulus Linux 3.7.2 and later is able to detect duplicate MAC and
IPv4/IPv6 addresses on hosts or virtual machines in a VXLAN-EVPN
configuration. The Cumulus Linux switch (VTEP) considers a host MAC or
IP address to be duplicate if the address moves across the network more
than a certain number of times within a certain number of seconds (five
moves within 180 seconds by default). In addition to legitimate host or
VM mobility scenarios, address movement can occur when IP addresses are
misconfigured on hosts or when packet looping occurs in the network due
to faulty configuration or behavior.</p>

<p>Duplicate address detection is enabled by default and triggers when:</p>

<ul>
<li>Two hosts have the same MAC address (the host IP addresses might be
the same or different)</li>
<li>Two hosts have the same IP address but different MAC addresses</li>
</ul>

<p>By default, when a duplicate address is detected, Cumulus Linux flags
the address as a duplicate and generates an error in syslog so that you
can troubleshoot the reason and address the fault, then clear the
duplicate address flag. No functional action is taken on the address.</p>

<p>If a MAC address is flagged as a duplicate, all IP addresses associated
with that MAC are flagged as duplicates. </p>

<p>MLAG Deployments</p>

<p>In an MLAG configuration, duplicate address detection runs independently
on each switch in the MLAG pair. Based on the sequence in which local
learn and/or route withdrawal from the remote VTEP occurs, an IP address
might be flagged as duplicate only on one of the switches in the MLAG
pair. In rare cases, neither switch might flag the IP address as a
duplicate.</p>

<p><strong>When Does Duplicate Address Detection Trigger?</strong></p>

<p>The VTEP that sees an address move from remote to local begins the
detection process by starting a timer. Each VTEP runs duplicate address
detection independently. Detection always starts with the first mobility
event from *remote* to <em>local</em>. If the address is initially remote, the
detection count can start with the very first move for the address. If
the address is initially local, the detection count starts only with the
second or higher move for the address. If an address is undergoing a
mobility event between remote VTEPs, duplicate detection is not started.</p>

<p>The following illustration shows VTEP-A, VTEP-B, and VTEP-C in an EVPN
configuration. Duplicate address detection triggers on VTEP-A when there
is a duplicate MAC address for two hosts attached to VTEP-A and VTEP-B.
However, duplicate detection does *not* trigger on VTEP-A when mobility
events occur between two remote VTEPs (VTEP-B and VTEP-C). </p>

<p> </p>

<p><img src="attachments/8362732/8366123.png" alt="" /></p>

<h4 id="configure-duplicate-address-detection">Configure Duplicate Address Detection</h4>

<p>To change the threshold for MAC and IP address moves, run
the <code>net add bgp l2vpn evpn dup-addr-detection max-moves &lt;number-of-events&gt; time &lt;duration&gt;</code> 
command. You can specify <code>max-moves</code> to be between 2 and 1000
and <code>time</code> to be between 2 and 1800 seconds.</p>

<p>The following example command sets the maximum number of address moves
allowed to 10 and the duplicate address detection time interval to 1200
seconds.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp l2vpn evpn dup-addr-detection max-moves 10 time 1200 </code></pre></div>
<p>To disable duplicate address detection, see <a href="#EthernetVirtualPrivateNetwork-EVPN-disableDAD">Disable Duplicate Address
Detection</a> below. </p>

<h4 id="example-syslog-messages">Example syslog Messages</h4>

<p>The following example shows the syslog message that is generated when
Cumulus Linux detects a MAC address as a duplicate during a local
update:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">2018/11/06 18:55:29.463327 ZEBRA: [EC 4043309149] VNI 1001: MAC 00:01:02:03:04:11 detected as duplicate during local update, last VTEP 172.16.0.16</code></pre></div>
<p>The following example shows the syslog message that is generated when
Cumulus Linux detects an IP address as a duplicate during a remote
update: </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">2018/11/09 22:47:15.071381 ZEBRA: [EC 4043309151] VNI 1002: MAC aa:22:aa:aa:aa:aa IP 10.0.0.9 detected as duplicate during remote update, from VTEP 172.16.0.16</code></pre></div>
<h4 id="freeze-a-detected-duplicate-address">Freeze a Detected Duplicate Address</h4>

<p>Cumulus Linux 3.7.3 and later provides a *freeze* option that takes
action on a detected duplicate address. You can freeze the
address *permanently* (until you intervene) or for a <em>defined amount of
time</em>, after which it is cleared automatically. </p>

<p>When you enable the freeze option and a duplicate address is detected:</p>

<ul>
<li>If the MAC or IP address is learned from a remote VTEP at the time
it is frozen, the forwarding information in the kernel and hardware
is not updated, leaving it in the prior state. Any future remote
updates are processed but they are not reflected in the kernel
entry. If the remote VTEP sends a MAC-IP route withdrawal, the local
VTEP removes the frozen remote entry. Then, if the local VTEP has a
locally-learned entry already present in its kernel, FRR will
originate a corresponding MAC-IP route and advertise it to all
remote VTEPs.</li>
<li>If the MAC or IP address is locally learned on this VTEP at the time
it is frozen, the address is not advertised to remote VTEPs. Future
local updates are processed but are not advertised to remote VTEPs.
If FRR receives a local entry delete event, the frozen entry is
removed from the FRR database. Any remote updates (from other VTEPs)
change the state of the entry to remote but the entry is not
installed in the kernel (until cleared).</li>
</ul>

<p><strong>To recover from a freeze</strong>, shut down the faulty host or VM or fix any
other misconfiguration in the network. If the address is
frozen *permanently,* issue the <a href="#EthernetVirtualPrivateNetwork-EVPN-clearDuplicateAddress">clear
command</a> on
the VTEP where the address is marked as duplicate. If the address is
frozen for a defined period of time, it is cleared automatically after
the timer expires (you can clear the duplicate address before the timer
expires with the <a href="#EthernetVirtualPrivateNetwork-EVPN-clearDuplicateAddress">clear
command</a>).</p>

<p>If you issue the <a href="#EthernetVirtualPrivateNetwork-EVPN-clearDuplicateAddress">clear
command</a> or
the timer expires before you address the fault, duplicate address
detection might occur repeatedly.</p>

<p>After you clear a frozen address, if it is present behind a remote VTEP,
the kernel and hardware forwarding tables are updated. If the address is
locally learned on this VTEP, the address is advertised to remote
VTEPs. All VTEPs get the correct address as soon as the host
communicates. Silent hosts are learned only after the faulty entries age
out, or you intervene and clear the faulty MAC and ARP table entries.</p>

<h4 id="configure-the-freeze-option">Configure the Freeze Option</h4>

<p>To enable Cumulus Linux to *freeze* detected duplicate addresses, run
the <code>net add bgp l2vpn evpn dup-addr-detection freeze &lt;duration&gt;|permanent</code> command.
The duration can be any number of seconds between 30 and 3600.</p>

<p>The following example command freezes duplicate addresses for a period
of 1000 seconds, after which it is cleared automatically:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp l2vpn evpn dup-addr-detection freeze 1000</code></pre></div>
<p>Best Practice</p>

<p>Cumulus Networks recommends you set the freeze timer to be three times
the duplicate address detection window. For example, if the duplicate
address detection window is set to the default of 180 seconds, set the
freeze timer to 540 seconds.</p>

<p>The following example command freezes duplicate addresses permanently
(until you issue the <a href="#EthernetVirtualPrivateNetwork-EVPN-clearDuplicateAddress">clear
command</a>):</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net add bgp l2vpn evpn dup-addr-detection freeze permanent</code></pre></div>
<h4 id="clear-duplicate-addresses">Clear Duplicate Addresses</h4>

<p>To clear a duplicate MAC or IP address (and unfreeze a frozen address),
run
the <code>net clear evpn dup-addr vni &lt;vni_id&gt; ip &lt;mac/ip address&gt;</code> command. The
following example command clears IP address 10.0.0.9 for VNI 101.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net clear evpn dup-addr vni 101 ip 10.0.0.9</code></pre></div>
<p>To clear duplicate addresses for all VNIs, run the following command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net clear evpn dup-addr vni all</code></pre></div>
<p>In an MLAG configuration, you need to run the <a href="#EthernetVirtualPrivateNetwork-EVPN-clearDuplicateAddress">clear
command</a> on
both the MLAG primary and secondary switch.</p>

<p>When you clear a duplicate MAC address, all its associated IP addresses
are also cleared. However, you cannot clear an associated IP address if
its MAC address is still in a duplicate state.</p>

<h4 id="disable-duplicate-address-detection">Disable Duplicate Address Detection</h4>

<p>By default, duplicate address detection is enabled and a syslog error is
generated when a duplicate address is detected. To disable duplicate
address detection, run the following command.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net del bgp l2vpn evpn dup-addr-detection</code></pre></div>
<p>When you disable duplicate address detection, Cumulus Linux clears the
configuration and all existing duplicate addresses.</p>

<h4 id="show-detected-duplicate-address-information">Show Detected Duplicate Address Information</h4>

<p>During the duplicate address detection process, you can see the start
time and current detection count with the net show evpn mac vni mac
 command. The following command example shows that detection started for
MAC address 00:01:02:03:04:11 for VNI 1001 on Tuesday, Nov 6 at 18:55:05
and the number of moves detected is 1.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn mac vni 1001 mac 00:01:02:03:04:11
MAC: 00:01:02:03:04:11
 Intf: hostbond3(15) VLAN: 1001
 Local Seq: 1 Remote Seq: 0
 Duplicate detection started at Tue Nov  6 18:55:05 2018, detection count 1
 Neighbors:
    10.0.1.26 Active</code></pre></div>
<p>After the duplicate MAC address is cleared,
the <code>net show evpn mac vni &lt;vni_id&gt; mac &lt;mac_addr&gt;</code> command shows:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">MAC: 00:01:02:03:04:11
 Remote VTEP: 172.16.0.16
 Local Seq: 13 Remote Seq: 14
 Duplicate, detected at Tue Nov  6 18:55:29 2018
 Neighbors:
    10.0.1.26 Active</code></pre></div>
<p>To display information for a duplicate IP address, run
the <code>net show evpn arp-cache vni &lt;vni_id&gt; ip &lt;ip_addr&gt; </code>command. The
following command example shows information for IP address 10.0.0.9 for
VNI 1001. </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn arp-cache vni 1001 ip 10.0.0.9
IP: 10.0.0.9
 Type: remote
 State: inactive
 MAC: 00:01:02:03:04:11
 Remote VTEP: 10.0.0.34
 Local Seq: 0 Remote Seq: 14
 Duplicate, detected at Tue Nov  6 18:55:29 2018</code></pre></div>
<p>To show a list of MAC addresses detected as duplicate for a specific VNI
or for all VNIs, run
the <code>net show evpn mac vni &lt;vni-id|all&gt; duplicate</code> command. The
following example command shows a list of duplicate MAC addresses for
VNI 1001:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn mac vni 1001 duplicate
Number of MACs (local and remote) known for this VNI: 16
MAC               Type   Intf/Remote VTEP      VLAN 
aa:bb:cc:dd:ee:ff local  hostbond3             1001  </code></pre></div>
<p>To show a list of IP addresses detected as duplicate for a specific VNI
or for all VNIs, run
the <code>net show evpn arp-cache vni &lt;vni-id|all&gt; duplicate</code> command. The
following example command shows a list of duplicate IP addresses for VNI
1001:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn arp-cache vni 1001 duplicate
Number of ARPs (local and remote) known for this VNI: 20
IP                Type   State    MAC                Remote VTEP          
10.0.0.8          local  active   aa:11:aa:aa:aa:aa
10.0.0.9          local  active   aa:11:aa:aa:aa:aa
10.10.0.12        remote active   aa:22:aa:aa:aa:aa  172.16.0.16</code></pre></div>
<p>To show configured duplicate address detection parameters, run
the <code>net show evpn</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show evpn
L2 VNIs: 4
L3 VNIs: 2
Advertise gateway mac-ip: No
Duplicate address detection: Enable
  Detection max-moves 7, time 300
  Detection freeze permanent</code></pre></div>
<h2 id="evpn-operational-commands">EVPN Operational Commands</h2>

<h3 id="general-linux-commands-related-to-evpn">General Linux Commands Related to EVPN</h3>

<p>You can use various <code>iproute2</code> commands to examine links, VLAN mappings
and the bridge MAC forwarding database known to the Linux kernel. You
can also use these commands to examine the neighbor cache and the
routing table (for the underlay or for a specific tenant VRF). Some of
the key commands are:</p>

<ul>
<li><code>ip [-d] link show</code></li>
<li><code>bridge link show</code></li>
<li><code>bridge vlan show</code></li>
<li><code>bridge [-s] fdb show</code></li>
<li><code>ip neighbor show</code></li>
<li><code>ip route show [table &lt;vrf-name&gt;]</code></li>
</ul>

<p>A sample output of <code>ip -d link show type vxlan</code> is shown below for one
VXLAN interface. Some relevant parameters are the VNI value, the state,
the local IP address for the VXLAN tunnel, the UDP port number (4789)
and the bridge that the interface is part of (*bridge* in the example
below). The output also shows that MAC learning is disabled (<em>off</em>) on
the VXLAN interface.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ ip -d link show type vxlan
9: vni100: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master bridge state UNKNOWN mode DEFAULT group default 
    link/ether 72:bc:b4:a3:eb:1e brd ff:ff:ff:ff:ff:ff promiscuity 1 
    vxlan id 10100 local 10.0.0.1 srcport 0 0 dstport 4789 nolearning ageing 300 
    bridge_slave state forwarding priority 8 cost 100 hairpin off guard off root_block off fastleave off learning off flood on port_id 0x8001 port_no 0x1 designated_port 32769 designated_cost 0 designated_bridge 8000.0:1:0:0:11:0 designated_root 8000.0:1:0:0:11:0 hold_timer    0.00 message_age_timer    0.00 forward_delay_timer    0.00 topology_change_ack 0 config_pending 0 proxy_arp off proxy_arp_wifi off mcast_router 1 mcast_fast_leave off mcast_flood on neigh_suppress on group_fwd_mask 0x0 group_fwd_mask_str 0x0 group_fwd_maskhi 0x0 group_fwd_maskhi_str 0x0 addrgenmode eui64 
...
cumulus@leaf01:~$</code></pre></div>
<p>A sample output of <code>bridge fdb show</code> is depicted below. Some interesting
information from this output includes:</p>

<ul>
<li><p>swp3 and swp4 are access ports with VLAN ID 100. This is mapped to
VXLAN interface vni100. </p></li>

<li><p>00:02:00:00:00:01 is a local host MAC learned on swp3.</p></li>

<li><p>The remote VTEPs which participate in VLAN ID 100 are 10.0.0.3,
10.0.0.4 and 10.0.0.2. This is evident from the FDB entries with a
MAC address of 00:00:00:00:00:00. These entries are used for BUM
traffic replication.</p></li>

<li><p>00:02:00:00:00:06 is a remote host MAC reachable over the VXLAN
tunnel to 10.0.0.2.</p></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ bridge fdb show
00:02:00:00:00:13 dev swp3 master bridge permanent
00:02:00:00:00:01 dev swp3 vlan 100 master bridge 
00:02:00:00:00:02 dev swp4 vlan 100 master bridge 
72:bc:b4:a3:eb:1e dev vni100 master bridge permanent
00:02:00:00:00:06 dev vni100 vlan 100 offload master bridge 
00:00:00:00:00:00 dev vni100 dst 10.0.0.3 self permanent
00:00:00:00:00:00 dev vni100 dst 10.0.0.4 self permanent
00:00:00:00:00:00 dev vni100 dst 10.0.0.2 self permanent
00:02:00:00:00:06 dev vni100 dst 10.0.0.2 self offload 
...</code></pre></div>
<p>A sample output of <code>ip neigh show</code> is shown below. Some interesting
information from this output includes:</p>

<ul>
<li><p>172.16.120.11 is a locally-attached host on VLAN 100. It is shown
twice because of the configuration of the anycast IP/MAC on the
switch.</p></li>

<li><p>172.16.120.42 is a remote host on VLAN 100 and 172.16.130.23 is a
remote host on VLAN 200. The MAC address of these hosts can be
examined using the <code>bridge fdb show</code> command described earlier to
determine the VTEPs behind which these hosts are located.</p></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ ip neigh show
172.16.120.11 dev vlan100-v0 lladdr 00:02:00:00:00:01 STALE
172.16.120.42 dev vlan100 lladdr 00:02:00:00:00:0e offload REACHABLE
172.16.130.23 dev vlan200 lladdr 00:02:00:00:00:07 offload REACHABLE
172.16.120.11 dev vlan100 lladdr 00:02:00:00:00:01 REACHABLE
...</code></pre></div>
<h3 id="general-bgp-operational-commands-relevant-to-evpn">General BGP Operational Commands Relevant to EVPN</h3>

<p>The following commands are not unique to EVPN but help troubleshoot
connectivity and route propagation. If BGP is used for the underlay
routing, you can view a summary of the layer 3 fabric connectivity by
running the <code>net show bgp summary</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp summary
show bgp ipv4 unicast summary
=============================
BGP router identifier 10.0.0.1, local AS number 65001 vrf-id 0
BGP table version 9
RIB entries 11, using 1496 bytes of memory
Peers 2, using 42 KiB of memory
Peer groups 1, using 72 bytes of memory

Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
s1(swp49s0)     4      65100      43      49        0    0    0 02:04:00            4
s2(swp49s1)     4      65100      43      49        0    0    0 02:03:59            4
Total number of neighbors 2

show bgp ipv6 unicast summary
=============================
No IPv6 neighbor is configured

show bgp evpn summary
=====================
BGP router identifier 10.0.0.1, local AS number 65001 vrf-id 0
BGP table version 0
RIB entries 15, using 2040 bytes of memory
Peers 2, using 42 KiB of memory
Peer groups 1, using 72 bytes of memory

Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
s1(swp49s0)     4      65100      43      49        0    0    0 02:04:00           30
s2(swp49s1)     4      65100      43      49        0    0    0 02:03:59           30
Total number of neighbors 2</code></pre></div>
<p>You can examine the underlay routing, which determines how remote VTEPs
are reached. Run the <code>net show route</code> command. Here is some sample
output from a leaf switch:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show route
 
show ip route
=============
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR,
       &gt; - selected route, * - FIB route

C&gt;* 10.0.0.11/32 is directly connected, lo, 19:48:21
B&gt;* 10.0.0.12/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:03
  *                     via fe80::4638:39ff:fe00:25, swp52, 19:48:03
B&gt;* 10.0.0.13/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:03
  *                     via fe80::4638:39ff:fe00:25, swp52, 19:48:03
B&gt;* 10.0.0.14/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:03
  *                     via fe80::4638:39ff:fe00:25, swp52, 19:48:03
B&gt;* 10.0.0.21/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:04
B&gt;* 10.0.0.22/32 [20/0] via fe80::4638:39ff:fe00:25, swp52, 19:48:03
B&gt;* 10.0.0.41/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:03
  *                     via fe80::4638:39ff:fe00:25, swp52, 19:48:03
B&gt;* 10.0.0.42/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:03
  *                     via fe80::4638:39ff:fe00:25, swp52, 19:48:03
C&gt;* 10.0.0.112/32 is directly connected, lo, 19:48:21
B&gt;* 10.0.0.134/32 [20/0] via fe80::4638:39ff:fe00:54, swp51, 19:48:03
  *                      via fe80::4638:39ff:fe00:25, swp52, 19:48:03
C&gt;* 169.254.1.0/30 is directly connected, peerlink.4094, 19:48:21

show ipv6 route
===============
Codes: K - kernel route, C - connected, S - static, R - RIPng,
       O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table,
       v - VNC, V - VNC-Direct, A - Babel, D - SHARP, F - PBR,
       &gt; - selected route, * - FIB route
C * fe80::/64 is directly connected, bridge, 19:48:21
C * fe80::/64 is directly connected, peerlink.4094, 19:48:21
C * fe80::/64 is directly connected, swp52, 19:48:21
C&gt;* fe80::/64 is directly connected, swp51, 19:48:21

 
cumulus@leaf01:~$</code></pre></div>
<p>You can view the MAC forwarding database on the switch by running
the <code>net show bridge macs</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bridge macs
VLAN      Master    Interface    MAC                TunnelDest    State      Flags          LastSeen
--------  --------  -----------  -----------------  ------------  ---------  -------------  ---------------
100       br0       br0          00:00:5e:00:01:01                permanent                 1 day, 03:38:43
100       br0       br0          00:01:00:00:11:00                permanent                 1 day, 03:38:43
100       br0       swp3         00:02:00:00:00:01                                          00:00:26
100       br0       swp4         00:02:00:00:00:02                                          00:00:16
100       br0       vni100       00:02:00:00:00:0a                           offload        1 day, 03:38:20
100       br0       vni100       00:02:00:00:00:0d                           offload        1 day, 03:38:20
100       br0       vni100       00:02:00:00:00:0e                           offload        1 day, 03:38:20
100       br0       vni100       00:02:00:00:00:05                           offload        1 day, 03:38:19
100       br0       vni100       00:02:00:00:00:06                           offload        1 day, 03:38:19
100       br0       vni100       00:02:00:00:00:09                           offload        1 day, 03:38:20
200       br0       br0          00:00:5e:00:01:01                permanent                 1 day, 03:38:42
200       br0       br0          00:01:00:00:11:00                permanent                 1 day, 03:38:43
200       br0       swp5         00:02:00:00:00:03                                          00:00:26
200       br0       swp6         00:02:00:00:00:04                                          00:00:26
200       br0       vni200       00:02:00:00:00:0b                           offload        1 day, 03:38:20
200       br0       vni200       00:02:00:00:00:0c                           offload        1 day, 03:38:20
200       br0       vni200       00:02:00:00:00:0f                           offload        1 day, 03:38:20
200       br0       vni200       00:02:00:00:00:07                           offload        1 day, 03:38:19
200       br0       vni200       00:02:00:00:00:08                           offload        1 day, 03:38:19
200       br0       vni200       00:02:00:00:00:10                           offload        1 day, 03:38:20
4001      br0       br0          00:01:00:00:11:00                permanent                 1 day, 03:38:42
4001      br0       vni4001      00:01:00:00:12:00                           offload        1 day, 03:38:19
4001      br0       vni4001      00:01:00:00:13:00                           offload        1 day, 03:38:20
4001      br0       vni4001      00:01:00:00:14:00                           offload        1 day, 03:38:20
untagged            br0          00:00:5e:00:01:01                permanent  self           never
untagged            vlan100      00:00:5e:00:01:01                permanent  self           never
untagged            vlan200      00:00:5e:00:01:01                permanent  self           never
...</code></pre></div>
<h3 id="display-evpn-address-family-peers">Display EVPN address-family Peers</h3>

<p>You can see the BGP peers participating in the layer 2 VPN/EVPN
address-family and their states using
the <code>net show bgp l2vpn evpn summary </code>command. The following sample
output from a leaf switch shows eBGP peering with two spine switches for
exchanging EVPN routes; both peering sessions are in
the *established* state.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp l2vpn evpn summary
BGP router identifier 10.0.0.1, local AS number 65001 vrf-id 0
BGP table version 0
RIB entries 15, using 2280 bytes of memory
Peers 2, using 39 KiB of memory
Peer groups 1, using 64 bytes of memory
Neighbor        V         AS MsgRcvd MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd
s1(swp1)        4      65100     103     107        0    0    0 1d02h08m           30
s2(swp2)        4      65100     103     107        0    0    0 1d02h08m           30
Total number of neighbors 2
cumulus@leaf01:~$</code></pre></div>
<h3 id="display-vnis-in-evpn">Display VNIs in EVPN</h3>

<p>Run the <code>show bgp l2vpn evpn vni</code> command to display the configured VNIs
on a network device participating in BGP EVPN. This command is only
relevant on a VTEP. If symmetric routing is configured, this command
displays the special layer 3 VNIs that are configured per tenant VRF.</p>

<p>The following example from a leaf switch shows two layer 2 VNIs — 10100
and 10200 — as well as a layer 3 VNI — 104001. For layer 2 VNIs, the
number of associated MAC and neighbor entries are shown. The VXLAN
interface and VRF corresponding to each VNI are also shown.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn vni
VNI        Type VxLAN IF              # MACs   # ARPs   # Remote VTEPs  Tenant VRF                           
10200      L2   vni200              8        12       3               vrf1                                 
10100      L2   vni100              8        12       3               vrf1                                 
104001     L3   vni4001             3        3        n/a             vrf1                                 
cumulus@leaf01:~$</code></pre></div>
<p>You can examine the EVPN information for a specific VNI in detail. The
following output shows details for the layer 2 VNI 10100 as well as for
the layer 3 VNI 104001. For the layer 2 VNI, the remote VTEPs which have
that VNI are shown. For the layer 3 VNI, the router MAC and associated
layer 2 VNIs are shown. The state of the layer 3 VNI depends on the
state of its associated VRF as well as the states of its underlying
VXLAN interface and SVI.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn vni 10100
VNI: 10100
 Type: L2
 Tenant VRF: vrf1
 VxLAN interface: vni100
 VxLAN ifIndex: 9
 Local VTEP IP: 10.0.0.1
 Remote VTEPs for this VNI:
  10.0.0.2
  10.0.0.4
  10.0.0.3
 Number of MACs (local and remote) known for this VNI: 8
 Number of ARPs (IPv4 and IPv6, local and remote) known for this VNI: 12
 Advertise-gw-macip: No
cumulus@leaf01:~$ 
cumulus@leaf01:~$ net show evpn vni 104001
VNI: 104001
  Type: L3
  Tenant VRF: vrf1
  Local Vtep Ip: 10.0.0.1
  Vxlan-Intf: vni4001
  SVI-If: vlan4001
  State: Up
  Router MAC: 00:01:00:00:11:00
  L2 VNIs: 10100 10200 
cumulus@leaf01:~$</code></pre></div>
<h3 id="examine-local-and-remote-mac-addresses-for-a-vni-in-evpn">Examine Local and Remote MAC Addresses for a VNI in EVPN</h3>

<p>Run <code>net show evpn mac vni &lt;vni&gt;</code> to examine all local and remote MAC
addresses for a VNI. This command is only relevant for a layer 2 VNI:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn mac vni 10100
Number of MACs (local and remote) known for this VNI: 8
MAC               Type   Intf/Remote VTEP      VLAN 
00:02:00:00:00:0e remote 10.0.0.4            
00:02:00:00:00:06 remote 10.0.0.2            
00:02:00:00:00:05 remote 10.0.0.2            
00:02:00:00:00:02 local  swp4                  100  
00:00:5e:00:01:01 local  vlan100-v0            100  
00:02:00:00:00:09 remote 10.0.0.3            
00:01:00:00:11:00 local  vlan100               100  
00:02:00:00:00:01 local  swp3                  100  
00:02:00:00:00:0a remote 10.0.0.3            
00:02:00:00:00:0d remote 10.0.0.4            
cumulus@leaf01:~$</code></pre></div>
<p>Run the <code>net show evpn mac vni all</code> command to examine MAC addresses for
all VNIs.</p>

<p>You can examine the details for a specific MAC addresse or query all
remote MAC addresses behind a specific VTEP:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn mac vni 10100 mac 00:02:00:00:00:02
MAC: 00:02:00:00:00:02
 Intf: swp4(6) VLAN: 100
 Local Seq: 0 Remote Seq: 0
 Neighbors:
    172.16.120.12 Active
cumulus@leaf01:~$ net show evpn mac vni 10100 mac 00:02:00:00:00:05
MAC: 00:02:00:00:00:05
 Remote VTEP: 10.0.0.2
 Neighbors:
    172.16.120.21 
cumulus@leaf01:~$ net show evpn mac vni 10100 vtep 10.0.0.3
VNI 10100
MAC               Type   Intf/Remote VTEP      VLAN 
00:02:00:00:00:09 remote 10.0.0.3            
00:02:00:00:00:0a remote 10.0.0.3            
cumulus@leaf01:~$</code></pre></div>
<h3 id="examine-local-and-remote-neighbors-for-a-vni-in-evpn">Examine Local and Remote Neighbors for a VNI in EVPN</h3>

<p>Run the <code>net show evpn arp-cache vni &lt;vni&gt;</code> command to examine all local
and remote neighbors (ARP entries) for a VNI. This command is only
relevant for a layer 2 VNI and the output shows both IPv4 and IPv6
neighbor entries:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn arp-cache vni 10100
Number of ARPs (local and remote) known for this VNI: 12
IP                      Type   MAC               Remote VTEP          
172.16.120.11           local  00:02:00:00:00:01
172.16.120.12           local  00:02:00:00:00:02
172.16.120.22           remote 00:02:00:00:00:06 10.0.0.2            
fe80::201:ff:fe00:1100  local  00:01:00:00:11:00
172.16.120.1            local  00:01:00:00:11:00
172.16.120.31           remote 00:02:00:00:00:09 10.0.0.3            
fe80::200:5eff:fe00:101 local  00:00:5e:00:01:01
...</code></pre></div>
<p>Run the net show evpn arp-cache vni all command to examine neighbor
entries for all VNIs.</p>

<h3 id="examine-remote-router-macs-in-evpn">Examine Remote Router MACs in EVPN</h3>

<p>When symmetric routing is deployed, run
the <code>net show evpn rmac vni &lt;vni&gt; </code>command to examine the router MACs
corresponding to all remote VTEPs. This command is only relevant for a
layer 3 VNI:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn rmac vni 104001
Number of Remote RMACs known for this VNI: 3
MAC               Remote VTEP          
00:01:00:00:14:00 10.0.0.4            
00:01:00:00:12:00 10.0.0.2            
00:01:00:00:13:00 10.0.0.3            
cumulus@leaf01:~$</code></pre></div>
<p>Run the  <code>net show evpn rmac vni all </code>command to examine router MACs for
all layer 3 VNIs.</p>

<h3 id="examine-gateway-next-hops-in-evpn">Examine Gateway Next Hops in EVPN</h3>

<p>When symmetric routing is deployed, you can run
the <code>net show evpn next-hops vni &lt;vni&gt;</code> command to examine the gateway
next hops. This command is only relevant for a layer 3 VNI. In general,
the gateway next hop IP addresses correspond to the remote VTEP IP
addresses. Remote host and prefix routes are installed using these next
hops:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn next-hops vni 104001
Number of NH Neighbors known for this VNI: 3
IP              RMAC             
10.0.0.3       00:01:00:00:13:00
10.0.0.4       00:01:00:00:14:00
10.0.0.2       00:01:00:00:12:00
cumulus@leaf01:~$</code></pre></div>
<p>Run the net show evpn next-hops vni all command to examine gateway next
hops for all layer 3 VNIs.  </p>

<p>You can query a specific next hop; the output displays the remote host
and prefix routes through this next hop:</p>

<p> </p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show evpn next-hops vni 104001 ip 10.0.0.4
Ip: 10.0.0.4
  RMAC: 00:01:00:00:14:00
  Refcount: 4
  Prefixes:
    172.16.120.41/32
    172.16.120.42/32
    172.16.130.43/32
    172.16.130.44/32
cumulus@leaf01:~$</code></pre></div>
<h3 id="display-the-vrf-routing-table-in-frr">Display the VRF Routing Table in FRR</h3>

<p>Run the  <code>net show route vrf &lt;vrf-name&gt;</code> comand to examine the VRF
routing table. This command is not specific to EVPN. In the context of
EVPN, this command is relevant when symmetric routing is deployed and
can be used to verify that remote host and prefix routes are installed
in the VRF routing table and point to the appropriate gateway next hop.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show route vrf vrf1
show ip route vrf vrf1 
=======================
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel,
       &gt; - selected route, * - FIB route

VRF vrf1:
K * 0.0.0.0/0 [255/8192] unreachable (ICMP unreachable), 1d02h42m
C * 172.16.120.0/24 is directly connected, vlan100-v0, 1d02h42m
C&gt;* 172.16.120.0/24 is directly connected, vlan100, 1d02h42m
B&gt;* 172.16.120.21/32 [20/0] via 10.0.0.2, vlan4001 onlink, 1d02h41m
B&gt;* 172.16.120.22/32 [20/0] via 10.0.0.2, vlan4001 onlink, 1d02h41m
B&gt;* 172.16.120.31/32 [20/0] via 10.0.0.3, vlan4001 onlink, 1d02h41m
B&gt;* 172.16.120.32/32 [20/0] via 10.0.0.3, vlan4001 onlink, 1d02h41m
B&gt;* 172.16.120.41/32 [20/0] via 10.0.0.4, vlan4001 onlink, 1d02h41m
...</code></pre></div>
<p>In the output above, the next hops for these routes are specified by
EVPN to be <em>onlink</em>, or reachable over the specified SVI. This is
necessary because this interface is not required to have an IP address.
Even if the interface is configured with an IP address, the next hop is
not on the same subnet as it is usually the IP address of the remote
VTEP (part of the underlay IP network).</p>

<h3 id="display-the-global-bgp-evpn-routing-table">Display the Global BGP EVPN Routing Table</h3>

<p>Run the <code>net show bgp l2vpn evpn route</code> command to display all EVPN
routes, both local and remote. The routes displayed here are based on RD
as they are across VNIs and VRFs:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp l2vpn evpn route 
BGP table version is 0, local router ID is 10.0.0.1
Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal
Origin codes: i - IGP, e - EGP, ? - incomplete
EVPN type-2 prefix: [2]:[ESI]:[EthTag]:[MAClen]:[MAC]
EVPN type-3 prefix: [3]:[EthTag]:[IPlen]:[OrigIP]
   Network          Next Hop            Metric LocPrf Weight Path
Route Distinguisher: 10.0.0.1:1
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]:[32]:[172.16.120.11]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]:[128]:[2001:172:16:120::11]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]:[32]:[172.16.120.12]
                    10.0.0.1                          32768 i
*&gt; [3]:[0]:[32]:[10.0.0.1]
                    10.0.0.1                          32768 i
Route Distinguisher: 10.0.0.1:2
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:01]:[32]:[172.16.130.11]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:02]:[32]:[172.16.130.12]
                    10.0.0.1                          32768 i
*&gt; [3]:[0]:[32]:[10.0.0.1]
                    10.0.0.1                          32768 i
...</code></pre></div>
<p>You can filter the routing table based on EVPN route type. The available
options are shown below:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp l2vpn evpn route type 
    macip      :  MAC-IP (Type-2) route
    multicast  :  Multicast
    prefix     :  An IPv4 or IPv6 prefix
cumulus@leaf01:~$</code></pre></div>
<h3 id="display-a-specific-evpn-route">Display a Specific EVPN Route</h3>

<p>To drill down on a specific route for more information, run
the <code>net show bgp l2vpn evpn route rd &lt;rd-value&gt;</code> command. This command
displays all EVPN routes with that RD and with the path attribute
details for each path. Additional filtering is possible based on route
type or by specifying the MAC and/or IP address. The following example
shows a specific MAC/IP route. The output shows that this remote host is
behind VTEP 10.0.0.4 and is reachable through two paths; one through
either spine switch. This example is from a symmetric routing
deployment, so the route shows both the layer 2 VNI (10200) and the
layer 3 VNI (104001) as well as the EVPN route target attributes
corresponding to each and the associated router MAC address.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp l2vpn evpn route rd 10.0.0.4:3 mac 00:02:00:00:00:10 ip 172.16.130.44
BGP routing table entry for 10.0.0.4:3:[2]:[0]:[0]:[48]:[00:02:00:00:00:10]:[32]:[172.16.130.44]
Paths: (2 available, best #2)
  Advertised to non peer-group peers:
  s1(swp1) s2(swp2)
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:10]:[32]:[172.16.130.44] VNI 10200/104001
  65100 65004
    10.0.0.4 from s2(swp2) (172.16.110.2)
      Origin IGP, localpref 100, valid, external
      Extended Community: RT:65004:10200 RT:65004:104001 ET:8 Rmac:00:01:00:00:14:00
      AddPath ID: RX 0, TX 97
      Last update: Sun Dec 17 20:57:24 2017
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:10]:[32]:[172.16.130.44] VNI 10200/104001
  65100 65004
    10.0.0.4 from s1(swp1) (172.16.110.1)
      Origin IGP, localpref 100, valid, external, bestpath-from-AS 65100, best
      Extended Community: RT:65004:10200 RT:65004:104001 ET:8 Rmac:00:01:00:00:14:00
      AddPath ID: RX 0, TX 71
      Last update: Sun Dec 17 20:57:23 2017

Displayed 2 paths for requested prefix
cumulus@leaf01:~$</code></pre></div>
<ul>
<li>Only global VNIs are supported. Even though VNI values are exchanged
in the type-2 and type-5 routes, the received values are not used
when installing the routes into the forwarding plane; the local
configuration is used. You must ensure that the VLAN to VNI mappings
and the layer 3 VNI assignment for a tenant VRF are uniform
throughout the network. </li>
<li>If the remote host is dual attached, the next hop for the EVPN route
is the anycast IP address of the remote
<a href="Multi-Chassis_Link_Aggregation_-_MLAG">MLAG</a> pair, when MLAG is
active.</li>
</ul>

<p>The following example shows a prefix (type-5) route. Such a route has
only the layer 3 VNI and the route target corresponding to this VNI.
This route is learned through two paths, one through each spine switch.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp l2vpn evpn route rd 172.16.100.2:3 type prefix
EVPN type-2 prefix: [2]:[ESI]:[EthTag]:[MAClen]:[MAC]
EVPN type-3 prefix: [3]:[EthTag]:[IPlen]:[OrigIP]
EVPN type-5 prefix: [5]:[EthTag]:[IPlen]:[IP]
BGP routing table entry for 172.16.100.2:3:[5]:[0]:[30]:[172.16.100.0]
Paths: (2 available, best #2)
  Advertised to non peer-group peers:
  s1(swp1) s2(swp2)
  Route [5]:[0]:[30]:[172.16.100.0] VNI 104001
  65100 65050
    10.0.0.5 from s2(swp2) (172.16.110.2)
      Origin incomplete, localpref 100, valid, external
      Extended Community: RT:65050:104001 ET:8 Rmac:00:01:00:00:01:00
      AddPath ID: RX 0, TX 112
      Last update: Tue Dec 19 00:12:18 2017
  Route [5]:[0]:[30]:[172.16.100.0] VNI 104001
  65100 65050
    10.0.0.5 from s1(swp1) (172.16.110.1)
      Origin incomplete, localpref 100, valid, external, bestpath-from-AS 65100, best
      Extended Community: RT:65050:104001 ET:8 Rmac:00:01:00:00:01:00
      AddPath ID: RX 0, TX 71
      Last update: Tue Dec 19 00:12:17 2017

Displayed 1 prefixes (2 paths) with this RD (of requested type)
cumulus@leaf01:~$</code></pre></div>
<h3 id="display-the-per-vni-evpn-routing-table">Display the per-VNI EVPN Routing Table</h3>

<p>Received EVPN routes are maintained in the global EVPN routing table
(described above), even if there are no appropriate local VNIs
to <strong>import</strong> them into. For example, a spine switch maintains the
global EVPN routing table even though there are no VNIs present on it.
When local VNIs are present, received EVPN routes are imported into the
per-VNI routing tables based on the route target attributes. You can
examine the per-VNI routing table with
the <code>net show bgp l2vpn evpn route vni &lt;vni&gt;</code> command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp l2vpn evpn route vni 10110
BGP table version is 8, local router ID is 10.0.0.1
Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal
Origin codes: i - IGP, e - EGP, ? - incomplete
EVPN type-2 prefix: [2]:[ESI]:[EthTag]:[MAClen]:[MAC]:[IPlen]:[IP]
EVPN type-3 prefix: [3]:[EthTag]:[IPlen]:[OrigIP]
   Network          Next Hop            Metric LocPrf Weight Path
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:07]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:07]:[32]:[172.16.120.11]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:07]:[128]:[fe80::202:ff:fe00:7]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:08]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:08]:[32]:[172.16.120.12]
                    10.0.0.1                          32768 i
*&gt; [2]:[0]:[0]:[48]:[00:02:00:00:00:08]:[128]:[fe80::202:ff:fe00:8]
                    10.0.0.1                          32768 i
*&gt; [3]:[0]:[32]:[10.0.0.1]
                    10.0.0.1                          32768 i
Displayed 7 prefixes (7 paths)
cumulus@leaf01:~$</code></pre></div>
<p>To display the VNI routing table for all VNIs, run
the <code>net show bgp l2vpn evpn route vni all</code> command.</p>

<h3 id="display-the-per-vrf-bgp-routing-table">Display the per-VRF BGP Routing Table</h3>

<p>When symmetric routing is deployed, received type-2 and type-5 routes
are imported into the VRF routing table (against the corresponding
address-family: IPv4 unicast or IPv6 unicast) based on a match on the
route target attributes. You can examine BGP&rsquo;s VRF routing table using
the <code>net show bgp vrf &lt;vrf-name&gt; ipv4 unicast</code> command or
the <code>net show bgp vrf &lt;vrf-name&gt; ipv6 unicast</code> command.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@leaf01:~$ net show bgp vrf vrf1 ipv4 unicast 
BGP table version is 8, local router ID is 172.16.120.250
Status codes: s suppressed, d damped, h history, * valid, &gt; best, = multipath,
              i internal, r RIB-failure, S Stale, R Removed
Origin codes: i - IGP, e - EGP, ? - incomplete
   Network          Next Hop            Metric LocPrf Weight Path
*  172.16.120.21/32     10.0.0.2                              0 65100 65002 i
*&gt;                  10.0.0.2                              0 65100 65002 i
*  172.16.120.22/32     10.0.0.2                              0 65100 65002 i
*&gt;                  10.0.0.2                              0 65100 65002 i
*  172.16.120.31/32     10.0.0.3                              0 65100 65003 i
*&gt;                  10.0.0.3                              0 65100 65003 i
*  172.16.120.32/32     10.0.0.3                              0 65100 65003 i
*&gt;                  10.0.0.3                              0 65100 65003 i
*  172.16.120.41/32     10.0.0.4                              0 65100 65004 i
*&gt;                  10.0.0.4                              0 65100 65004 i
*  172.16.120.42/32     10.0.0.4                              0 65100 65004 i
*&gt;                  10.0.0.4                              0 65100 65004 i
*  172.16.100.0/24     10.0.0.5                              0 65100 65050 ?
*&gt;                  10.0.0.5                              0 65100 65050 ?
*  172.16.100.0/24     10.0.0.6                              0 65100 65050 ?
*&gt;                  10.0.0.6                              0 65100 65050 ?
Displayed  8 routes and 16 total paths
cumulus@leaf01:~$</code></pre></div>
<h3 id="examine-mac-moves">Examine MAC Moves</h3>

<p>The first time a MAC moves from behind one VTEP to behind another, BGP
associates a MAC Mobility (MM) extended community attribute of sequence
number 1, with the type-2 route for that MAC. From there, each time this
MAC moves to a new VTEP, the MM sequence number increments by 1. You can
examine the MM sequence number associated with a MAC&rsquo;s type-2 route with
the  <code>net show bgp l2vpn evpn route vni &lt;vni&gt; mac &lt;mac&gt;</code> command. The
sample output below shows the type-2 route for a MAC that has moved
three times:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show bgp l2vpn evpn route vni 10109 mac 00:02:22:22:22:02
BGP routing table entry for [2]:[0]:[0]:[48]:[00:02:22:22:22:02]
Paths: (1 available, best #1)
Not advertised to any peer
Route [2]:[0]:[0]:[48]:[00:02:22:22:22:02] VNI 10109
Local
6.0.0.184 from 0.0.0.0 (6.0.0.184)
Origin IGP, localpref 100, weight 32768, valid, sourced, local, bestpath-from-AS Local, best
Extended Community: RT:650184:10109 ET:8 MM:3
AddPath ID: RX 0, TX 10350121
Last update: Tue Feb 14 18:40:37 2017

Displayed 1 paths for requested prefix</code></pre></div>
<h3 id="examine-sticky-mac-addresses">Examine Sticky MAC Addresses</h3>

<p>You can identify static or <em>sticky</em> MACs in EVPN by the presence
of <code>MM:0, sticky MAC</code> in the Extended Community line of the output
from <code>net show bgp l2vpn evpn route vni &lt;vni&gt; mac &lt;mac&gt;:</code></p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">cumulus@switch:~$ net show bgp l2vpn evpn route vni 10101 mac 00:02:00:00:00:01
BGP routing table entry for [2]:[0]:[0]:[48]:[00:02:00:00:00:01]
Paths: (1 available, best #1)
  Not advertised to any peer
  Route [2]:[0]:[0]:[48]:[00:02:00:00:00:01] VNI 10101
  Local
    172.16.130.18 from 0.0.0.0 (172.16.130.18)
      Origin IGP, localpref 100, weight 32768, valid, sourced, local, bestpath-from-AS Local, best
      Extended Community: ET:8 RT:60176:10101 MM:0, sticky MAC
      AddPath ID: RX 0, TX 46
      Last update: Tue Apr 11 21:44:02 2017

Displayed 1 paths for requested prefix</code></pre></div>
<h2 id="troubleshooting">Troubleshooting</h2>

<p>To troubleshoot EVPN, enable FRR debug logs. The relevant debug options
are as follows:</p>

<ul>
<li><code>debug zebra vxlan</code> traces VNI addition and deletion (local and
remote) as well as MAC and neighbor addition and deletion (local and
remote).</li>
<li><code>debug zebra kernel</code> traces actual netlink messages exchanged with
the kernel, which includes everything, not just EVPN.</li>
<li><code>debug bgp updates</code> traces BGP update exchanges, including all
updates. Output is extended to show EVPN specific information.</li>
<li><code>debug bgp zebra</code> traces interactions between BGP and zebra for EVPN
(and other) routes.</li>
</ul>

<h2 id="caveats">Caveats</h2>

<p>The following caveats apply to EVPN in this version of Cumulus Linux:</p>

<ul>
<li><p>When EVPN is enabled on a switch (VTEP), all locally defined VNIs on
that switch and other information (such as MAC addresses) pertaining
to them are advertised to EVPN peers. There is no provision to only
announce certain VNIs.</p></li>

<li><p>In a <a href="LNV_VXLAN_Active-Active_Mode">VXLAN
active-active</a> configuration, ARPs are
sometimes <em>not</em> suppressed even if ARP suppression is enabled. This
is because the neighbor entries are not synchronized  between the
two switches operating in active-active mode by a control plane.
This has no impact on forwarding.</p></li>

<li><p>You must configure the overlay (tenants) in a specific VRF(s) and
separate from the underlay, which resides in the default VRF. A
layer 3 VNI mapping for the default VRF is not supported.</p></li>

<li><p>On the Broadcom Trident II+, Trident 3, and Maverick-based switch,
when a lookup is done after VXLAN decapsulation on the
external-facing switch (exit/border leaf), the switch does not
rewrite the MAC addresses or TTL; for through traffic, packets are
dropped by the next hop instead of correctly routing from a VXLAN
overlay network into a non-VXLAN external network (such as the
Internet). This applies to all forms of VXLAN routing (centralized,
asymmetric and symmetric) and affects all traffic from VXLAN overlay
hosts that need to be routed after VXLAN decapsulation on an
exit/border leaf, including traffic destined to external networks
(through traffic) and traffic destined to the exit leaf SVI address.</p>

<p>To work around this issue, modify the external-facing interface for
each VLAN sub-interface on the exit leaf by creating a temporary VNI
and associating it with the existing VLAN ID.</p>

<p>For example, if the expected interface configuration is:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto swp3.2001
iface swp3.2001
    vrf vrf1
    address 10.0.0.2/24
# where swp3 is the external facing port and swp3.2001 is the VLAN sub-interface

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge ports vx-4001
    bridge-vids 4001

auto vx-4001
iface vx-4001
    vxlan-id 4001
    &lt;... usual vxlan config ...&gt;
    bridge-access 4001
# where vnid 4001 represents the L3 VNI

auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1</code></pre></div>
<p>Modify the configuration as follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">auto swp3
iface swp3
    bridge-access 2001
# associate the port (swp3) with bridge 2001

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge ports swp3 vx-4001 vx-16000000
    bridge-vids 2001
# where vx-4001 is the existing VNI and vx-16000000 is a new temporary VNI
# this is now bridging the port (swp3), the VNI (vx-4001),
# and the new temporary VNI (vx-16000000)
# the bridge VLAN ID is now 2001

auto vlan2001
iface vlan2001
    vlan-id 2001
    vrf vrf1
    address 10.0.0.2/24
    vlan-raw-device bridge
# create a VLAN 2001 with the associated VRF and IP address

auto vx-16000000
iface vx-16000000
    vxlan-id 16000000
    bridge-access 2001
    &lt;... usual vxlan config ...&gt;
# associate the temporary VNI (vx-16000000) with bridge 2001

auto vx-4001
iface vx-4001
    vxlan-id 4001
    &lt;... usual vxlan config ...&gt;
    bridge-access 4001
# where vnid 4001 represents the L3 VNI

auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1</code></pre></div>
<p>If an MLAG pair is used instead of a single exit/border leaf, add
the same temporary VNIs on both switches of the MLAG pair.</p></li>
</ul>

<h2 id="example-configurations">Example Configurations</h2>

<ul>
<li>Basic Clos (4x2) for bridging</li>
<li>Clos with MLAG and centralized routing</li>
<li>Clos with MLAG and asymmetric routing</li>
<li>Basic Clos with symmetric routing and exit leafs</li>
</ul>

<h3 id="basic-clos-4x2-for-bridging">Basic Clos (4x2) for Bridging</h3>

<p>The following example configuration shows a basic Clos topology for
bridging.</p>

<p><img src="attachments/8362732/8362735.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<h4 id="leaf01-and-leaf02-configurations">leaf01 and leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-414969498" class="expand-container">
<div id="expander-control-414969498" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/network/interfaces
</div>
<div id="expander-content-414969498" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.7/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.7

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  920 
auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.9/30
    mtu 9202
    clagd-priority 4096
    clagd-sys-mac 44:38:39:ff:ff:01
    clagd-peer-ip 169.254.0.10
    # post-up sysctl -w net.ipv4.conf.peerlink-3/4094.accept_local=1
    clagd-backup-ip 10.0.0.8

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152 
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152 
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto VxLanA-1
iface VxLanA-1
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1001
    bridge-pvid 1

auto vlan1
iface vlan1
    vlan-id 1
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1000
iface vlan1000
    vlan-id 1000
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1001
iface vlan1001
    vlan-id 1001
    vlan-raw-device VxLanA-1
    ip-forward off</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-2111962651" class="expand-container">
<div id="expander-control-2111962651" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/network/interfaces
</div>
<div id="expander-content-2111962651" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/network/interfaces 
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.8/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.7

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202
auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.10/30
    mtu 9202
    clagd-priority 8192
    clagd-sys-mac 44:38:39:ff:ff:01
    clagd-peer-ip 169.254.0.9
    # post-up sysctl -w net.ipv4.conf.peerlink-3/4094.accept_local=1
    clagd-backup-ip 10.0.0.7

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto VxLanA-1
iface VxLanA-1
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1001
    bridge-pvid 1

auto vlan1
iface vlan1
    vlan-id 1
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1000
iface vlan1000
    vlan-id 1000
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1001
iface vlan1001
    vlan-id 1001
    vlan-raw-device VxLanA-1
    ip-forward off</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1749872716" class="expand-container">
<div id="expander-control-1749872716" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/frr/frr.conf
</div>
<div id="expander-content-1749872716" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/frr/frr.conf
 
log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65542
 bgp router-id 10.0.0.7
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-1766394915" class="expand-container">
<div id="expander-control-1766394915" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/frr/frr.conf
</div>
<div id="expander-content-1766394915" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/frr/frr.conf
 
log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65543
 bgp router-id 10.0.0.8
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="leaf03-and-leaf04-configurations">leaf03 and leaf04 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1260619717" class="expand-container">
<div id="expander-control-1260619717" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/network/interfaces
</div>
<div id="expander-content-1260619717" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.9/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.9

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202
auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.9/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 4096
    clagd-sys-mac 44:38:39:ff:ff:02
    clagd-peer-ip 169.254.0.10
    # post-up sysctl -w net.ipv4.conf.peerlink-3/4094.accept_local=1
    clagd-backup-ip 10.0.0.10

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto VxLanA-1
iface VxLanA-1
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1001
    bridge-pvid 1

auto vlan1
iface vlan1
    vlan-id 1
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1000
iface vlan1000
    vlan-id 1000
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1001
iface vlan1001
    vlan-id 1001
    vlan-raw-device VxLanA-1
    ip-forward off</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-750827821" class="expand-container">
<div id="expander-control-750827821" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/network/interfaces
</div>
<div id="expander-content-750827821" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/network/interfaces 

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.10/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.9

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202
auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.10/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 8192
    clagd-sys-mac 44:38:39:ff:ff:02
    clagd-peer-ip 169.254.0.9
    # post-up sysctl -w net.ipv4.conf.peerlink-3/4094.accept_local=1
    clagd-backup-ip 10.0.0.9

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto VxLanA-1
iface VxLanA-1
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1001
    bridge-pvid 1

auto vlan1
iface vlan1
    vlan-id 1
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1000
iface vlan1000
    vlan-id 1000
    vlan-raw-device VxLanA-1
    ip-forward off

auto vlan1001
iface vlan1001
    vlan-id 1001
    vlan-raw-device VxLanA-1
    ip-forward off</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1713380390" class="expand-container">
<div id="expander-control-1713380390" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/frr/frr.conf
</div>
<div id="expander-content-1713380390" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/frr/frr.conf

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65544
 bgp router-id 10.0.0.9
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-2078795090" class="expand-container">
<div id="expander-control-2078795090" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/frr/frr.conf
</div>
<div id="expander-content-2078795090" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/frr/frr.conf

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65545
 bgp router-id 10.0.0.10
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="spine01-and-spine02-configurations">spine01 and spine02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1329497546" class="expand-container">
<div id="expander-control-1329497546" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/network/interfaces
</div>
<div id="expander-content-1329497546" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.5/32
    alias BGP un-numbered Use for Vxlan Src Tunnel

auto downlink-1
iface downlink-1
    bond-slaves swp1 swp2
    mtu  9202

auto downlink-2
iface downlink-2
    bond-slaves swp3 swp4
    mtu  9202

auto downlink-3
iface downlink-3
    bond-slaves swp5 swp6
    mtu  9202
auto downlink-4
iface downlink-4
    bond-slaves swp7 swp8
    mtu  9202</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-1933178240" class="expand-container">
<div id="expander-control-1933178240" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/network/interfaces
</div>
<div id="expander-content-1933178240" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)
 
# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.6/32
    alias BGP un-numbered Use for Vxlan Src Tunnel

auto downlink-1
iface downlink-1
    bond-slaves swp1 swp2
    mtu  9202

auto downlink-2
iface downlink-2
    bond-slaves swp3 swp4
    mtu  9202

auto downlink-3
iface downlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto downlink-4
iface downlink-4
    bond-slaves swp7 swp8
    mtu  9202</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1210373036" class="expand-container">
<div id="expander-control-1210373036" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/frr/frr.conf
</div>
<div id="expander-content-1210373036" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/frr/frr.conf
 
log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface downlink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 64435
 bgp router-id 10.0.0.5
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor downlink-1 interface v6only remote-as external
 neighbor downlink-2 interface v6only remote-as external
 neighbor downlink-3 interface v6only remote-as external
 neighbor downlink-4 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor downlink-1 allowas-in origin
  neighbor downlink-2 allowas-in origin
  neighbor downlink-3 allowas-in origin
  neighbor downlink-4 allowas-in origin
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-655212914" class="expand-container">
<div id="expander-control-655212914" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/frr/frr.conf
</div>
<div id="expander-content-655212914" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/frr/frr.conf

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface downlink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 64435
 bgp router-id 10.0.0.6
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor downlink-1 interface v6only remote-as external
 neighbor downlink-2 interface v6only remote-as external
 neighbor downlink-3 interface v6only remote-as external
 neighbor downlink-4 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor downlink-1 allowas-in origin
  neighbor downlink-2 allowas-in origin
  neighbor downlink-3 allowas-in origin
  neighbor downlink-4 allowas-in origin
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="clos-configuration-with-mlag-and-centralized-routing">Clos Configuration with MLAG and Centralized Routing</h3>

<p>The following example configuration shows a basic Clos topology with
centralized routing. MLAG is configured between leaf switches.</p>

<p><img src="attachments/8362732/8362734.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<h4 id="leaf01-and-leaf02-configurations-1">leaf01 and leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-247483064" class="expand-container">
<div id="expander-control-247483064" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/network/interfaces
</div>
<div id="expander-content-247483064" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.7/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.7

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202
 
auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202
 
auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202
 
auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.9/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 4096
    clagd-sys-mac 44:38:39:ff:ff:01
    clagd-peer-ip 169.254.0.10
    clagd-backup-ip 10.0.0.8

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    address 45.0.0.2/24
    address 2001:fee1::2/64
    vlan-id 1000
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.0.1/24 2001:fee1::1/64
    vrf vrf1

auto vlan1001
iface vlan1001
    address 45.0.1.2/24
    address 2001:fee1:0:1::2/64
    vlan-id 1001
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.1.1/24 2001:fee1:0:1::1/64
    vrf vrf1

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    address 45.0.2.2/24
    address 2001:fee1:0:2::2/64
    vlan-id 1002
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.2.1/24 2001:fee1:0:2::1/64
    vrf vrf2

auto vlan1003
iface vlan1003
    address 45.0.3.2/24
    address 2001:fee1:0:3::2/64
    vlan-id 1003
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.3.1/24 2001:fee1:0:3::1/64
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-2025455875" class="expand-container">
<div id="expander-control-2025455875" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/network/interfaces
</div>
<div id="expander-content-2025455875" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.8/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.7

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.10/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 8192
    clagd-sys-mac 44:38:39:ff:ff:01
    clagd-peer-ip 169.254.0.9
    clagd-backup-ip 10.0.0.7

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    address 45.0.0.3/24
    address 2001:fee1::3/64
    vlan-id 1000
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.0.1/24 2001:fee1::1/64
    vrf vrf1

auto vlan1001
iface vlan1001
    address 45.0.1.3/24
    address 2001:fee1:0:1::3/64
    vlan-id 1001
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.1.1/24 2001:fee1:0:1::1/64
    vrf vrf1

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    address 45.0.2.3/24
    address 2001:fee1:0:2::3/64
    vlan-id 1002
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.2.1/24 2001:fee1:0:2::1/64
    vrf vrf2

auto vlan1003
iface vlan1003
    address 45.0.3.3/24
    address 2001:fee1:0:3::3/64
    vlan-id 1003
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.3.1/24 2001:fee1:0:3::1/64
    vrf vrf2 </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1984246579" class="expand-container">
<div id="expander-control-1984246579" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/frr/frr.conf
</div>
<div id="expander-content-1984246579" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65542
 bgp router-id 10.0.0.7
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-default-gw
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-1682120108" class="expand-container">
<div id="expander-control-1682120108" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/frr/frr.conf
</div>
<div id="expander-content-1682120108" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65543
 bgp router-id 10.0.0.8
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-default-gw
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="leaf03-and-leaf04-configurations-1">leaf03 and leaf04 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-442312026" class="expand-container">
<div id="expander-control-442312026" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/network/interfaces
</div>
<div id="expander-content-442312026" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.9/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.9

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.9/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 4096
    clagd-sys-mac 44:38:39:ff:ff:02
    clagd-peer-ip 169.254.0.10
    clagd-backup-ip 10.0.0.10

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    vlan-id 1000
    vlan-raw-device bridge
    ip-forward off

auto vlan1001
iface vlan1001
    vlan-id 1001
    vlan-raw-device bridge
    ip-forward off

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    vlan-id 1002
    vlan-raw-device bridge
    ip-forward off

auto vlan1003
iface vlan1003
    vlan-id 1003
    vlan-raw-device bridge
    ip-forward off </code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-135423584" class="expand-container">
<div id="expander-control-135423584" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/network/interfaces
</div>
<div id="expander-content-135423584" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.10/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.9

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.10/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 8192
    clagd-sys-mac 44:38:39:ff:ff:02
    clagd-peer-ip 169.254.0.9
    clagd-backup-ip 10.0.0.9

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    vlan-id 1000
    vlan-raw-device bridge
    ip-forward off

auto vlan1001
iface vlan1001
    vlan-id 1001
    vlan-raw-device bridge
    ip-forward off

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    vlan-id 1002
    vlan-raw-device bridge
    ip-forward off

auto vlan1003
iface vlan1003
    vlan-id 1003
    vlan-raw-device bridge
    ip-forward off </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1243129263" class="expand-container">
<div id="expander-control-1243129263" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/frr/frr.conf
</div>
<div id="expander-content-1243129263" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65544
 bgp router-id 10.0.0.9
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-418695898" class="expand-container">
<div id="expander-control-418695898" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/frr/frr.conf
</div>
<div id="expander-content-418695898" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65545
 bgp router-id 10.0.0.10
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="spine01-and-spine02-configurations-1">spine01 and spine02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1936983673" class="expand-container">
<div id="expander-control-1936983673" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/network/interfaces
</div>
<div id="expander-content-1936983673" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.5/32
    alias BGP un-numbered Use for Vxlan Src Tunnel

auto downlink-1
iface downlink-1
    bond-slaves swp1 swp2
    mtu  9202

auto downlink-2
iface downlink-2
    bond-slaves swp3 swp4
    mtu  9202

auto downlink-3
iface downlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto downlink-4
iface downlink-4
    bond-slaves swp7 swp8
    mtu  9202</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-2132761841" class="expand-container">
<div id="expander-control-2132761841" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/network/interfaces
</div>
<div id="expander-content-2132761841" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.6/32
    alias BGP un-numbered Use for Vxlan Src Tunnel

auto downlink-1
iface downlink-1
    bond-slaves swp1 swp2
    mtu  9202

auto downlink-2
iface downlink-2
    bond-slaves swp3 swp4
    mtu  9202

auto downlink-3
iface downlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto downlink-4
iface downlink-4
    bond-slaves swp7 swp8
    mtu  9202</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-671915127" class="expand-container">
<div id="expander-control-671915127" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/frr/frr.conf
</div>
<div id="expander-content-671915127" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface downlink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 64435
 bgp router-id 10.0.0.5
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor downlink-1 interface v6only remote-as external
 neighbor downlink-2 interface v6only remote-as external
 neighbor downlink-3 interface v6only remote-as external
 neighbor downlink-4 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor downlink-1 allowas-in origin
  neighbor downlink-2 allowas-in origin
  neighbor downlink-3 allowas-in origin
  neighbor downlink-4 allowas-in origin
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-391774066" class="expand-container">
<div id="expander-control-391774066" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/frr/frr.conf
</div>
<div id="expander-content-391774066" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface downlink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 64435
 bgp router-id 10.0.0.6
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor downlink-1 interface v6only remote-as external
 neighbor downlink-2 interface v6only remote-as external
 neighbor downlink-3 interface v6only remote-as external
 neighbor downlink-4 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor downlink-1 allowas-in origin
  neighbor downlink-2 allowas-in origin
  neighbor downlink-3 allowas-in origin
  neighbor downlink-4 allowas-in origin
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="clos-configuration-with-mlag-and-evpn-asymetric-routing">Clos Configuration with MLAG and EVPN Asymetric Routing</h3>

<p>The following example configuration is a basic Clos topology with EVPN
asymmetric routing. MLAG is configured between leaf switches.</p>

<p><img src="attachments/8362732/8362733.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<h4 id="leaf01-and-leaf02-configurations-2">leaf01 and leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1059224623" class="expand-container">
<div id="expander-control-1059224623" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/network/interfaces
</div>
<div id="expander-content-1059224623" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.7/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.7

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.9/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 4096
    clagd-sys-mac 44:38:39:ff:ff:01
    clagd-peer-ip 169.254.0.10
    clagd-backup-ip 10.0.0.8

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.7
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    address 45.0.0.2/24
    address 2001:fee1::2/64
    vlan-id 1000
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.0.1/24 2001:fee1::1/64
    vrf vrf1

auto vlan1001
iface vlan1001
    address 45.0.1.2/24
    address 2001:fee1:0:1::2/64
    vlan-id 1001
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.1.1/24 2001:fee1:0:1::1/64
    vrf vrf1

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    address 45.0.2.2/24
    address 2001:fee1:0:2::2/64
    vlan-id 1002
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.2.1/24 2001:fee1:0:2::1/64
    vrf vrf2

auto vlan1003
iface vlan1003
    address 45.0.3.2/24
    address 2001:fee1:0:3::2/64
    vlan-id 1003
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.3.1/24 2001:fee1:0:3::1/64
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-567590215" class="expand-container">
<div id="expander-control-567590215" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/network/interfaces
</div>
<div id="expander-content-567590215" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.8/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 172.16.100.7

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.10/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 8192
    clagd-sys-mac 44:38:39:ff:ff:01
    clagd-peer-ip 169.254.0.9
    clagd-backup-ip 10.0.0.7

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.8
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    address 45.0.0.3/24
    address 2001:fee1::3/64
    vlan-id 1000
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.0.1/24 2001:fee1::1/64
    vrf vrf1

auto vlan1001
iface vlan1001
    address 45.0.1.3/24
    address 2001:fee1:0:1::3/64
    vlan-id 1001
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.1.1/24 2001:fee1:0:1::1/64
    vrf vrf1

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    address 45.0.2.3/24
    address 2001:fee1:0:2::3/64
    vlan-id 1002
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.2.1/24 2001:fee1:0:2::1/64
    vrf vrf2

auto vlan1003
iface vlan1003
    address 45.0.3.3/24
    address 2001:fee1:0:3::3/64
    vlan-id 1003
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.3.1/24 2001:fee1:0:3::1/64
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1767116676" class="expand-container">
<div id="expander-control-1767116676" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/frr/frr.conf
</div>
<div id="expander-content-1767116676" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code> cumulus@leaf01:~$ cat /etc/frr/frr.conf
 
log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65542
 bgp router-id 10.0.0.7
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-78803511" class="expand-container">
<div id="expander-control-78803511" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/frr/frr.conf
</div>
<div id="expander-content-78803511" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/frr/frr.conf
 
log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65543
 bgp router-id 10.0.0.8
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="leaf03-and-leaf04-configurations-2">leaf03 and leaf04 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-2059663045" class="expand-container">
<div id="expander-control-2059663045" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/network/interfaces
</div>
<div id="expander-content-2059663045" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.9/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 36.0.0.9

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.9/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 4096
    clagd-sys-mac 44:38:39:ff:ff:02
    clagd-peer-ip 169.254.0.10
    clagd-backup-ip 10.0.0.10

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.9
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    address 45.0.0.2/24
    address 2001:fee1::2/64
    vlan-id 1000
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.0.1/24 2001:fee1::1/64
    vrf vrf1

auto vlan1001
iface vlan1001
    address 45.0.1.2/24
    address 2001:fee1:0:1::2/64
    vlan-id 1001
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.1.1/24 2001:fee1:0:1::1/64
    vrf vrf1

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    address 45.0.2.2/24
    address 2001:fee1:0:2::2/64
    vlan-id 1002
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.2.1/24 2001:fee1:0:2::1/64
    vrf vrf2

auto vlan1003
iface vlan1003
    address 45.0.3.2/24
    address 2001:fee1:0:3::2/64
    vlan-id 1003
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.3.1/24 2001:fee1:0:3::1/64
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-857440446" class="expand-container">
<div id="expander-control-857440446" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/network/interfaces
</div>
<div id="expander-content-857440446" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.10/32
    alias BGP un-numbered Use for Vxlan Src Tunnel
    clagd-vxlan-anycast-ip 36.0.0.9

auto uplink-1
iface uplink-1
    bond-slaves swp1 swp2
    mtu  9202

auto uplink-2
iface uplink-2
    bond-slaves swp3 swp4
    mtu  9202

auto peerlink-3
iface peerlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto peerlink-3.4094
iface peerlink-3.4094
    address 169.254.0.10/30
    mtu 9202
    alias clag and vxlan communication primary path
    clagd-priority 8192
    clagd-sys-mac 44:38:39:ff:ff:02
    clagd-peer-ip 169.254.0.9
    clagd-backup-ip 10.0.0.9

auto hostbond4
iface hostbond4
    bond-slaves swp7
    mtu  9152
    clag-id 1
    bridge-pvid 1000

auto hostbond5
iface hostbond5
    bond-slaves swp8
    mtu  9152
    clag-id 2
    bridge-pvid 1001

auto vx-101000
iface vx-101000
    vxlan-id 101000
    bridge-access 1000
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101001
iface vx-101001
    vxlan-id 101001
    bridge-access 1001
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101002
iface vx-101002
    vxlan-id 101002
    bridge-access 1002
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto vx-101003
iface vx-101003
    vxlan-id 101003
    bridge-access 1003
    vxlan-local-tunnelip 10.0.0.10
    bridge-learning off
    bridge-arp-nd-suppress on
    mstpctl-portbpdufilter yes
    mstpctl-bpduguard  yes
    mtu 9152

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports vx-101000 vx-101001 vx-101002 vx-101003 peerlink-3 hostbond4 hostbond5
    bridge-stp on
    bridge-vids 1000-1003
    bridge-pvid 1

auto vrf1
iface vrf1
    vrf-table auto

auto vlan1000
iface vlan1000
    address 45.0.0.3/24
    address 2001:fee1::3/64
    vlan-id 1000
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.0.1/24 2001:fee1::1/64
    vrf vrf1

auto vlan1001
iface vlan1001
    address 45.0.1.3/24
    address 2001:fee1:0:1::3/64
    vlan-id 1001
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.1.1/24 2001:fee1:0:1::1/64
    vrf vrf1

auto vrf2
iface vrf2
    vrf-table auto

auto vlan1002
iface vlan1002
    address 45.0.2.3/24
    address 2001:fee1:0:2::3/64
    vlan-id 1002
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.2.1/24 2001:fee1:0:2::1/64
    vrf vrf2

auto vlan1003
iface vlan1003
    address 45.0.3.3/24
    address 2001:fee1:0:3::3/64
    vlan-id 1003
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 45.0.3.1/24 2001:fee1:0:3::1/64
    vrf vrf2 </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-229557873" class="expand-container">
<div id="expander-control-229557873" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/frr/frr.conf
</div>
<div id="expander-content-229557873" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65544
 bgp router-id 10.0.0.9
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-617970788" class="expand-container">
<div id="expander-control-617970788" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/frr/frr.conf
</div>
<div id="expander-content-617970788" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface peerlink-3.4094
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface uplink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 65545
 bgp router-id 10.0.0.10
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor peerlink-3.4094 interface v6only remote-as external
 neighbor uplink-1 interface v6only remote-as external
 neighbor uplink-2 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor peerlink-3.4094 activate
  neighbor uplink-1 activate
  neighbor uplink-2 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor uplink-1 activate
  neighbor uplink-2 activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="spine01-and-spine02-configurations-2">spine01 and spine02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1761432738" class="expand-container">
<div id="expander-control-1761432738" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/network/interfaces
</div>
<div id="expander-content-1761432738" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.5/32
    alias BGP un-numbered Use for Vxlan Src Tunnel

auto downlink-1
iface downlink-1
    bond-slaves swp1 swp2
    mtu  9202

auto downlink-2
iface downlink-2
    bond-slaves swp3 swp4
    mtu  9202

auto downlink-3
iface downlink-3
    bond-slaves swp5 swp6
    mtu  9202
auto downlink-4
iface downlink-4
    bond-slaves swp7 swp8
    mtu  9202</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-973653715" class="expand-container">
<div id="expander-control-973653715" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/network/interfaces
</div>
<div id="expander-content-973653715" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5)

# The primary network interface
auto eth0
iface eth0 inet dhcp

# Include any platform-specific interface configuration
#source /etc/network/interfaces.d/*.if

auto lo
iface lo
    address 10.0.0.6/32
    alias BGP un-numbered Use for Vxlan Src Tunnel

auto downlink-1
iface downlink-1
    bond-slaves swp1 swp2
    mtu  9202

auto downlink-2
iface downlink-2
    bond-slaves swp3 swp4
    mtu  9202

auto downlink-3
iface downlink-3
    bond-slaves swp5 swp6
    mtu  9202

auto downlink-4
iface downlink-4
    bond-slaves swp7 swp8
    mtu  9202</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-490301360" class="expand-container">
<div id="expander-control-490301360" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/frr/frr.conf
</div>
<div id="expander-content-490301360" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/frr/frr.conf

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface downlink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 64435
 bgp router-id 10.0.0.5
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor downlink-1 interface v6only remote-as external
 neighbor downlink-2 interface v6only remote-as external
 neighbor downlink-3 interface v6only remote-as external
 neighbor downlink-4 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor downlink-1 allowas-in origin
  neighbor downlink-2 allowas-in origin
  neighbor downlink-3 allowas-in origin
  neighbor downlink-4 allowas-in origin
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
!
line vty
 exec-timeout 0 0
! </code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-824918953" class="expand-container">
<div id="expander-control-824918953" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/frr/frr.conf
</div>
<div id="expander-content-824918953" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/frr/frr.conf

log file /var/log/frr/bgpd.log
!
log timestamp precision 6
!
interface downlink-1
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-2
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-3
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
interface downlink-4
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
router bgp 64435
 bgp router-id 10.0.0.6
 coalesce-time 1000
 bgp bestpath as-path multipath-relax
 neighbor downlink-1 interface v6only remote-as external
 neighbor downlink-2 interface v6only remote-as external
 neighbor downlink-3 interface v6only remote-as external
 neighbor downlink-4 interface v6only remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
  neighbor downlink-1 allowas-in origin
  neighbor downlink-2 allowas-in origin
  neighbor downlink-3 allowas-in origin
  neighbor downlink-4 allowas-in origin
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor downlink-1 activate
  neighbor downlink-2 activate
  neighbor downlink-3 activate
  neighbor downlink-4 activate
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="basic-clos-configuration-with-evpn-symmetric-routing">Basic Clos Configuration with EVPN Symmetric Routing</h3>

<p>The following example configuration is a basic Clos topology with EVPN
symmetric routing with external prefix (type-5) routing via dual,
non-MLAG exit leafs connected to an edge router. Here is the topology
diagram:</p>

<p><img src="attachments/8362732/8362731.png" alt="" />{height=&ldquo;400&rdquo;}</p>

<h4 id="leaf01-and-leaf02-configurations-3">leaf01 and leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1368766130" class="expand-container">
<div id="expander-control-1368766130" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/network/interfaces
</div>
<div id="expander-content-1368766130" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 10.0.0.1/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

# L2 interfaces - ports, vxlan and bridge
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3
    bridge-access 110

auto swp4
iface swp4
    bridge-access 110

auto swp5
iface swp5
    bridge-access 210

auto swp6
iface swp6
    bridge-access 210

auto vni110
iface vni110
    vxlan-id 10110
    vxlan-local-tunnelip 10.0.0.1
    bridge-learning off
    bridge-access 110
    bridge-arp-nd-suppress on

auto vni210
iface vni210
    vxlan-id 10210
    vxlan-local-tunnelip 10.0.0.1
    bridge-learning off
    bridge-access 210
    bridge-arp-nd-suppress on

auto vni4001
iface vni4001
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.1
    bridge-learning off
    bridge-access 4001

auto vni4002
iface vni4002
    vxlan-id 104002
    vxlan-local-tunnelip 10.0.0.1
    bridge-learning off
    bridge-access 4002

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports swp3 swp4 swp5 swp6 vni110 vni210 vni4001 vni4002
    bridge-stp on
    bridge-vids 110 210

# Tenants (VRFs)
auto vrf1
iface vrf1
    vrf-table auto

auto vrf2
iface vrf2
    vrf-table auto

# Tenant SVIs - anycast GW
auto vlan110
iface vlan110
    address 172.16.120.1/24
    vlan-id 110
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.120.250/24
    vrf vrf1

auto vlan210
iface vlan210
    address 172.16.130.1/24
    vlan-id 210
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.130.250/24
    vrf vrf2

# L3 VLAN interface per tenant (for L3 VNI)
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1

auto vlan4002
iface vlan4002
    vlan-id 4002
    vlan-raw-device bridge
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-1108829222" class="expand-container">
<div id="expander-control-1108829222" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/network/interfaces
</div>
<div id="expander-content-1108829222" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 10.0.0.2/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

# L2 interfaces - ports, vxlan and bridge
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3
    bridge-access 120

auto swp4
iface swp4
    bridge-access 120

auto swp5
iface swp5
    bridge-access 220

auto swp6
iface swp6
    bridge-access 220

auto vni120
iface vni120
    vxlan-id 10120
    vxlan-local-tunnelip 10.0.0.2
    bridge-learning off
    bridge-access 120
    bridge-arp-nd-suppress on

auto vni220
iface vni220
    vxlan-id 10220
    vxlan-local-tunnelip 10.0.0.2
    bridge-learning off
    bridge-access 220
    bridge-arp-nd-suppress on

auto vni4001
iface vni4001
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.2
    bridge-learning off
    bridge-access 4001

auto vni4002
iface vni4002
    vxlan-id 104002
    vxlan-local-tunnelip 10.0.0.2
    bridge-learning off
    bridge-access 4002

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports swp3 swp4 swp5 swp6 vni120 vni220 vni4001 vni4002
    bridge-stp on
    bridge-vids 120 220

# Tenants (VRFs)
auto vrf1
iface vrf1
    vrf-table auto

auto vrf2
iface vrf2
    vrf-table auto

# Tenant SVIs - anycast GW
auto vlan120
iface vlan120
    address 172.16.120.2/24
    vlan-id 120
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.120.250/24
    vrf vrf1

auto vlan220
iface vlan220
    address 172.16.130.2/24
    vlan-id 220
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.130.250/24
    vrf vrf2

# L3 VLAN interface per tenant (for L3 VNI)
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1

auto vlan4002
iface vlan4002
    vlan-id 4002
    vlan-raw-device bridge
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-395792713" class="expand-container">
<div id="expander-control-395792713" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf01 /etc/frr/frr.conf
</div>
<div id="expander-content-395792713" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf01:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
vrf vrf1
 vni 104001
vrf vrf2
 vni 104002
!
interface swp1
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
interface swp2
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
router bgp 65001
 bgp router-id 10.0.0.1
 neighbor SPINE peer-group
 neighbor SPINE remote-as external
 neighbor SPINE timers 10 30
 neighbor swp1 interface peer-group SPINE
 neighbor swp2 interface peer-group SPINE
 !
 address-family ipv4 unicast
  network 10.0.0.1/32
 exit-address-family
!
 address-family l2vpn evpn
  neighbor SPINE activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-726199515" class="expand-container">
<div id="expander-control-726199515" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf02 /etc/frr/frr.conf
</div>
<div id="expander-content-726199515" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf02:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
vrf vrf1
 vni 104001
vrf vrf2
 vni 104002
!
interface swp1
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
interface swp2
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
router bgp 65002
 bgp router-id 10.0.0.2
 neighbor SPINE peer-group
 neighbor SPINE remote-as external
 neighbor SPINE timers 10 30
 neighbor swp1 interface peer-group SPINE
 neighbor swp2 interface peer-group SPINE
 !
 address-family ipv4 unicast
  network 10.0.0.2/32
 exit-address-family
!
 address-family l2vpn evpn
  neighbor SPINE activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="leaf03-and-leaf04-configurations-3">leaf03 and leaf04 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1434295379" class="expand-container">
<div id="expander-control-1434295379" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/network/interfaces
</div>
<div id="expander-content-1434295379" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 10.0.0.3/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

# L2 interfaces - ports, vxlan and bridge
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3
    bridge-access 130

auto swp4
iface swp4
    bridge-access 130

auto swp5
iface swp5
    bridge-access 230

auto swp6
iface swp6
    bridge-access 230

auto vni130
iface vni130
    vxlan-id 10130
    vxlan-local-tunnelip 10.0.0.3
    bridge-learning off
    bridge-access 130
    bridge-arp-nd-suppress on

auto vni230
iface vni230
    vxlan-id 10230
    vxlan-local-tunnelip 10.0.0.3
    bridge-learning off
    bridge-access 230
    bridge-arp-nd-suppress on

auto vni4001
iface vni4001
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.3
    bridge-learning off
    bridge-access 4001

auto vni4002
iface vni4002
    vxlan-id 104002
    vxlan-local-tunnelip 10.0.0.3
    bridge-learning off
    bridge-access 4002

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports swp3 swp4 swp5 swp6 vni130 vni230 vni4001 vni4002
    bridge-stp on
    bridge-vids 130 230

# Tenants (VRFs)
auto vrf1
iface vrf1
    vrf-table auto

auto vrf2
iface vrf2
    vrf-table auto

# Tenant SVIs - anycast GW
auto vlan130
iface vlan130
    address 172.16.120.3/24
    vlan-id 130
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.120.250/24
    vrf vrf1

auto vlan230
iface vlan230
    address 172.16.130.3/24
    vlan-id 230
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.130.250/24
    vrf vrf2

# L3 VLAN interface per tenant (for L3 VNI)
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1

auto vlan4002
iface vlan4002
    vlan-id 4002
    vlan-raw-device bridge
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-825030638" class="expand-container">
<div id="expander-control-825030638" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/network/interfaces
</div>
<div id="expander-content-825030638" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 10.0.0.4/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

# L2 interfaces - ports, vxlan and bridge
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3
    bridge-access 140

auto swp4
iface swp4
    bridge-access 140

auto swp5
iface swp5
    bridge-access 240

auto swp6
iface swp6
    bridge-access 240

auto vni140
iface vni140
    vxlan-id 10140
    vxlan-local-tunnelip 10.0.0.4
    bridge-learning off
    bridge-access 140
    bridge-arp-nd-suppress on

auto vni240
iface vni240
    vxlan-id 10240
    vxlan-local-tunnelip 10.0.0.4
    bridge-learning off
    bridge-access 240
    bridge-arp-nd-suppress on

auto vni4001
iface vni4001
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.4
    bridge-learning off
    bridge-access 4001

auto vni4002
iface vni4002
    vxlan-id 104002
    vxlan-local-tunnelip 10.0.0.4
    bridge-learning off
    bridge-access 4002

auto bridge
iface bridge
    bridge-vlan-aware yes
    bridge-ports swp3 swp4 swp5 swp6 vni140 vni240 vni4001 vni4002
    bridge-stp on
    bridge-vids 140 240

# Tenants (VRFs)
auto vrf1
iface vrf1
    vrf-table auto

auto vrf2
iface vrf2
    vrf-table auto

# Tenant SVIs - anycast GW
auto vlan140
iface vlan140
    address 172.16.120.4/24
    vlan-id 140
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.120.250/24
    vrf vrf1

auto vlan240
iface vlan240
    address 172.16.130.4/24
    vlan-id 240
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.130.250/24
    vrf vrf2

# L3 VLAN interface per tenant (for L3 VNI)
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1

auto vlan4002
iface vlan4002
    vlan-id 4002
    vlan-raw-device bridge
    vrf vrf2</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1189558602" class="expand-container">
<div id="expander-control-1189558602" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf03 /etc/frr/frr.conf
</div>
<div id="expander-content-1189558602" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf03:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
vrf vrf1
 vni 104001
vrf vrf2
 vni 104002
!
interface swp1
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
interface swp2
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
router bgp 65003
 bgp router-id 10.0.0.3
 neighbor SPINE peer-group
 neighbor SPINE remote-as external
 neighbor SPINE timers 10 30
 neighbor swp1 interface peer-group SPINE
 neighbor swp2 interface peer-group SPINE
 !
 address-family ipv4 unicast
  network 10.0.0.3/32
 exit-address-family
!
 address-family l2vpn evpn
  neighbor SPINE activate
  advertise-all-vni
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-159962484" class="expand-container">
<div id="expander-control-159962484" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />leaf04 /etc/frr/frr.conf
</div>
<div id="expander-content-159962484" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@leaf04:~$ cat /etc/frr/frr.conf 
 
log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
vrf vrf1
 vni 104001
vrf vrf2
 vni 104002
!
interface swp1
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
interface swp2
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
router bgp 65004
 bgp router-id 10.0.0.4
 neighbor SPINE peer-group
 neighbor SPINE remote-as external
 neighbor SPINE timers 10 30
 neighbor swp1 interface peer-group SPINE
 neighbor swp2 interface peer-group SPINE
 !
 address-family ipv4 unicast
  network 10.0.0.4/32
 exit-address-family
!
 address-family l2vpn evpn
  neighbor SPINE activate
  advertise-all-vni
 exit-address-family
!
router bgp 65004 vrf vrf1
 bgp router-id 172.16.120.4
 neighbor 172.16.120.100 remote-as external
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
!
router bgp 65004 vrf vrf2
 bgp router-id 172.16.130.4
 neighbor 172.16.130.100 remote-as external
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="spine01-and-spine02-configurations-3">spine01 and spine02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-59066398" class="expand-container">
<div id="expander-control-59066398" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/network/interfaces
</div>
<div id="expander-content-59066398" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
<strong>spine01 /etc/network/interfaces</strong>
</div>
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 172.16.110.1/24

auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3

auto swp4
iface swp4

auto swp5
iface swp5

auto swp6
iface swp6</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-2119404308" class="expand-container">
<div id="expander-control-2119404308" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/network/interfaces
</div>
<div id="expander-content-2119404308" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;">
<strong>spine02 /etc/network/interfaces</strong>
</div>
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 172.16.110.2/24

auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3

auto swp4
iface swp4

auto swp5
iface swp5

auto swp6
iface swp6</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1242797524" class="expand-container">
<div id="expander-control-1242797524" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine01 /etc/frr/frr.conf
</div>
<div id="expander-content-1242797524" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine01:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
router bgp 65100
 bgp router-id 172.16.110.1
 neighbor LEAF peer-group
 neighbor LEAF remote-as external
 neighbor LEAF timers 10 30
 neighbor swp1 interface peer-group LEAF
 neighbor swp2 interface peer-group LEAF
 neighbor swp3 interface peer-group LEAF
 neighbor swp4 interface peer-group LEAF
 neighbor BORDER-LEAF peer-group
 neighbor BORDER-LEAF remote-as external
 neighbor BORDER-LEAF timers 10 30
 neighbor swp5 interface peer-group BORDER-LEAF
 neighbor swp6 interface peer-group BORDER-LEAF
 !
 address-family ipv4 unicast
  network 172.16.110.1/24
  neighbor LEAF activate
  neighbor BORDER-LEAF activate
  neighbor LEAF route-reflector-client
  neighbor BORDER-LEAF route-reflector-client
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor LEAF activate
  neighbor BORDER-LEAF activate
  neighbor LEAF route-reflector-client
  neighbor BORDER-LEAF route-reflector-client
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-773314269" class="expand-container">
<div id="expander-control-773314269" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />spine02 /etc/frr/frr.conf
</div>
<div id="expander-content-773314269" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@spine02:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
router bgp 65100
 bgp router-id 172.16.110.2
 neighbor LEAF peer-group
 neighbor LEAF remote-as external
 neighbor LEAF timers 10 30
 neighbor swp1 interface peer-group LEAF
 neighbor swp2 interface peer-group LEAF
 neighbor swp3 interface peer-group LEAF
 neighbor swp4 interface peer-group LEAF
 neighbor BORDER-LEAF peer-group
 neighbor BORDER-LEAF remote-as external
 neighbor BORDER-LEAF timers 10 30
 neighbor swp5 interface peer-group BORDER-LEAF
 neighbor swp6 interface peer-group BORDER-LEAF
 !
 address-family ipv4 unicast
  network 172.16.110.2/24
  neighbor LEAF activate
  neighbor BORDER-LEAF activate
  neighbor LEAF route-reflector-client
  neighbor BORDER-LEAF route-reflector-client
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor LEAF activate
  neighbor BORDER-LEAF activate
  neighbor LEAF route-reflector-client
  neighbor BORDER-LEAF route-reflector-client
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="border-leaf01-and-border-leaf02-configurations">border-leaf01 and border-leaf02 Configurations</h4>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-157510538" class="expand-container">
<div id="expander-control-157510538" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />border-leaf01 /etc/network/interfaces
</div>
<div id="expander-content-157510538" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@border-leaf01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

auto lo:1
iface lo:1
    address 10.0.0.5/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

# Physical interfaces
auto swp1s0
iface swp1s0

auto swp1s1
iface swp1s1

auto swp1s2
iface swp1s2
    bridge-vids 2001 2002

auto swp1s3
iface swp1s3
    bridge-access 150

auto swp2s0
iface swp2s0
    bridge-access 250

auto vni150
iface vni150
    vxlan-id 10150
    vxlan-local-tunnelip 10.0.0.5
    bridge-learning off
    bridge-access 150
    bridge-arp-nd-suppress on
    
auto vni250
iface vni250
    vxlan-id 10250
    vxlan-local-tunnelip 10.0.0.5
    bridge-learning off
    bridge-access 250
    bridge-arp-nd-suppress on

# Tenant VRFs
auto vrf1
iface vrf1
    vrf-table auto

auto vrf2
iface vrf2
    vrf-table auto

# VxLAN interfaces (VLAN to VNI mappings)
# Need only the L3 VxLAN interfaces
auto vni4001
iface vni4001
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.5
    bridge-learning off
    bridge-access 4001

auto vni4002
iface vni4002
    vxlan-id 104002
    vxlan-local-tunnelip 10.0.0.5
    bridge-learning off
    bridge-access 4002

# Bridge
auto bridge
iface bridge
      bridge-vlan-aware yes
      bridge-ports swp4 swp5 vni160 vni260 vni4001 vni4002
      bridge-stp on
      bridge-vids 160 260 2001 2002
 
# Tenant SVIs - anycast GW
auto vlan160
iface vlan160
    address 172.16.120.1/24
    vlan-id 160
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.120.250/24
    vrf vrf1
 
auto vlan260
iface vlan260
    address 172.16.130.2/24
    vlan-id 260
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.130.250/24
    vrf vrf2
 
# L3 VLAN interface per tenant (for L3 VNI)
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1
 
auto vlan4002
iface vlan4002
    vlan-id 4002
    vlan-raw-device bridge
    vrf vrf2
# External-facing L3 VLAN interface per tenant (towards WAN edge)
#auto swp1s2.4001
#iface swp1s2.4001
#    address 172.16.100.2/30
#    vrf vrf1
#
#auto swp1s2.4002
#iface swp1s2.4002
#    address 172.16.100.6/30
#    vrf vrf2
#
# configuration below is a workaround for RN-766
#
auto vlan2001
iface vlan2001
    vlan-id 2001
    vlan-raw-device bridge
    vrf vrf1
    address 172.16.100.2/30
 
auto vlan2002
iface vlan2002
    vlan-id 2002
    vlan-raw-device bridge
    vrf vrf2
    address 172.16.100.6/30
 
auto vni16001
iface vni16001
    vxlan-id 16001
    vxlan-local-tunnelip 10.0.0.5
    bridge-learning off
    bridge-access 2001
 
auto vni16002
iface vni16002
    vxlan-id 16002
    vxlan-local-tunnelip 10.0.0.5
    bridge-learning off
    bridge-access 2002</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-674280835" class="expand-container">
<div id="expander-control-674280835" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />border-leaf02 /etc/network/interfaces
</div>
<div id="expander-content-674280835" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@border-leaf02:~$ cat /etc/network/interfaces

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 10.0.0.6/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

# Physical interfaces
auto swp1
iface swp1

auto swp2
iface swp2

auto swp3
iface swp3

auto swp4
iface swp4
    bridge-access 160

auto swp5
iface swp5
    bridge-access 260

auto vni160
iface vni160
    vxlan-id 10160
    vxlan-local-tunnelip 10.0.0.6
    bridge-learning off
    bridge-access 160
    bridge-arp-nd-suppress on

auto vni260
iface vni260
    vxlan-id 10260
    vxlan-local-tunnelip 10.0.0.6
    bridge-learning off
    bridge-access 260
    bridge-arp-nd-suppress on

# Tenant VRFs
auto vrf1
iface vrf1
    vrf-table auto

auto vrf2
iface vrf2
    vrf-table auto

# VxLAN interfaces (VLAN to VNI mappings)
# Need only the L3 VxLAN interfaces
auto vni4001
iface vni4001
    vxlan-id 104001
    vxlan-local-tunnelip 10.0.0.6
    bridge-learning off
    bridge-access 4001

auto vni4002
iface vni4002
    vxlan-id 104002
    vxlan-local-tunnelip 10.0.0.6
    bridge-learning off
    bridge-access 4002

# Bridge
auto bridge
iface bridge
      bridge-vlan-aware yes
      bridge-ports swp4 swp5 vni160 vni260 vni4001 vni4002
      bridge-stp on
      bridge-vids 160 260 2001 2002

# Tenant SVIs - anycast GW
auto vlan160
iface vlan160
    address 172.16.120.1/24
    vlan-id 160
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.120.250/24
    vrf vrf1
 
auto vlan260
iface vlan260
    address 172.16.130.2/24
    vlan-id 260
    vlan-raw-device bridge
    address-virtual 00:00:5e:00:01:01 172.16.130.250/24
    vrf vrf2
 
# L3 VLAN interface per tenant (for L3 VNI)
auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf vrf1
 
auto vlan4002
iface vlan4002
    vlan-id 4002
    vlan-raw-device bridge
    vrf vrf2
 
# External-facing L3 VLAN interface per tenant (towards WAN edge)
# auto swp3.4001
# iface swp3.4001
#     address 172.16.101.2/30
#     vrf vrf1
#  
# auto swp3.4002
# iface swp3.4002
#     address 172.16.101.6/30
#     vrf vrf2
#
# configuration below is a workaround for RN-766
#
auto vlan2001
iface vlan2001
    vlan-id 2001
    vlan-raw-device bridge
    vrf vrf1
    address 172.16.101.2/30

auto vlan2002
iface vlan2002
    vlan-id 2002
    vlan-raw-device bridge
    vrf vrf2
    address 172.16.101.6/30                         
 
auto vni16001
iface vni16001
    vxlan-id 16001
    vxlan-local-tunnelip 10.0.0.6
    bridge-learning off
    bridge-access 2001
 
auto vni16002
iface vni16002
    vxlan-id 16002
    vxlan-local-tunnelip 10.0.0.6
    bridge-learning off
    bridge-access 2002</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-724553007" class="expand-container">
<div id="expander-control-724553007" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />border-leaf01 /etc/frr/frr.conf
</div>
<div id="expander-content-724553007" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@border-leaf01:~$ cat /etc/frr/frr.conf 
 
log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
vrf vrf1
 vni 104001
vrf vrf2
 vni 104002
!
interface swp1s0
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
interface swp1s1
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
router bgp 65005
 bgp router-id 10.0.0.5
 neighbor SPINE peer-group
 neighbor SPINE remote-as external
 neighbor SPINE timers 1200 4800
 neighbor swp1s0 interface peer-group SPINE
 neighbor swp1s1 interface peer-group SPINE
 !
 address-family ipv4 unicast
  network 10.0.0.5/32
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor SPINE activate
  advertise-all-vni
 exit-address-family
!
router bgp 65005 vrf vrf1
 bgp router-id 172.16.100.2
 neighbor 172.16.100.1 remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
 exit-address-family
!
router bgp 65005 vrf vrf2
 bgp router-id 172.16.100.6
 neighbor 172.16.100.5 remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
<td><div id="expander-1326485410" class="expand-container">
<div id="expander-control-1326485410" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />border-leaf02 /etc/frr/frr.conf
</div>
<div id="expander-content-1326485410" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@border-leaf02:~$ cat /etc/frr/frr.conf 
 
log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
vrf vrf1
 vni 104001
vrf vrf2
 vni 104002
!
interface swp1
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
interface swp2
 no ipv6 nd suppress-ra
 ipv6 nd ra-interval 10
!
router bgp 65005
 bgp router-id 10.0.0.6
 neighbor SPINE peer-group
 neighbor SPINE remote-as external
 neighbor SPINE timers 10 30
 neighbor swp1 interface peer-group SPINE
 neighbor swp2 interface peer-group SPINE
 !
 address-family ipv4 unicast
  network 10.0.0.6/32
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor SPINE activate
  advertise-all-vni
 exit-address-family
!
router bgp 65005 vrf vrf1
 bgp router-id 172.16.100.2
 neighbor 172.16.100.1 remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
 exit-address-family
!
router bgp 65005 vrf vrf2
 bgp router-id 172.16.100.6
 neighbor 172.16.100.5 remote-as external
 !
 address-family ipv4 unicast
  redistribute connected
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
 exit-address-family
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h4 id="router01-configurations">router01 Configurations</h4>

<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><div id="expander-1338842080" class="expand-container">
<div id="expander-control-1338842080" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />router01 /etc/network/interfaces
</div>
<div id="expander-content-1338842080" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@router01:~$ cat /etc/network/interfaces
 
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0
    address 192.168.0.15/24
    gateway 192.168.0.2

auto lo:1
iface lo:1
    address 120.0.0.1/32
    #pre-up sysctl -w net.ipv4.neigh.default.gc_thresh1=0
    #pre-up sysctl -w net.ipv4.route.gc_timeout=60
    #pre-up sysctl -w net.ipv4.neigh.default.base_reachable_time_ms=240000

auto swp1
iface swp1

auto swp1.2001
iface swp1.2001
    address 172.16.100.1/24

auto swp1.2002
iface swp1.2002
    address 172.16.100.5/24

auto swp2
iface swp2

auto swp2.4001
iface swp2.4001
    address 172.16.100.1/24

auto swp2.4002
iface swp2.4002
    address 172.16.100.5/24

auto swp3
iface swp3
    address 81.1.1.1/24

auto swp4
iface swp4
    address 81.1.2.1/24

auto swp5
iface swp5
    address 81.1.3.1/24

auto swp6
iface swp6
    address 81.1.4.1/24</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
<tr class="even">
<td><div id="expander-1113804167" class="expand-container">
<div id="expander-control-1113804167" class="expand-control">
<img src="images/icons/grey_arrow_down.png" class="expand-control-image" />router01 /etc/frr/frr.conf
</div>
<div id="expander-content-1113804167" class="expand-content">
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>cumulus@router01:~$ cat /etc/frr/frr.conf 

log file /var/log/frr/frr.log
log timestamp precision 6
!
password CumulusLinux!
enable password CumulusLinux!
!
router bgp 65200
 bgp router-id 120.0.0.1
 neighbor 172.16.100.2 remote-as external
 neighbor 172.16.100.6 remote-as external
 neighbor 172.16.100.2 remote-as external
 neighbor 172.16.100.6 remote-as external
 !
 address-family ipv4 unicast
  redistribute connected route-map HOST_ALLOW
 exit-address-family
!
ip prefix-list HOSTS seq 1 permit 81.1.1.0/24
ip prefix-list HOSTS seq 2 permit 81.1.2.0/24
ip prefix-list HOSTS seq 3 permit 81.1.3.0/24
ip prefix-list HOSTS seq 4 permit 81.1.4.0/24
ip prefix-list HOSTS seq 5 deny any
!
route-map HOST_ALLOW permit 1
 match ip address prefix-list HOSTS
!
!
line vty
 exec-timeout 0 0
!</code></pre>
</div>
</div>
</div>
</div></td>
</tr>
</tbody>
</table>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362745.png">evpn.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362744.png">symmetric-routing.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362732/8362743.png">Clos and EVPN
symmetric routing.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362742.png">EVPEN_MLAG_Config.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362741.png">asymmetric-evpn@2000x.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362740.png">Asymmetric-EVPN.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362732/8362739.png">Centralized
– EVPN.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362732/8362738.png">Symmetric –
EVPN.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362737.png">basic_CLOS_EVPN_fix.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362736.png">EVPN-BasicCLOS-2000.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362735.png">EVPN-BasicCLOS.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362734.png">EVPN_Centralized.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362733.png">EVPN_Asymmetric.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8362731.png">EVPN_Symmetric.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362732/8366123.png">DAD_example.png</a> (image/png)</p>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#ethernet-virtual-private-network-evpn">Ethernet Virtual Private Network - EVPN</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#basic-evpn-configuration">Basic EVPN Configuration</a>
<ul>
<li><a href="#enable-evpn-between-bgp-neighbors">Enable EVPN between BGP Neighbors</a></li>
<li><a href="#advertise-all-vnis">Advertise All VNIs</a></li>
<li><a href="#auto-derivation-of-rds-and-rts">Auto-derivation of RDs and RTs</a></li>
<li><a href="#user-defined-rds-and-rts">User-defined RDs and RTs</a></li>
<li><a href="#enable-evpn-in-an-ibgp-environment-with-an-ospf-underlay">Enable EVPN in an iBGP Environment with an OSPF Underlay</a></li>
<li><a href="#disable-data-plane-mac-learning-over-vxlan-tunnels">Disable Data Plane MAC Learning over VXLAN Tunnels</a></li>
<li><a href="#bum-traffic">BUM Traffic</a></li>
</ul></li>
<li><a href="#arp-and-nd-suppression">ARP and ND Suppression</a>
<ul>
<li><a href="#uft-profiles-other-than-the-default">UFT Profiles Other than the Default</a></li>
<li><a href="#support-for-evpn-neighbor-discovery-nd-extended-community">Support for EVPN Neighbor Discovery (ND) Extended Community</a>
<ul>
<li><a href="#router-flag">Router Flag</a></li>
</ul></li>
</ul></li>
<li><a href="#evpn-and-vxlan-active-active-mode">EVPN and VXLAN Active-active Mode</a>
<ul>
<li><a href="#active-active-vtep-anycast-ip-behavior">Active-active VTEP Anycast IP Behavior</a></li>
<li><a href="#failure-scenario-behaviors"><strong>Failure Scenario Behaviors</strong></a></li>
</ul></li>
<li><a href="#inter-subnet-routing">Inter-subnet Routing</a>
<ul>
<li><a href="#centralized-routing">Centralized Routing</a>
<ul>
<li><a href="#advertising-the-default-gateway">Advertising the Default Gateway</a></li>
</ul></li>
<li><a href="#asymmetric-routing">Asymmetric Routing</a></li>
<li><a href="#symmetric-routing">Symmetric Routing</a>
<ul>
<li><a href="#vxlan-interface-corresponding-to-the-layer-3-vni">VXLAN Interface Corresponding to the Layer 3 VNI</a></li>
<li><a href="#svi-for-the-layer-3-vni">SVI for the Layer 3 VNI</a></li>
<li><a href="#vrf-to-layer-3-vni-mapping">VRF to Layer 3 VNI Mapping</a></li>
<li><a href="#configure-rd-and-rts-for-the-tenant-vrf">Configure RD and RTs for the Tenant VRF</a></li>
<li><a href="#advertise-the-locally-attached-subnets">Advertise the Locally-attached Subnets</a></li>
</ul></li>
</ul></li>
<li><a href="#prefix-based-routing-evpn-type-5-routes">Prefix-based Routing — EVPN Type-5 Routes</a>
<ul>
<li><a href="#configure-the-switch-to-install-evpn-type-5-routes">Configure the Switch to Install EVPN Type-5 Routes</a></li>
<li><a href="#announce-evpn-type-5-routes">Announce EVPN Type-5 Routes</a></li>
<li><a href="#evpn-type-5-routing-with-asymmetric-routing">EVPN Type-5 Routing with Asymmetric Routing</a></li>
<li><a href="#control-which-rib-routes-are-injected-into-evpn">Control Which RIB Routes Are Injected into EVPN</a></li>
<li><a href="#originate-default-evpn-type-5-routes">Originate Default EVPN Type-5 Routes</a></li>
</ul></li>
<li><a href="#evpn-enhancements">EVPN Enhancements</a>
<ul>
<li><a href="#static-sticky-mac-addresses">Static (Sticky) MAC Addresses</a></li>
<li><a href="#filter-evpn-routes-based-on-type">Filter EVPN Routes Based on Type</a></li>
<li><a href="#extended-mobility">Extended Mobility</a></li>
<li><a href="#duplicate-address-detection">Duplicate Address Detection</a>
<ul>
<li><a href="#configure-duplicate-address-detection">Configure Duplicate Address Detection</a></li>
<li><a href="#example-syslog-messages">Example syslog Messages</a></li>
<li><a href="#freeze-a-detected-duplicate-address">Freeze a Detected Duplicate Address</a></li>
<li><a href="#configure-the-freeze-option">Configure the Freeze Option</a></li>
<li><a href="#clear-duplicate-addresses">Clear Duplicate Addresses</a></li>
<li><a href="#disable-duplicate-address-detection">Disable Duplicate Address Detection</a></li>
<li><a href="#show-detected-duplicate-address-information">Show Detected Duplicate Address Information</a></li>
</ul></li>
</ul></li>
<li><a href="#evpn-operational-commands">EVPN Operational Commands</a>
<ul>
<li><a href="#general-linux-commands-related-to-evpn">General Linux Commands Related to EVPN</a></li>
<li><a href="#general-bgp-operational-commands-relevant-to-evpn">General BGP Operational Commands Relevant to EVPN</a></li>
<li><a href="#display-evpn-address-family-peers">Display EVPN address-family Peers</a></li>
<li><a href="#display-vnis-in-evpn">Display VNIs in EVPN</a></li>
<li><a href="#examine-local-and-remote-mac-addresses-for-a-vni-in-evpn">Examine Local and Remote MAC Addresses for a VNI in EVPN</a></li>
<li><a href="#examine-local-and-remote-neighbors-for-a-vni-in-evpn">Examine Local and Remote Neighbors for a VNI in EVPN</a></li>
<li><a href="#examine-remote-router-macs-in-evpn">Examine Remote Router MACs in EVPN</a></li>
<li><a href="#examine-gateway-next-hops-in-evpn">Examine Gateway Next Hops in EVPN</a></li>
<li><a href="#display-the-vrf-routing-table-in-frr">Display the VRF Routing Table in FRR</a></li>
<li><a href="#display-the-global-bgp-evpn-routing-table">Display the Global BGP EVPN Routing Table</a></li>
<li><a href="#display-a-specific-evpn-route">Display a Specific EVPN Route</a></li>
<li><a href="#display-the-per-vni-evpn-routing-table">Display the per-VNI EVPN Routing Table</a></li>
<li><a href="#display-the-per-vrf-bgp-routing-table">Display the per-VRF BGP Routing Table</a></li>
<li><a href="#examine-mac-moves">Examine MAC Moves</a></li>
<li><a href="#examine-sticky-mac-addresses">Examine Sticky MAC Addresses</a></li>
</ul></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#caveats">Caveats</a></li>
<li><a href="#example-configurations">Example Configurations</a>
<ul>
<li><a href="#basic-clos-4x2-for-bridging">Basic Clos (4x2) for Bridging</a>
<ul>
<li><a href="#leaf01-and-leaf02-configurations">leaf01 and leaf02 Configurations</a></li>
<li><a href="#leaf03-and-leaf04-configurations">leaf03 and leaf04 Configurations</a></li>
<li><a href="#spine01-and-spine02-configurations">spine01 and spine02 Configurations</a></li>
</ul></li>
<li><a href="#clos-configuration-with-mlag-and-centralized-routing">Clos Configuration with MLAG and Centralized Routing</a>
<ul>
<li><a href="#leaf01-and-leaf02-configurations-1">leaf01 and leaf02 Configurations</a></li>
<li><a href="#leaf03-and-leaf04-configurations-1">leaf03 and leaf04 Configurations</a></li>
<li><a href="#spine01-and-spine02-configurations-1">spine01 and spine02 Configurations</a></li>
</ul></li>
<li><a href="#clos-configuration-with-mlag-and-evpn-asymetric-routing">Clos Configuration with MLAG and EVPN Asymetric Routing</a>
<ul>
<li><a href="#leaf01-and-leaf02-configurations-2">leaf01 and leaf02 Configurations</a></li>
<li><a href="#leaf03-and-leaf04-configurations-2">leaf03 and leaf04 Configurations</a></li>
<li><a href="#spine01-and-spine02-configurations-2">spine01 and spine02 Configurations</a></li>
</ul></li>
<li><a href="#basic-clos-configuration-with-evpn-symmetric-routing">Basic Clos Configuration with EVPN Symmetric Routing</a>
<ul>
<li><a href="#leaf01-and-leaf02-configurations-3">leaf01 and leaf02 Configurations</a></li>
<li><a href="#leaf03-and-leaf04-configurations-3">leaf03 and leaf04 Configurations</a></li>
<li><a href="#spine01-and-spine02-configurations-3">spine01 and spine02 Configurations</a></li>
<li><a href="#border-leaf01-and-border-leaf02-configurations">border-leaf01 and border-leaf02 Configurations</a></li>
<li><a href="#router01-configurations">router01 Configurations</a></li>
</ul></li>
</ul></li>
<li><a href="#attachments">Attachments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
