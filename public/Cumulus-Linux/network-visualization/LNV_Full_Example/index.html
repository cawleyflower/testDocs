<!DOCTYPE html><html>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L N v Full Example | Cumulus Networks Documentation</title>

<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link rel="stylesheet" href="/normalize.min.css">

<link rel="stylesheet" href="/book.min.50a619ce4c0e99594908d162684f42218608aa6fde2bd83cca5025d59ba535e3.css">

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="http://example.org/">Cumulus Networks Documentation</a>
</h2>



    


  
  
    
    
  
 
  <ul>
    
    <li><a href="/Cumulus-Linux/installation-management/">
    Installation Management</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/installation-management/Adding_and_Updating_Packages/">Adding and Updating Packages</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Installing_a_New_Cumulus_Linux_Image/">Installing a New Cumulus Linux Image</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Managing_Cumulus_Linux_Disk_Images/">Managing Cumulus Linux Disk Images</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Upgrading_Cumulus_Linux/">Upgrading Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Using_Snapshots/">Using Snapshots</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/installation-management/Zero_Touch_Provisioning_-_ZTP/">Zero Touch Provisioning Z T P</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer1-switch-ports/">
    Layer1 Switch Ports</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/802.1X_Interfaces/">802.1 X Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Buffer_and_Queue_Management/">Buffer and Queue Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Relays/">D H C P Relays</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/DHCP_Servers/">D H C P Servers</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Facebook_Voyager_Optical_Interfaces/">Facebook Voyager Optical Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/Prescriptive_Topology_Manager_-_PTM/">Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/Interface_Configuration_and_Management/">Interface Configuration and Management</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer1-switch-ports/interface_configuration_and_management/switch_port_attributes/Switch_Port_Attributes/">Switch Port Attributes</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer2/">
    Layer2</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Prescriptive_Topology_Manager_-_PTM/">Copy of Prescriptive Topology Manager P T M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Copy_of_Spanning_Tree_and_Rapid_Spanning_Tree/">Copy of Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Ethernet_Bridging_-_VLANs/">Ethernet Bridging v L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/IGMP_and_MLD_Snooping/">I G M P and M L D Snooping</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/LACP_Bypass/">L a C P Bypass</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Link_Layer_Discovery_Protocol/">Link Layer Discovery Protocol</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Multi-Chassis_Link_Aggregation_-_MLAG/">Multi Chassis Link Aggregation M L a G</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Spanning_Tree_and_Rapid_Spanning_Tree/">Spanning Tree and Rapid Spanning Tree</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/Virtual_Router_Redundancy_-_VRR/">Virtual Router Redundancy v R R</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/bonding_link_aggregation/Bonding_-_Link_Aggregation/">Bonding Link Aggregation</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/Traditional_Bridge_Mode/">Traditional Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN-aware_Bridge_Mode/">V L a N Aware Bridge Mode</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/ethernet_bridging_vlans/VLAN_Tagging/">V L a N Tagging</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/link_layer_discovery_protocol/voice_vlan/Voice_VLAN/">Voice v L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer2/virtual_router_redundancy/ifplugd/ifplugd/">Ifplugd</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/layer3/">
    Layer3</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/layer3/Address_Resolution_Protocol_-_ARP/">Address Resolution Protocol a R P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Bidirectional_Forwarding_Detection_-_BFD/">Bidirectional Forwarding Detection B F D</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Border_Gateway_Protocol_-_BGP/">Border Gateway Protocol B G P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Configuring_FRRouting/">Configuring F R Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Equal_Cost_Multipath_Load_Sharing_-_Hardware_ECMP/">Equal Cost Multipath Load Sharing Hardware E C M P</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/FRRouting_Overview/">F R Routing Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/GRE_Tunneling/">G R E Tunneling</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Introduction_to_Routing_Protocols/">Introduction to Routing Protocols</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Management_VRF/">Management v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Network_Topology/">Network Topology</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_-_OSPF/">Open Shortest Path First O S P F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Open_Shortest_Path_First_v3_-_OSPFv3/">Open Shortest Path First V3 O S P Fv3</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Policy-based_Routing/">Policy Based Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Protocol_Independent_Multicast_-_PIM/">Protocol Independent Multicast P I M</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Redistribute_Neighbor/">Redistribute Neighbor</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Routing/">Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Segment_Routing/">Segment Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/Virtual_Routing_and_Forwarding_-_VRF/">Virtual Routing and Forwarding v R F</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/configuring_frrouting/comparing_nclu_and_vtysh_commands/Comparing_NCLU_and_vtysh_Commands/">Comparing N C L U and Vtysh Commands</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/layer3/frrouting_overview/Upgrading_from_Quagga_to_FRRouting/">Upgrading From Quagga to F R Routing</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/monitoring-troubleshooting/">
    Monitoring Troubleshooting</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/ASIC_Monitoring/">A S I C Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/FRRouting_Log_Message_Reference/">F R Routing Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Best_Practices/">Monitoring Best Practices</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_System_Hardware/">Monitoring System Hardware</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Monitoring_Virtual_Device_Counters/">Monitoring Virtual Device Counters</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Network_Troubleshooting/">Network Troubleshooting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Resource_Diagnostics_Using_cl-resource-query/">Resource Diagnostics Using Cl Resource Query</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Simple_Network_Management_Protocol_SNMP_Monitoring/">Simple Network Management Protocol S N M P Monitoring</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Single_User_Mode_-_Boot_Recovery/">Single User Mode Boot Recovery</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Troubleshooting_Network_Interfaces/">Troubleshooting Network Interfaces</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/Understanding_the_cl-support_Output_File/">Understanding the Cl Support Output File</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/monitoring_system_hardware/network_switch_port_led_and_stats_led/Network_Switch_Port_LED_and_Status_LED_Guidelines/">Network Switch Port L E D and Status L E D Guidelines</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/monitoring_system_statistics/Monitoring_System_Statistics_and_Network_Traffic_with_sFlow/">Monitoring System Statistics and Network Traffic With S Flow</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/network_troubleshooting/using_nclu_to_troubleshoot/Using_NCLU_to_Troubleshoot_Your_Network_Configuration/">Using N C L U to Troubleshoot Your Network Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/simple_network_management/using_nutanix_prisim_as_monitoring_tool/Using_Nutanix_Prism_as_a_Monitoring_Tool/">Using Nutanix Prism as a Monitoring Tool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/switchd_Log_Message_Reference/">Switchd Log Message Reference</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/troubleshooting_network_interfaces/monitoring_interfaces_and_transcievers_using_ethtool/Monitoring_Interfaces_and_Transceivers_Using_ethtool/">Monitoring Interfaces and Transceivers Using Ethtool</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_log_files/Troubleshooting_Log_Files/">Troubleshooting Log Files</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/monitoring-troubleshooting/understanding_cl-support_output_file/troubleshooting_the_etc_directory/Troubleshooting_the_etc_Directory/">Troubleshooting the Etc Directory</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-solutions/">
    Network Solutions</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Anycast_Design_Guide/">Anycast Design Guide</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Hyperconverged_Solution_with_Nutanix/">Cumulus Hyperconverged Solution With Nutanix</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Cumulus_Networks_Services_Demos/">Cumulus Networks Services Demos</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Data_Center_Host_to_ToR_Architecture/">Data Center Host to to R Architecture</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/Docker_on_Cumulus_Linux/">Docker on Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/OpenStack_Neutron_ML2_and_Cumulus_Linux/">Open Stack Neutron M L2 and Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-solutions/RDMA_over_Converged_Ethernet_-_RoCE/">R D M a Over Converged Ethernet Ro C E</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/network-visualization/">
    Network Visualization</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Eng_Update_of_VXLAN_Hyperloop/">Eng Update of v X L a N Hyperloop</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Ethernet_Virtual_Private_Network_-_EVPN/">Ethernet Virtual Private Network E v P N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs/">Hybrid Cloud Connectivity With Qin Q and v X L a Ns</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/LNV_Full_Example/" class="active">L N v Full Example</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Lightweight_Network_Virtualization_Overview/">Lightweight Network Virtualization Overview</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Static_VXLAN_Configurations/">Static v X L a N Configurations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Routing/">V X L a N Routing</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Scale/">V X L a N Scale</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/VXLAN_Tunnel_DSCP_Operations__DRAFT/">V X L a N Tunnel D S C P Operations — D R a F T</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/Virtualization_Integrations/">Virtualization Integrations</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_mac_bindings/Static_MAC_Bindings_with_VXLAN/">Static M a C Bindings With v X L a N</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/static_vxlan_configurations/static_vxlan_tunnels/Static_VXLAN_Tunnels/">Static v X L a N Tunnels</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_hardware_vteps_vmware_nsx-mh/Integrating_Hardware_VTEPs_with_VMware_NSX-MH/">Integrating Hardware v T E Ps With v Mware N S X M H</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_midonet_openstack/Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack/">Integrating Hardware v T E Ps With Midokura Mido Net and Open Stack</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/integrating_vteps_vmware_nsx-v/Integrating_Hardware_VTEPs_with_VMware_NSX-V/">Integrating Hardware v T E Ps With v Mware N S X V</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/network-visualization/virtualization_integrations/ovsdb_server_high_availability/OVSDB_Server_High_Availability/">O v S D B Server High Availability</a>
    </li>
    
  </ul>

    </li>
    
    <li><a href="/Cumulus-Linux/system-config/">
    System Config</a> 
  <ul>
    

    
    <li>
      <a href="/Cumulus-Linux/system-config/Authentication_Authorization_and_Accounting/">Authentication Authorization and Accounting</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_a_Global_Proxy/">Configuring a Global Proxy</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Configuring_switchd/">Configuring Switchd</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Copy_of_Netfilter_-_ACLs/">Copy of Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/HTTP_API/">H T T P a P I</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Netfilter_-_ACLs/">Netfilter a C Ls</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Network_Command_Line_Utility_-_NCLU/">Network Command Line Utility N C L U</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Power_over_Ethernet_-_PoE/">Power Over Ethernet Po E</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Services_and_Daemons_in_Cumulus_Linux/">Services and Daemons in Cumulus Linux</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/Setting_Date_and_Time/">Setting Date and Time</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/LDAP_Authentication_and_Authorization/">L D a P Authentication and Authorization</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/RADIUS_AAA/">R a D I U S a a A</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/SSH_for_Remote_Access/">S S H for Remote Access</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/TACACS_Plus/">T a C a C S Plus</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/User_Accounts/">User Accounts</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/authentication_authorization_accounting/Using_sudo_to_Delegate_Privileges/">Using Sudo to Delegate Privileges</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Default_Cumulus_Linux_ACL_Configuration/">Default Cumulus Linux a C L Configuration</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/system-config/netfilter_acls/default_cumulus_linux_acl_config/Filtering_Learned_MAC_Addresses/">Filtering Learned M a C Addresses</a>
    </li>
    
  </ul>

    </li>
    

    
    <li>
      <a href="/Cumulus-Linux/whats-new/">What&#39;s New</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/cumulus-linux-index/Cumulus_Linux_Index/">Cumulus Linux Index</a>
    </li>
    
    <li>
      <a href="/Cumulus-Linux/quick-start/Quick_Start_Guide/">Quick Start Guide</a>
    </li>
    
  </ul>








</nav>

    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" />
  </label>
  <strong>L N v Full Example</strong>
</header>

      
<article class="markdown">

<h1 id="lnv-full-example">LNV Full Example</h1>

<p>Lightweight Network Virtualization (LNV) is a technique for
deploying <a href="Network_Virtualization">VXLANs</a> without a central controller
on bare metal switches. This a full example complete with diagram. Refer
to the <a href="Lightweight_Network_Virtualization_Overview">Lightweight Network Virtualization
chapter</a> for more detailed
information. This full example uses the <strong>recommended way</strong> of deploying
LNV, which is to use anycast to load balance the service nodes.</p>

<p>LNV is a lightweight controller option. <a href="http://cumulusnetworks.com/cumulus-linux/overview/#cl-howtoBuy">Contact Cumulus
Networks</a>
with your scale requirements so we can make sure this is the right fit
for you. There are also other controller options that can work on
Cumulus Linux.</p>

<h2 id="contents">Contents</h2>

<p><img src="images/icons/grey_arrow_down.png" alt="" />{.expand-control-image}This topic
describes &hellip;</p>

<ul>
<li><a href="#LNVFullExample-ExampleLNVConfiguration">Example LNV Configuration</a>

<ul>
<li><a href="#LNVFullExample-Layer3IPAddressing">Layer 3 IP Addressing</a></li>
<li><a href="#LNVFullExample-FRRoutingConfiguration">FRRouting
Configuration</a></li>
<li><a href="#LNVFullExample-HostConfiguration">Host Configuration</a></li>
<li><a href="#LNVFullExample-ServiceNodeConfiguration">Service Node
Configuration</a></li>
</ul></li>
<li><a href="#LNVFullExample-RelatedInformation">Related Information</a></li>
</ul>

<h2 id="example-lnv-configuration">Example LNV Configuration</h2>

<p>The following images illustrate the configuration:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Physical Cabling Diagram</p>
<p><img src="attachments/8362715/8362721.png" class="image-center" width="300" /></p></td>
<td><p>Network Virtualization Diagram</p>
<p><img src="attachments/8362715/8362719.png" width="300" /></p></td>
</tr>
</tbody>
</table>

<p>Want to try out configuring LNV and do not have a Cumulus Linux switch?
Check out <a href="https://cumulusnetworks.com/cumulus-vx/">Cumulus VX</a> .</p>

<p><img src="attachments/8362715/8362722.png" alt="" />{width=&ldquo;50&rdquo;} Feeling Overwhelmed?
Come join a <a href="http://cumulusnetworks.com/education/instructor-led-training/">Cumulus Boot
Camp</a> and
get instructor-led training!</p>

<h3 id="layer-3-ip-addressing">Layer 3 IP Addressing</h3>

<p>Here is the configuration for the IP addressing information used in this
example:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1:</strong> <code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.3/32
  address 10.10.10.10/32
 
auto eth0
iface eth0 inet dhcp

auto swp49
iface swp49
  address 10.1.1.2/30
 
auto swp50
iface swp50
  address 10.1.1.6/30
 
auto swp51
iface swp51
  address 10.1.1.50/30
 
auto swp52
iface swp52
  address 10.1.1.54/30</code></pre>
</div>
</div></td>
<td><p><strong>spine2:</strong> <code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.4/32
  address 10.10.10.10/32
 
auto eth0
iface eth0 inet dhcp

auto swp49
iface swp49 
 address 10.1.1.18/30
 
auto swp50
iface swp50 
 address 10.1.1.22/30
 
auto swp51
iface swp51 
address 10.1.1.34/30
 
auto swp52
iface swp52 
address 10.1.1.38/30</code></pre>
</div>
</div></td>
</tr>
<tr class="even">
<td><p><strong>leaf1:</strong> <code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.1/32
  vxrd-src-ip 10.2.1.1
  vxrd-svcnode-ip 10.10.10.10

auto eth0
iface eth0 inet dhcp

auto swp1s0
iface swp1s0
  address 10.1.1.1/30

auto swp1s1
iface swp1s1
  address 10.1.1.5/30

auto swp1s2
iface swp1s2
  address 10.1.1.33/30

auto swp1s3
iface swp1s3
  address 10.1.1.37/30

auto vni-10
iface vni-10
  vxlan-id 10
  vxlan-local-tunnelip 10.2.1.1
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

auto vni-2000
iface vni-2000
  vxlan-id 2000
  vxlan-local-tunnelip 10.2.1.1
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

auto vni-30
iface vni-30
  vxlan-id 30
  vxlan-local-tunnelip 10.2.1.1
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

auto br-10
iface br-10
  bridge-ports swp32s0.10 vni-10

auto br-20
iface br-20
  bridge-ports swp32s0.20 vni-2000

auto br-30
iface br-30
  bridge-ports swp32s0.30 vni-30</code></pre>
</div>
</div></td>
<td><p><strong>leaf2:</strong> <code>/etc/network/interfaces</code></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto lo
iface lo inet loopback
  address 10.2.1.2/32
  vxrd-src-ip 10.2.1.2
  vxrd-svcnode-ip 10.10.10.10

auto eth0
iface eth0 inet dhcp

auto swp1s0
iface swp1s0 inet static
 address 10.1.1.17/30

auto swp1s1
iface swp1s1 inet static
 address 10.1.1.21/30

auto swp1s2
iface swp1s2 inet static
 address 10.1.1.49/30

auto swp1s3
iface swp1s3 inet static
 address 10.1.1.53/30

auto vni-10
iface vni-10
  vxlan-id 10
  vxlan-local-tunnelip 10.2.1.2
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

auto vni-2000
iface vni-2000
  vxlan-id 2000
  vxlan-local-tunnelip 10.2.1.2
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

auto vni-30
iface vni-30
  vxlan-id 30
  vxlan-local-tunnelip 10.2.1.2
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

auto br-10
iface br-10
  bridge-ports swp32s0.10 vni-10

auto br-20
iface br-20
  bridge-ports swp32s0.20 vni-2000

auto br-30
iface br-30
  bridge-ports swp32s0.30 vni-30</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="frrouting-configuration">FRRouting Configuration</h3>

<p>The service nodes and registration nodes must all be routable between
each other. The layer 3 fabric on Cumulus Linux can either be
<a href="Border_Gateway_Protocol_-_BGP">BGP</a> or
<a href="Open_Shortest_Path_First_-_OSPF">OSPF</a>.  In this example, OSPF is used
to demonstrate full reachability. </p>

<p>Here is the FRRouting configuration using OSPF:</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1:</strong>/etc/frr/frr.conf</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>interface lo
 ip ospf area 0.0.0.0
interface swp49
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp50
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp51
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp52
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
!
!
!
!
router-id 10.2.1.3
router ospf
 ospf router-id 10.2.1.3</code></pre>
</div>
</div></td>
<td><p><strong>spine2:</strong> /etc/frr/frr.conf</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>interface lo
 ip ospf area 0.0.0.0
interface swp49
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp50
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp51
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp52
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
!
!
!
!
router-id 10.2.1.4
router ospf
 ospf router-id 10.2.1.4</code></pre>
</div>
</div></td>
</tr>
<tr class="even">
<td><p><strong>leaf1:</strong> /etc/frr/frr.conf</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>interface lo
 ip ospf area 0.0.0.0
interface swp1s0
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s1
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s2
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s3
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
!
!
!
!
router-id 10.2.1.1
router ospf
 ospf router-id 10.2.1.1</code></pre>
</div>
</div></td>
<td><p><strong>leaf2:</strong> /etc/frr/frr.conf</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>interface lo
 ip ospf area 0.0.0.0
interface swp1s0
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s1
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s2
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
interface swp1s3
 ip ospf network point-to-point
 ip ospf area 0.0.0.0
!
!
!
!
!
router-id 10.2.1.2
router ospf
 ospf router-id 10.2.1.2</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="host-configuration">Host Configuration</h3>

<p>In this example, the servers are running Ubuntu 14.04. You must map a
trunk from server1 and server2 to the respective switch. In Ubuntu, this
is done with subinterfaces.</p>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>server1</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto eth3.10
iface eth3.10 inet static
  address 10.10.10.1/24

auto eth3.20
iface eth3.20 inet static
  address 10.10.20.1/24

auto eth3.30
iface eth3.30 inet static
  address 10.10.30.1/24</code></pre>
</div>
</div></td>
<td><p><strong>server2</strong></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="text" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: text; gutter: false; theme: Confluence"><code>auto eth3.10
iface eth3.10 inet static
  address 10.10.10.2/24

auto eth3.20
iface eth3.20 inet static
  address 10.10.20.2/24

auto eth3.30
iface eth3.30 inet static
  address 10.10.30.2/24</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h3 id="service-node-configuration">Service Node Configuration</h3>

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>spine1</strong>:/etc/vxsnd.conf</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>[common]
# Log level is one of DEBUG, INFO, WARNING, ERROR, CRITICAL
#loglevel = INFO
# Destination for log message.  Can be a file name, &#39;stdout&#39;, or &#39;syslog&#39;
#logdest = syslog
# log file size in bytes. Used when logdest is a file
#logfilesize = 512000
# maximum number of log files stored on disk. Used when logdest is a file
#logbackupcount = 14
# The file to write the pid. If using monit, this must match the one
# in the vxsnd.rc
#pidfile = /var/run/vxsnd.pid
# The file name for the unix domain socket used for mgmt.
#udsfile = /var/run/vxsnd.sock
# UDP port for vxfld control messages
#vxfld_port = 10001
# This is the address to which registration daemons send control messages for
# registration and/or BUM packets for replication
svcnode_ip = 10.10.10.10
# Holdtime (in seconds) for soft state. It is used when sending a
# register msg to peers in response to learning a &lt;vni, addr&gt; from a
# VXLAN data pkt
#holdtime = 90
# Local IP address to bind to for receiving inter-vxsnd control traffic
src_ip = 10.2.1.3
[vxsnd]
# Space separated list of IP addresses of vxsnd to share state with
svcnode_peers = 10.2.1.4
# When set to true, the service node will listen for vxlan data traffic
# Note: Use 1, yes, true, or on, for True and 0, no, false, or off,
# for False
#enable_vxlan_listen = true
# When set to true, the svcnode_ip will be installed on the loopback
# interface, and it will be withdrawn when the vxsnd is no longer in
# service.  If set to true, the svcnode_ip configuration
# variable must be defined.
# Note: Use 1, yes, true, or on, for True and 0, no, false, or off,
# for False
#install_svcnode_ip = false
# Seconds to wait before checking the database to age out stale entries
#age_check = 90</code></pre>
</div>
</div></td>
<td><p><strong>spine2</strong>:/etc/vxsnd.conf</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="plain" data-syntaxhighlighter-params="brush: plain; gutter: false; theme: Confluence" data-theme="Confluence" style="brush: plain; gutter: false; theme: Confluence"><code>[common]
# Log level is one of DEBUG, INFO, WARNING, ERROR, CRITICAL
#loglevel = INFO
# Destination for log message.  Can be a file name, &#39;stdout&#39;, or &#39;syslog&#39;
#logdest = syslog
# log file size in bytes. Used when logdest is a file
#logfilesize = 512000
# maximum number of log files stored on disk. Used when logdest is a file
#logbackupcount = 14
# The file to write the pid. If using monit, this must match the one
# in the vxsnd.rc
#pidfile = /var/run/vxsnd.pid
# The file name for the unix domain socket used for mgmt.
#udsfile = /var/run/vxsnd.sock
# UDP port for vxfld control messages
#vxfld_port = 10001
# This is the address to which registration daemons send control messages for
# registration and/or BUM packets for replication
svcnode_ip = 10.10.10.10
# Holdtime (in seconds) for soft state. It is used when sending a
# register msg to peers in response to learning a &lt;vni, addr&gt; from a
# VXLAN data pkt
#holdtime = 90
# Local IP address to bind to for receiving inter-vxsnd control traffic
src_ip = 10.2.1.4
[vxsnd]
# Space separated list of IP addresses of vxsnd to share state with
svcnode_peers = 10.2.1.3
# When set to true, the service node will listen for vxlan data traffic
# Note: Use 1, yes, true, or on, for True and 0, no, false, or off,
# for False
#enable_vxlan_listen = true
# When set to true, the svcnode_ip will be installed on the loopback
# interface, and it will be withdrawn when the vxsnd is no longer in
# service.  If set to true, the svcnode_ip configuration
# variable must be defined.
# Note: Use 1, yes, true, or on, for True and 0, no, false, or off,
# for False
#install_svcnode_ip = false
# Seconds to wait before checking the database to age out stale entries
#age_check = 90</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<h2 id="related-information">Related Information</h2>

<ul>
<li><a href="https://tools.ietf.org/html/rfc7348">tools.ietf.org/html/rfc7348</a></li>
<li><a href="http://en.wikipedia.org/wiki/Anycast">en.wikipedia.org/wiki/Anycast</a></li>
<li><a href="Lightweight_Network_Virtualization_Overview">Detailed LNV Configuration
Guide</a></li>
<li><a href="http://cumulusnetworks.com/education/instructor-led-training/">Cumulus Networks
Training</a></li>

<li><p><a href="Network_Virtualization">Network virtualization chapter, Cumulus Linux user
guide</a></p>

<ul>
<li><a href="Static_VXLAN_Configurations">Static VXLAN Configurations</a>

<ul>
<li><a href="Static_VXLAN_Tunnels">Static VXLAN Tunnels</a></li>
<li><a href="Static_MAC_Bindings_with_VXLAN">Static MAC Bindings with
VXLAN</a></li>
</ul></li>
<li><a href="Lightweight_Network_Virtualization_Overview">Lightweight Network Virtualization
Overview</a>

<ul>
<li><a href="LNV_VXLAN_Active-Active_Mode">LNV VXLAN Active-Active Mode</a></li>
<li><a href="LNV_Full_Example">LNV Full Example</a></li>
</ul></li>
<li><a href="Ethernet_Virtual_Private_Network_-_EVPN">Ethernet Virtual Private Network -
EVPN</a></li>
<li><a href="VXLAN_Routing">VXLAN Routing</a></li>
<li><a href="Virtualization_Integrations">Virtualization Integrations</a>

<ul>
<li><a href="Integrating_Hardware_VTEPs_with_Midokura_MidoNet_and_OpenStack">Integrating Hardware VTEPs with Midokura MidoNet and
OpenStack</a></li>
<li><a href="Integrating_Hardware_VTEPs_with_VMware_NSX-V">Integrating Hardware VTEPs with VMware
NSX-V</a></li>
<li><a href="Integrating_Hardware_VTEPs_with_VMware_NSX-MH">Integrating Hardware VTEPs with VMware
NSX-MH</a></li>
<li><a href="OVSDB_Server_High_Availability">OVSDB Server High
Availability</a></li>
</ul></li>
<li><a href="VXLAN_Scale">VXLAN Scale</a></li>
<li><a href="VXLAN_Tunnel_DSCP_Operations_—_DRAFT">VXLAN Tunnel DSCP Operations
— DRAFT</a></li>
<li><a href="Hybrid_Cloud_Connectivity_with_QinQ_and_VXLANs">Hybrid Cloud Connectivity with QinQ and
VXLANs</a></li>
<li><a href="Eng_Update_of_VXLAN_Hyperloop">Eng Update of VXLAN Hyperloop</a></li>
</ul></li>
</ul>

<h2 id="attachments">Attachments:</h2>

<p><img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;}
<a href="attachments/8362715/8362722.png">turtle_training.png</a> (image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362715/8362723.png">Screen Shot
2015-04-17 at 2.59.30 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362715/8362719.png">Screen Shot
2015-04-22 at 1.58.50 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362715/8362720.png">Screen Shot
2015-04-20 at 10.02.37 AM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362715/8362721.png">Screen Shot
2015-04-20 at 10.02.57 AM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362715/8362717.png">Screen Shot
2015-04-17 at 2.28.44 PM.png</a>
(image/png)<br />
<img src="images/icons/bullet_blue.gif" alt="" />{width=&ldquo;8&rdquo; height=&ldquo;8&rdquo;} <a href="attachments/8362715/8362718.png">Screen Shot
2015-04-23 at 5.00.38 PM.png</a>
(image/png)</p>

<h2 id="comments">Comments:</h2>

<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>If the ingress packet coming with 802.1Q header, VxLAN will strip the header and encap. </p>
<p>Does Cumulus support keep this 802.1Q header? I need this header for doing QoS (packet classification).</p>
<p>Or Cumulus can support map PCP to DSCP before VxLAN encap? </p>
<div class="smallfont" data-align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by pete at Jan 04, 2017 04:30
</div></td>
</tr>
<tr class="even">
<td><p>Hi,</p>
<blockquote>
<p>If the ingress packet coming with 802.1Q header, VxLAN will strip the header and encap.</p>
</blockquote>
<p>Only the VLAN tag should get stripped.</p>
<p> </p>
<blockquote>
<p>Does Cumulus support keep this 802.1Q header? I need this header for doing QoS (packet classification).</p>
</blockquote>
<p>No, the 802.1Q header is not carried across the VXLAN tunnel.</p>
<blockquote>
<p>Or Cumulus can support map PCP to DSCP before VxLAN encap?</p>
</blockquote>
<p>PCP to DSCP is a re-marking action (writing a DSCP value into the packet header before transmit). Cumulus Linux doesn't support DSCP remark in the regular datapath (i.e. traffic.conf) configuration.</p>
<p>You can mark the DSCP value as an ACL action. So perhaps you can get this to work, with the stipulation that it must be done via ACL rules.</p>
<p>Does this help?</p>
<p><br />
<br />
</p>
<p> </p>
<div class="smallfont" data-align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by pete at Jan 12, 2017 02:12
</div></td>
</tr>
</tbody>
</table>
</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    <a href="https://github.com/cawleyflower/testDocs/commit/0f1fa77f244c4b4642688df1f5e961e88daa6e08" title='Last modified March 4, 2019 16:11 EST by Cawleyflower' target="_blank" rel="noopener">
      <img src="/svg/code-merge.svg" /> Last Modified Mar 4, 2019
    </a>
  </div>
  
  
</div>


    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#lnv-full-example">LNV Full Example</a>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#example-lnv-configuration">Example LNV Configuration</a>
<ul>
<li><a href="#layer-3-ip-addressing">Layer 3 IP Addressing</a></li>
<li><a href="#frrouting-configuration">FRRouting Configuration</a></li>
<li><a href="#host-configuration">Host Configuration</a></li>
<li><a href="#service-node-configuration">Service Node Configuration</a></li>
</ul></li>
<li><a href="#related-information">Related Information</a></li>
<li><a href="#attachments">Attachments:</a></li>
<li><a href="#comments">Comments:</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
</body>

</html>
