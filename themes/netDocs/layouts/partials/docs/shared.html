{{/*These templates contains some more complex logic and shared between partials*/}}
{{ define "title" }}
  {{ if and .IsSection .File }}
    {{ $sections := split (trim .File.Dir "/") "/" }}
    {{ $title := index ($sections | last 1) 0 | humanize | title }}
    {{ default $title .Title }}
  {{ else if and .IsPage .File }}
    {{ $title := .File.BaseFileName | humanize | title }}
    {{ default $title .Title }}
  {{ else }}
    {{ .Title }}
  {{ end }}
{{ end }}

{{ define "hrefhack" }}
  {{ $attrEq := "$=" }}
  {{ $attrVal := .RelPermalink }}
  {{ if eq .RelPermalink "/" }}
    {{ $attrEq = "=" }}
    {{ $attrVal = .Permalink }}
  {{ end }}

  <style>
  nav ul a[href{{ $attrEq }}"{{ $attrVal }}"] {
      color: {{ default "#004ed0" .Site.Params.BookMenuBundleActiveLinkColor }};
  }
  </style>
{{ end }}

{{ define "jsmenu" }}
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>
{{ end }}


{{ define "jscollapse"}}
<script>

let elesSections = document.querySelectorAll('.cn-book-section-container')
elesSections.forEach(node => {
  if(node.querySelector('.active') != null){
    node.setAttribute('class', '.cn-book-section-container disp')
  }else{
    node.setAttribute('class', '.cn-book-section-container hide')
  }

  if(node.parentNode.querySelector('.active') != null){
    node.setAttribute('class', '.cn-book-section-container disp')
  }


  eleToggler = document.createElement('input')
  eleToggler.setAttribute('type', 'checkbox')
  eleToggler.setAttribute('class', 'menuCollapse')

  eleToggler.addEventListener('click', function(event){

    if(node.getAttribute('class') == '.cn-book-section-container hide'){
      node.setAttribute('class', '.cn-book-section-container disp')
    }else if(node.getAttribute('class') == '.cn-book-section-container disp'){
      node.setAttribute('class', '.cn-book-section-container hide')
    }
  })
  let par = node.parentNode
  let lnk = par.querySelector('a')
  if(par.tagName == 'LI'){
    par.insertBefore(eleToggler, lnk)
  }
})




</script>
{{ end }}
