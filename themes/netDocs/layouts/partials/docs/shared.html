{{/*These templates contains some more complex logic and shared between partials*/}}
{{ define "title" }}
  {{ if and .IsSection .File }}
    {{ $sections := split (trim .File.Dir "/") "/" }}
    {{ $title := index ($sections | last 1) 0 | humanize | title }}
    {{ default $title .Title }}
  {{ else if and .IsPage .File }}
    {{ $title := .File.BaseFileName | humanize | title }}
    {{ default $title .Title }}
  {{ else }}
    {{ .Title }}
  {{ end }}
{{ end }}

{{ define "hrefhack" }}
  {{ $attrEq := "$=" }}
  {{ $attrVal := .RelPermalink }}
  {{ if eq .RelPermalink "/" }}
    {{ $attrEq = "=" }}
    {{ $attrVal = .Permalink }}
  {{ end }}

  <style>
  nav ul a[href{{ $attrEq }}"{{ $attrVal }}"] {
      color: {{ default "#004ed0" .Site.Params.BookMenuBundleActiveLinkColor }};
  }
  </style>
{{ end }}

{{ define "jsmenu" }}
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>
{{ end }}


{{ define "jscollapse"}}
<script>


let elesSections = document.querySelectorAll('.cn-book-section-container')
elesSections.forEach(node => {
  if(node.querySelector('.active') != null){
    node.setAttribute('class', '.cn-book-section-container expand')
  }else{
    node.setAttribute('class', '.cn-book-section-container collapse')
  }

  if(node.parentNode.querySelector('.active') != null){
    node.setAttribute('class', '.cn-book-section-container expand')
  }


  eleToggler = document.createElement('input')
  eleToggler.setAttribute('type', 'image')
  eleToggler.setAttribute('class', 'menuControl')
  eleToggler.setAttribute('src', "/icons/baseline-expand_more.svg")

  eleToggler.addEventListener('click', function(event){

    if(node.getAttribute('class') == '.cn-book-section-container collapse'){
      this.setAttribute('src', "/icons/baseline-expand_less.svg")
      node.setAttribute('class', '.cn-book-section-container expand')
    }else if(node.getAttribute('class') == '.cn-book-section-container expand'){
      node.setAttribute('class', '.cn-book-section-container collapse')
      this.setAttribute('src', "/icons/baseline-expand_more.svg")

    }
  })

  if(node.querySelector('a') == null){
    eleToggler.setAttribute('class', 'menuControl empty')
  }

  let par = node.parentNode
  let lnk = par.querySelector('a')
  if(par.tagName == 'LI'){
    par.insertBefore(eleToggler, lnk)
  }
})
</script>
{{ end }}

{{ define "headerBehavior" }}
<script>
  // Not sure what this is
  function ShowHideBurger() {
    if($('.burger-menu-items').hasClass('active1')) {
      $('.burger-menu-items').removeClass('active1').hide();
      $('.burger-lines').removeClass('open');
    }else {
      $('.burger-menu-items').addClass('active1').show();
      $('.burger-lines').addClass('open');
    }
  }

  (function() {
    window.addEventListener('scroll', function(event) {

      document.querySelector('.header-wrapper').
    });
    menu.scrollTop = localStorage.getItem('menu.scrollTop')
  })()



  $(document).ready(function(){

    // Give the mobile and tablet navbar a black background when the user scrolls down
    $(window).scroll(function () {
      if ( $(window).scrollTop() > 0 ) {
        $('.header-wrapper').addClass('scrolling');
      } else {
        $('.header-wrapper').removeClass('scrolling');
        console.log($(window).scrollTop())
      }
    });

  });
</script>
{{ end }}
